"use strict";(self.webpackChunksasuga_admin=self.webpackChunksasuga_admin||[]).push([[281],{5841:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var s=n(4165),r=n(5861),a=n(1413),o=n(9439),i=n(2791),c=n(4),u=(n(9954),n(6407)),l=n(7039),d=n.p+"static/media/image_audio_call_start.74e98228a4edc883018a.png",h=n.p+"static/media/image_video_call.7523180027a4a659b3e4.png",p=n(2481),m=n(1095),f=n(6910),g=n(184);function x(e){var t=e.message,n=(0,f.F_)(m.I8),s=(0,o.Z)(n,1)[0];return(0,g.jsx)("div",{className:"chat-bubble ".concat(t.sender===s.uid?"right":"left"),children:(0,g.jsx)("div",{className:"chat-bubble__right",children:(0,g.jsx)("p",{className:"user-message",children:t.message})})})}var v=n(9230);function b(e){var t=e.selectedChat,n=e.spanRef,a=e.userFCMTOken,c=(0,v.$G)().t,u=(0,i.useState)(""),l=(0,o.Z)(u,2),d=l[0],h=l[1],x=(0,i.useState)("45px"),b=(0,o.Z)(x,2),j=b[0],w=b[1],Z=(0,f.F_)(m.I8),y=(0,o.Z)(Z,1)[0],C=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(r){var o,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),""!==d.trim()){e.next=4;break}return alert("Enter valid message"),e.abrupt("return");case 4:return o=(0,p.JU)(m.db,"chatroom",y.uid,"chats",t.selectedUser),e.next=7,(0,p.r7)(o,{app_message_count:(0,p.nP)(1)});case 7:return console.log(a),fetch("https://us-central1-sasuga-d222e.cloudfunctions.net/sendNotification",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:d,registrationToken:a,title:"Admin",image:"",mobile_number:"",email:""})}).then((function(e){if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){console.log(e)})).catch((function(e){console.error(e)})),i=(0,p.hJ)(m.db,"chatroom/".concat(y.uid,"/chats/").concat(t.selectedUser,"/messages")),e.next=12,(0,p.ET)(i,{message:d,createdAt:(0,p.Bt)(),sender:y.uid});case 12:h(""),n.current.scrollIntoView({behavior:"smooth"});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){0===d.length&&w("45px")}),[d]);return(0,g.jsxs)("form",{onSubmit:function(e){return C(e)},className:"send-message",children:[(0,g.jsx)("label",{htmlFor:"messageInput",hidden:!0,children:c("EnterMessage.EnterMessage")}),(0,g.jsx)("textarea",{id:"messageInput",name:"messageInput",type:"text",className:"form-input__input send-message-text-area",placeholder:"type message...",value:d,style:{width:"530px",padding:"10px",borderRadius:"21px",height:j},onKeyDown:function(e){e.target.scrollHeight<100&&w(e.target.scrollHeight),13===e.keyCode&&!1===e.shiftKey&&(e.preventDefault(),C(e),w("45px"))},onChange:function(e){return h(e.target.value)}})]})}var j=n(7948),w=n.n(j),Z=document.getElementById("root");w().setAppElement(Z);var y={overlay:{zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},content:{maxWidth:"100%",width:"100%",border:"none",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"}},C=function(e){var t=e.selectedChat,n=e.userFCMTOken,l=e.userTitle,v=e.userEmailAudio,j=e.userPhoneNumberAudio,Z=e.userImageAudio,C=(0,i.useState)([]),N=(0,o.Z)(C,2),k=N[0],_=N[1],S=(0,i.useState)(!1),E=(0,o.Z)(S,2),A=E[0],I=E[1],T=(0,i.useState)("Audio"),U=(0,o.Z)(T,2),O=U[0],J=U[1],P=(0,i.useRef)(null),V=(0,f.F_)(m.I8),F=(0,o.Z)(V,1)[0],M=(0,i.useState)(!1),R=(0,o.Z)(M,2),L=R[0],D=R[1];(0,i.useEffect)((function(){if(F){var e=(0,p.IO)((0,p.hJ)(m.db,"chatroom/"+F.uid+"/chats/"+t.selectedUser+"/messages")),n=(0,p.cf)(e,(function(e){var t=[];e.forEach((function(e){t.push((0,a.Z)((0,a.Z)({},e.data()),{},{id:e.id}))}));var n=t.sort((function(e,t){return e.createdAt-t.createdAt}));_(n),P.current&&P.current.scrollIntoView({behavior:"smooth"})}));return function(){return n}}}),[F,t]),(0,i.useEffect)((function(){P.current&&P.current.scrollIntoView({behavior:"smooth"})}),[k]);var H=function(e){A&&!e.target.closest(".your-modal-class")&&I(!1)};(0,i.useEffect)((function(){return A?document.addEventListener("mousedown",H):document.removeEventListener("mousedown",H),function(){document.removeEventListener("mousedown",H)}}),[A]);var G=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(r){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:return a=(0,p.JU)(m.db,"chatroom",F.uid,"chats",t.selectedUser),e.next=9,(0,p.r7)(a,{app_call_count:(0,p.nP)(1)});case 9:J(r),fetch("https://us-central1-sasuga-d222e.cloudfunctions.net/sendNotification",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:r,registrationToken:n,title:"Admin",image:"",mobile_number:"",email:""})}).then((function(e){if(console.log("responseresponse",e),!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){I(!1),q(),console.log("Notification send ",e)})).catch((function(e){console.error(e)})),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),alert("Please allow Microphone permission"),e.abrupt("return");case 17:e.next=23;break;case 19:return e.prev=19,e.t1=e.catch(0),alert("Please allow Camera permission"),e.abrupt("return");case 23:case"end":return e.stop()}}),e,null,[[0,19],[3,13]])})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.JU)(m.db,"call","hO01sqCg552JEdhQMGae"),e.next=3,(0,p.pl)(t,{isCalling:!0},{merge:!0}).then(function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Call popup done start");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:D(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,g.jsxs)("div",{className:"w-full pt-[10px] overflow-y-scroll",style:{height:"calc(100% - 62px)"},children:[(0,g.jsx)("div",{onClick:function(){I(!0)},className:"right",style:{marginLeft:"auto",cursor:"pointer",position:"absolute",right:"35px",top:"-43px",zIndex:99},children:(0,g.jsx)(c.Kt,{})}),(0,g.jsxs)("div",{style:{flexDirection:"column",height:"100%"},className:"flex h-[89vh] video",children:[k&&(0,g.jsxs)(g.Fragment,{children:[null===k||void 0===k?void 0:k.map((function(e){return(0,g.jsx)(x,{message:e},e.id)})),(0,g.jsx)("span",{ref:P,onLoad:void(P.current&&P.current.scrollIntoView({behavior:"smooth"}))})]}),(0,g.jsx)(b,{selectedChat:t,userFCMTOken:n,spanRef:P})]}),(0,g.jsx)(w(),{style:y,isOpen:A,onRequestClose:function(){return I(!1)},children:(0,g.jsxs)("div",{className:"your-modal-class",style:{width:"20%",borderRadius:20,padding:15,backgroundColor:"#fff"},children:[(0,g.jsx)("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:17},children:"Call Type"}),(0,g.jsxs)("div",{style:{display:"flex",marginTop:20,justifyContent:"space-around",alignItems:"center"},children:[(0,g.jsx)("img",{src:d,onClick:function(){return G("Audio")},style:{cursor:"pointer",height:60,width:60}}),(0,g.jsx)("img",{src:h,onClick:function(){return G("Video")},style:{cursor:"pointer",height:60,width:60}})]})]})}),L&&(0,g.jsxs)("div",{className:"flex  gap-3 pr-2 chat-cont",children:[(0,g.jsx)("div",{className:"h-screen md:min-w-[280px] px-2 py-3"}),(0,g.jsx)(u.Z,{title:l,videoCall:L,userImageAudio:Z,userEmailAudio:v,userPhoneNumberAudio:j,setVideoCall:D,callType:O})]})]})},N=(n(6954),n(7689)),k=n(3016),_=n(8660),S=n(440),E=(n(2426),n(7159),function(){var e=(0,f.F_)(m.I8),t=(0,o.Z)(e,1)[0],n=(0,i.useState)([]),d=(0,o.Z)(n,2),h=d[0],x=d[1],v=(0,i.useState)(""),b=(0,o.Z)(v,2),j=b[0],w=b[1],Z=(0,i.useState)([]),y=(0,o.Z)(Z,2),E=(y[0],y[1],(0,i.useState)("")),A=(0,o.Z)(E,2),I=A[0],T=A[1],U=(0,i.useState)(""),O=(0,o.Z)(U,2),J=O[0],P=O[1],V=(0,i.useState)(""),F=(0,o.Z)(V,2),M=F[0],R=F[1],L=(0,i.useState)(""),D=(0,o.Z)(L,2),H=D[0],G=D[1],q=(0,i.useState)(""),z=(0,o.Z)(q,2),B=z[0],K=z[1],Q=(0,i.useState)(null),W=(0,o.Z)(Q,2),$=W[0],X=W[1],Y=(0,i.useState)(!1),ee=(0,o.Z)(Y,2),te=ee[0],ne=ee[1],se=(0,i.useState)(!1),re=(0,o.Z)(se,2),ae=re[0],oe=re[1],ie=(0,i.useState)("Audio"),ce=(0,o.Z)(ie,2),ue=ce[0],le=ce[1],de=(0,i.useState)(""),he=(0,o.Z)(de,2),pe=he[0],me=he[1],fe=(0,i.useState)(""),ge=(0,o.Z)(fe,2),xe=ge[0],ve=ge[1],be=(0,i.useState)(""),je=(0,o.Z)(be,2),we=je[0],Ze=je[1],ye=(0,i.useState)(""),Ce=(0,o.Z)(ye,2),Ne=Ce[0],ke=Ce[1],_e=(0,i.useState)(""),Se=(0,o.Z)(_e,2),Ee=Se[0],Ae=Se[1],Ie=(0,i.useState)(!1),Te=(0,o.Z)(Ie,2),Ue=Te[0],Oe=Te[1];(0,i.useEffect)((function(){if(t){var e=(0,p.IO)((0,p.hJ)(m.db,"chatroom/"+t.uid+"/chats")),n=(0,p.cf)(e,(function(e){var t=[];e.forEach((function(e){t.push((0,a.Z)((0,a.Z)({},e.data()),{},{id:e.id}))})),x(t)}));return function(){return n}}}),[t]);var Je=(0,N.TH)(),Pe=Je.state;(0,i.useEffect)((function(){null!==Pe&&(me(Pe.name),ve(Pe.email),Ze(Pe.phoneNumber),ke(Pe.image),oe(Pe.toggleVideo),X(Pe.open)),le(null==Pe?"Audio":Pe.typeAudioVideo)}),[Je]),(0,i.useEffect)((function(){var e="hO01sqCg552JEdhQMGae",t=(0,p.cf)((0,p.JU)(m.db,"call",e),function(){var t=(0,r.Z)((0,s.Z)().mark((function t(n){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=n.data())){t.next=7;break}if(!0===a.isReceiving&&Oe(!0),!1===a.isCalling&&(oe(!1),X(!1)),!a.isCancelled){t.next=7;break}return t.next=7,(0,p.pl)((0,p.JU)(m.db,"call",e),{isCalling:!1,isReceiving:!1,isCancelled:!1,callType:""},{merge:!0}).then(function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Call cancelled."),window.location.reload();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());return function(){return t}}),[]);var Ve=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,p.JU)(m.db,"chatroom",t.uid,"chats",n),e.next=3,(0,p.pl)(a,{web_call_count:0,web_message_count:0},{merge:!0}).then(function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("counts reset");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return console.log("videoddsssss",te),console.log("chatschatschatschatschats",$),(0,g.jsxs)("div",{className:"flex justify-between gap-3 pr-2 chat-cont",children:[(0,g.jsx)("div",{className:"border border-[#E2E2E2] h-screen md:min-w-[280px] px-2 py-3",children:(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"relative mt-2 flex items-center",children:[(0,g.jsx)("div",{className:"absolute inset-y-0 -top-1.5 left-1.5 flex py-1.5 pr-1.5 text-gray",children:(0,g.jsx)(c.ol,{})}),(0,g.jsx)("input",{type:"text",name:"search",id:"search",onChange:function(e){return Ae(e.target.value)},className:"block w-full rounded-md py-1.5 pl-10 border border-gray focus:outline-none"})]}),(0,g.jsx)("div",{className:"mt-[17px] [&>*:nth-child(1)]:mt-0",children:h.filter((function(e){return e.name.toLowerCase().includes(Ee.toLowerCase())})).map((function(e,t){return(0,g.jsxs)("div",{onClick:function(){return t=e,console.log("evnt.phoneevnt.phoneevnt.phone",t.phone),T(t.fcm_token),P(t.name),G(t.phone),K(t.photoUrl),R(t.email),w(t.id),void Ve(t.id);var t},className:"chat-item",id:e.id,children:[(0,g.jsxs)("div",{className:"relative rounded w-full h-[56px] pl-4 py-1 flex items-center gap-3 rounded-b-none mt-2 ".concat(j==e.id?"bg-gray50":""),children:[(0,g.jsx)("div",{className:"h-[48px] w-[48px] rounded-full border border-lightblue overflow-hidden",children:""!==e.photoUrl?(0,g.jsx)("img",{src:e.photoUrl,alt:"",className:"w-full h-full object-cover"}):(0,g.jsx)("img",{src:S,alt:"",className:"w-full h-full object-cover"})}),(0,g.jsxs)("div",{className:"text-darkBlack",children:[(0,g.jsxs)("h2",{className:"font-[700] text-base leading-5",children:[e.name,","," ",(0,g.jsx)("span",{className:"font-[400] hidden md:block",children:e.phone?e.phone:e.email})]}),(0,g.jsx)("p",{className:"hidden md:block",children:e.location})]}),(0,g.jsxs)("div",{className:"chat-notification-cont",children:[e.web_call_count>0&&(0,g.jsxs)("span",{className:"alertCounts",children:[(0,g.jsx)("span",{className:"numbers",children:e.web_call_count}),(0,g.jsx)("img",{src:k,alt:"messages"})]}),e.web_message_count>0&&(0,g.jsxs)("span",{className:"alertCounts",children:[(0,g.jsx)("span",{className:"numbers",children:e.web_message_count}),(0,g.jsx)("img",{src:_,alt:"messages"})]})]})]}),(0,g.jsx)("span",{className:"block h-[1px] borderGradient w-full mt-[4.5px]"})]},e.id)}))})]})}),$&&(0,g.jsx)(l.Z,{title:pe,userImageChatSection:Ne,toggleVideo:ae,settoggleVideo:oe,open:$,setOpen:X,userPhoneNumber:we,userEmail:xe,setVideoCall:ne,setIsReceiving:Oe}),te&&(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(u.Z,{userImageAudio:B,userEmailAudio:M,userPhoneNumberAudio:H,title:pe,videoCall:te,setVideoCall:ne,callType:ue,isReceivings:Ue})}),j&&(0,g.jsx)(C,{userImageAudio:B,userTitle:J,userPhoneNumberAudio:H,userEmailAudio:M,userFCMTOken:I,selectedChat:{selectedUser:j}})]})})}}]);
//# sourceMappingURL=281.4f1cb3f2.chunk.js.map
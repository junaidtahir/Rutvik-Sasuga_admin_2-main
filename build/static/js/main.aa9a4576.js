/*! For license information please see main.aa9a4576.js.LICENSE.txt */
(function(){var __webpack_modules__={1095:function(e,t,n){"use strict";n.d(t,{I8:function(){return ge},db:function(){return ye},Fw:function(){return _e},NI:function(){return Ee}});var r=n(4165),i=n(5861),a=n(7825);(0,a.KN)("firebase","10.4.0","app");var o,s=n(9439),c=n(7762),u=n(5671),l=n(3144),d=n(4942),f=n(6781),p=n(5854),h=n(3258),v=(n(6463),"analytics"),m="firebase_id",g="origin",y=6e4,_="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",E="https://www.googletagmanager.com/gtag/js",b=new f.Yd("@firebase/analytics"),w=(o={},(0,d.Z)(o,"already-exists","A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId."),(0,d.Z)(o,"already-initialized","initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance."),(0,d.Z)(o,"already-initialized-settings","Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect."),(0,d.Z)(o,"interop-component-reg-failed","Firebase Analytics Interop Component failed to instantiate: {$reason}"),(0,d.Z)(o,"invalid-analytics-context","Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}"),(0,d.Z)(o,"indexeddb-unavailable","IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}"),(0,d.Z)(o,"fetch-throttle","The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}."),(0,d.Z)(o,"config-fetch-failed","Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}"),(0,d.Z)(o,"no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.'),(0,d.Z)(o,"no-app-id",'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'),(0,d.Z)(o,"no-client-id",'The "client_id" field is empty.'),(0,d.Z)(o,"invalid-gtag-resource","Trusted Types detected an invalid gtag resource: {$gtagURL}."),o),S=new p.LL("analytics","Analytics",w);function k(e){if(!e.startsWith(E)){var t=S.create("invalid-gtag-resource",{gtagURL:e});return b.warn(t.message),""}return e}function T(e){return Promise.all(e.map((function(e){return e.catch((function(e){return e}))})))}function I(e,t){var n=function(e,t){var n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:k}),r=document.createElement("script"),i="".concat(E,"?l=").concat(e,"&id=").concat(t);r.src=n?null===n||void 0===n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function C(e,t,n,r,i,a){return R.apply(this,arguments)}function R(){return R=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a,o,s){var c,u,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a[o],e.prev=1,!c){e.next=7;break}return e.next=5,n[c];case 5:e.next=14;break;case 7:return e.next=9,T(i);case 9:if(u=e.sent,!(l=u.find((function(e){return e.measurementId===o})))){e.next=14;break}return e.next=14,n[l.appId];case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),b.error(e.t0);case 19:t("config",o,s);case 20:case"end":return e.stop()}}),e,null,[[1,16]])}))),R.apply(this,arguments)}function A(e,t,n,r,i){return O.apply(this,arguments)}function O(){return O=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a,o){var s,u,l,d,f,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=[],!o||!o.send_to){e.next=26;break}return u=o.send_to,Array.isArray(u)||(u=[u]),e.next=7,T(i);case 7:l=e.sent,d=(0,c.Z)(u),e.prev=9,p=(0,r.Z)().mark((function e(){var t,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,i=l.find((function(e){return e.measurementId===t})),!(a=i&&n[i.appId])){e.next=7;break}s.push(a),e.next=9;break;case 7:return s=[],e.abrupt("return",1);case 9:case"end":return e.stop()}}),e)})),d.s();case 12:if((f=d.n()).done){e.next=18;break}return e.delegateYield(p(),"t0",14);case 14:if(!e.t0){e.next=16;break}return e.abrupt("break",18);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(9),d.e(e.t1);case 23:return e.prev=23,d.f(),e.finish(23);case 26:return 0===s.length&&(s=Object.values(n)),e.next=29,Promise.all(s);case 29:t("event",a,o||{}),e.next=35;break;case 32:e.prev=32,e.t2=e.catch(0),b.error(e.t2);case 35:case"end":return e.stop()}}),e,null,[[0,32],[9,20,23,26]])}))),O.apply(this,arguments)}function N(e,t,n,a,o){var s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window[a].push(arguments)};return window[o]&&"function"===typeof window[o]&&(s=window[o]),window[o]=function(e,t,n,a){function o(){return o=(0,i.Z)((0,r.Z)().mark((function i(o){var s,c,u,l,d,f,p,h,v,m,g,y,_=arguments;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(r.prev=0,s=_.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=_[u];if("event"!==o){r.next=8;break}return l=c[0],d=c[1],r.next=6,A(e,t,n,l,d);case 6:r.next=15;break;case 8:if("config"!==o){r.next=14;break}return f=c[0],p=c[1],r.next=12,C(e,t,n,a,f,p);case 12:r.next=15;break;case 14:"consent"===o?(h=c[0],e("consent","update",h)):"get"===o?(v=c[0],m=c[1],g=c[2],e("get",v,m,g)):"set"===o?(y=c[0],e("set",y)):e.apply(void 0,[o].concat(c));case 15:r.next=20;break;case 17:r.prev=17,r.t0=r.catch(0),b.error(r.t0);case 20:case"end":return r.stop()}}),i,null,[[0,17]])}))),o.apply(this,arguments)}return function(e){return o.apply(this,arguments)}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[o]}}function x(e){for(var t=window.document.getElementsByTagName("script"),n=0,r=Object.values(t);n<r.length;n++){var i=r[n];if(i.src&&i.src.includes(E)&&i.src.includes(e))return i}return null}var D=30,P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;(0,u.Z)(this,e),this.throttleMetadata=t,this.intervalMillis=n}return(0,l.Z)(e,[{key:"getThrottleMetadata",value:function(e){return this.throttleMetadata[e]}},{key:"setThrottleMetadata",value:function(e,t){this.throttleMetadata[e]=t}},{key:"deleteThrottleMetadata",value:function(e){delete this.throttleMetadata[e]}}]),e}(),L=new P;function M(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function U(e){return j.apply(this,arguments)}function j(){return(j=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,s,c,u,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.appId,a=t.apiKey,o={method:"GET",headers:M(a)},s=_.replace("{app-id}",i),e.next=5,fetch(s,o);case 5:if(200===(c=e.sent).status||304===c.status){e.next=18;break}return u="",e.prev=8,e.next=11,c.json();case 11:l=e.sent,(null===(n=l.error)||void 0===n?void 0:n.message)&&(u=l.error.message),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(8);case 17:throw S.create("config-fetch-failed",{httpStatus:c.status,responseMessage:u});case 18:return e.abrupt("return",c.json());case 19:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function F(e){return V.apply(this,arguments)}function V(){return V=(0,i.Z)((0,r.Z)().mark((function e(t){var n,a,o,s,c,u,l,d,f=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:L,a=f.length>2?f[2]:void 0,o=t.options,s=o.appId,c=o.apiKey,u=o.measurementId,s){e.next=5;break}throw S.create("no-app-id");case 5:if(c){e.next=9;break}if(!u){e.next=8;break}return e.abrupt("return",{measurementId:u,appId:s});case 8:throw S.create("no-api-key");case 9:return l=n.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},d=new K,setTimeout((0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.abort();case 1:case"end":return e.stop()}}),e)}))),void 0!==a?a:y),e.abrupt("return",B({appId:s,apiKey:c,measurementId:u},l,d,n));case 13:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function B(e,t,n){return G.apply(this,arguments)}function G(){return G=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){var a,o,s,c,u,l,d,f,h,v,m=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.throttleEndTimeMillis,o=n.backoffCount,s=m.length>3&&void 0!==m[3]?m[3]:L,u=t.appId,l=t.measurementId,e.prev=3,e.next=6,Z(i,a);case 6:e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(3),!l){e.next=13;break}return b.warn("Timed out fetching this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,"]")),e.abrupt("return",{appId:u,measurementId:l});case 13:throw e.t0;case 14:return e.prev=14,e.next=17,U(t);case 17:return d=e.sent,s.deleteThrottleMetadata(u),e.abrupt("return",d);case 22:if(e.prev=22,e.t1=e.catch(14),q(f=e.t1)){e.next=33;break}if(s.deleteThrottleMetadata(u),!l){e.next=32;break}return b.warn("Failed to fetch this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===f||void 0===f?void 0:f.message,"]")),e.abrupt("return",{appId:u,measurementId:l});case 32:throw e.t1;case 33:return h=503===Number(null===(c=null===f||void 0===f?void 0:f.customData)||void 0===c?void 0:c.httpStatus)?(0,p.$s)(o,s.intervalMillis,D):(0,p.$s)(o,s.intervalMillis),v={throttleEndTimeMillis:Date.now()+h,backoffCount:o+1},s.setThrottleMetadata(u,v),b.debug("Calling attemptFetch again in ".concat(h," millis")),e.abrupt("return",B(t,v,i,s));case 38:case"end":return e.stop()}}),e,null,[[3,8],[14,22]])}))),G.apply(this,arguments)}function Z(e,t){return new Promise((function(n,r){var i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener((function(){clearTimeout(a),r(S.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}function q(e){if(!(e instanceof p.ZR)||!e.customData)return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}var W,H,K=function(){function e(){(0,u.Z)(this,e),this.listeners=[]}return(0,l.Z)(e,[{key:"addEventListener",value:function(e){this.listeners.push(e)}},{key:"abort",value:function(){this.listeners.forEach((function(e){return e()}))}}]),e}();function z(){return(z=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a,o){var s,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!o.global){e.next=5;break}return t("event",i,a),e.abrupt("return");case 5:return e.next=7,n;case 7:s=e.sent,c=Object.assign(Object.assign({},a),{send_to:s}),t("event",i,c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){H=e}function J(e){W=e}function X(){return Q.apply(this,arguments)}function Q(){return(Q=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,p.hl)()){e.next=5;break}return b.warn(S.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),e.abrupt("return",!1);case 5:return e.prev=5,e.next=8,(0,p.eu)();case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(5),b.warn(S.create("indexeddb-unavailable",{errorInfo:null===e.t0||void 0===e.t0?void 0:e.t0.toString()}).message),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,null,[[5,10]])})))).apply(this,arguments)}function $(){return $=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a,o,c,u){var l,d,f,p,h,v,y,_;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(d=F(t)).then((function(e){i[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&b.warn("The measurement ID in the local Firebase config (".concat(t.options.measurementId,")")+" does not match the measurement ID fetched from the server (".concat(e.measurementId,").")+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")})).catch((function(e){return b.error(e)})),n.push(d),f=X().then((function(e){return e?a.getId():void 0})),e.next=6,Promise.all([d,f]);case 6:return p=e.sent,h=(0,s.Z)(p,2),v=h[0],y=h[1],x(c)||I(c,v.measurementId),H&&(o("consent","default",H),Y(void 0)),o("js",new Date),(_=null!==(l=null===u||void 0===u?void 0:u.config)&&void 0!==l?l:{})[g]="firebase",_.update=!0,null!=y&&(_[m]=y),o("config",v.measurementId,_),W&&(o("set",W),J(void 0)),e.abrupt("return",v.measurementId);case 20:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}var ee,te,ne=function(){function e(t){(0,u.Z)(this,e),this.app=t}return(0,l.Z)(e,[{key:"_delete",value:function(){return delete re[this.app.options.appId],Promise.resolve()}}]),e}(),re={},ie=[],ae={},oe="dataLayer",se="gtag",ce=!1;function ue(e,t,n){!function(){var e=[];if((0,p.ru)()&&e.push("This is a browser extension environment."),(0,p.zI)()||e.push("Cookies are not available."),e.length>0){var t=e.map((function(e,t){return"(".concat(t+1,") ").concat(e)})).join(" "),n=S.create("invalid-analytics-context",{errorInfo:t});b.warn(n.message)}}();var r=e.options.appId;if(!r)throw S.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw S.create("no-api-key");b.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+" measurement ID for this Firebase app. Falling back to the measurement ID ".concat(e.options.measurementId)+' provided in the "measurementId" field in the local Firebase config.')}if(null!=re[r])throw S.create("already-exists",{id:r});if(!ce){!function(e){var t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(oe);var i=N(re,ie,ae,oe,se),a=i.wrappedGtag,o=i.gtagCore;te=a,ee=o,ce=!0}return re[r]=function(e,t,n,r,i,a,o){return $.apply(this,arguments)}(e,ie,ae,t,ee,oe,n),new ne(e)}function le(e,t,n,r){e=(0,p.m9)(e),function(e,t,n,r,i){return z.apply(this,arguments)}(te,re[e.app.options.appId],t,n,r).catch((function(e){return b.error(e)}))}var de="@firebase/analytics",fe="0.10.0";(0,a.Xd)(new h.wA(v,(function(e,t){var n=t.options;return ue(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),n)}),"PUBLIC")),(0,a.Xd)(new h.wA("analytics-internal",(function(e){try{var t=e.getProvider(v).getImmediate();return{logEvent:function(e,n,r){return le(t,e,n,r)}}}catch(n){throw S.create("interop-component-reg-failed",{reason:n})}}),"PRIVATE")),(0,a.KN)(de,fe),(0,a.KN)(de,fe,"esm2017");var pe=n(6635),he=n(2481),ve=n(6954),me=(0,a.ZF)({apiKey:"AIzaSyCQ9XQ9lf0ADR329-nd1IgD3C5CCnGJtnw",authDomain:"sasuga-d222e.firebaseapp.com",projectId:"sasuga-d222e",storageBucket:"sasuga-d222e.appspot.com",messagingSenderId:"451516213776",appId:"1:451516213776:web:c9742cb3eb5236bbd7b895",measurementId:"G-27TMFDSPBZ"}),ge=(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.Mq)();e=(0,p.m9)(e);var t=(0,a.qX)(e,v);t.isInitialized()?t.getImmediate():function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,a.qX)(e,v);if(n.isInitialized()){var r=n.getImmediate();if((0,p.vZ)(t,n.getOptions()))return r;throw S.create("already-initialized")}var i=n.initialize({options:t})}(e)}(me),(0,pe.v0)(me)),ye=(0,he.ad)(me),_e=(0,ve.KL)(),Ee=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ve.LP)(_e,{vapidKey:"BO_pl85MXO5Bj3S9aTK2jm5sL8lBXnN2-zcRNHm_HNt6eQmE5KC0vMLeDpIuR8h3WY-1bMOhW8vsVG72loSQgiQ"});case 3:if(!(t=e.sent)){e.next=21;break}return console.log("Current token for client: ",t),n=(0,he.JU)(ye,"admin","TLEgZhqA6Mh4N1uhc6cguKmMoI63"),e.next=9,(0,he.QT)(n);case 9:if(!e.sent.exists()){e.next=16;break}return e.next=13,(0,he.r7)(n,{token:t,timestamp:new Date});case 13:console.log("Token document updated with ID: TLEgZhqA6Mh4N1uhc6cguKmMoI63"),e.next=19;break;case 16:return e.next=18,(0,he.pl)(n,{id:"TLEgZhqA6Mh4N1uhc6cguKmMoI63",token:t,timestamp:new Date});case 18:console.log("Token document added with ID: TLEgZhqA6Mh4N1uhc6cguKmMoI63");case 19:e.next=22;break;case 21:console.log("No registration token available. Request permission to generate one.");case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("An error occurred while retrieving or storing the token: ",e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(){return e.apply(this,arguments)}}()},9954:function(e,t,n){"use strict";n.d(t,{Z:function(){return Be}});var r=n(4165),i=n(5861),a=n(9439),o=n(2791),s=n(168),c=n(3433),u=n(1413),l=n(4942),d={data:""},f=function(e){return"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||d},p=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,h=/\/\*[^]*?\*\/|  +/g,v=/\n+/g,m=function e(t,n){var r="",i="",a="",o=function(o){var s=t[o];"@"==o[0]?"i"==o[1]?r=o+" "+s+";":i+="f"==o[1]?e(s,o):o+"{"+e(s,"k"==o[1]?"":n)+"}":"object"==typeof s?i+=e(s,n?n.replace(/([^,])+/g,(function(e){return o.replace(/(^:.*)|([^,])+/g,(function(t){return/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t}))})):o):null!=s&&(o=/^--/.test(o)?o:o.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=e.p?e.p(o,s):o+":"+s+";")};for(var s in t)o(s);return r+(n&&a?n+"{"+a+"}":a)+i},g={},y=function e(t){if("object"==typeof t){var n="";for(var r in t)n+=r+e(t[r]);return n}return t},_=function(e,t,n,r,i){var a=y(e),o=g[a]||(g[a]=function(e){for(var t=0,n=11;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n}(a));if(!g[o]){var s=a!==e?e:function(e){for(var t,n,r=[{}];t=p.exec(e.replace(h,""));)t[4]?r.shift():t[3]?(n=t[3].replace(v," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(v," ").trim();return r[0]}(e);g[o]=m(i?(0,l.Z)({},"@keyframes "+o,s):s,n?"":"."+o)}var c=n&&g.g?g.g:null;return n&&(g.g=g[o]),function(e,t,n,r){r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)}(g[o],t,r,c),o},E=function(e,t,n){return e.reduce((function(e,r,i){var a=t[i];if(a&&a.call){var o=a(n),s=o&&o.props&&o.props.className||/^go/.test(o)&&o;a=s?"."+s:o&&"object"==typeof o?o.props?"":m(o,""):!1===o?"":o}return e+r+(null==a?"":a)}),"")};function b(e){var t=this||{},n=e.call?e(t.p):e;return _(n.unshift?n.raw?E(n,[].slice.call(arguments,1),t.p):n.reduce((function(e,n){return Object.assign(e,n&&n.call?n(t.p):n)}),{}):n,f(t.target),t.g,t.o,t.k)}b.bind({g:1});var w,S,k,T,I,C,R,A,O,N,x,D,P,L,M,U,j,F,V,B=b.bind({k:1});function G(e,t){var n=this||{};return function(){var r=arguments;function i(a,o){var s=Object.assign({},a),c=s.className||i.className;n.p=Object.assign({theme:S&&S()},s),n.o=/ *go\d+/.test(c),s.className=b.apply(n,r)+(c?" "+c:""),t&&(s.ref=o);var u=e;return e[0]&&(u=s.as||e,delete s.as),k&&u[0]&&k(s),w(u,s)}return t?t(i):i}}var Z=function(e,t){return function(e){return"function"==typeof e}(e)?e(t):e},q=function(){var e=0;return function(){return(++e).toString()}}(),W=function(){var e;return function(){if(void 0===e&&typeof window<"u"){var t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}}(),H=new Map,K=function(e){if(!H.has(e)){var t=setTimeout((function(){H.delete(e),X({type:4,toastId:e})}),1e3);H.set(e,t)}},z=function e(t,n){switch(n.type){case 0:return(0,u.Z)((0,u.Z)({},t),{},{toasts:[n.toast].concat((0,c.Z)(t.toasts)).slice(0,20)});case 1:return n.toast.id&&function(e){var t=H.get(e);t&&clearTimeout(t)}(n.toast.id),(0,u.Z)((0,u.Z)({},t),{},{toasts:t.toasts.map((function(e){return e.id===n.toast.id?(0,u.Z)((0,u.Z)({},e),n.toast):e}))});case 2:var r=n.toast;return t.toasts.find((function(e){return e.id===r.id}))?e(t,{type:1,toast:r}):e(t,{type:0,toast:r});case 3:var i=n.toastId;return i?K(i):t.toasts.forEach((function(e){K(e.id)})),(0,u.Z)((0,u.Z)({},t),{},{toasts:t.toasts.map((function(e){return e.id===i||void 0===i?(0,u.Z)((0,u.Z)({},e),{},{visible:!1}):e}))});case 4:return void 0===n.toastId?(0,u.Z)((0,u.Z)({},t),{},{toasts:[]}):(0,u.Z)((0,u.Z)({},t),{},{toasts:t.toasts.filter((function(e){return e.id!==n.toastId}))});case 5:return(0,u.Z)((0,u.Z)({},t),{},{pausedAt:n.time});case 6:var a=n.time-(t.pausedAt||0);return(0,u.Z)((0,u.Z)({},t),{},{pausedAt:void 0,toasts:t.toasts.map((function(e){return(0,u.Z)((0,u.Z)({},e),{},{pauseDuration:e.pauseDuration+a})}))})}},Y=[],J={toasts:[],pausedAt:void 0},X=function(e){J=z(J,e),Y.forEach((function(e){e(J)}))},Q=function(e){return function(t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return(0,u.Z)((0,u.Z)({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},n),{},{id:(null==n?void 0:n.id)||q()})}(t,e,n);return X({type:2,toast:r}),r.id}},$=function(e,t){return Q("blank")(e,t)};$.error=Q("error"),$.success=Q("success"),$.loading=Q("loading"),$.custom=Q("custom"),$.dismiss=function(e){X({type:3,toastId:e})},$.remove=function(e){return X({type:4,toastId:e})},$.promise=function(e,t,n){var r=$.loading(t.loading,(0,u.Z)((0,u.Z)({},n),null==n?void 0:n.loading));return e.then((function(e){return $.success(Z(t.success,e),(0,u.Z)((0,u.Z)({id:r},n),null==n?void 0:n.success)),e})).catch((function(e){$.error(Z(t.error,e),(0,u.Z)((0,u.Z)({id:r},n),null==n?void 0:n.error))})),e};var ee=B(T||(T=(0,s.Z)(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),te=B(I||(I=(0,s.Z)(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),ne=B(C||(C=(0,s.Z)(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),re=G("div")(R||(R=(0,s.Z)(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),(function(e){return e.primary||"#ff4b4b"}),ee,te,(function(e){return e.secondary||"#fff"}),ne),ie=B(A||(A=(0,s.Z)(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),ae=G("div")(O||(O=(0,s.Z)(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),(function(e){return e.secondary||"#e0e0e0"}),(function(e){return e.primary||"#616161"}),ie),oe=B(N||(N=(0,s.Z)(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),se=B(x||(x=(0,s.Z)(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),ce=G("div")(D||(D=(0,s.Z)(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),(function(e){return e.primary||"#61d345"}),oe,se,(function(e){return e.secondary||"#fff"})),ue=G("div")(P||(P=(0,s.Z)(["\n  position: absolute;\n"]))),le=G("div")(L||(L=(0,s.Z)(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),de=B(M||(M=(0,s.Z)(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),fe=G("div")(U||(U=(0,s.Z)(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),de),pe=function(e){var t=e.toast,n=t.icon,r=t.type,i=t.iconTheme;return void 0!==n?"string"==typeof n?o.createElement(fe,null,n):n:"blank"===r?null:o.createElement(le,null,o.createElement(ae,(0,u.Z)({},i)),"loading"!==r&&o.createElement(ue,null,"error"===r?o.createElement(re,(0,u.Z)({},i)):o.createElement(ce,(0,u.Z)({},i))))},he=function(e){return"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n")},ve=function(e){return"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n")},me=G("div")(j||(j=(0,s.Z)(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),ge=G("div")(F||(F=(0,s.Z)(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"])));o.memo((function(e){var t=e.toast,n=e.position,r=e.style,i=e.children,s=t.height?function(e,t){var n=e.includes("top")?1:-1,r=W()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[he(n),ve(n)],i=(0,a.Z)(r,2),o=i[0],s=i[1];return{animation:t?"".concat(B(o)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(B(s)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}}(t.position||n||"top-center",t.visible):{opacity:0},c=o.createElement(pe,{toast:t}),l=o.createElement(ge,(0,u.Z)({},t.ariaProps),Z(t.message,t));return o.createElement(me,{className:t.className,style:(0,u.Z)((0,u.Z)((0,u.Z)({},s),r),t.style)},"function"==typeof i?i({icon:c,message:l}):o.createElement(o.Fragment,null,c,l))}));!function(e,t,n,r){m.p=t,w=e,S=n,k=r}(o.createElement);b(V||(V=(0,s.Z)(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"])));var ye,_e=n(7039),Ee=n(6661),be=n(1197),we=n.n(be);!function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(ye||(ye={}));"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var Se,ke,Te,Ie=o.createContext({});Ie.Provider,Ie.Consumer;!function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"}(Se||(Se={})),function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"}(ke||(ke={})),function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"}(Te||(Te={}));var Ce=o.createContext({rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}}),Re=(Ce.Provider,o.createContext([])),Ae=(Re.Provider,Re.Consumer,o.createContext([])),Oe=(Ae.Provider,Ae.Consumer,o.createContext({}));Oe.Provider,Se.no,Se.no,(0,Ee.createClient)({codec:"vp8",mode:"live"}),o.createElement(o.Fragment,null,o.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),o.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),o.createElement(o.Fragment,null,o.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),o.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),o.createElement(o.Fragment,null,o.createElement("polyline",{points:"15 3 21 3 21 9"}),o.createElement("polyline",{points:"9 21 3 21 3 15"}),o.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),o.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),o.createElement(o.Fragment,null,o.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),o.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),o.createElement(o.Fragment,null,o.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),o.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),o.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),o.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),o.createElement(o.Fragment,null,o.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),o.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),o.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),o.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),o.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),o.createElement(o.Fragment,null,o.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),o.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),o.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),o.createElement(o.Fragment,null,o.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}));(0,o.createContext)({});var Ne,xe,De,Pe;!function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"}(Ne||(Ne={})),function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"}(xe||(xe={})),function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"}(De||(De={})),function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"}(Pe||(Pe={}));var Le=(0,o.createContext)(null);Le.Provider,Le.Consumer;(0,Ee.createMicrophoneAndCameraTracks)({encoderConfig:{}},{encoderConfig:{}}),function(){var e}(),function(){var e}(),new TextEncoder,new TextDecoder;n(9085),n(5462),n(3322);var Me=n(1095),Ue=(n(2481),n(7710),n(184)),je=n(6954),Fe=n(6407),Ve=n(7689),Be=function(){var e=(0,o.useState)(!1),t=(0,a.Z)(e,2),n=(t[0],t[1],(0,o.useState)(null)),s=(0,a.Z)(n,2),c=s[0],u=s[1],l=(0,o.useState)(!1),d=(0,a.Z)(l,2),f=d[0],p=d[1],h=(0,o.useState)(!1),v=(0,a.Z)(h,2),m=v[0],g=v[1],y=(0,o.useState)("Audio"),_=(0,a.Z)(y,2),E=_[0],b=(_[1],(0,o.useState)("")),w=(0,a.Z)(b,2),S=w[0],k=(w[1],(0,Ve.s0)()),T=(0,o.useState)({title:"",body:""}),I=(0,a.Z)(T,2);I[0],I[1];(0,o.useEffect)((function(){new Promise((function(e){(0,je.ps)(Me.Fw,(function(e){if(""!==e.from){console.log("payload",e);var t={name:e.notification.title,toggleVideo:!0,image:e.notification.image,open:!0,email:e.data["gcm.notification.email"],phoneNumber:e.data["gcm.notification.mobile_number"],typeAudioVideo:e.notification.body};k("/reply",{state:t})}}))}))}),[]),(0,o.useEffect)((function(){!1===c&&C()}),[c]);var C=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Audio"===E){e.next=11;break}return e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:!0});case 4:e.sent.getTracks().forEach((function(e){return e.stop()})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("Error accessing camera:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();return console.log("videoCallvideoCall",f),console.log("callTypecallType",E),(0,Ue.jsx)(Ue.Fragment,{children:m&&(0,Ue.jsxs)("div",{className:"w-[600px]",children:[c&&(0,Ue.jsx)(_e.Z,{title:S,toggleVideo:m,settoggleVideo:g,open:c,setOpen:u,setVideoCall:p}),f&&(0,Ue.jsx)(Fe.Z,{videoCall:f,setVideoCall:p,callType:E})]})})}},6407:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var r=n(3433),i=n(4165),a=n(1413),o=n(5861),s=n(9439),c=n(2791),u=n(6661),l=n.p+"static/media/image_defalut_radius.6727ed90113a9ea51637.png",d=n(1095),f=n(2481),p=n(7710),h=n(7159),v=n(184),m={mode:"rtc",codec:"vp8"},g=p.ur,y=p.tV,_=p.hc,E=function(e){var t=e.users,n=e.tracks;return(0,v.jsxs)("div",{id:"videos",children:[(0,v.jsx)(u.AgoraVideoPlayer,{className:"vid",videoTrack:n[1],style:{height:"530px",width:"100%"}}),t.length>0&&t.map((function(e){return e.videoTrack?(0,v.jsx)(u.AgoraVideoPlayer,{className:"small-video vid",videoTrack:e.videoTrack},e.uid):null}))]})},b=function(e){e.videoCall;var t=e.setVideoCall,n=e.callType,p=e.title,b=e.userEmailAudio,w=e.userPhoneNumberAudio,S=e.userImageAudio,k=e.isReceivings,T=(0,c.useState)(!0),I=(0,s.Z)(T,2),C=(I[0],I[1]),R=(0,c.useState)(_),A=(0,s.Z)(R,2),O=A[0],N=(A[1],(0,u.createClient)(m)),x=(0,u.createMicrophoneAndCameraTracks)(),D=(0,u.createMicrophoneAndCameraTracks)(),P=(D.audioTrack,D.videoTrack,(0,c.useState)(!1)),L=(0,s.Z)(P,2),M=L[0],U=L[1],j=(0,c.useState)(!1),F=(0,s.Z)(j,2),V=F[0],B=F[1];(0,c.useEffect)((function(){!0===k&&U(!0)}),[k]),(0,c.useEffect)((function(){var e=(0,f.IO)((0,f.hJ)(d.db,"call")),t=((0,f.JU)(d.db,"call","hO01sqCg552JEdhQMGae"),[]),n=(0,f.cf)(e,(function(e){var n,r;(t.length=0,e.forEach((function(e){t.push({id:e.id,data:e.data()})})),0!==t.length)&&(console.log("\ud83d\ude80 ~ file: VideoCalling.tsx:132 ~ unsubscribe ~ ids:",t),!0===(null===(n=t[0])||void 0===n?void 0:n.data.isReceiving)?U(!0):"incoming"===(null===(r=t[0])||void 0===r?void 0:r.data.callType)&&B(!0))}));return function(){return n}}),[]),(0,c.useEffect)((function(){!0===k&&U(!0)}),[k]),(0,c.useEffect)((function(){var e=(0,f.IO)((0,f.hJ)(d.db,"call")),t=((0,f.JU)(d.db,"call","hO01sqCg552JEdhQMGae"),[]),n=(0,f.cf)(e,(function(e){var n,r;(t.length=0,e.forEach((function(e){t.push({id:e.id,data:e.data()})})),0!==t.length)&&(console.log("\ud83d\ude80 ~ file: VideoCalling.tsx:132 ~ unsubscribe ~ ids:",t),!0===(null===(n=t[0])||void 0===n?void 0:n.data.isReceiving)?U(!0):"incoming"===(null===(r=t[0])||void 0===r?void 0:r.data.callType)&&B(!0))}));return function(){return n}}),[]);var G=function(e){var r=N(),u=e.tracks,l=e.setStart,p=e.setVideoOnOff,h=e.setInCall,m=(0,c.useState)({video:!0,audio:!0}),g=(0,s.Z)(m,2),y=g[0],_=g[1],E=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("audio"!==t){e.next=6;break}return e.next=3,u[0].setEnabled(!y.audio);case 3:_((function(e){return(0,a.Z)((0,a.Z)({},e),{},{audio:!e.audio})})),e.next=11;break;case 6:if("video"!==t){e.next=11;break}return e.next=9,u[1].setEnabled(!y.video);case 9:p(!y.video),_((function(e){return(0,a.Z)((0,a.Z)({},e),{},{video:!e.video})}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.leave();case 2:return r.removeAllListeners(),u[0].close(),u[1].close(),l(!1),n=(0,f.JU)(d.db,"call","hO01sqCg552JEdhQMGae"),e.next=9,(0,f.pl)(n,{isCalling:!1,isReceiving:!1,isCancelled:!1,callType:""},{merge:!0}).then(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location.reload(),console.log("Video Call done start");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 9:t(!1),h(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)("div",{className:"controls",children:[(0,v.jsx)("p",{className:y.audio?"on":"",onClick:function(){return E("audio")},children:y.audio?(0,v.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAL6SURBVHgBzVmB1aIwDI4ucGzwd4Nzg2MENzhHuA1gA9lAN9ANwAn0JsCbAG+CXPNIJVRUmqLn916tQJt8TdM2gRkogYiJrRa2LG354v8JF8LFljPXB1uq2WxWwbtgCaa2FLY0GA7qs7FlAa8CEyw9xRWTXtpi2MqufUKE+Bm1OXl9SZaBqcAK155Vco0SHszWllrIW8sBakkaT2geLbSTmwu5tdq6PG2NEDS5X3mGCNfhkdxOYcUHusi1dsKtxpH1RrmFN4EN4siaZ40TQXIHb4YgWz+cRexW9+OGL4JnqPW9RgY7GFDA9suEbx9tWUEgeH04pEMNSn6YgwLY32slloGiSJbbukq4M4oa9Rt5zwpCWQOBYBdobqwqnHgDCmB7TBL23v1G60pioMUkArn/amig9vocQdTNEnFL5mxaWuEnG4ad4UPAXCpouS3m9iflZwf4PPzmeklEf/BFBZ+HimtDRN3GfoYA8Ha0DmhPPkdn+i8YjxPX3+VCCjqJ3F7E/58uJmwDb0IVoCNxC+pqUeu8F/gwCE7JHKaF8a6/cR1thLkTguFByB/ul9pqz3JS9l06ACj6IpkHtoyLM09jFQhOF/WmjG3CdvVLWiR4i2tsiV1UlAbocEf7kS72fBEUPPACcQvxpxC8ZZm5IJlxuzpAhTyaK2mZAgLhWTEbeC7TjJhZy12+TihBAexnk2ThEtuXDKV3fwWBwDambd0F+yGVAQV4iiocRoWRQYm82Zk4Aizc+TzJVKczOBR6iulvMDJXEgpWoAT2M+GF/7DUWBX7q/8eQld75txm6GEqBI9+Y4H9zDGaKI5JMrHz1Rr/f7pcjG2oyp9igN2e+9xQns+9jSy2e68jacZ2ki/Jdvj6l2SO5PiXZNAnWwePUq8jnKQQJPczQjYFYbZiJuTGG4KFFp7QDeqPxQz7+27UCXZPiX+eH7H72LDA248NBruPDaXXl2Sl8CpgF3NqP98UGoIziAArdIWs+QX9D2J/oU09ztCmKydtEvkPEDGZo2i2f6wAAAAASUVORK5CYII=",alt:"mute icon"}):(0,v.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQ1SURBVFhHtZk9Th0xEMd5KFJamkjpwg2C0iUN9GmQcgHqVLlBuAHcAG4AN+DREAmJQLp0kDKREkgXKZFe/j/vzD7vw7u238dPGrwe2+NZf4y9j9HanEwmkw0lW5JdyQt7RofAg+TO0nPJeDQajZUWoz4ulLxucpWo8Y7kUHIvqYU2RxJeahDVuaCBY+o8qouDZ6HVlLEEp3clmxIfzTDiki0ro86NJAZbm1a9g/QdJ8GK+lEdOjwItRsYlX1JspMhaCM5ltxKHGzHL/jIScES6EcVMBwbxcHW6LzIBnax5dAHurmcZNp8HWIou65qkc14IP5YGlPlJFO18Cj2gW3JTzqaoWq6j029MtRHarqvrDiNKvB27uSJqVeG+kg5CfjQP4sq9N09XHEJyH7KyUuJD9SBVe2iAqbcqQ49oHYfJb62ryV7VtRB+t7drZT94eyEBjFSejDfN1UVahfH2hiO2BblsyFIeQ9dZ6ZqkMLfgmGfN5A7YRSUemf3oZLQc9ZJkI694jMzHVVlCEFwZKoq1I5jEk5NFVDeO6sO5irzFz00VdegqapQu72mefdFlb9r1JMrS2MG46TKfZbwbWNdfxhadviNrmFcy1bBK0udT+rrjT0nMV+4FuLb1rr++Brgzrhsnlsak3Uy4ouluzi63TwH75eGZoqpfdrkWmqcBPdpE0c9sFdNuxwhHCWDsjk5ezP/LPmusg9NtogbS19i1DdS1UlkbcKFVkm7mSSp3c1m4uINxTOnuoQpuG9HVFPCt82ivJWkvnHeWVpF5NMGji6TZ5Y6/yxdeBBwNBjR8FZNvfjGH7UjarzneYZfkieScxsZv3j7ussS+fRAxoNyVbBXfT7Y4IelKVj/wa5SvxVNj8QMqutH+zWZ0+a5e3nIofqcHH9Dyy44jk2OQHeSWxXchsaFqL4fzWMyPjLTM7UA1S+5BbFrT0JJw7yztk/Gw0b3SjWA6qacBKaa6yJhKv4NAH3ybjqE2nCnhR1/a4+l2TdWnZSTXyX8GJECfdVIAm1Ca/lmqpkhHkDlg9OtZ4z7msdmbSRpUdvHV09lfPoZ2aRx6bNrEqTzDqqn2lFbXtijRPf3BCl6P0Wk63VSKUZ96fRRu9s9Sjw+bqX0UYX2LfScm+74E7uPYkdV19cmpNe2Cnyt0jEOFE33spDt+KX7w6UK44qpE2dlToLse8wNA2XqNKrA0KdOnFU7SewFnMyHM1VKTfelFS8d2WYW3Uk2Zf5XQ1VKOQllb1mJbHLp8KW2kJPczN0QEDYWdlg2GEUPQbDQdHucxKhHA8AoU1XtMG0k8e9TUHaCqVJRCJKOTmbPcy4NdMR1jGlsO+RZQhv/Z0N8SQFsFd9NMTjL4O5WOQ5xTOZOoxS0welyB40Rre0Zqr67rUMXRpN/jPmo8vnxW8KnB5/i/C7FrzFzfD+trf0H/4vpvlI01pIAAAAASUVORK5CYII=",alt:"unmute icon"})}),"Video"==n&&(0,v.jsx)("p",{className:y.video?"on":"",onClick:function(){return E("video")},children:y.video?(0,v.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALpSURBVHgB1VntkZswEJVv8j90cOogdBDSga+TuwrMVWBSgd2B0wFcBXYqMB1wV8FmN34Kax3YWIA8eTM7QkjafVqk1QcLEwgiSjhJWZYsj3hOIIJ3lhrpG0u1WCwqEwtMMGMpWBq6HdJmw5KauQCCpWe4Aukli4WXXf1ECKFM6hy8tqLLmqkAg2vPK3mIEXRmy3JU+ta6g6Ekrac0H6201Zsrvcdg7+KzNUrR5OPKc8TtNjyS2ym8eMGWDK2dGlbDyHq93JpIgEMcWXutcqJI7kxkKLLHi1+R2tl9ueJM8By17qtkqYU1dwLmh0PWVaFEYW7uDBW6Sr8gHR3PJgSGQKO9+oCyZ6Sycai9Rs8Utq5rHOmGGMkcZCPzE9mlJtP0jU0aT9LhV4dumRclytcdZQT7idtsCPZdvXNWTCCU/sp7n9L58vzJUaoTmXz6DO/fTCSwYRlq4hjLIp4+oMh6VX8jXQrR78hUJgKY5IoT95lfeTw+mdPmugsVUvvFtDvy2syLr3Ra7dzkeGGSxZU2ztPfhKhFpjbzIoXULE9M8jCgjfN08s+jCAlzo2b54YfAPggnzOPkwfwnEKJ/PUlxNiGWRULOoOCvOL0L0Q9k5iYqY1JCkWXZI0Rdg0VaP5h2Zs13hD3hA6HoFfk1QtUlWNdWiNbIZCYCmGzOyQuyOUJW39fMkFZ6iSu7akZeQlOvzt4tof6WynYYmmpTUnXo1uezoqNM0OiXBV7mHcqm2OYNP122drdou9EvM6Uw+lnJh+fp1C8s+7waG8xhRT3DRXuVaM7btiugIYdMNVaPdP/jcjG04sZEBrVXO9cdBdc3scnS6YLXkbRDG+lLsh3Nf0m2CQ1j/soxvJfhNm4nqRTpeEYIG9aMBLy4UnrHOwJKC0/pJkQxOr6i85WumHRowUhF59hT+7Mhpc8/Gyy1PxtKr63oysxcAKEthf++KUIILswIwKAT8eajOf8hJqcH2ZjXBhcNoYfIP5/aGxwybp79AAAAAElFTkSuQmCC",alt:"mute video icon"}):(0,v.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAQJSURBVFhHxZk/VtwwEMZ3cwJuEI6QllSbIj3JNdKQE0BOADeAG0CTmqVJukCK1FClBV4OQL6fPOOV1rLXkneT7715kkby6PPo38iezyrx8vKyp+SN5FDy2vLoEPAkebD0RrKcz+dLpaMg+wdKvjWlCsjAQnImeZSUgmfOJbxUL1R/QOMYVrUZagvB6/DUCksJpA8l+xL3ZvC45I3V0eZOEgNb+9a8hXQdkgLeHYYa0eFpaN4Ar5xIOp1sAs9ILiT3Ege2wwsqrSaJ4dgoBFuv1UI2sIstB318bLIJRpFk2HweYmhwXtVANtcdEaOYJEM12Yt9kO33oZcUxcN9YeqdQPZzc/KPZHj+qwELx0lemnonkP0cya+WwqF/FFXpq3u44UTIdnZ1S2JHnVrzFKpgyB3FW89YyPbgFqQ868OxMPUKUvpmfmKqrUO2B0k6pPOt69pUDaTwt8DtO/Gm7I4iCaRnCvius/KqCmxB4NxULaQ7kvhDtfhtaYzBLUj17tUzUwWlE8mdvVNJ5hBIKmVd+JRLFo/Kvmbofw8FwQa4tTYJrG589BJBj/UOt1Kmm69wR+Iolf0lFq9U9jlAzLg1yDiE1uPJt4pJv6vuSHkcA7EryZ0ErI/oT0sPY9YEwB1YXZFH1TznyR9Wd9wUA8IOo7T1HGWHyoSI4IrCbZPPBx1WN5qomuZIAvq5bLIBeDVA+T6iPk/vKfhiyZ5EVjeKqJrlSH6y1MG8TJyich9RtinwyBwNBDV3uNtUQ8ayc1Lyq8kGcId6p758Tg4i4rQH0cnoI8nCsfxkQDSwVmdVQUghSVY1wzwqCI84PUH0ucm319zRKCTJcLMVQZaF1S6mAfh29QBRny9FV41CkuBZdR+UfmmKM0LKY8v3wYk+Q5QJDpIVN4QKki3Uhr3zc1OacZ4ToPeNpnNa0qkfoWlIZbC6dntSdnQUBFTn9pOvJCrnjtD1bcv3+AWFOKRaP8Ko31ZQ0vmcI118P1tFSYLKbVBiqqDkSwboBM3SbSPM4/nSNdANPVXw4cFgZ75IVzTcUyHbsafTF5TCj7HEqyr/U5JA9j1w6X79k9K9CsJbKP0fJH1ugs6aCVCFz1XcXvcFYwJkP74uJ4srgSrjhuvYKUmgPjwMhMPwSakGdV/VJkJ98IEXQDI/5A41yM3JG0lxHDAW2JY4yc3bmBrkSPo1d/NbVkA249OpmiS6eD8DbBuTCcsGXozvTtXD3c5J5THquwHAKENVTJhnJBCMTzpsb55aTdsE2YUjPZ3wcyEGQQMdcVtkGNsOyUt4xn82+IHiwNboiG2d6MbVrTYQ4hyOvTIWPAPp8QQNc562fPEdxzp0wZv8GHOvcsXh9kBgTswbPjSoj4pL5Gz2F/RYJdqDkSW2AAAAAElFTkSuQmCC",alt:"unmute video icon"})}),(0,v.jsx)("p",{onClick:function(){return b()},children:(0,v.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAR5SURBVHgBzZlNbBNHFMffG9tNyEdrpKotURGmEqGRIrFpg9SqB5xLVbUVTW+tOKBKVdUeKpUDVxK4olbNqT0gAQcO3CIE3FAckFAkDKwQIiRIYAnJRFxwCJAQ2/t4b+w19ma9nrW8gf8h3uzO8/z8Zt6bmbcIbeqmZSW74yWLUI0rwh2AYCFBkhCS8pyvC3ydA/kEmgVwMkPZ2xloUwghNT86nBa4GOFBF8q4M4bmHqeLUJwavnbHDmVr2lAAEWITbJGGToggQyX8Zci2cybNW4LKEPcmnAkH8C+IQkT/rpbU0RHbLgQ1CwSdt6wUJmiGL1MQrXJUxLEg76pmDxYty1JxugnRQ4q0Q27vtaxmDXw9KpAUp5mwwdIBFUqAY8PX7A2BtgF0E4e7mQo8DUa806ABVAJnS2LThjtIuVWGrQ+whjkq0Q1vHlKU2hLXLDXVPFod8gfwFomIM0HWzsh1zaMMedL0C979bj/sunQFPpm+CIltAxBG3bt2a3sTIdDE62vWIqcFB/TcNILcNnGs9v/a4gI8/ONXcFZWWtoK5Pb/T4Dq74fHfx+HJ2fPtLRxvao9WgbHaNXxQurOB3fDB4cOt7SthxQVl/JgIkJnXD5V5Q/+YGL0/m+/+95/7/v9gcPphVw6egSezc6AiZjtoGQjpXdDYJbYY339TZ8lBgaMIZcvnIMQ4u0kWOxRlTa1KD/zn4fFfB6enj8XBaSWDL9CxH2mBi+uZ33v5w8fguKjfCSQFVJIKQTz9fwlR7hXy+zJtXsL0UGy2Jt7JJhSpgZPfTrr+Wy0IZd2GrKqpKIQHi1zrvQOvwTR9v8qYBFBalC8u3cPhbEQDwqMV5L432HPRgCpJXO0EMbgxY2sb1BJ4o8KklVQDsEyhNTSsSNNl8xmkFt/OgC9+8agTeVif378YZqX/E/DWDmcT2l9HXq//Ar8IGWuYleXbieBJlNFr15ff6MXjedzVyGMiGghzjkqB21o1TP89ZACJoG3cnkGkry0ulNCtPXnA9DHnpWNjDf3BiiD86NWGpHMFt6qmkW3936QZDW7P/4tmEh2UKq7BHaYgOoEpEjSmmHbgt7m7eRzCdeGTptYuPPNL7plH7Ayaz4wYmuyh2UnTsun3uYRqWkwUCIgT8p8k2wgc6/VFi5M+ioCTlWBK+LEL9+ebmXYV00xrWDkR/V8PqrbyzAnPqoss4//OW4MydE+O5S9lW4AbSeoohbFcOfQXOV8XzvcVU57NAVvibgoN+VCihrO9V1FNQnYXl7tqJjhZS9M1t9qANUZQOFY2PW/o2JIYRjJNJYhN1TzxN0IbwZW+uQy+4/1Q+7Kt+w4yNU0gd3MaSCQ0uegTyWv+ry55r/gMo/DmYAirkdVh9vPk65UkL0Ydq3jSJTZQKJ7tYfLjHPBtXzzlw3sXSg7p3h4jE+tQdKvdEhNukWwVgr9+kbqVFICkupKmPNWtbNCmfcVyEu2KWCdbfuS1YwHLy2vdNjTSf6yHS68QMnpgStytsNzUODW+sD2ph1TvQKpYw9uZKIEwQAAAABJRU5ErkJggg==",alt:"leave icon"})})]})},Z=function(e){var a=e.setInCall,u=e.channelName,m=(0,c.useState)([]),_=(0,s.Z)(m,2),k=_[0],T=_[1],I=(0,c.useState)(!1),C=(0,s.Z)(I,2),R=C[0],A=C[1],O=(0,c.useState)(!1),D=(0,s.Z)(O,2),P=D[0],L=D[1],U=(0,c.useState)(!0),j=(0,s.Z)(U,2),F=j[0],B=j[1],Z=N(),q=x(),W=q.ready,H=q.tracks;(0,c.useEffect)((function(){var e=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("init",n),Z.on("user-published",function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.subscribe(t,n);case 2:console.log("subscribe success"),"video"===n&&T((function(e){return[].concat((0,r.Z)(e),[t])})),"audio"===n&&(null===(a=t.audioTrack)||void 0===a||a.play());case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Z.on("user-unpublished",(function(e,t){var n;(console.log("unpublished",e,t),"audio"===t)&&(null===(n=e.audioTrack)||void 0===n||n.stop());"video"===t&&T((function(t){return t.filter((function(t){return t.uid!==e.uid}))}))})),Z.on("user-left",(function(e){T((function(t){return t.filter((function(t){return t.uid!==e.uid}))})),t(!1),a(!1)})),e.next=6,Z.join(g,n,y,null);case 6:if(e.sent,!H){e.next=10;break}return e.next=10,Z.publish([H[0],H[1]]);case 10:A(!0);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();W&&H&&(console.log("init ready"),e(u))}),[u,Z,W,H]),(0,c.useEffect)((function(){setTimeout((function(){L(!0)}),6e4)}),[]),(0,c.useEffect)((function(){0===k.length&&P&&K()}),[k,P]);var K=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.leave();case 2:return Z.removeAllListeners(),H&&H[0].close(),H&&H[1].close(),A(!1),n=(0,f.JU)(d.db,"call","hO01sqCg552JEdhQMGae"),e.next=9,(0,f.pl)(n,{isCalling:!1,isReceiving:!1,isCancelled:!1,callType:""},{merge:!0}).then(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location.reload(),console.log("Video Call done start");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 9:t(!1),a(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsxs)("div",{className:"call-cont",children:[M&&(0,v.jsx)(h.Z,{isIncoming:V}),"Video"==n&&R&&H&&F&&(0,v.jsx)(E,{users:k,tracks:H}),"Video"==n&&R&&H&&!F&&(0,v.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,v.jsx)("img",{src:l,style:{height:"200px",width:"200px",objectFit:"cover",borderRadius:"100px"}})}),"Audio"==n&&(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{src:""==S?l:S,style:{height:100,display:"flex",alignItems:"center",justifyContent:"center",width:100}}),(0,v.jsxs)("div",{style:{color:"#fff",fontSize:20,display:"flex",fontWeight:"bold",marginBottom:20,justifyContent:"center",alignItems:"center"},children:[" ",p+" ..."]}),(0,v.jsxs)("div",{style:{color:"#fff",fontSize:20,display:"flex",fontWeight:"bold",marginBottom:20,justifyContent:"center",alignItems:"center"},children:[" ",null!==w&&void 0!==w?w:b]})]}),W&&H&&(0,v.jsx)(G,{setVideoOnOff:B,tracks:H,setStart:A,setInCall:a})]})};return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Z,{setInCall:C,channelName:O})})}},4:function(e,t,n){"use strict";n.d(t,{EZ:function(){return h},Jr:function(){return f},Kt:function(){return a},OD:function(){return s},O_:function(){return c},Oo:function(){return p},Pt:function(){return l},Ss:function(){return u},bu:function(){return o},d:function(){return d},ol:function(){return i}});var r=n(184),i=function(){return(0,r.jsx)("svg",{style:{alignSelf:"end"},xmlns:"http://www.w3.org/2000/svg",width:"37",height:"32",viewBox:"0 0 37 32",fill:"none",children:(0,r.jsx)("path",{d:"M24.1992 20.7584H22.9943L22.5673 20.3468C24.3974 18.213 25.343 15.3017 24.8244 12.2076C24.1076 7.97033 20.5694 4.5866 16.2992 4.06837C9.84802 3.27579 4.41868 8.70194 5.21173 15.1493C5.73026 19.4171 9.11597 22.9532 13.3557 23.6696C16.4517 24.1878 19.3646 23.2428 21.4997 21.4138L21.9115 21.8405V23.0447L28.3932 29.5225C29.0185 30.1474 30.0403 30.1474 30.6656 29.5225C31.2908 28.8976 31.2908 27.8764 30.6656 27.2515L24.1992 20.7584ZM15.0486 20.7584C11.2511 20.7584 8.18566 17.6947 8.18566 13.8995C8.18566 10.1042 11.2511 7.04057 15.0486 7.04057C18.8461 7.04057 21.9115 10.1042 21.9115 13.8995C21.9115 17.6947 18.8461 20.7584 15.0486 20.7584Z",fill:"currentColor"})})},a=function(){return(0,r.jsxs)("svg",{style:{alignSelf:"end"},xmlns:"http://www.w3.org/2000/svg",width:"38",height:"32",viewBox:"0 0 38 32",fill:"none",children:[(0,r.jsx)("path",{d:"M0 4.6666C0 2.0893 2.0893 0 4.6666 0H32.6662C35.2435 0 37.3328 2.0893 37.3328 4.6666V10.4973C36.86 10.1629 36.332 9.89586 35.7592 9.7128L34.6662 9.36355V4.6666C34.6662 3.56206 33.7707 2.66663 32.6662 2.66663H4.6666C3.56206 2.66663 2.66663 3.56206 2.66663 4.6666V21.9997C2.66663 23.1042 3.56206 23.9997 4.6666 23.9997H10.6665V21.333C10.6665 19.8603 11.8604 18.6664 13.3331 18.6664H23.9997C25.4724 18.6664 26.6663 19.8603 26.6663 21.333V21.88C25.0634 21.8429 23.5508 22.6386 22.6398 23.977L21.3571 25.8615L21.1641 26.1791L21.1315 26.2394C21.0562 26.3788 20.988 26.5215 20.9269 26.6663H4.6666C2.0893 26.6663 0 24.577 0 21.9997V4.6666Z",fill:"#9E9E9E"}),(0,r.jsx)("path",{d:"M37.1175 14.6795C37.2588 15.2943 37.3305 15.9391 37.3332 16.6136V16.6882C37.3244 19.0188 36.4927 21.7035 34.8375 24.7422C34.4901 25.38 34.1373 25.9771 33.7791 26.5328C31.9205 29.4157 29.9168 31.1925 27.768 31.8629C26.7728 32.1733 25.7038 31.9477 24.8995 31.2725L24.687 31.0773L23.8615 30.2485C23.1462 29.5304 22.9989 28.3944 23.4785 27.5056L23.6004 27.3051L24.8443 25.4773C25.2115 24.9379 25.7744 24.6115 26.3734 24.5547C26.4928 24.5435 26.6136 24.5427 26.7344 24.5534C26.8158 24.5603 26.8974 24.5723 26.9784 24.5896L27.1974 24.6494L29.4941 25.4152C30.4106 24.7216 31.1749 23.8486 31.7866 22.7963C32.3112 21.8942 32.6543 20.9798 32.8159 20.0534L32.8815 19.5889L30.9693 17.7739C30.3392 17.176 30.1104 16.2449 30.368 15.4069L30.4504 15.181L31.3184 13.1344C31.7253 12.1745 32.7002 11.6524 33.6565 11.8516L33.861 11.9055L34.9479 12.2527C36.0255 12.5971 36.8508 13.5203 37.1175 14.6795Z",fill:"#9E9E9E"}),(0,r.jsx)("path",{d:"M23.9998 10.6665C23.9998 13.612 21.612 15.9998 18.6665 15.9998C15.721 15.9998 13.3333 13.612 13.3333 10.6665C13.3333 7.72103 15.721 5.33325 18.6665 5.33325C21.612 5.33325 23.9998 7.72103 23.9998 10.6665Z",fill:"#9E9E9E"})]})},o=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,r.jsx)("path",{d:"M13.5762 7.52899C13.8366 7.78933 13.8366 8.21146 13.5762 8.47179L9.80498 12.2431C9.54464 12.5034 9.12251 12.5034 8.86218 12.2431C8.60184 11.9827 8.60184 11.5606 8.86218 11.3003L11.4953 8.66706H2.66691C2.29871 8.66706 2.00024 8.36859 2.00024 8.00039C2.00024 7.63219 2.29871 7.33372 2.66691 7.33372H11.4953L8.86218 4.70057C8.60184 4.44022 8.60184 4.01811 8.86218 3.75776C9.12251 3.49741 9.54464 3.49741 9.80498 3.75776L13.5762 7.52899Z",fill:"currentColor"})})},s=function(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"33",height:"32",viewBox:"0 0 33 32",fill:"none",children:[(0,r.jsx)("circle",{cx:"16.6666",cy:"16",r:"16",fill:"#2288FF","fill-opacity":"0.15"}),(0,r.jsx)("path",{d:"M17.9542 24.75L16.8667 24.125L19.3667 19.75H23.1167C23.4482 19.75 23.7662 19.6183 24.0006 19.3839C24.235 19.1495 24.3667 18.8315 24.3667 18.5V11C24.3667 10.6685 24.235 10.3505 24.0006 10.1161C23.7662 9.8817 23.4482 9.75 23.1167 9.75H10.6167C10.2852 9.75 9.96724 9.8817 9.73282 10.1161C9.4984 10.3505 9.3667 10.6685 9.3667 11V18.5C9.3667 18.8315 9.4984 19.1495 9.73282 19.3839C9.96724 19.6183 10.2852 19.75 10.6167 19.75H16.2417V21H10.6167C9.95366 21 9.31777 20.7366 8.84893 20.2678C8.38009 19.7989 8.1167 19.163 8.1167 18.5V11C8.1167 10.337 8.38009 9.70107 8.84893 9.23223C9.31777 8.76339 9.95366 8.5 10.6167 8.5H23.1167C23.7797 8.5 24.4156 8.76339 24.8845 9.23223C25.3533 9.70107 25.6167 10.337 25.6167 11V18.5C25.6167 19.163 25.3533 19.7989 24.8845 20.2678C24.4156 20.7366 23.7797 21 23.1167 21H20.0917L17.9542 24.75Z",fill:"#1B91FF"}),(0,r.jsx)("path",{d:"M11.8667 12.25H21.8667V13.5H11.8667V12.25Z",fill:"#1B91FF"}),(0,r.jsx)("path",{d:"M11.8667 16H18.1167V17.25H11.8667V16Z",fill:"#1B91FF"})]})},c=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",children:(0,r.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.4964 0.760114C13.13 0.175297 12.4334 -0.113249 11.7608 0.0411986L9.42926 0.57662C9.19064 0.631421 8.94269 0.631421 8.70407 0.57662L6.37248 0.0411986C5.69988 -0.113249 5.00326 0.175297 4.63688 0.760114L3.36682 2.78735C3.23683 2.99485 3.06151 3.17018 2.85401 3.30018L0.826758 4.57023C0.241941 4.93662 -0.0466059 5.63323 0.107855 6.30583L0.643263 8.6374C0.698077 8.87602 0.698077 9.12397 0.643276 9.36259L0.107855 11.6942C-0.0466059 12.3668 0.241941 13.0633 0.826758 13.4297L2.85401 14.6998C3.06151 14.8298 3.23683 15.0051 3.36682 15.2126L4.63688 17.2399C5.00326 17.8247 5.69988 18.1132 6.37248 17.9588L8.70407 17.4234C8.94269 17.3686 9.19064 17.3686 9.42926 17.4234L11.7608 17.9588C12.4334 18.1132 13.13 17.8247 13.4964 17.2399L14.7665 15.2126C14.8965 15.0052 15.0717 14.8298 15.2792 14.6998L17.3065 13.4297C17.8914 13.0633 18.1799 12.3668 18.0254 11.6942L17.4901 9.36259C17.4352 9.12397 17.4352 8.87602 17.4901 8.6374L18.0254 6.30583C18.1799 5.63323 17.8914 4.93662 17.3065 4.57023L15.2792 3.30018C15.0717 3.17018 14.8965 2.99485 14.7665 2.78735L13.4964 0.760114ZM12.8448 6.10907C13.0268 5.80088 12.9246 5.4035 12.6163 5.2215C12.3081 5.03949 11.9107 5.14178 11.7287 5.44998L8.34076 11.1868L6.29418 9.22688C6.03567 8.97932 5.62543 8.98814 5.37787 9.24659C5.13032 9.50517 5.1392 9.91539 5.3977 10.163L8.03488 12.6883C8.17771 12.8254 8.37537 12.8894 8.57148 12.8624C8.76745 12.8353 8.94049 12.7204 9.04107 12.5499L12.8448 6.10907Z",fill:"#16B188"})})},u=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",children:(0,r.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.06665 18C14.0372 18 18.0667 13.9705 18.0667 9C18.0667 4.02944 14.0372 0 9.06665 0C4.09609 0 0.0666504 4.02944 0.0666504 9C0.0666504 13.9705 4.09609 18 9.06665 18ZM9.06665 16.3581C5.00291 16.3581 1.7086 13.0637 1.7086 9C1.7086 7.26289 2.31056 5.66638 3.31726 4.40768L13.6589 14.7494C12.4003 15.7561 10.8037 16.3581 9.06665 16.3581ZM14.8161 13.5923C15.8228 12.3336 16.4247 10.7371 16.4247 9C16.4247 4.93626 13.1304 1.64195 9.06665 1.64195C7.32955 1.64195 5.73305 2.2439 4.47435 3.2506L14.8161 13.5923Z",fill:"#FF9A02"})})},l=function(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,r.jsx)("path",{d:"M18 6L6 18",stroke:"#52678E","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),(0,r.jsx)("path",{d:"M6 6L18 18",stroke:"#52678E","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]})},d=function(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:[(0,r.jsx)("path",{d:"M16 5.33332C10.1089 5.33332 5.33329 10.109 5.33329 16C5.33329 21.891 10.1089 26.6667 16 26.6667C21.891 26.6667 26.6666 21.891 26.6666 16C26.6666 10.109 21.891 5.33332 16 5.33332ZM2.66663 16C2.66663 8.63619 8.63616 2.66666 16 2.66666C23.3638 2.66666 29.3333 8.63619 29.3333 16C29.3333 23.3638 23.3638 29.3333 16 29.3333C8.63616 29.3333 2.66663 23.3638 2.66663 16Z",fill:"#52678E"}),(0,r.jsx)("path",{d:"M16 13.3333C16.7363 13.3333 17.3333 13.9303 17.3333 14.6667V22.6667C17.3333 23.403 16.7363 24 16 24C15.2636 24 14.6666 23.403 14.6666 22.6667V14.6667C14.6666 13.9303 15.2636 13.3333 16 13.3333Z",fill:"#52678E"}),(0,r.jsx)("path",{d:"M18 9.99999C18 11.1046 17.1045 12 16 12C14.8954 12 14 11.1046 14 9.99999C14 8.89542 14.8954 7.99999 16 7.99999C17.1045 7.99999 18 8.89542 18 9.99999Z",fill:"#52678E"})]})},f=function(){return(0,r.jsx)("svg",{width:"18",height:"14",viewBox:"0 0 18 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M17.6644 0.252586C18.0772 0.619504 18.1143 1.25158 17.7474 1.66436L7.08075 13.6644C6.89099 13.8778 6.61898 14 6.33334 14C6.04771 14 5.7757 13.8778 5.58593 13.6644L0.252601 7.66436C-0.114317 7.25158 -0.077136 6.6195 0.335647 6.25259C0.74843 5.88567 1.3805 5.92285 1.74742 6.33563L6.33334 11.4948L16.2526 0.335632C16.6195 -0.0771512 17.2516 -0.114332 17.6644 0.252586Z",fill:"#16B188"})})},p=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"17",height:"17",viewBox:"0 0 17 17",fill:"none",children:(0,r.jsx)("path",{d:"M12.1 9.9C11 11 11 12.1 9.9 12.1C8.8 12.1 7.7 11 6.6 9.9C5.5 8.8 4.4 7.7 4.4 6.6C4.4 5.5 5.5 5.5 6.6 4.4C7.7 3.3 4.4 0 3.3 0C2.2 0 0 3.3 0 3.3C0 5.5 2.2605 9.9605 4.4 12.1C6.5395 14.2395 11 16.5 13.2 16.5C13.2 16.5 16.5 14.3 16.5 13.2C16.5 12.1 13.2 8.8 12.1 9.9Z",fill:"white"})})},h=function(){return(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M15.2118 1.51435L14.5449 0.84744C14.3543 0.656893 14.005 0.688651 13.7827 0.942714L6.31958 8.40581L4.73168 6.62737C4.54114 6.43682 4.54114 6.18276 4.66817 5.96045L5.87497 4.30904C6.2243 3.86443 6.19254 3.22928 5.84321 2.78467L4.28707 0.84744C3.81071 0.275799 2.95324 0.212283 2.41336 0.752167L0.761953 2.40357C0.507891 2.65764 0.380859 3.00697 0.380859 3.35631C0.539649 6.27803 1.71469 9.07272 3.55664 11.1687L1.01602 13.7094C0.793711 13.9317 0.761953 14.281 0.920743 14.4716L1.58766 15.1385C1.7782 15.329 2.12754 15.2973 2.34985 15.0432L15.1165 2.27654C15.3706 2.05424 15.4023 1.7049 15.2118 1.51435Z",fill:"white"}),(0,r.jsx)("path",{d:"M15.2117 11.7721L13.2745 10.2159C12.8299 9.86659 12.1948 9.83483 11.7501 10.1842L10.0987 11.391C9.90819 11.5498 9.62237 11.518 9.43182 11.3274L8.66963 10.6288L5.97021 13.3282C7.90744 14.6303 10.2258 15.4877 12.6394 15.6148C12.9887 15.6465 13.338 15.4877 13.5921 15.2337L15.2435 13.5823C15.8469 13.1059 15.8151 12.2167 15.2117 11.7721Z",fill:"white"})]})}},7039:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(4165),i=n(5861),a=(n(2791),n(4)),o=n(1095),s=n(2481),c=n(440),u=n(7948),l=n.n(u),d=n(184),f=document.getElementById("root"),p={overlay:{zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.4)"},content:{maxWidth:"100%",width:"100%",border:"none",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"}};l().setAppElement(f);var h=function(e){e.toggleVideo;var t=e.settoggleVideo,n=(e.open,e.setOpen),u=e.title,f=e.setVideoCall,h=e.userImageChatSection,v=e.userEmail,m=e.userPhoneNumber,g=e.setIsReceiving,y=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,s.JU)(o.db,"call","hO01sqCg552JEdhQMGae"),e.next=3,(0,s.pl)(t,{isCalling:!0,isReceiving:!0},{merge:!0}).then(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Call popup done start");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:f(!0),g(!0),n(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,s.JU)(o.db,"call","hO01sqCg552JEdhQMGae"),e.next=3,(0,s.pl)(a,{isCalling:!1,isReceiving:!1,callType:""},{merge:!0}).then(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("done end");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:n(!1),f(!1),t(!1),g(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return console.log("userImageChatSection",h),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(l(),{style:p,isOpen:!0,onRequestClose:function(){return n(!1)},children:(0,d.jsxs)("div",{style:{background:"#FFF",width:"40%",borderRadius:"10px"},children:[(0,d.jsx)("div",{style:{display:"flex",justifyContent:"end",padding:10},className:"cursor-pointer",onClick:function(){n(!1)},children:(0,d.jsx)(a.Pt,{})}),(0,d.jsx)("div",{className:"sm:flex sm:items-start px-[32px] justify-center",children:(0,d.jsx)("div",{className:"flex flex-col gap-4 py-[60px]",children:(0,d.jsx)("div",{className:"sm:flex sm:items-start px-[32px] justify-center",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsx)("div",{className:"w-[72px] h-[72px] rounded-full bg-[#F4F4F6] mx-auto flex items-center justify-center",children:(0,d.jsx)("img",{src:null!==h&&void 0!==h?h:c,alt:"user",className:"w-full h-full object-cover"})}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("p",{className:"max-w-[270px] text-[14px] text-[#52678E] font-medium",children:[(0,d.jsx)("b",{className:"text-[18px]",children:u})," is calling..."]}),(0,d.jsx)("b",{className:"text-[18px]",children:m||v})]}),(0,d.jsxs)("div",{className:"flex items-center justify-center gap-9",children:[(0,d.jsx)("button",{className:"h-[35px] w-[35px] rounded-full bg-[#16B188] flex items-center justify-center",onClick:function(){return y()},children:(0,d.jsx)(a.Oo,{})}),(0,d.jsx)("button",{className:"h-[35px] w-[35px] rounded-full bg-[#D8352F] flex items-center justify-center",onClick:function(){return _()},children:(0,d.jsx)(a.EZ,{})})]})]})})})})]})})})}},7159:function(e,t,n){"use strict";var r=n(9439),i=n(2791),a=n(184);t.Z=function(e){var t=e.isIncoming;console.log("\ud83d\ude80 ~ file: CallDuration.js:4 ~ CallDuration ~ isIncoming:",t);var n=(0,i.useState)(0),o=(0,r.Z)(n,2),s=o[0],c=o[1];(0,i.useEffect)((function(){var e=setInterval((function(){c((function(e){return e+1}))}),1e3);return function(){return clearInterval(e)}}),[]);var u=function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"))}(s);return(0,a.jsxs)("div",{className:"absolute bottom-[85px]",children:[(0,a.jsx)("p",{style:{position:"relative",zIndex:"99999",color:"#ffff"},children:u}),t&&(0,a.jsx)("p",{style:{position:"relative",zIndex:"99999",color:"#ffff"},children:"Indoming call...."})]})}},2970:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r={Initial:"/",Login:"/login",Dashboard:"/dashboard",Reply:"/reply",Usermanagement:"/usermanagement",AdminSetting:"/adminsetting",pushNotification:"/pushnotification",notification:"/notification",changeLanguage:"/changelanguage"}},1778:function(e,t,n){"use strict";n.d(t,{Z:function(){return ee}});var r=n(2963),i=n(4506),a=n(7762),o=n(7326),s=n(136),c=n(9388),u=n(1413),l=n(5671),d=n(3144),f={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},p=function(){function e(t){(0,l.Z)(this,e);var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(t,n)}return(0,d.Z)(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||f,this.options=t,this.debug=t.debug}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,r){return r&&!this.debug?null:("string"===typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,(0,u.Z)((0,u.Z)({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}(),h=new p,v=function(){function e(){(0,l.Z)(this,e),this.observers={}}return(0,d.Z)(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function m(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.resolve=e,n.reject=t,n}function g(e){return null==e?"":""+e}function y(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"===typeof e}for(var a="string"!==typeof t?[].concat(t):t.split(".");a.length>1;){if(i())return{};var o=r(a.shift());!e[o]&&n&&(e[o]=new n),e=Object.prototype.hasOwnProperty.call(e,o)?e[o]:{}}return i()?{}:{obj:e,k:r(a.shift())}}function _(e,t,n){var r=y(e,t,Object);r.obj[r.k]=n}function E(e,t){var n=y(e,t),r=n.obj,i=n.k;if(r)return r[i]}function b(e,t,n){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"===typeof e[r]||e[r]instanceof String||"string"===typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):b(e[r],t[r],n):e[r]=t[r]);return e}function w(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function k(e){return"string"===typeof e?e.replace(/[&<>"'\/]/g,(function(e){return S[e]})):e}var T=[" ",",","?","!",";"];function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var r=t.split(n),i=e,a=0;a<r.length;++a){if(!i)return;if("string"===typeof i[r[a]]&&a+1<r.length)return;if(void 0===i[r[a]]){for(var o=2,s=r.slice(a,a+o).join(n),c=i[s];void 0===c&&r.length>a+o;)o++,c=i[s=r.slice(a,a+o).join(n)];if(void 0===c)return;if(null===c)return null;if(t.endsWith(s)){if("string"===typeof c)return c;if(s&&"string"===typeof c[s])return c[s]}var u=r.slice(a+o).join(n);return u?I(c,u,n):void 0}i=i[r[a]]}return i}}function C(e){return e&&e.indexOf("_")>0?e.replace("_","-"):e}var R=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;(0,l.Z)(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return(r=t.call(this)).data=e||{},r.options=i,void 0===r.options.keySeparator&&(r.options.keySeparator="."),void 0===r.options.ignoreJSONStructure&&(r.options.ignoreJSONStructure=!0),r}return(0,d.Z)(n,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,a=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure,o=[e,t];n&&"string"!==typeof n&&(o=o.concat(n)),n&&"string"===typeof n&&(o=o.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(o=e.split("."));var s=E(this.data,o);return s||!a||"string"!==typeof n?s:I(this.data&&this.data[e]&&this.data[e][t],n,i)}},{key:"addResource",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},a=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,o=[e,t];n&&(o=o.concat(a?n.split(a):n)),e.indexOf(".")>-1&&(r=t,t=(o=e.split("."))[1]),this.addNamespaces(t),_(this.data,o,r),i.silent||this.emit("added",e,t,n,r)}},{key:"addResources",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)"string"!==typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(e,t,i,n[i],{silent:!0});r.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},o=[e,t];e.indexOf(".")>-1&&(r=n,n=t,t=(o=e.split("."))[1]),this.addNamespaces(t);var s=E(this.data,o)||{};r?b(s,n,i):s=(0,u.Z)((0,u.Z)({},s),n),_(this.data,o,s),a.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?(0,u.Z)((0,u.Z)({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),n}(v),A={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,r,i){var a=this;return e.forEach((function(e){a.processors[e]&&(t=a.processors[e].process(t,n,r,i))})),t}},O={},N=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;(0,l.Z)(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=t.call(this),function(e,t,n){e.forEach((function(e){t[e]&&(n[e]=t[e])}))}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,(0,o.Z)(r)),r.options=i,void 0===r.options.keySeparator&&(r.options.keySeparator="."),r.logger=h.create("translator"),r}return(0,d.Z)(n,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(void 0===e||null===e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS||[],a=n&&e.indexOf(n)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!function(e,t,n){t=t||"",n=n||"";var r=T.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===r.length)return!0;var i=new RegExp("(".concat(r.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),a=!i.test(e);if(!a){var o=e.indexOf(n);o>0&&!i.test(e.substring(0,o))&&(a=!0)}return a}(e,n,r);if(a&&!o){var s=e.match(this.interpolator.nestingRegexp);if(s&&s.length>0)return{key:e,namespaces:i};var c=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(c[0])>-1)&&(i=c.shift()),e=c.join(r)}return"string"===typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,t,r){var i=this;if("object"!==typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"===typeof t&&(t=(0,u.Z)({},t)),t||(t={}),void 0===e||null===e)return"";Array.isArray(e)||(e=[String(e)]);var a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,s=this.extractFromKey(e[e.length-1],t),c=s.key,l=s.namespaces,d=l[l.length-1],f=t.lng||this.language,p=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(f&&"cimode"===f.toLowerCase()){if(p){var h=t.nsSeparator||this.options.nsSeparator;return a?{res:"".concat(d).concat(h).concat(c),usedKey:c,exactUsedKey:c,usedLng:f,usedNS:d,usedParams:this.getUsedParamsDetails(t)}:"".concat(d).concat(h).concat(c)}return a?{res:c,usedKey:c,exactUsedKey:c,usedLng:f,usedNS:d,usedParams:this.getUsedParamsDetails(t)}:c}var v=this.resolve(e,t),m=v&&v.res,g=v&&v.usedKey||c,y=v&&v.exactUsedKey||c,_=Object.prototype.toString.apply(m),E=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject;if(b&&m&&("string"!==typeof m&&"boolean"!==typeof m&&"number"!==typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(_)<0&&("string"!==typeof E||"[object Array]"!==_)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var w=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,m,(0,u.Z)((0,u.Z)({},t),{},{ns:l})):"key '".concat(c," (").concat(this.language,")' returned an object instead of string.");return a?(v.res=w,v.usedParams=this.getUsedParamsDetails(t),v):w}if(o){var S="[object Array]"===_,k=S?[]:{},T=S?y:g;for(var I in m)if(Object.prototype.hasOwnProperty.call(m,I)){var C="".concat(T).concat(o).concat(I);k[I]=this.translate(C,(0,u.Z)((0,u.Z)({},t),{joinArrays:!1,ns:l})),k[I]===C&&(k[I]=m[I])}m=k}}else if(b&&"string"===typeof E&&"[object Array]"===_)(m=m.join(E))&&(m=this.extendTranslation(m,e,t,r));else{var R=!1,A=!1,O=void 0!==t.count&&"string"!==typeof t.count,N=n.hasDefaultValue(t),x=O?this.pluralResolver.getSuffix(f,t.count,t):"",D=t.ordinal&&O?this.pluralResolver.getSuffix(f,t.count,{ordinal:!1}):"",P=t["defaultValue".concat(x)]||t["defaultValue".concat(D)]||t.defaultValue;!this.isValidLookup(m)&&N&&(R=!0,m=P),this.isValidLookup(m)||(A=!0,m=c);var L=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&A?void 0:m,M=N&&P!==m&&this.options.updateMissing;if(A||R||M){if(this.logger.log(M?"updateKey":"missingKey",f,d,c,M?P:m),o){var U=this.resolve(c,(0,u.Z)((0,u.Z)({},t),{},{keySeparator:!1}));U&&U.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var j=[],F=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&F&&F[0])for(var V=0;V<F.length;V++)j.push(F[V]);else"all"===this.options.saveMissingTo?j=this.languageUtils.toResolveHierarchy(t.lng||this.language):j.push(t.lng||this.language);var B=function(e,n,r){var a=N&&r!==m?r:L;i.options.missingKeyHandler?i.options.missingKeyHandler(e,d,n,a,M,t):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,d,n,a,M,t),i.emit("missingKey",e,d,n,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&O?j.forEach((function(e){i.pluralResolver.getSuffixes(e,t).forEach((function(n){B([e],c+n,t["defaultValue".concat(n)]||P)}))})):B(j,c,P))}m=this.extendTranslation(m,e,t,v,r),A&&m===c&&this.options.appendNamespaceToMissingKey&&(m="".concat(d,":").concat(c)),(A||R)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(d,":").concat(c):c,R?m:void 0):this.options.parseMissingKeyHandler(m))}return a?(v.res=m,v.usedParams=this.getUsedParamsDetails(t),v):m}},{key:"extendTranslation",value:function(e,t,n,r,i){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,(0,u.Z)((0,u.Z)({},this.options.interpolation.defaultVariables),n),n.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init((0,u.Z)((0,u.Z)({},n),{interpolation:(0,u.Z)((0,u.Z)({},this.options.interpolation),n.interpolation)}));var o,s="string"===typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(s){var c=e.match(this.interpolator.nestingRegexp);o=c&&c.length}var l=n.replace&&"string"!==typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(l=(0,u.Z)((0,u.Z)({},this.options.interpolation.defaultVariables),l)),e=this.interpolator.interpolate(e,l,n.lng||this.language,n),s){var d=e.match(this.interpolator.nestingRegexp);o<(d&&d.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&r&&r.res&&(n.lng=r.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return i&&i[0]===r[0]&&!n.context?(a.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):a.translate.apply(a,r.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var f=n.postProcess||this.options.postProcess,p="string"===typeof f?[f]:f;return void 0!==e&&null!==e&&p&&p.length&&!1!==n.applyPostProcessor&&(e=A.handle(p,e,t,this.options&&this.options.postProcessPassResolved?(0,u.Z)({i18nResolved:r},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,r,i,a,o=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"===typeof e&&(e=[e]),e.forEach((function(e){if(!o.isValidLookup(t)){var c=o.extractFromKey(e,s),u=c.key;n=u;var l=c.namespaces;o.options.fallbackNS&&(l=l.concat(o.options.fallbackNS));var d=void 0!==s.count&&"string"!==typeof s.count,f=d&&!s.ordinal&&0===s.count&&o.pluralResolver.shouldUseIntlApi(),p=void 0!==s.context&&("string"===typeof s.context||"number"===typeof s.context)&&""!==s.context,h=s.lngs?s.lngs:o.languageUtils.toResolveHierarchy(s.lng||o.language,s.fallbackLng);l.forEach((function(e){o.isValidLookup(t)||(a=e,!O["".concat(h[0],"-").concat(e)]&&o.utils&&o.utils.hasLoadedNamespace&&!o.utils.hasLoadedNamespace(a)&&(O["".concat(h[0],"-").concat(e)]=!0,o.logger.warn('key "'.concat(n,'" for languages "').concat(h.join(", "),'" won\'t get resolved as namespace "').concat(a,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach((function(n){if(!o.isValidLookup(t)){i=n;var a,c=[u];if(o.i18nFormat&&o.i18nFormat.addLookupKeys)o.i18nFormat.addLookupKeys(c,u,n,e,s);else{var l;d&&(l=o.pluralResolver.getSuffix(n,s.count,s));var h="".concat(o.options.pluralSeparator,"zero"),v="".concat(o.options.pluralSeparator,"ordinal").concat(o.options.pluralSeparator);if(d&&(c.push(u+l),s.ordinal&&0===l.indexOf(v)&&c.push(u+l.replace(v,o.options.pluralSeparator)),f&&c.push(u+h)),p){var m="".concat(u).concat(o.options.contextSeparator).concat(s.context);c.push(m),d&&(c.push(m+l),s.ordinal&&0===l.indexOf(v)&&c.push(m+l.replace(v,o.options.pluralSeparator)),f&&c.push(m+h))}}for(;a=c.pop();)o.isValidLookup(t)||(r=a,t=o.getResource(n,e,a,s))}})))}))}})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:a}}},{key:"isValidLookup",value:function(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}},{key:"getUsedParamsDetails",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.replace&&"string"!==typeof e.replace,n=t?e.replace:e;if(t&&"undefined"!==typeof e.count&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n=(0,u.Z)((0,u.Z)({},this.options.interpolation.defaultVariables),n)),!t){n=(0,u.Z)({},n);var r,i=(0,a.Z)(["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]);try{for(i.s();!(r=i.n()).done;){delete n[r.value]}}catch(o){i.e(o)}finally{i.f()}}return n}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}]),n}(v);function x(e){return e.charAt(0).toUpperCase()+e.slice(1)}var D=function(){function e(t){(0,l.Z)(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=h.create("languageUtils")}return(0,d.Z)(e,[{key:"getScriptPartFromCode",value:function(e){if(!(e=C(e))||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!(e=C(e))||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"===typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=x(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=x(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=x(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var r=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(r)||(t=r)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var r=n.getLanguagePartFromCode(e);if(n.isSupportedCode(r))return t=r;t=n.options.supportedLngs.find((function(e){return e===r?e:e.indexOf("-")<0&&r.indexOf("-")<0?void 0:0===e.indexOf(r)?e:void 0}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"===typeof e&&(e=e(t)),"string"===typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],a=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"===typeof e&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&a(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&a(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&a(this.getLanguagePartFromCode(e))):"string"===typeof e&&a(this.formatLanguageCode(e)),r.forEach((function(e){i.indexOf(e)<0&&a(n.formatLanguageCode(e))})),i}}]),e}(),P=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],L={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},M=["v1","v2","v3"],U=["v4"],j={zero:0,one:1,two:2,few:3,many:4,other:5};var F=function(){function e(t){(0,l.Z)(this,e);var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=t,this.options=n,this.logger=h.create("pluralResolver"),this.options.compatibilityJSON&&!U.includes(this.options.compatibilityJSON)||"undefined"!==typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=function(){var e={};return P.forEach((function(t){t.lngs.forEach((function(n){e[n]={numbers:t.nr,plurals:L[t.fc]}}))})),e}()}return(0,d.Z)(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(C(e),{type:t.ordinal?"ordinal":"cardinal"})}catch(n){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((function(e,t){return j[e]-j[t]})).map((function(e){return"".concat(t.options.prepend).concat(n.ordinal?"ordinal".concat(t.options.prepend):"").concat(e)})):r.numbers.map((function(r){return t.getSuffix(e,r,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(n.ordinal?"ordinal".concat(this.options.prepend):"").concat(r.select(t)):this.getSuffixRetroCompatible(r,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),i=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var a=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"===typeof i?"_plural_".concat(i.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?a():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}},{key:"shouldUseIntlApi",value:function(){return!M.includes(this.options.compatibilityJSON)}}]),e}();function V(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=function(e,t,n){var r=E(e,n);return void 0!==r?r:E(t,n)}(e,t,n);return!a&&i&&"string"===typeof n&&void 0===(a=I(e,n,r))&&(a=I(t,n,r)),a}var B=function(){function e(){(0,l.Z)(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=h.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return(0,d.Z)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:k,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?w(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?w(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?w(t.nestingPrefix):t.nestingPrefixEscaped||w("$t("),this.nestingSuffix=t.nestingSuffix?w(t.nestingSuffix):t.nestingSuffixEscaped||w(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,r){var i,a,o,s=this,c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function l(e){return e.replace(/\$/g,"$$$$")}var d=function(e){if(e.indexOf(s.formatSeparator)<0){var i=V(t,c,e,s.options.keySeparator,s.options.ignoreJSONStructure);return s.alwaysFormat?s.format(i,void 0,n,(0,u.Z)((0,u.Z)((0,u.Z)({},r),t),{},{interpolationkey:e})):i}var a=e.split(s.formatSeparator),o=a.shift().trim(),l=a.join(s.formatSeparator).trim();return s.format(V(t,c,o,s.options.keySeparator,s.options.ignoreJSONStructure),l,n,(0,u.Z)((0,u.Z)((0,u.Z)({},r),t),{},{interpolationkey:o}))};this.resetRegExp();var f=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,p=r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return l(e)}},{regex:this.regexp,safeValue:function(e){return s.escapeValue?l(s.escape(e)):l(e)}}].forEach((function(t){for(o=0;i=t.regex.exec(e);){var n=i[1].trim();if(void 0===(a=d(n)))if("function"===typeof f){var c=f(e,i,r);a="string"===typeof c?c:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))a="";else{if(p){a=i[0];continue}s.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),a=""}else"string"===typeof a||s.useRawValueToEscape||(a=g(a));var u=t.safeValue(a);if(e=e.replace(i[0],u),p?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,++o>=s.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,r,i,a=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function s(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var r=e.split(new RegExp("".concat(n,"[ ]*{"))),a="{".concat(r[1]);e=r[0];var o=(a=this.interpolate(a,i)).match(/'/g),s=a.match(/"/g);(o&&o.length%2===0&&!s||s.length%2!==0)&&(a=a.replace(/'/g,'"'));try{i=JSON.parse(a),t&&(i=(0,u.Z)((0,u.Z)({},t),i))}catch(c){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),c),"".concat(e).concat(n).concat(a)}return delete i.defaultValue,e}for(;n=this.nestingRegexp.exec(e);){var c=[];(i=(i=(0,u.Z)({},o)).replace&&"string"!==typeof i.replace?i.replace:i).applyPostProcessor=!1,delete i.defaultValue;var l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var d=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=d.shift(),c=d,l=!0}if((r=t(s.call(this,n[1].trim(),i),i))&&n[0]===e&&"string"!==typeof r)return r;"string"!==typeof r&&(r=g(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),r=""),l&&(r=c.reduce((function(e,t){return a.format(e,t,o.lng,(0,u.Z)((0,u.Z)({},o),{},{interpolationkey:n[1].trim()}))}),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}]),e}();function G(e){var t={};return function(n,r,i){var a=r+JSON.stringify(i),o=t[a];return o||(o=e(C(r),i),t[a]=o),o(n)}}var Z=function(){function e(){(0,l.Z)(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=h.create("formatter"),this.options=t,this.formats={number:G((function(e,t){var n=new Intl.NumberFormat(e,(0,u.Z)({},t));return function(e){return n.format(e)}})),currency:G((function(e,t){var n=new Intl.NumberFormat(e,(0,u.Z)((0,u.Z)({},t),{},{style:"currency"}));return function(e){return n.format(e)}})),datetime:G((function(e,t){var n=new Intl.DateTimeFormat(e,(0,u.Z)({},t));return function(e){return n.format(e)}})),relativetime:G((function(e,t){var n=new Intl.RelativeTimeFormat(e,(0,u.Z)({},t));return function(e){return n.format(e,t.range||"day")}})),list:G((function(e,t){var n=new Intl.ListFormat(e,(0,u.Z)({},t));return function(e){return n.format(e)}}))},this.init(t)}return(0,d.Z)(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=G(t)}},{key:"format",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.split(this.formatSeparator).reduce((function(e,t){var o=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var r=e.split("(");t=r[0].toLowerCase().trim();var a=r[1].substring(0,r[1].length-1);"currency"===t&&a.indexOf(":")<0?n.currency||(n.currency=a.trim()):"relativetime"===t&&a.indexOf(":")<0?n.range||(n.range=a.trim()):a.split(";").forEach((function(e){if(e){var t=e.split(":"),r=(0,i.Z)(t),a=r[0],o=r.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[a.trim()]||(n[a.trim()]=o),"false"===o&&(n[a.trim()]=!1),"true"===o&&(n[a.trim()]=!0),isNaN(o)||(n[a.trim()]=parseInt(o,10))}}))}return{formatName:t,formatOptions:n}}(t),s=o.formatName,c=o.formatOptions;if(r.formats[s]){var l=e;try{var d=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},f=d.locale||d.lng||a.locale||a.lng||n;l=r.formats[s](e,f,(0,u.Z)((0,u.Z)((0,u.Z)({},c),a),d))}catch(p){r.logger.warn(p)}return l}return r.logger.warn("there was no format function for ".concat(s)),e}),e)}}]),e}();var q=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e,r,i){var a;(0,l.Z)(this,n);var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(a=t.call(this)).backend=e,a.store=r,a.services=i,a.languageUtils=i.languageUtils,a.options=o,a.logger=h.create("backendConnector"),a.waitingReads=[],a.maxParallelReads=o.maxParallelReads||10,a.readingCalls=0,a.maxRetries=o.maxRetries>=0?o.maxRetries:5,a.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(i,o.backend,o),a}return(0,d.Z)(n,[{key:"queueLoad",value:function(e,t,n,r){var i=this,a={},o={},s={},c={};return e.forEach((function(e){var r=!0;t.forEach((function(t){var s="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[s]=2:i.state[s]<0||(1===i.state[s]?void 0===o[s]&&(o[s]=!0):(i.state[s]=1,r=!1,void 0===o[s]&&(o[s]=!0),void 0===a[s]&&(a[s]=!0),void 0===c[t]&&(c[t]=!0)))})),r||(s[e]=!0)})),(Object.keys(a).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(a),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(c)}}},{key:"loaded",value:function(e,t,n){var r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),n&&this.store.addResourceBundle(i,a,n),this.state[e]=t?-1:2;var o={};this.queue.forEach((function(n){!function(e,t,n,r){var i=y(e,t,Object),a=i.obj,o=i.k;a[o]=a[o]||[],r&&(a[o]=a[o].concat(n)),r||a[o].push(n)}(n.loaded,[i],a),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(e){o[e]||(o[e]={});var t=n.loaded[e];t.length&&t.forEach((function(t){void 0===o[e][t]&&(o[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",o),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:a,callback:o});else{this.readingCalls++;var s=function(s,c){if(r.readingCalls--,r.waitingReads.length>0){var u=r.waitingReads.shift();r.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}s&&c&&i<r.maxRetries?setTimeout((function(){r.read.call(r,e,t,n,i+1,2*a,o)}),a):o(s,c)},c=this.backend[n].bind(this.backend);if(2!==c.length)return c(e,t,s);try{var u=c(e,t);u&&"function"===typeof u.then?u.then((function(e){return s(null,e)})).catch(s):s(null,u)}catch(l){s(l)}}}},{key:"prepareLoading",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"===typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"===typeof t&&(t=[t]);var a=this.queueLoad(e,t,r,i);if(!a.toLoad.length)return a.pending.length||i(),null;a.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),i=r[0],a=r[1];this.read(i,a,"read",void 0,void 0,(function(r,o){r&&t.logger.warn("".concat(n,"loading namespace ").concat(a," for language ").concat(i," failed"),r),!r&&o&&t.logger.log("".concat(n,"loaded namespace ").concat(a," for language ").concat(i),o),t.loaded(e,r,o)}))}},{key:"saveMissing",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(void 0!==n&&null!==n&&""!==n){if(this.backend&&this.backend.create){var s=(0,u.Z)((0,u.Z)({},a),{},{isUpdate:i}),c=this.backend.create.bind(this.backend);if(c.length<6)try{var l;(l=5===c.length?c(e,t,n,r,s):c(e,t,n,r))&&"function"===typeof l.then?l.then((function(e){return o(null,e)})).catch(o):o(null,l)}catch(d){o(d)}else c(e,t,n,r,o,s)}e&&e[0]&&this.store.addResource(e[0],t,n,r)}}}]),n}(v);function W(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===typeof e[1]&&(t=e[1]),"string"===typeof e[1]&&(t.defaultValue=e[1]),"string"===typeof e[2]&&(t.tDescription=e[2]),"object"===typeof e[2]||"object"===typeof e[3]){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function H(e){return"string"===typeof e.ns&&(e.ns=[e.ns]),"string"===typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"===typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function K(){}var z=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,l.Z)(this,n);var i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if((e=t.call(this)).options=H(a),e.services={},e.logger=h,e.modules={external:[]},i=(0,o.Z)(e),Object.getOwnPropertyNames(Object.getPrototypeOf(i)).forEach((function(e){"function"===typeof i[e]&&(i[e]=i[e].bind(i))})),s&&!e.isInitialized&&!a.isClone){if(!e.options.initImmediate)return e.init(a,s),(0,r.Z)(e,(0,o.Z)(e));setTimeout((function(){e.init(a,s)}),0)}return e}return(0,d.Z)(n,[{key:"init",value:function(){var e=this,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;"function"===typeof n&&(r=n,n={}),!n.defaultNS&&!1!==n.defaultNS&&n.ns&&("string"===typeof n.ns?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));var i=W();function a(e){return e?"function"===typeof e?new e:e:null}if(this.options=(0,u.Z)((0,u.Z)((0,u.Z)({},i),this.options),H(n)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=(0,u.Z)((0,u.Z)({},i.interpolation),this.options.interpolation)),void 0!==n.keySeparator&&(this.options.userDefinedKeySeparator=n.keySeparator),void 0!==n.nsSeparator&&(this.options.userDefinedNsSeparator=n.nsSeparator),!this.options.isClone){var o;this.modules.logger?h.init(a(this.modules.logger),this.options):h.init(null,this.options),this.modules.formatter?o=this.modules.formatter:"undefined"!==typeof Intl&&(o=Z);var s=new D(this.options);this.store=new R(this.options.resources,this.options);var c=this.services;c.logger=h,c.resourceStore=this.store,c.languageUtils=s,c.pluralResolver=new F(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!o||this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format||(c.formatter=a(o),c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new B(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new q(a(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e].concat(r))})),this.modules.languageDetector&&(c.languageDetector=a(this.modules.languageDetector),c.languageDetector.init&&c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=a(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new N(this.services,this.options),this.translator.on("*",(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e].concat(r))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,r||(r=K),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(n){e[n]=function(){var e;return(e=t.store)[n].apply(e,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(n){e[n]=function(){var e;return(e=t.store)[n].apply(e,arguments),t}}));var d=m(),f=function(){var t=function(t,n){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),d.resolve(n),r(t,n)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?f():setTimeout(f,0),d}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K,r="string"===typeof e?e:this.language;if("function"===typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return n();var i=[],a=function(e){e&&("cimode"!==e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){"cimode"!==e&&i.indexOf(e)<0&&i.push(e)})))};if(r)a(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return a(e)}));this.options.preload&&this.options.preload.forEach((function(e){return a(e)})),this.services.backendConnector.load(i,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var r=m();return e||(e=this.languages),t||(t=this.options.ns),n||(n=K),this.services.backendConnector.reload(e,t,(function(e){r.resolve(),n(e)})),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&A.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this,r=this;this.isLanguageChangingTo=e;var i=m();this.emit("languageChanging",e);var a=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},o=function(o){e||o||!n.services.languageDetector||(o=[]);var s="string"===typeof o?o:n.services.languageUtils.getBestMatchFromCodes(o);s&&(n.language||a(s),n.translator.language||n.translator.changeLanguage(s),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage&&n.services.languageDetector.cacheUserLanguage(s)),n.loadResources(s,(function(e){!function(e,o){o?(a(o),n.translator.changeLanguage(o),n.isLanguageChangingTo=void 0,n.emit("languageChanged",o),n.logger.log("languageChanged",o)):n.isLanguageChangingTo=void 0,i.resolve((function(){return r.t.apply(r,arguments)})),t&&t(e,(function(){return r.t.apply(r,arguments)}))}(e,s)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),i}},{key:"getFixedT",value:function(e,t,n){var r=this,i=function e(t,i){var a;if("object"!==typeof i){for(var o=arguments.length,s=new Array(o>2?o-2:0),c=2;c<o;c++)s[c-2]=arguments[c];a=r.options.overloadTranslationOptionHandler([t,i].concat(s))}else a=(0,u.Z)({},i);a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns,a.keyPrefix=a.keyPrefix||n||e.keyPrefix;var l,d=r.options.keySeparator||".";return l=a.keyPrefix&&Array.isArray(t)?t.map((function(e){return"".concat(a.keyPrefix).concat(d).concat(e)})):a.keyPrefix?"".concat(a.keyPrefix).concat(d).concat(t):t,r.t(l,a)};return"string"===typeof e?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=n.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,a=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var o=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};if(n.precheck){var s=n.precheck(this,o);if(void 0!==s)return s}return!!this.hasResourceBundle(r,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!o(r,e)||i&&!o(a,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,r=m();return this.options.ns?("string"===typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=m();"string"===typeof e&&(e=[e]);var r=this.options.preload||[],i=e.filter((function(e){return r.indexOf(e)<0}));return i.length?(this.options.preload=r.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";var t=this.services&&this.services.languageUtils||new D(W());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K,i=t.forkResourceStore;i&&delete t.forkResourceStore;var a=(0,u.Z)((0,u.Z)((0,u.Z)({},this.options),t),{isClone:!0}),o=new n(a);void 0===t.debug&&void 0===t.prefix||(o.logger=o.logger.clone(t));return["store","services","language"].forEach((function(t){o[t]=e[t]})),o.services=(0,u.Z)({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i&&(o.store=new R(this.store.data,a),o.services.resourceStore=o.store),o.translator=new N(o.services,a),o.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];o.emit.apply(o,[e].concat(n))})),o.init(a,r),o.translator.options=a,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}],[{key:"createInstance",value:function(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}}]),n}(v),Y=z.createInstance();Y.createInstance=z.createInstance;Y.createInstance,Y.dir,Y.init,Y.loadResources,Y.reloadResources,Y.use,Y.changeLanguage,Y.getFixedT,Y.t,Y.exists,Y.setDefaultNamespace,Y.hasLoadedNamespace,Y.loadNamespaces,Y.loadLanguages;var J=n(9230),X=JSON.parse('{"Sidebar":{"Dashboard":"Dashboard","UserManagement":"User Management","PushNotification":"Push notification","Reply":"Reply","AdminSetting":"Admin Setting","ChangeLanguage":"Change Language","LogOut":"Logout"},"Header":{"Dashboard":"Dashboard","UserManagement":"User Management","NotificationManagement":"Notification Management","AdminSetting":"Admin Setting","WelcomeBack":"Welcome Back \ud83c\udf89","ReplyForClients":"Reply for clients","ChangeLanguage":"Change Language"},"Dashboard":{"NumberOfPremiumUsers":"Number of Premium users","NumberOfRegisteredUsers":"Number of Registered users","NumberOfActiveUsers":"Number of active users","SummaryOfUsersState":"Summary of users state","SummaryOfGender":"Summary of Gender"},"UserManagement":{"Results":"Results","ClearFilters":"Clear filters","FilterBy":"Filter by","SerialNumber":"S/N","UserId":"User ID","Phone":"Phone","Email":"Email","Avatar":"Avatar","UserName":"User Name","Gender":"Gender","Age":"Age","Location":"Location","Action":"Action","Showing":"Showing","SubscriptionType":"Subscription Type"},"SendMessage":{"SendMessage":"Send Message","VerifyUser":"Verify User","DeleteUser":"Delete User","SusupendUser":"Susupend User","To":"To","Message":"Message","Send":"Send","TypeMessageHere":"Type message here","YouAreAboutToVerify":"You are about to active","YouAreAboutToDelete":"You are about to delete","ClickConfirmToVerify":"click confirm to active","ClickConfirmToDelete":"click confirm to delete","Confirm":"Confirm","Cancel":"Cancel","YouAreAboutToSuspend":"You are about to disable","ClickConfirmToSuspend":"click confirm to disable","MessageSent":"Message sent","YourMessageHasBeenSentSuccessfully":"Your message has been sent successfully"},"Notification":{"NewNotification":"New Notification","Type":"Type","Search":"Search","UserEmailOrUsername":"useremail or username","Number":"No","NotificationMessagelete":"Notification Message","NotificationType":"Notification Type","CreateTime":"Create Time","Action":"Action","Delete":"Delete","Title":"Title"},"EnterMessage":{"EnterMessage":"Enter Message"},"Login":{"Login":"Login","Username":"Username","Password":"Password"},"AdminSetting":{"ChangeAdminPassword":"Change Admin Password","PreviousPassword":"Previous Password","NewPassword":"New Password","RepeatPassword":"Repeat Password","ChangePassword":"Change password"}}'),Q=JSON.parse('{"Sidebar":{"Dashboard":"\ub300\uc2dc \ubcf4\ub4dc","UserManagement":"\uc0ac\uc6a9\uc790 \uad00\ub9ac","PushNotification":"\ud478\uc2dc \uc54c\ub9bc","Reply":"\ud68c\uc2e0","AdminSetting":"\uad00\ub9ac\uc790 \uc124\uc815","ChangeLanguage":"\uc5b8\uc5b4 \ubcc0\uacbd","LogOut":"\ub85c\uadf8\uc544\uc6c3"},"Header":{"Dashboard":"\ub300\uc2dc \ubcf4\ub4dc","UserManagement":"\uc0ac\uc6a9\uc790 \uad00\ub9ac","NotificationManagement":"\uc54c\ub9bc \uad00\ub9ac","AdminSetting":"\uad00\ub9ac\uc790 \uc124\uc815","WelcomeBack":"\ub2e4\uc2dc \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4 \ud83c\udf89","ReplyForClients":"\uace0\uac1d\uc5d0 \ub300\ud55c \ud68c\uc2e0","ChangeLanguage":"\uc5b8\uc5b4 \ubcc0\uacbd"},"Dashboard":{"NumberOfRegisteredUsers":"\ub4f1\ub85d\ub41c \uc0ac\uc6a9\uc790 \uc218","NumberOfActiveUsers":"\ud65c\uc131 \uc0ac\uc6a9\uc790 \uc218","SummaryOfUsersState":"\uc0ac\uc6a9\uc790 \uc0c1\ud0dc \uc694\uc57d"},"UserManagement":{"Results":"\uacb0\uacfc","ClearFilters":"\ud544\ud130 \uc9c0\uc6b0\uae30","FilterBy":"\ud544\ud130\ub9c1 \uae30\uc900","SerialNumber":"\uc77c\ub828 \ubc88\ud638","UserId":"\uc0ac\uc6a9\uc790 ID","UserName":"\uc0ac\uc6a9\uc790 \uc774\ub984","Gender":"\uc131\ubcc4","Age":"\ub098\uc774","Location":"\uc704\uce58","Action":"\ub3d9\uc791","Showing":"\ud45c\uc2dc \uc911"},"SendMessage":{"SendMessage":"\uba54\uc2dc\uc9c0 \ubcf4\ub0b4\uae30","VerifyUser":"\uc0ac\uc6a9\uc790 \ud655\uc778","SusupendUser":"\uc0ac\uc6a9\uc790 \uc815\uc9c0","To":"\ubc1b\ub294 \uc0ac\ub78c","Message":"\uba54\uc2dc\uc9c0","Send":"\uc804\uc1a1","TypeMessageHere":"\uc5ec\uae30\uc5d0 \uba54\uc2dc\uc9c0 \uc785\ub825","YouAreAboutToVerify":"\uc0ac\uc6a9\uc790 \ud655\uc778\uc744 \uc9c4\ud589 \uc911\uc785\ub2c8\ub2e4","ClickConfirmToVerify":"\ud655\uc778\ud558\ub824\uba74 \ud074\ub9ad","Confirm":"\ud655\uc778","Cancel":"\ucde8\uc18c","YouAreAboutToSuspend":"\uc0ac\uc6a9\uc790 \uc815\uc9c0\ub97c \uc9c4\ud589 \uc911\uc785\ub2c8\ub2e4","ClickConfirmToSuspend":"\ud655\uc778\ud558\ub824\uba74 \ud074\ub9ad","MessageSent":"\uba54\uc2dc\uc9c0 \uc804\uc1a1\ub428","YourMessageHasBeenSentSuccessfully":"\uba54\uc2dc\uc9c0\uac00 \uc131\uacf5\uc801\uc73c\ub85c \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4"},"Notification":{"NewNotification":"\uc0c8\ub85c\uc6b4 \uc54c\ub9bc","Type":"\uc720\ud615","Search":"\uac80\uc0c9","UserEmailOrUsername":"\uc0ac\uc6a9\uc790 \uc774\uba54\uc77c \ub610\ub294 \uc0ac\uc6a9\uc790 \uc774\ub984","Number":"\ubc88\ud638","NotificationMessagelete":"\uc54c\ub9bc \uba54\uc2dc\uc9c0","NotificationType":"\uc54c\ub9bc \uc720\ud615","CreateTime":"\uc0dd\uc131 \uc2dc\uac04","Action":"\ub3d9\uc791","Delete":"\uc0ad\uc81c"},"EnterMessage":{"EnterMessage":"\uba54\uc2dc\uc9c0 \uc785\ub825"},"Login":{"Login":"\ub85c\uadf8\uc778","Username":"\uc0ac\uc6a9\uc790 \uc774\ub984","Password":"\ube44\ubc00\ubc88\ud638"},"AdminSetting":{"ChangeAdminPassword":"\uad00\ub9ac\uc790 \ube44\ubc00\ubc88\ud638 \ubcc0\uacbd","PreviousPassword":"\uc774\uc804 \ube44\ubc00\ubc88\ud638","NewPassword":"\uc0c8 \ube44\ubc00\ubc88\ud638","RepeatPassword":"\ube44\ubc00\ubc88\ud638 \ubc18\ubcf5","ChangePassword":"\ube44\ubc00\ubc88\ud638 \ubcc0\uacbd"}}'),$=JSON.parse('{"Sidebar":{"Dashboard":"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9","UserManagement":"\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406","PushNotification":"\u30d7\u30c3\u30b7\u30e5\u901a\u77e5","Reply":"\u8fd4\u4fe1","AdminSetting":"\u7ba1\u7406\u8005\u8a2d\u5b9a","ChangeLanguage":"\u8a00\u8a9e\u3092\u5909\u66f4","LogOut":"\u30ed\u30b0\u30a2\u30a6\u30c8"},"Header":{"Dashboard":"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9","UserManagement":"\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406","NotificationManagement":"\u901a\u77e5\u7ba1\u7406","AdminSetting":"\u7ba1\u7406\u8005\u8a2d\u5b9a","WelcomeBack":"\u304a\u5e30\u308a\u306a\u3055\u3044 \ud83c\udf89","ReplyForClients":"\u9867\u5ba2\u3078\u306e\u8fd4\u4fe1","ChangeLanguage":"\u8a00\u8a9e\u3092\u5909\u66f4"},"Dashboard":{"NumberOfRegisteredUsers":"\u767b\u9332\u30e6\u30fc\u30b6\u30fc\u6570","NumberOfActiveUsers":"\u30a2\u30af\u30c6\u30a3\u30d6\u30e6\u30fc\u30b6\u30fc\u6570","SummaryOfUsersState":"\u30e6\u30fc\u30b6\u30fc\u72b6\u614b\u306e\u8981\u7d04"},"UserManagement":{"Results":"\u7d50\u679c","ClearFilters":"\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30af\u30ea\u30a2","FilterBy":"\u30d5\u30a3\u30eb\u30bf\u30fc","SerialNumber":"\u30b7\u30ea\u30a2\u30eb\u756a\u53f7","UserId":"\u30e6\u30fc\u30b6\u30fcID","UserName":"\u30e6\u30fc\u30b6\u30fc\u540d","Gender":"\u6027\u5225","Age":"\u5e74\u9f62","Location":"\u5834\u6240","Action":"\u30a2\u30af\u30b7\u30e7\u30f3","Showing":"\u8868\u793a\u4e2d"},"SendMessage":{"SendMessage":"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1","VerifyUser":"\u30e6\u30fc\u30b6\u30fc\u3092\u78ba\u8a8d","SusupendUser":"\u30e6\u30fc\u30b6\u30fc\u3092\u505c\u6b62","To":"\u5b9b\u5148","Message":"\u30e1\u30c3\u30bb\u30fc\u30b8","Send":"\u9001\u4fe1","TypeMessageHere":"\u3053\u3053\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b","YouAreAboutToVerify":"\u30e6\u30fc\u30b6\u30fc\u3092\u78ba\u8a8d\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","ClickConfirmToVerify":"\u78ba\u8a8d\u3059\u308b\u306b\u306f\u30af\u30ea\u30c3\u30af","Confirm":"\u78ba\u8a8d","Cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","YouAreAboutToSuspend":"\u30e6\u30fc\u30b6\u30fc\u3092\u505c\u6b62\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059","ClickConfirmToSuspend":"\u78ba\u8a8d\u3059\u308b\u306b\u306f\u30af\u30ea\u30c3\u30af","MessageSent":"\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3057\u305f","YourMessageHasBeenSentSuccessfully":"\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6b63\u5e38\u306b\u9001\u4fe1\u3055\u308c\u307e\u3057\u305f"},"Notification":{"NewNotification":"\u65b0\u3057\u3044\u901a\u77e5","Type":"\u7a2e\u985e","Search":"\u691c\u7d22","UserEmailOrUsername":"\u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30e6\u30fc\u30b6\u30fc\u540d","Number":"\u756a\u53f7","NotificationMessagelete":"\u901a\u77e5\u30e1\u30c3\u30bb\u30fc\u30b8","NotificationType":"\u901a\u77e5\u306e\u7a2e\u985e","CreateTime":"\u4f5c\u6210\u6642\u523b","Action":"\u30a2\u30af\u30b7\u30e7\u30f3","Delete":"\u524a\u9664"},"EnterMessage":{"EnterMessage":"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b"},"Login":{"Login":"\u30ed\u30b0\u30a4\u30f3","Username":"\u30e6\u30fc\u30b6\u30fc\u540d","Password":"\u30d1\u30b9\u30ef\u30fc\u30c9"},"AdminSetting":{"ChangeAdminPassword":"\u7ba1\u7406\u8005\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4","PreviousPassword":"\u4ee5\u524d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9","NewPassword":"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9","RepeatPassword":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u7e70\u308a\u8fd4\u3059","ChangePassword":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4"}}');Y.use(J.Db).init({resources:{en:{translation:X},ko:{translation:Q},jp:{translation:$}},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});var ee=Y},7710:function(e,t,n){"use strict";n.d(t,{hR:function(){return i},hc:function(){return o},tV:function(){return s},ur:function(){return a}});var r=n(1778),i=function(e){switch(e){case"/dashboard":return r.Z.t("Header.Dashboard");case"/login":case"/":return r.Z.t("Header.WelcomeBack");case"/changeLanguage":return r.Z.t("Header.ChangeLanguage");case"/usermanagement":return r.Z.t("Header.UserManagement");case"/adminsetting":return r.Z.t("Header.AdminSetting");case"/reply":return r.Z.t("Header.ReplyForClients");case"/pushnotification":return r.Z.t("Header.NotificationManagement")}},a="b6bd836cb84b4c16af13e61eb114ff1e",o="test_call",s="007eJxTYGCU/hseujd1esriayXtumWLXBmeRNRK/15xqXNvSpJ+p4UCQ5JZUoqFsVlykoVJkkmyoVlimqFxqplhapKhoUlammGqt5J3akMgI8PZiamMjAwQCOJzMpSkFpfEJyfm5DAwAADNSSD5"},5854:function(e,t,n){"use strict";n.d(t,{$s:function(){return z},BH:function(){return w},L:function(){return h},LL:function(){return D},P0:function(){return _},Pz:function(){return b},Sg:function(){return S},ZR:function(){return x},aH:function(){return E},b$:function(){return C},eu:function(){return O},hl:function(){return A},m9:function(){return Y},ne:function(){return B},pd:function(){return V},q4:function(){return y},ru:function(){return I},tV:function(){return v},uI:function(){return T},vZ:function(){return M},w1:function(){return R},xO:function(){return j},xb:function(){return L},z$:function(){return k},zI:function(){return N},zd:function(){return F}});var r=n(7762),i=n(9439),a=n(7326),o=n(3144),s=n(5671),c=n(136),u=n(9388),l=n(8664),d=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,c=i+2<e.length,u=c?e[i+2]:0,l=a>>2,d=(3&a)<<4|s>>4,f=(15&s)<<2|u>>6,p=63&u;c||(p=64,o||(f=64)),r.push(n[l],n[d],n[f],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(d(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],c=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&c)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==c)throw new p;var u=a<<2|o>>4;if(r.push(u),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==c){var d=s<<6&192|c;r.push(d)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},p=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).name="DecodeBase64StringError",e}return(0,o.Z)(n)}((0,l.Z)(Error)),h=function(e){return function(e){var t=d(e);return f.encodeByteArray(t,!0)}(e).replace(/\./g,"")},v=function(e){try{return f.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};var m=function(){return function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__},g=function(){try{return m()||function(){if("undefined"!==typeof process){var e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}}()||function(){if("undefined"!==typeof document){var e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}var t=e&&v(e[1]);return t&&JSON.parse(t)}}()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},y=function(e){var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},_=function(e){var t=y(e);if(t){var n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));var r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]}},E=function(){var e;return null===(e=g())||void 0===e?void 0:e.config},b=function(e){var t;return null===(t=g())||void 0===t?void 0:t["_".concat(e)]},w=function(){function e(){var t=this;(0,s.Z)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return(0,o.Z)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function S(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(a)),""].join(".")}function k(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function T(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(k())}function I(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function C(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function R(){var e=k();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function A(){try{return"object"===typeof indexedDB}catch(e){return!1}}function O(){return new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(a){t(a)}}))}function N(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}var x=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var o;return(0,s.Z)(this,n),(o=t.call(this,r)).code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf((0,a.Z)(o),n.prototype),Error.captureStackTrace&&Error.captureStackTrace((0,a.Z)(o),D.prototype.create),o}return(0,o.Z)(n)}((0,l.Z)(Error)),D=function(){function e(t,n,r){(0,s.Z)(this,e),this.service=t,this.serviceName=n,this.errors=r}return(0,o.Z)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(P,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new x(n,a,t)}}]),e}();var P=/\{\$([^}]+)}/g;function L(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function M(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],c=t[o];if(U(s)&&U(c)){if(!M(s,c))return!1}else if(s!==c)return!1}for(var u=0,l=r;u<l.length;u++){var d=l[u];if(!n.includes(d))return!1}return!0}function U(e){return null!==e&&"object"===typeof e}function j(e){for(var t=[],n=function(){var e=(0,i.Z)(a[r],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},r=0,a=Object.entries(e);r<a.length;r++)n();return t.length?"&"+t.join("&"):""}function F(e){var t={};return e.replace(/^\?/,"").split("&").forEach((function(e){if(e){var n=e.split("="),r=(0,i.Z)(n,2),a=r[0],o=r[1];t[decodeURIComponent(a)]=decodeURIComponent(o)}})),t}function V(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function B(e,t){var n=new G(e,t);return n.subscribe.bind(n)}var G=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return(0,o.Z)(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var i,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(e,t){if("object"!==typeof e||null===e)return!1;var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(i.next=Z),void 0===i.error&&(i.error=Z),void 0===i.complete&&(i.complete=Z);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?i.error(a.finalError):i.complete()}catch(e){}})),this.observers.push(i),o}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function Z(){}var q=1e3,W=2,H=144e5,K=.5;function z(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:q)*Math.pow(t,e),r=Math.round(K*n*(Math.random()-.5)*2);return Math.min(H,n+r)}function Y(e){return e&&e._delegate?e._delegate:e}},8278:function(e,t,n){"use strict";n.d(t,{J0:function(){return g},RQ:function(){return G},WK:function(){return K},X3:function(){return H},Zn:function(){return j},Zq:function(){return V},aU:function(){return r},cP:function(){return w},fp:function(){return k},lX:function(){return m},pC:function(){return B}});var r,i=n(3144),a=n(5671),o=n(136),s=n(9388),c=n(8664),u=n(9439),l=n(4506),d=n(7762),f=n(3433);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));var h,v="popstate";function m(e){return void 0===e&&(e={}),S((function(e,t){var n=e.location;return E("",{pathname:n.pathname,search:n.search,hash:n.hash},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:b(t)}),null,e)}function g(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function y(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function _(e,t){return{usr:e.state,key:e.key,idx:t}}function E(e,t,n,r){return void 0===n&&(n=null),p({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?w(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function b(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,i=void 0===r?"":r,a=e.hash,o=void 0===a?"":a;return i&&"?"!==i&&(n+="?"===i.charAt(0)?i:"?"+i),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function w(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function S(e,t,n,i){void 0===i&&(i={});var a=i,o=a.window,s=void 0===o?document.defaultView:o,c=a.v5Compat,u=void 0!==c&&c,l=s.history,d=r.Pop,f=null,h=m();function m(){return(l.state||{idx:null}).idx}function y(){d=r.Pop;var e=m(),t=null==e?null:e-h;h=e,f&&f({action:d,location:S.location,delta:t})}function w(e){var t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:b(e);return g(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==h&&(h=0,l.replaceState(p({},l.state,{idx:h}),""));var S={get action(){return d},get location(){return e(s,l)},listen:function(e){if(f)throw new Error("A history only accepts one active listener");return s.addEventListener(v,y),f=e,function(){s.removeEventListener(v,y),f=null}},createHref:function(e){return t(s,e)},createURL:w,encodeLocation:function(e){var t=w(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){d=r.Push;var i=E(S.location,e,t);n&&n(i,e);var a=_(i,h=m()+1),o=S.createHref(i);try{l.pushState(a,"",o)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;s.location.assign(o)}u&&f&&f({action:d,location:S.location,delta:1})},replace:function(e,t){d=r.Replace;var i=E(S.location,e,t);n&&n(i,e);var a=_(i,h=m()),o=S.createHref(i);l.replaceState(a,"",o),u&&f&&f({action:d,location:S.location,delta:0})},go:function(e){return l.go(e)}};return S}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(h||(h={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function k(e,t,n){void 0===n&&(n="/");var r=j(("string"===typeof t?w(t):t).pathname||"/",n);if(null==r)return null;var i=T(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(i);for(var a=null,o=0;null==a&&o<i.length;++o)a=L(i[o],U(r));return a}function T(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");var i=function(e,i,a){var o={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};o.relativePath.startsWith("/")&&(g(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));var s=G([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(g(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),T(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:P(s,e.index),routesMeta:c})};return e.forEach((function(e,t){var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?")){var r,a=(0,d.Z)(I(e.path));try{for(a.s();!(r=a.n()).done;){var o=r.value;i(e,t,o)}}catch(s){a.e(s)}finally{a.f()}}else i(e,t)})),t}function I(e){var t=e.split("/");if(0===t.length)return[];var n=(0,l.Z)(t),r=n[0],i=n.slice(1),a=r.endsWith("?"),o=r.replace(/\?$/,"");if(0===i.length)return a?[o,""]:[o];var s=I(i.join("/")),c=[];return c.push.apply(c,(0,f.Z)(s.map((function(e){return""===e?o:[o,e].join("/")})))),a&&c.push.apply(c,(0,f.Z)(s)),c.map((function(t){return e.startsWith("/")&&""===t?"/":t}))}var C=/^:\w+$/,R=3,A=2,O=1,N=10,x=-2,D=function(e){return"*"===e};function P(e,t){var n=e.split("/"),r=n.length;return n.some(D)&&(r+=x),t&&(r+=A),n.filter((function(e){return!D(e)})).reduce((function(e,t){return e+(C.test(t)?R:""===t?O:N)}),r)}function L(e,t){for(var n=e.routesMeta,r={},i="/",a=[],o=0;o<n.length;++o){var s=n[o],c=o===n.length-1,u="/"===i?t:t.slice(i.length)||"/",l=M({path:s.relativePath,caseSensitive:s.caseSensitive,end:c},u);if(!l)return null;Object.assign(r,l.params);var d=s.route;a.push({params:r,pathname:G([i,l.pathname]),pathnameBase:Z(G([i,l.pathnameBase])),route:d}),"/"!==l.pathnameBase&&(i=G([i,l.pathnameBase]))}return a}function M(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);y("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');var r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(function(e,t){return r.push(t),"/([^\\/]+)"}));e.endsWith("*")?(r.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");var a=new RegExp(i,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),r=(0,u.Z)(n,2),i=r[0],a=r[1],o=t.match(i);if(!o)return null;var s=o[0],c=s.replace(/(.)\/+$/,"$1"),l=o.slice(1);return{params:a.reduce((function(e,t,n){if("*"===t){var r=l[n]||"";c=s.slice(0,s.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return y(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+n+")."),e}}(l[n]||"",t),e}),{}),pathname:s,pathnameBase:c,pattern:e}}function U(e){try{return decodeURI(e)}catch(t){return y(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function j(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function F(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function V(e){return e.filter((function(e,t){return 0===t||e.route.path&&e.route.path.length>0}))}function B(e,t,n,r){var i;void 0===r&&(r=!1),"string"===typeof e?i=w(e):(g(!(i=p({},e)).pathname||!i.pathname.includes("?"),F("?","pathname","search",i)),g(!i.pathname||!i.pathname.includes("#"),F("#","pathname","hash",i)),g(!i.search||!i.search.includes("#"),F("#","search","hash",i)));var a,o=""===e||""===i.pathname,s=o?"/":i.pathname;if(r||null==s)a=n;else{var c=t.length-1;if(s.startsWith("..")){for(var u=s.split("/");".."===u[0];)u.shift(),c-=1;i.pathname=u.join("/")}a=c>=0?t[c]:"/"}var l=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?w(e):e,r=n.pathname,i=n.search,a=void 0===i?"":i,o=n.hash,s=void 0===o?"":o,c=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:c,search:q(a),hash:W(s)}}(i,a),d=s&&"/"!==s&&s.endsWith("/"),f=(o||"."===s)&&n.endsWith("/");return l.pathname.endsWith("/")||!d&&!f||(l.pathname+="/"),l}var G=function(e){return e.join("/").replace(/\/\/+/g,"/")},Z=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},q=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},W=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""},H=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}((0,c.Z)(Error));function K(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var z=["post","put","patch","delete"],Y=(new Set(z),["get"].concat(z));new Set(Y),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred")},6661:function(e,t,n){"use strict";n.d(t,{AgoraVideoPlayer:function(){return u},createClient:function(){return s},createMicrophoneAndCameraTracks:function(){return c}});var r,i=n(2791),a=n(3322),o=n.n(a);!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(r||(r={}));var s=function(e){var t;return function(){return t||(t=o().createClient(e)),t}};function c(e,t){var n=null;return function(){var r=(0,i.useState)(!1),a=r[0],s=r[1],c=(0,i.useState)(null),u=c[0],l=c[1],d=(0,i.useRef)(n);return(0,i.useEffect)((function(){return null===d.current?function(){try{return Promise.resolve(o().createMicrophoneAndCameraTracks(e,t)).then((function(e){return n=e}))}catch(r){return Promise.reject(r)}}().then((function(e){d.current=e,s(!0)}),(function(e){l(e)})):s(!0),function(){n=null}}),[]),{ready:a,tracks:d.current,error:u}}}var u=function(e){var t=(0,i.useRef)(null),n=e.videoTrack,r=e.config,a=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["videoTrack","config"]);return(0,i.useLayoutEffect)((function(){return null!==t.current&&n.play(t.current,r),function(){n.stop()}}),[n]),i.createElement("div",Object.assign({},a,{ref:t}))}},3322:function(e,t,n){var r=n(4993).default,i=n(1588).default,a=n(3808).default,o=n(4704).default,s=n(7061).default,c=n(7156).default,u=n(7424).default,l=n(6690).default,d=n(9728).default,f=n(6115).default,p=n(1655).default,h=n(6389).default,v=n(3496).default,m=n(861).default,g=n(8416).default;e.exports=function(){"use strict";var e,t,y,_,E;function b(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var w=!0,S=!0;function k(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function T(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};var a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function I(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(w=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function C(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(S=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function R(){if("object"==typeof window){if(w)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function A(e,t){S&&console.warn(e+" is deprecated, please use "+t+" instead.")}function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function N(e){return O(e)?Object.keys(e).reduce((function(t,n){var r=O(e[n]),i=r?N(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,g({},n,i))}),{}):e}function x(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?x(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){x(e,e.get(t),n)}))})))}function D(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&x(e,n,i)}))})),i}var P=R;function L(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),(a={})[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var s,c=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s))return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=o.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),P("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return P("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return o(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function M(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function U(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var a=new Event("track");a.track=r.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var a=new Event("track");a.track=r,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],n.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else T(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function j(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function F(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],a=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(o(e)))};return t.apply(this,[c,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(s(o(e)))},r])})).then(i,a)}}}function V(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return D(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),T(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return D(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(n?r=!0:n=e),e.track===a})),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function B(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}function G(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return B(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new e.MediaStream([t]);this._streams[n.id]=o,this._reverseStreams[o.id]=n,this.addStream(o)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=s(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function Z(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))}function q(e,t){T(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var W=Object.freeze({__proto__:null,fixNegotiationNeeded:q,shimAddTrackRemoveTrack:G,shimAddTrackRemoveTrackWithNative:B,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:j,shimGetStats:F,shimGetUserMedia:L,shimMediaStream:M,shimOnTrack:U,shimPeerConnection:Z,shimSenderReceiverGetStats:V});function H(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){A("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},r&&r.prototype.getSettings){var o=r.prototype.getSettings;r.prototype.getSettings=function(){var e=o.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function K(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function z(e,t){if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=g({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],a=e[1],o=e[2];return r.apply(this,[i||null]).then((function(e){if(t.version<53&&!a)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(a,o)}}}function Y(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function J(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),T(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function X(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;A("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function Q(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=m(e)).length>0;n&&e.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,a=i.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(a).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}}function ee(e){if("object"==typeof e&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function te(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function ne(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}var re=Object.freeze({__proto__:null,shimAddTransceiver:$,shimCreateAnswer:ne,shimCreateOffer:te,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:ee,shimGetUserMedia:H,shimOnTrack:K,shimPeerConnection:z,shimRTCDataChannel:Q,shimReceiverGetStats:J,shimRemoveStream:X,shimSenderGetStats:Y});function ie(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function ae(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function oe(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}}function se(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(ce(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function ce(e){return e&&void 0!==e.video?Object.assign({},e,{video:N(e.video)}):e}function ue(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(A("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function le(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function de(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function fe(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var pe=Object.freeze({__proto__:null,shimAudioContext:fe,shimCallbacksAPI:oe,shimConstraints:ce,shimCreateOfferLegacy:de,shimGetUserMedia:se,shimLocalStreamsAPI:ie,shimRTCIceServerUrls:ue,shimRemoteStreamsAPI:ae,shimTrackEventTransceiver:le}),he="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var me={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){var t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substring(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){var t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){var t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(var i=3;i<r.length;i++){var a=r[i],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))}));var u=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((function(e){u.forEach((function(t){e.rtcpFeedback.find((function(e){return e.type===t.type&&e.parameter===t.parameter}))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var i=0;return n.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substring(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});var l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=l}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substring(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};var o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){var s=o[0].substring(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t}(me);var ge=me.exports,ye=ve(ge),_e=b({__proto__:null,default:ye},[ge]);function Ee(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),r=ye.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,T(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function be(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||T(e,"icecandidate",(function(e){if(e.candidate){var t=ye.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function we(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=ye.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=ye.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=ye.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),n(arguments[0])){var e,s=r(arguments[0]),c=i(s),u=a(arguments[0],s);e=0===c&&0===u?Number.POSITIVE_INFINITY:0===c||0===u?Math.max(c,u):Math.min(c,u);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return e}}),this._sctp=l}return o.apply(this,arguments)}}}function Se(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},T(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function ke(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function Te(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71)&&!("safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}}function Ie(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function Ce(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return n.apply(e,[t])}))})}}var Re=Object.freeze({__proto__:null,removeExtmapAllowMixed:Te,shimAddIceCandidateNullOrEmpty:Ie,shimConnectionState:ke,shimMaxMessageSize:we,shimParameterlessSetLocalDescription:Ce,shimRTCIceCandidate:Ee,shimRTCIceCandidateRelayProtocol:be,shimSendThrowTypeError:Se});!function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=R,r=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=k(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=k(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=k(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:Re,extractVersion:k,disableLog:I,disableWarnings:C,sdp:_e};switch(r.browser){case"chrome":if(!W||!Z||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=W,Ie(e,r),Ce(e),L(e,r),M(e),Z(e,r),U(e),G(e,r),j(e),F(e),V(e),q(e,r),Ee(e),be(e),ke(e),we(e,r),Se(e),Te(e,r);break;case"firefox":if(!re||!z||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=re,Ie(e,r),Ce(e),H(e,r),z(e,r),K(e),X(e),Y(e),J(e),Q(e),$(e),ee(e),te(e),ne(e),Ee(e),ke(e),we(e,r),Se(e);break;case"safari":if(!pe||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=pe,Ie(e,r),Ce(e),ue(e),de(e),oe(e),ie(e),ae(e),le(e),se(e),fe(e),Ee(e),be(e),we(e,r),Se(e),Te(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Ae=function(e){try{return!!e()}catch(e){return!0}},Oe=!Ae((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Ne=Oe,xe=Function.prototype,De=xe.call,Pe=Ne&&xe.bind.bind(De,De),Le=Ne?Pe:function(e){return function(){return De.apply(e,arguments)}},Me=Le({}.isPrototypeOf),Ue=function(e){return e&&e.Math==Math&&e},je=Ue("object"==typeof globalThis&&globalThis)||Ue("object"==typeof window&&window)||Ue("object"==typeof self&&self)||Ue("object"==typeof he&&he)||function(){return this}()||he||Function("return this")(),Fe=Oe,Ve=Function.prototype,Be=Ve.apply,Ge=Ve.call,Ze="object"==typeof Reflect&&Reflect.apply||(Fe?Ge.bind(Be):function(){return Ge.apply(Be,arguments)}),qe=Le,We=qe({}.toString),He=qe("".slice),Ke=function(e){return He(We(e),8,-1)},ze=Ke,Ye=Le,Je=function(e){if("Function"===ze(e))return Ye(e)},Xe="object"==typeof document&&document.all,Qe={all:Xe,IS_HTMLDDA:void 0===Xe&&void 0!==Xe},$e=Qe.all,et=Qe.IS_HTMLDDA?function(e){return"function"==typeof e||e===$e}:function(e){return"function"==typeof e},tt={},nt=!Ae((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),rt=Oe,it=Function.prototype.call,at=rt?it.bind(it):function(){return it.apply(it,arguments)},ot={},st={}.propertyIsEnumerable,ct=Object.getOwnPropertyDescriptor,ut=ct&&!st.call({1:2},1);ot.f=ut?function(e){var t=ct(this,e);return!!t&&t.enumerable}:st;var lt,dt,ft=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},pt=Ae,ht=Ke,vt=Object,mt=Le("".split),gt=pt((function(){return!vt("z").propertyIsEnumerable(0)}))?function(e){return"String"==ht(e)?mt(e,""):vt(e)}:vt,yt=function(e){return null==e},_t=yt,Et=TypeError,bt=function(e){if(_t(e))throw Et("Can't call method on "+e);return e},wt=gt,St=bt,kt=function(e){return wt(St(e))},Tt=et,It=Qe.all,Ct=Qe.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Tt(e)||e===It}:function(e){return"object"==typeof e?null!==e:Tt(e)},Rt={},At=Rt,Ot=je,Nt=et,xt=function(e){return Nt(e)?e:void 0},Dt=function(e,t){return arguments.length<2?xt(At[e])||xt(Ot[e]):At[e]&&At[e][t]||Ot[e]&&Ot[e][t]},Pt="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Lt=je,Mt=Pt,Ut=Lt.process,jt=Lt.Deno,Ft=Ut&&Ut.versions||jt&&jt.version,Vt=Ft&&Ft.v8;Vt&&(dt=(lt=Vt.split("."))[0]>0&&lt[0]<4?1:+(lt[0]+lt[1])),!dt&&Mt&&(!(lt=Mt.match(/Edge\/(\d+)/))||lt[1]>=74)&&(lt=Mt.match(/Chrome\/(\d+)/))&&(dt=+lt[1]);var Bt=dt,Gt=Bt,Zt=Ae,qt=je.String,Wt=!!Object.getOwnPropertySymbols&&!Zt((function(){var e=Symbol();return!qt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Gt&&Gt<41})),Ht=Wt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Kt=Dt,zt=et,Yt=Me,Jt=Object,Xt=Ht?function(e){return"symbol"==typeof e}:function(e){var t=Kt("Symbol");return zt(t)&&Yt(t.prototype,Jt(e))},Qt=String,$t=function(e){try{return Qt(e)}catch(e){return"Object"}},en=et,tn=$t,nn=TypeError,rn=function(e){if(en(e))return e;throw nn(tn(e)+" is not a function")},an=rn,on=yt,sn=function(e,t){var n=e[t];return on(n)?void 0:an(n)},cn=at,un=et,ln=Ct,dn=TypeError,fn={exports:{}},pn=je,hn=Object.defineProperty,vn=function(e,t){try{hn(pn,e,{value:t,configurable:!0,writable:!0})}catch(S){pn[e]=t}return t},mn="__core-js_shared__",gn=je[mn]||vn(mn,{}),yn=gn;(fn.exports=function(e,t){return yn[e]||(yn[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var _n=fn.exports,En=bt,bn=Object,wn=function(e){return bn(En(e))},Sn=wn,kn=Le({}.hasOwnProperty),Tn=Object.hasOwn||function(e,t){return kn(Sn(e),t)},In=Le,Cn=0,Rn=Math.random(),An=In(1..toString),On=function(e){return"Symbol("+(void 0===e?"":e)+")_"+An(++Cn+Rn,36)},Nn=_n,xn=Tn,Dn=On,Pn=Wt,Ln=Ht,Mn=je.Symbol,Un=Nn("wks"),jn=Ln?Mn.for||Mn:Mn&&Mn.withoutSetter||Dn,Fn=function(e){return xn(Un,e)||(Un[e]=Pn&&xn(Mn,e)?Mn[e]:jn("Symbol."+e)),Un[e]},Vn=at,Bn=Ct,Gn=Xt,Zn=sn,qn=function(e,t){var n,r;if("string"===t&&un(n=e.toString)&&!ln(r=cn(n,e)))return r;if(un(n=e.valueOf)&&!ln(r=cn(n,e)))return r;if("string"!==t&&un(n=e.toString)&&!ln(r=cn(n,e)))return r;throw dn("Can't convert object to primitive value")},Wn=TypeError,Hn=Fn("toPrimitive"),Kn=function(e,t){if(!Bn(e)||Gn(e))return e;var n,r=Zn(e,Hn);if(r){if(void 0===t&&(t="default"),n=Vn(r,e,t),!Bn(n)||Gn(n))return n;throw Wn("Can't convert object to primitive value")}return void 0===t&&(t="number"),qn(e,t)},zn=Xt,Yn=function(e){var t=Kn(e,"string");return zn(t)?t:t+""},Jn=Ct,Xn=je.document,Qn=Jn(Xn)&&Jn(Xn.createElement),$n=function(e){return Qn?Xn.createElement(e):{}},er=$n,tr=!nt&&!Ae((function(){return 7!=Object.defineProperty(er("div"),"a",{get:function(){return 7}}).a})),nr=nt,rr=at,ir=ot,ar=ft,or=kt,sr=Yn,cr=Tn,ur=tr,lr=Object.getOwnPropertyDescriptor;tt.f=nr?lr:function(e,t){if(e=or(e),t=sr(t),ur)try{return lr(e,t)}catch(e){}if(cr(e,t))return ar(!rr(ir.f,e,t),e[t])};var dr=Ae,fr=et,pr=/#|\.prototype\./,hr=function(e,t){var n=mr[vr(e)];return n==yr||n!=gr&&(fr(t)?dr(t):!!t)},vr=hr.normalize=function(e){return String(e).replace(pr,".").toLowerCase()},mr=hr.data={},gr=hr.NATIVE="N",yr=hr.POLYFILL="P",_r=hr,Er=rn,br=Oe,wr=Je(Je.bind),Sr=function(e,t){return Er(e),void 0===t?e:br?wr(e,t):function(){return e.apply(t,arguments)}},kr={},Tr=nt&&Ae((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ir=Ct,Cr=String,Rr=TypeError,Ar=function(e){if(Ir(e))return e;throw Rr(Cr(e)+" is not an object")},Or=nt,Nr=tr,xr=Tr,Dr=Ar,Pr=Yn,Lr=TypeError,Mr=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,jr="enumerable",Fr="configurable",Vr="writable";kr.f=Or?xr?function(e,t,n){if(Dr(e),t=Pr(t),Dr(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Vr in n&&!n[Vr]){var r=Ur(e,t);r&&r[Vr]&&(e[t]=n.value,n={configurable:Fr in n?n[Fr]:r[Fr],enumerable:jr in n?n[jr]:r[jr],writable:!1})}return Mr(e,t,n)}:Mr:function(e,t,n){if(Dr(e),t=Pr(t),Dr(n),Nr)try{return Mr(e,t,n)}catch(e){}if("get"in n||"set"in n)throw Lr("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Br=kr,Gr=ft,Zr=nt?function(e,t,n){return Br.f(e,t,Gr(1,n))}:function(e,t,n){return e[t]=n,e},qr=je,Wr=Ze,Hr=Je,Kr=et,zr=tt.f,Yr=_r,Jr=Rt,Xr=Sr,Qr=Zr,$r=Tn,ei=function(e){var t=function t(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Wr(e,this,arguments)};return t.prototype=e.prototype,t},ti=function(e,t){var n,r,i,a,o,s,c,u,l,d=e.target,f=e.global,p=e.stat,h=e.proto,v=f?qr:p?qr[d]:(qr[d]||{}).prototype,m=f?Jr:Jr[d]||Qr(Jr,d,{})[d],g=m.prototype;for(a in t)r=!(n=Yr(f?a:d+(p?".":"#")+a,e.forced))&&v&&$r(v,a),s=m[a],r&&(c=e.dontCallGetSet?(l=zr(v,a))&&l.value:v[a]),o=r&&c?c:t[a],r&&typeof s==typeof o||(u=e.bind&&r?Xr(o,qr):e.wrap&&r?ei(o):h&&Kr(o)?Hr(o):o,(e.sham||o&&o.sham||s&&s.sham)&&Qr(u,"sham",!0),Qr(m,a,u),h&&($r(Jr,i=d+"Prototype")||Qr(Jr,i,{}),Qr(Jr[i],a,o),e.real&&g&&(n||!g[a])&&Qr(g,a,o)))},ni=Math.ceil,ri=Math.floor,ii=Math.trunc||function(e){var t=+e;return(t>0?ri:ni)(t)},ai=function(e){var t=+e;return t!=t||0===t?0:ii(t)},oi=ai,si=Math.max,ci=Math.min,ui=function(e,t){var n=oi(e);return n<0?si(n+t,0):ci(n,t)},li=ai,di=Math.min,fi=function(e){return e>0?di(li(e),9007199254740991):0},pi=function(e){return fi(e.length)},hi=kt,vi=ui,mi=pi,gi=function(e){return function(t,n,r){var i,a=hi(t),o=mi(a),s=vi(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},yi={includes:gi(!0),indexOf:gi(!1)},_i=yi.includes;ti({target:"Array",proto:!0,forced:Ae((function(){return!Array(1).includes()}))},{includes:function(e){return _i(this,e,arguments.length>1?arguments[1]:void 0)}});var Ei=Rt,bi=function(e){return Ei[e+"Prototype"]},wi=bi("Array").includes,Si=Ct,ki=Ke,Ti=Fn("match"),Ii=function(e){var t;return Si(e)&&(void 0!==(t=e[Ti])?!!t:"RegExp"==ki(e))},Ci=TypeError,Ri={};Ri[Fn("toStringTag")]="z";var Ai="[object z]"===String(Ri),Oi=Ai,Ni=et,xi=Ke,Di=Fn("toStringTag"),Pi=Object,Li="Arguments"==xi(function(){return arguments}()),Mi=Oi?xi:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Pi(e),Di))?n:Li?xi(t):"Object"==(r=xi(t))&&Ni(t.callee)?"Arguments":r},Ui=Mi,ji=String,Fi=function(e){if("Symbol"===Ui(e))throw TypeError("Cannot convert a Symbol value to a string");return ji(e)},Vi=Fn("match"),Bi=ti,Gi=function(e){if(Ii(e))throw Ci("The method doesn't accept regular expressions");return e},Zi=bt,qi=Fi,Wi=function(e){var t=/./;try{"/./"[e](t)}catch(S){try{return t[Vi]=!1,"/./"[e](t)}catch(e){}}return!1},Hi=Le("".indexOf);Bi({target:"String",proto:!0,forced:!Wi("includes")},{includes:function(e){return!!~Hi(qi(Zi(this)),qi(Gi(e)),arguments.length>1?arguments[1]:void 0)}});var Ki=bi("String").includes,zi=Me,Yi=wi,Ji=Ki,Xi=Array.prototype,Qi=String.prototype,$i=ve((function(e){var t=e.includes;return e===Xi||zi(Xi,e)&&t===Xi.includes?Yi:"string"==typeof e||e===Qi||zi(Qi,e)&&t===Qi.includes?Ji:t})),ea={exports:{}},ta=ti,na=nt,ra=kr.f;ta({target:"Object",stat:!0,forced:Object.defineProperty!==ra,sham:!na},{defineProperty:ra});var ia=Rt.Object,aa=ea.exports=function(e,t,n){return ia.defineProperty(e,t,n)};ia.defineProperty.sham&&(aa.sham=!0);var oa=ve(ea.exports),sa=Ke,ca=Array.isArray||function(e){return"Array"==sa(e)},ua=TypeError,la=Yn,da=kr,fa=ft,pa=function(e,t,n){var r=la(t);r in e?da.f(e,r,fa(0,n)):e[r]=n},ha=et,va=gn,ma=Le(Function.toString);ha(va.inspectSource)||(va.inspectSource=function(e){return ma(e)});var ga=va.inspectSource,ya=Le,_a=Ae,Ea=et,ba=Mi,wa=ga,Sa=function(){},ka=[],Ta=Dt("Reflect","construct"),Ia=/^\s*(?:class|function)\b/,Ca=ya(Ia.exec),Ra=!Ia.exec(Sa),Aa=function(e){if(!Ea(e))return!1;try{return Ta(Sa,ka,e),!0}catch(e){return!1}},Oa=function(e){if(!Ea(e))return!1;switch(ba(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ra||!!Ca(Ia,wa(e))}catch(e){return!0}};Oa.sham=!0;var Na=!Ta||_a((function(){var e;return Aa(Aa.call)||!Aa(Object)||!Aa((function(){e=!0}))||e}))?Oa:Aa,xa=ca,Da=Na,Pa=Ct,La=Fn("species"),Ma=Array,Ua=function(e){var t;return xa(e)&&(t=e.constructor,(Da(t)&&(t===Ma||xa(t.prototype))||Pa(t)&&null===(t=t[La]))&&(t=void 0)),void 0===t?Ma:t},ja=function(e,t){return new(Ua(e))(0===t?0:t)},Fa=Ae,Va=Bt,Ba=Fn("species"),Ga=ti,Za=Ae,qa=ca,Wa=Ct,Ha=wn,Ka=pi,za=function(e){if(e>9007199254740991)throw ua("Maximum allowed index exceeded");return e},Ya=pa,Ja=ja,Xa=function(e){return Va>=51||!Fa((function(){var t=[];return(t.constructor={})[Ba]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Qa=Bt,$a=Fn("isConcatSpreadable"),eo=Qa>=51||!Za((function(){var e=[];return e[$a]=!1,e.concat()[0]!==e})),to=function(e){if(!Wa(e))return!1;var t=e[$a];return void 0!==t?!!t:qa(e)};Ga({target:"Array",proto:!0,arity:1,forced:!eo||!Xa("concat")},{concat:function(e){var t,n,r,i,a,o=Ha(this),s=Ja(o,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(to(a=-1===t?o:arguments[t]))for(i=Ka(a),za(c+i),n=0;n<i;n++,c++)n in a&&Ya(s,c,a[n]);else za(c+1),Ya(s,c++,a);return s.length=c,s}});var no={},ro={},io=Tn,ao=kt,oo=yi.indexOf,so=ro,co=Le([].push),uo=function(e,t){var n,r=ao(e),i=0,a=[];for(n in r)!io(so,n)&&io(r,n)&&co(a,n);for(;t.length>i;)io(r,n=t[i++])&&(~oo(a,n)||co(a,n));return a},lo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],fo=uo,po=lo,ho=Object.keys||function(e){return fo(e,po)},vo=nt,mo=Tr,go=kr,yo=Ar,_o=kt,Eo=ho;no.f=vo&&!mo?Object.defineProperties:function(e,t){yo(e);for(var n,r=_o(t),i=Eo(t),a=i.length,o=0;a>o;)go.f(e,n=i[o++],r[n]);return e};var bo,wo=Dt("document","documentElement"),So=On,ko=_n("keys"),To=function(e){return ko[e]||(ko[e]=So(e))},Io=Ar,Co=no,Ro=lo,Ao=ro,Oo=wo,No=$n,xo="prototype",Do="script",Po=To("IE_PROTO"),Lo=function(){},Mo=function(e){return"<"+Do+">"+e+"</"+Do+">"},Uo=function(e){e.write(Mo("")),e.close();var t=e.parentWindow.Object;return e=null,t},jo=function(){try{bo=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;jo="undefined"!=typeof document?document.domain&&bo?Uo(bo):(t=No("iframe"),n="java"+Do+":",t.style.display="none",Oo.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Mo("document.F=Object")),e.close(),e.F):Uo(bo);for(var r=Ro.length;r--;)delete jo[xo][Ro[r]];return jo()};Ao[Po]=!0;var Fo=Object.create||function(e,t){var n;return null!==e?(Lo[xo]=Io(e),n=new Lo,Lo[xo]=null,n[Po]=e):n=jo(),void 0===t?n:Co.f(n,t)},Vo={},Bo=uo,Go=lo.concat("length","prototype");Vo.f=Object.getOwnPropertyNames||function(e){return Bo(e,Go)};var Zo={},qo=ui,Wo=pi,Ho=pa,Ko=Array,zo=Math.max,Yo=function(e,t,n){for(var r=Wo(e),i=qo(t,r),a=qo(void 0===n?r:n,r),o=Ko(zo(a-i,0)),s=0;i<a;i++,s++)Ho(o,s,e[i]);return o.length=s,o},Jo=Ke,Xo=kt,Qo=Vo.f,$o=Yo,es="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Zo.f=function(e){return es&&"Window"==Jo(e)?function(e){try{return Qo(e)}catch(e){return $o(es)}}(e):Qo(Xo(e))};var ts={};ts.f=Object.getOwnPropertySymbols;var ns=Zr,rs=function(e,t,n,r){return r&&r.enumerable?e[t]=n:ns(e,t,n),e},is=kr,as=function(e,t,n){return is.f(e,t,n)},os={},ss=Fn;os.f=ss;var cs,us,ls,ds=Rt,fs=Tn,ps=os,hs=kr.f,vs=function(e){var t=ds.Symbol||(ds.Symbol={});fs(t,e)||hs(t,e,{value:ps.f(e)})},ms=at,gs=Dt,ys=Fn,_s=rs,Es=function(){var e=gs("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=ys("toPrimitive");t&&!t[r]&&_s(t,r,(function(e){return ms(n,this)}),{arity:1})},bs=Mi,ws=Ai?{}.toString:function(){return"[object "+bs(this)+"]"},Ss=Ai,ks=kr.f,Ts=Zr,Is=Tn,Cs=ws,Rs=Fn("toStringTag"),As=function(e,t,n,r){if(e){var i=n?e:e.prototype;Is(i,Rs)||ks(i,Rs,{configurable:!0,value:t}),r&&!Ss&&Ts(i,"toString",Cs)}},Os=et,Ns=je.WeakMap,xs=Os(Ns)&&/native code/.test(String(Ns)),Ds=je,Ps=Ct,Ls=Zr,Ms=Tn,Us=gn,js=To,Fs=ro,Vs="Object already initialized",Bs=Ds.TypeError,Gs=Ds.WeakMap;if(xs||Us.state){var Zs=Us.state||(Us.state=new Gs);Zs.get=Zs.get,Zs.has=Zs.has,Zs.set=Zs.set,cs=function(e,t){if(Zs.has(e))throw Bs(Vs);return t.facade=e,Zs.set(e,t),t},us=function(e){return Zs.get(e)||{}},ls=function(e){return Zs.has(e)}}else{var qs=js("state");Fs[qs]=!0,cs=function(e,t){if(Ms(e,qs))throw Bs(Vs);return t.facade=e,Ls(e,qs,t),t},us=function(e){return Ms(e,qs)?e[qs]:{}},ls=function(e){return Ms(e,qs)}}var Ws={set:cs,get:us,has:ls,enforce:function(e){return ls(e)?us(e):cs(e,{})},getterFor:function(e){return function(t){var n;if(!Ps(t)||(n=us(t)).type!==e)throw Bs("Incompatible receiver, "+e+" required");return n}}},Hs=Sr,Ks=gt,zs=wn,Ys=pi,Js=ja,Xs=Le([].push),Qs=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(c,u,l,d){for(var f,p,h=zs(c),v=Ks(h),m=Hs(u,l),g=Ys(v),y=0,_=d||Js,E=t?_(c,g):n||o?_(c,0):void 0;g>y;y++)if((s||y in v)&&(p=m(f=v[y],y,h),e))if(t)E[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:Xs(E,f)}else switch(e){case 4:return!1;case 7:Xs(E,f)}return a?-1:r||i?i:E}},$s={forEach:Qs(0),map:Qs(1),filter:Qs(2),some:Qs(3),every:Qs(4),find:Qs(5),findIndex:Qs(6),filterReject:Qs(7)},ec=ti,tc=je,nc=at,rc=Le,ic=nt,ac=Wt,oc=Ae,sc=Tn,cc=Me,uc=Ar,lc=kt,dc=Yn,fc=Fi,pc=ft,hc=Fo,vc=ho,mc=Vo,gc=Zo,yc=ts,_c=tt,Ec=kr,bc=no,wc=ot,Sc=rs,kc=as,Tc=_n,Ic=ro,Cc=On,Rc=Fn,Ac=os,Oc=vs,Nc=Es,xc=As,Dc=Ws,Pc=$s.forEach,Lc=To("hidden"),Mc="Symbol",Uc="prototype",jc=Dc.set,Fc=Dc.getterFor(Mc),Vc=Object[Uc],Bc=tc.Symbol,Gc=Bc&&Bc[Uc],Zc=tc.TypeError,qc=tc.QObject,Wc=_c.f,Hc=Ec.f,Kc=gc.f,zc=wc.f,Yc=rc([].push),Jc=Tc("symbols"),Xc=Tc("op-symbols"),Qc=Tc("wks"),$c=!qc||!qc[Uc]||!qc[Uc].findChild,eu=ic&&oc((function(){return 7!=hc(Hc({},"a",{get:function(){return Hc(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Wc(Vc,t);r&&delete Vc[t],Hc(e,t,n),r&&e!==Vc&&Hc(Vc,t,r)}:Hc,tu=function(e,t){var n=Jc[e]=hc(Gc);return jc(n,{type:Mc,tag:e,description:t}),ic||(n.description=t),n},nu=function e(t,n,r){t===Vc&&e(Xc,n,r),uc(t);var i=dc(n);return uc(r),sc(Jc,i)?(r.enumerable?(sc(t,Lc)&&t[Lc][i]&&(t[Lc][i]=!1),r=hc(r,{enumerable:pc(0,!1)})):(sc(t,Lc)||Hc(t,Lc,pc(1,{})),t[Lc][i]=!0),eu(t,i,r)):Hc(t,i,r)},ru=function(e,t){uc(e);var n=lc(t),r=vc(n).concat(su(n));return Pc(r,(function(t){ic&&!nc(iu,n,t)||nu(e,t,n[t])})),e},iu=function(e){var t=dc(e),n=nc(zc,this,t);return!(this===Vc&&sc(Jc,t)&&!sc(Xc,t))&&(!(n||!sc(this,t)||!sc(Jc,t)||sc(this,Lc)&&this[Lc][t])||n)},au=function(e,t){var n=lc(e),r=dc(t);if(n!==Vc||!sc(Jc,r)||sc(Xc,r)){var i=Wc(n,r);return!i||!sc(Jc,r)||sc(n,Lc)&&n[Lc][r]||(i.enumerable=!0),i}},ou=function(e){var t=Kc(lc(e)),n=[];return Pc(t,(function(e){sc(Jc,e)||sc(Ic,e)||Yc(n,e)})),n},su=function(e){var t=e===Vc,n=Kc(t?Xc:lc(e)),r=[];return Pc(n,(function(e){!sc(Jc,e)||t&&!sc(Vc,e)||Yc(r,Jc[e])})),r};ac||(Bc=function(){if(cc(Gc,this))throw Zc("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?fc(arguments[0]):void 0,t=Cc(e),n=function e(n){this===Vc&&nc(e,Xc,n),sc(this,Lc)&&sc(this[Lc],t)&&(this[Lc][t]=!1),eu(this,t,pc(1,n))};return ic&&$c&&eu(Vc,t,{configurable:!0,set:n}),tu(t,e)},Sc(Gc=Bc[Uc],"toString",(function(){return Fc(this).tag})),Sc(Bc,"withoutSetter",(function(e){return tu(Cc(e),e)})),wc.f=iu,Ec.f=nu,bc.f=ru,_c.f=au,mc.f=gc.f=ou,yc.f=su,Ac.f=function(e){return tu(Rc(e),e)},ic&&kc(Gc,"description",{configurable:!0,get:function(){return Fc(this).description}})),ec({global:!0,constructor:!0,wrap:!0,forced:!ac,sham:!ac},{Symbol:Bc}),Pc(vc(Qc),(function(e){Oc(e)})),ec({target:Mc,stat:!0,forced:!ac},{useSetter:function(){$c=!0},useSimple:function(){$c=!1}}),ec({target:"Object",stat:!0,forced:!ac,sham:!ic},{create:function(e,t){return void 0===t?hc(e):ru(hc(e),t)},defineProperty:nu,defineProperties:ru,getOwnPropertyDescriptor:au}),ec({target:"Object",stat:!0,forced:!ac},{getOwnPropertyNames:ou}),Nc(),xc(Bc,Mc),Ic[Lc]=!0;var cu=Wt&&!!Symbol.for&&!!Symbol.keyFor,uu=ti,lu=Dt,du=Tn,fu=Fi,pu=_n,hu=cu,vu=pu("string-to-symbol-registry"),mu=pu("symbol-to-string-registry");uu({target:"Symbol",stat:!0,forced:!hu},{for:function(e){var t=fu(e);if(du(vu,t))return vu[t];var n=lu("Symbol")(t);return vu[t]=n,mu[n]=t,n}});var gu=ti,yu=Tn,_u=Xt,Eu=$t,bu=cu,wu=_n("symbol-to-string-registry");gu({target:"Symbol",stat:!0,forced:!bu},{keyFor:function(e){if(!_u(e))throw TypeError(Eu(e)+" is not a symbol");if(yu(wu,e))return wu[e]}});var Su=Le([].slice),ku=ca,Tu=et,Iu=Ke,Cu=Fi,Ru=Le([].push),Au=ti,Ou=Dt,Nu=Ze,xu=at,Du=Le,Pu=Ae,Lu=et,Mu=Xt,Uu=Su,ju=function(e){if(Tu(e))return e;if(ku(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?Ru(n,i):"number"!=typeof i&&"Number"!=Iu(i)&&"String"!=Iu(i)||Ru(n,Cu(i))}var a=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if(ku(this))return t;for(var r=0;r<a;r++)if(n[r]===e)return t}}},Fu=Wt,Vu=String,Bu=Ou("JSON","stringify"),Gu=Du(/./.exec),Zu=Du("".charAt),qu=Du("".charCodeAt),Wu=Du("".replace),Hu=Du(1..toString),Ku=/[\uD800-\uDFFF]/g,zu=/^[\uD800-\uDBFF]$/,Yu=/^[\uDC00-\uDFFF]$/,Ju=!Fu||Pu((function(){var e=Ou("Symbol")();return"[null]"!=Bu([e])||"{}"!=Bu({a:e})||"{}"!=Bu(Object(e))})),Xu=Pu((function(){return'"\\udf06\\ud834"'!==Bu("\udf06\ud834")||'"\\udead"'!==Bu("\udead")})),Qu=function(e,t){var n=Uu(arguments),r=ju(t);if(Lu(r)||void 0!==e&&!Mu(e))return n[1]=function(e,t){if(Lu(r)&&(t=xu(r,this,Vu(e),t)),!Mu(t))return t},Nu(Bu,null,n)},$u=function(e,t,n){var r=Zu(n,t-1),i=Zu(n,t+1);return Gu(zu,e)&&!Gu(Yu,i)||Gu(Yu,e)&&!Gu(zu,r)?"\\u"+Hu(qu(e,0),16):e};Bu&&Au({target:"JSON",stat:!0,arity:3,forced:Ju||Xu},{stringify:function(e,t,n){var r=Uu(arguments),i=Nu(Ju?Qu:Bu,null,r);return Xu&&"string"==typeof i?Wu(i,Ku,$u):i}});var el=ts,tl=wn;ti({target:"Object",stat:!0,forced:!Wt||Ae((function(){el.f(1)}))},{getOwnPropertySymbols:function(e){var t=el.f;return t?t(tl(e)):[]}}),vs("asyncIterator"),vs("hasInstance"),vs("isConcatSpreadable"),vs("iterator"),vs("match"),vs("matchAll"),vs("replace"),vs("search"),vs("species"),vs("split");var nl=Es;vs("toPrimitive"),nl();var rl=Dt,il=As;vs("toStringTag"),il(rl("Symbol"),"Symbol"),vs("unscopables"),As(je.JSON,"JSON",!0);var al,ol,sl,cl=Rt.Symbol,ul={},ll=nt,dl=Tn,fl=Function.prototype,pl=ll&&Object.getOwnPropertyDescriptor,hl=dl(fl,"name"),vl={EXISTS:hl,PROPER:hl&&"something"===function(){}.name,CONFIGURABLE:hl&&(!ll||ll&&pl(fl,"name").configurable)},ml=!Ae((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),gl=Tn,yl=et,_l=wn,El=ml,bl=To("IE_PROTO"),wl=Object,Sl=wl.prototype,kl=El?wl.getPrototypeOf:function(e){var t=_l(e);if(gl(t,bl))return t[bl];var n=t.constructor;return yl(n)&&t instanceof n?n.prototype:t instanceof wl?Sl:null},Tl=Ae,Il=et,Cl=Ct,Rl=Fo,Al=kl,Ol=rs,Nl=Fn("iterator"),xl=!1;[].keys&&("next"in(sl=[].keys())?(ol=Al(Al(sl)))!==Object.prototype&&(al=ol):xl=!0);var Dl=!Cl(al)||Tl((function(){var e={};return al[Nl].call(e)!==e}));Il((al=Dl?{}:Rl(al))[Nl])||Ol(al,Nl,(function(){return this}));var Pl={IteratorPrototype:al,BUGGY_SAFARI_ITERATORS:xl},Ll=Pl.IteratorPrototype,Ml=Fo,Ul=ft,jl=As,Fl=ul,Vl=function(){return this},Bl=Le,Gl=rn,Zl=et,ql=String,Wl=TypeError,Hl=function(e,t,n){try{return Bl(Gl(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Kl=Ar,zl=function(e){if("object"==typeof e||Zl(e))return e;throw Wl("Can't set "+ql(e)+" as a prototype")},Yl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Hl(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Kl(n),zl(r),t?e(n,r):n.__proto__=r,n}}():void 0),Jl=ti,Xl=at,Ql=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Ml(Ll,{next:Ul(+!r,n)}),jl(e,i,!1,!0),Fl[i]=Vl,e},$l=kl,ed=As,td=rs,nd=ul,rd=Pl,id=vl.PROPER,ad=rd.BUGGY_SAFARI_ITERATORS,od=Fn("iterator"),sd="keys",cd="values",ud="entries",ld=function(){return this},dd=function(e,t,n,r,i,a,o){Ql(n,t,r);var s,c,u,l=function(e){if(e===i&&v)return v;if(!ad&&e in p)return p[e];switch(e){case sd:case cd:case ud:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,p=e.prototype,h=p[od]||p["@@iterator"]||i&&p[i],v=!ad&&h||l(i),m="Array"==t&&p.entries||h;if(m&&(s=$l(m.call(new e)))!==Object.prototype&&s.next&&(ed(s,d,!0,!0),nd[d]=ld),id&&i==cd&&h&&h.name!==cd&&(f=!0,v=function(){return Xl(h,this)}),i)if(c={values:l(cd),keys:a?v:l(sd),entries:l(ud)},o)for(u in c)(ad||f||!(u in p))&&td(p,u,c[u]);else Jl({target:t,proto:!0,forced:ad||f},c);return o&&p[od]!==v&&td(p,od,v,{name:i}),nd[t]=v,c},fd=function(e,t){return{value:e,done:t}},pd=kt,hd=ul,vd=Ws;kr.f;var md=dd,gd=fd,yd="Array Iterator",_d=vd.set,Ed=vd.getterFor(yd);md(Array,"Array",(function(e,t){_d(this,{type:yd,target:pd(e),index:0,kind:t})}),(function(){var e=Ed(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,gd(void 0,!0)):gd("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),hd.Arguments=hd.Array;var bd={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},wd=je,Sd=Mi,kd=Zr,Td=ul,Id=Fn("toStringTag");for(var Cd in bd){var Rd=wd[Cd],Ad=Rd&&Rd.prototype;Ad&&Sd(Ad)!==Id&&kd(Ad,Id,Cd),Td[Cd]=Td.Array}var Od=cl,Nd=Fn,xd=kr.f,Dd=Nd("metadata"),Pd=Function.prototype;void 0===Pd[Dd]&&xd(Pd,Dd,{value:null}),vs("dispose"),vs("metadata");var Ld=Od;vs("asyncDispose");var Md=Le,Ud=Dt("Symbol"),jd=Ud.keyFor,Fd=Md(Ud.prototype.valueOf),Vd=Ud.isRegisteredSymbol||function(e){try{return void 0!==jd(Fd(e))}catch(e){return!1}};ti({target:"Symbol",stat:!0},{isRegisteredSymbol:Vd});for(var Bd=_n,Gd=Dt,Zd=Le,qd=Xt,Wd=Fn,Hd=Gd("Symbol"),Kd=Hd.isWellKnownSymbol,zd=Gd("Object","getOwnPropertyNames"),Yd=Zd(Hd.prototype.valueOf),Jd=Bd("wks"),Xd=0,Qd=zd(Hd),$d=Qd.length;Xd<$d;Xd++)try{var ef=Qd[Xd];qd(Hd[ef])&&Wd(ef)}catch(b){}var tf=function(e){if(Kd&&Kd(e))return!0;try{for(var t=Yd(e),n=0,r=zd(Jd),i=r.length;n<i;n++)if(Jd[r[n]]==t)return!0}catch(e){}return!1};ti({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:tf}),vs("matcher"),vs("observable"),ti({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Vd}),ti({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:tf}),vs("metadataKey"),vs("patternMatch"),vs("replaceAll");var nf=ve(Ld),rf=Le,af=ai,of=Fi,sf=bt,cf=rf("".charAt),uf=rf("".charCodeAt),lf=rf("".slice),df=function(e){return function(t,n){var r,i,a=of(sf(t)),o=af(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=uf(a,o))<55296||r>56319||o+1===s||(i=uf(a,o+1))<56320||i>57343?e?cf(a,o):r:e?lf(a,o,o+2):i-56320+(r-55296<<10)+65536}},ff=(df(!1),df(!0)),pf=Fi,hf=Ws,vf=dd,mf=fd,gf="String Iterator",yf=hf.set,_f=hf.getterFor(gf);vf(String,"String",(function(e){yf(this,{type:gf,string:pf(e),index:0})}),(function(){var e,t=_f(this),n=t.string,r=t.index;return r>=n.length?mf(void 0,!0):(e=ff(n,r),t.index+=e.length,mf(e,!1))}));var Ef=ve(os.f("iterator"));function bf(e){return bf="function"==typeof nf&&"symbol"==typeof Ef?function(e){return typeof e}:function(e){return e&&"function"==typeof nf&&e.constructor===nf&&e!==nf.prototype?"symbol":typeof e},bf(e)}var wf=ve(os.f("toPrimitive"));function Sf(e){var t=function(e,t){if("object"!==bf(e)||null===e)return e;var n=e[wf];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==bf(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===bf(t)?t:String(t)}function kf(e,t,n){return(t=Sf(t))in e?oa(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Tf=bi("Array").keys,If=Mi,Cf=Tn,Rf=Me,Af=Tf,Of=Array.prototype,Nf={DOMTokenList:!0,NodeList:!0},xf=ve((function(e){var t=e.keys;return e===Of||Rf(Of,e)&&t===Of.keys||Cf(Nf,If(e))?Af:t})),Df=$t,Pf=TypeError,Lf=Yo,Mf=Math.floor,Uf=function e(t,n){var r=t.length,i=Mf(r/2);return r<8?jf(t,n):Ff(t,e(Lf(t,0,i),n),e(Lf(t,i),n),n)},jf=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},Ff=function(e,t,n,r){for(var i=t.length,a=n.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?r(t[o],n[s])<=0?t[o++]:n[s++]:o<i?t[o++]:n[s++];return e},Vf=Uf,Bf=Ae,Gf=function(e,t){var n=[][e];return!!n&&Bf((function(){n.call(null,t||function(){return 1},1)}))},Zf=Pt.match(/firefox\/(\d+)/i),qf=!!Zf&&+Zf[1],Wf=/MSIE|Trident/.test(Pt),Hf=Pt.match(/AppleWebKit\/(\d+)\./),Kf=!!Hf&&+Hf[1],zf=ti,Yf=Le,Jf=rn,Xf=wn,Qf=pi,$f=function(e,t){if(!delete e[t])throw Pf("Cannot delete property "+Df(t)+" of "+Df(e))},ep=Fi,tp=Ae,np=Vf,rp=Gf,ip=qf,ap=Wf,op=Bt,sp=Kf,cp=[],up=Yf(cp.sort),lp=Yf(cp.push),dp=tp((function(){cp.sort(void 0)})),fp=tp((function(){cp.sort(null)})),pp=rp("sort"),hp=!tp((function(){if(op)return op<70;if(!(ip&&ip>3)){if(ap)return!0;if(sp)return sp<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)cp.push({k:t+r,v:n})}for(cp.sort((function(e,t){return t.v-e.v})),r=0;r<cp.length;r++)t=cp[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));zf({target:"Array",proto:!0,forced:dp||!fp||!pp||!hp},{sort:function(e){void 0!==e&&Jf(e);var t=Xf(this);if(hp)return void 0===e?up(t):up(t,e);var n,r,i=[],a=Qf(t);for(r=0;r<a;r++)r in t&&lp(i,t[r]);for(np(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:ep(t)>ep(n)?1:-1}}(e)),n=Qf(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)$f(t,r++);return t}});var vp=bi("Array").sort,mp=Me,gp=vp,yp=Array.prototype,_p=ve((function(e){var t=e.sort;return e===yp||mp(yp,e)&&t===yp.sort?gp:t})),Ep=Dt,bp=Vo,wp=ts,Sp=Ar,kp=Le([].concat),Tp=Ep("Reflect","ownKeys")||function(e){var t=bp.f(Sp(e)),n=wp.f;return n?kp(t,n(e)):t},Ip=Tn,Cp=Tp,Rp=tt,Ap=kr,Op=Ct,Np=Zr,xp=Error,Dp=Le("".replace),Pp=String(xp("zxcasd").stack),Lp=/\n\s*at [^:]*:[^\n]*/,Mp=Lp.test(Pp),Up=ft,jp=!Ae((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Up(1,7)),7!==e.stack)})),Fp=Zr,Vp=function(e,t){if(Mp&&"string"==typeof e&&!xp.prepareStackTrace)for(;t--;)e=Dp(e,Lp,"");return e},Bp=jp,Gp=Error.captureStackTrace,Zp=ul,qp=Fn("iterator"),Wp=Array.prototype,Hp=Mi,Kp=sn,zp=yt,Yp=ul,Jp=Fn("iterator"),Xp=function(e){if(!zp(e))return Kp(e,Jp)||Kp(e,"@@iterator")||Yp[Hp(e)]},Qp=at,$p=rn,eh=Ar,th=$t,nh=Xp,rh=TypeError,ih=at,ah=Ar,oh=sn,sh=Sr,ch=at,uh=Ar,lh=$t,dh=function(e){return void 0!==e&&(Zp.Array===e||Wp[qp]===e)},fh=pi,ph=Me,hh=function(e,t){var n=arguments.length<2?nh(e):t;if($p(n))return eh(Qp(n,e));throw rh(th(e)+" is not iterable")},vh=Xp,mh=function(e,t,n){var r,i;ah(e);try{if(!(r=oh(e,"return"))){if("throw"===t)throw n;return n}r=ih(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return ah(r),n},gh=TypeError,yh=function(e,t){this.stopped=e,this.result=t},_h=yh.prototype,Eh=function(e,t,n){var r,i,a,o,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),v=sh(t,l),m=function(e){return r&&mh(r,"normal",e),new yh(!0,e)},g=function(e){return d?(uh(e),h?v(e[0],e[1],m):v(e[0],e[1])):h?v(e,m):v(e)};if(f)r=e.iterator;else if(p)r=e;else{if(!(i=vh(e)))throw gh(lh(e)+" is not iterable");if(dh(i)){for(a=0,o=fh(e);o>a;a++)if((s=g(e[a]))&&ph(_h,s))return s;return new yh(!1)}r=hh(e,i)}for(c=f?e.next:r.next;!(u=ch(c,r)).done;){try{s=g(u.value)}catch(e){mh(r,"throw",e)}if("object"==typeof s&&s&&ph(_h,s))return s}return new yh(!1)},bh=Fi,wh=ti,Sh=Me,kh=kl,Th=Yl,Ih=function(e,t,n){for(var r=Cp(t),i=Ap.f,a=Rp.f,o=0;o<r.length;o++){var s=r[o];Ip(e,s)||n&&Ip(n,s)||i(e,s,a(t,s))}},Ch=Fo,Rh=Zr,Ah=ft,Oh=function(e,t){Op(t)&&"cause"in t&&Np(e,"cause",t.cause)},Nh=function(e,t,n,r){Bp&&(Gp?Gp(e,t):Fp(e,"stack",Vp(n,r)))},xh=Eh,Dh=function(e,t){return void 0===e?arguments.length<2?"":t:bh(e)},Ph=Fn("toStringTag"),Lh=Error,Mh=[].push,Uh=function e(t,n){var r,i=Sh(jh,this);Th?r=Th(Lh(),i?kh(this):jh):(r=i?this:Ch(jh),Rh(r,Ph,"Error")),void 0!==n&&Rh(r,"message",Dh(n)),Nh(r,e,r.stack,1),arguments.length>2&&Oh(r,arguments[2]);var a=[];return xh(t,Mh,{that:a}),Rh(r,"errors",a),r};Th?Th(Uh,Lh):Ih(Uh,Lh,{name:!0});var jh=Uh.prototype=Ch(Lh.prototype,{constructor:Ah(1,Uh),message:Ah(1,""),name:Ah(1,"AggregateError")});wh({global:!0,constructor:!0,arity:2},{AggregateError:Uh});var Fh,Vh,Bh,Gh,Zh="undefined"!=typeof process&&"process"==Ke(process),qh=Dt,Wh=as,Hh=nt,Kh=Fn("species"),zh=Me,Yh=TypeError,Jh=Na,Xh=$t,Qh=TypeError,$h=Ar,ev=function(e){if(Jh(e))return e;throw Qh(Xh(e)+" is not a constructor")},tv=yt,nv=Fn("species"),rv=function(e,t){var n,r=$h(e).constructor;return void 0===r||tv(n=$h(r)[nv])?t:ev(n)},iv=TypeError,av=/(?:ipad|iphone|ipod).*applewebkit/i.test(Pt),ov=je,sv=Ze,cv=Sr,uv=et,lv=Tn,dv=Ae,fv=wo,pv=Su,hv=$n,vv=function(e,t){if(e<t)throw iv("Not enough arguments");return e},mv=av,gv=Zh,yv=ov.setImmediate,_v=ov.clearImmediate,Ev=ov.process,bv=ov.Dispatch,wv=ov.Function,Sv=ov.MessageChannel,kv=ov.String,Tv=0,Iv={},Cv="onreadystatechange";dv((function(){Fh=ov.location}));var Rv=function(e){if(lv(Iv,e)){var t=Iv[e];delete Iv[e],t()}},Av=function(e){return function(){Rv(e)}},Ov=function(e){Rv(e.data)},Nv=function(e){ov.postMessage(kv(e),Fh.protocol+"//"+Fh.host)};yv&&_v||(yv=function(e){vv(arguments.length,1);var t=uv(e)?e:wv(e),n=pv(arguments,1);return Iv[++Tv]=function(){sv(t,void 0,n)},Vh(Tv),Tv},_v=function(e){delete Iv[e]},gv?Vh=function(e){Ev.nextTick(Av(e))}:bv&&bv.now?Vh=function(e){bv.now(Av(e))}:Sv&&!mv?(Gh=(Bh=new Sv).port2,Bh.port1.onmessage=Ov,Vh=cv(Gh.postMessage,Gh)):ov.addEventListener&&uv(ov.postMessage)&&!ov.importScripts&&Fh&&"file:"!==Fh.protocol&&!dv(Nv)?(Vh=Nv,ov.addEventListener("message",Ov,!1)):Vh=Cv in hv("script")?function(e){fv.appendChild(hv("script"))[Cv]=function(){fv.removeChild(this),Rv(e)}}:function(e){setTimeout(Av(e),0)});var xv={set:yv,clear:_v},Dv=function(){this.head=null,this.tail=null};Dv.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Pv,Lv,Mv,Uv,jv,Fv=Dv,Vv=/ipad|iphone|ipod/i.test(Pt)&&"undefined"!=typeof Pebble,Bv=/web0s(?!.*chrome)/i.test(Pt),Gv=je,Zv=Sr,qv=tt.f,Wv=xv.set,Hv=Fv,Kv=av,zv=Vv,Yv=Bv,Jv=Zh,Xv=Gv.MutationObserver||Gv.WebKitMutationObserver,Qv=Gv.document,$v=Gv.process,em=Gv.Promise,tm=qv(Gv,"queueMicrotask"),nm=tm&&tm.value;if(!nm){var rm=new Hv,im=function(){var e,t;for(Jv&&(e=$v.domain)&&e.exit();t=rm.get();)try{t()}catch(e){throw rm.head&&Pv(),e}e&&e.enter()};Kv||Jv||Yv||!Xv||!Qv?!zv&&em&&em.resolve?((Uv=em.resolve(void 0)).constructor=em,jv=Zv(Uv.then,Uv),Pv=function(){jv(im)}):Jv?Pv=function(){$v.nextTick(im)}:(Wv=Zv(Wv,Gv),Pv=function(){Wv(im)}):(Lv=!0,Mv=Qv.createTextNode(""),new Xv(im).observe(Mv,{characterData:!0}),Pv=function(){Mv.data=Lv=!Lv}),nm=function(e){rm.head||Pv(),rm.add(e)}}var am=nm,om=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},sm=je.Promise,cm="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,um=!cm&&!Zh&&"object"==typeof window&&"object"==typeof document,lm=je,dm=sm,fm=et,pm=_r,hm=ga,vm=Fn,mm=um,gm=cm,ym=Bt,_m=dm&&dm.prototype,Em=vm("species"),bm=!1,wm=fm(lm.PromiseRejectionEvent),Sm=pm("Promise",(function(){var e=hm(dm),t=e!==String(dm);if(!t&&66===ym)return!0;if(!_m.catch||!_m.finally)return!0;if(!ym||ym<51||!/native code/.test(e)){var n=new dm((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[Em]=r,!(bm=n.then((function(){}))instanceof r))return!0}return!t&&(mm||gm)&&!wm})),km={CONSTRUCTOR:Sm,REJECTION_EVENT:wm,SUBCLASSING:bm},Tm={},Im=rn,Cm=TypeError,Rm=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw Cm("Bad Promise constructor");t=e,n=r})),this.resolve=Im(t),this.reject=Im(n)};Tm.f=function(e){return new Rm(e)};var Am,Om,Nm=ti,xm=Zh,Dm=je,Pm=at,Lm=rs,Mm=As,Um=function(e){var t=qh(e);Hh&&t&&!t[Kh]&&Wh(t,Kh,{configurable:!0,get:function(){return this}})},jm=rn,Fm=et,Vm=Ct,Bm=function(e,t){if(zh(t,e))return e;throw Yh("Incorrect invocation")},Gm=rv,Zm=xv.set,qm=am,Wm=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},Hm=om,Km=Fv,zm=Ws,Ym=sm,Jm=km,Xm=Tm,Qm="Promise",$m=Jm.CONSTRUCTOR,eg=Jm.REJECTION_EVENT,tg=zm.getterFor(Qm),ng=zm.set,rg=Ym&&Ym.prototype,ig=Ym,ag=rg,og=Dm.TypeError,sg=Dm.document,cg=Dm.process,ug=Xm.f,lg=ug,dg=!!(sg&&sg.createEvent&&Dm.dispatchEvent),fg="unhandledrejection",pg=function(e){var t;return!(!Vm(e)||!Fm(t=e.then))&&t},hg=function(e,t){var n,r,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(o||(2===t.rejection&&_g(t),t.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===e.promise?u(og("Promise-chain cycle")):(r=pg(n))?Pm(r,n,c,u):c(n)):u(a)}catch(e){l&&!i&&l.exit(),u(e)}},vg=function(e,t){e.notified||(e.notified=!0,qm((function(){for(var n,r=e.reactions;n=r.get();)hg(n,e);e.notified=!1,t&&!e.rejection&&gg(e)})))},mg=function(e,t,n){var r,i;dg?((r=sg.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Dm.dispatchEvent(r)):r={promise:t,reason:n},!eg&&(i=Dm["on"+e])?i(r):e===fg&&Wm("Unhandled promise rejection",n)},gg=function(e){Pm(Zm,Dm,(function(){var t,n=e.facade,r=e.value;if(yg(e)&&(t=Hm((function(){xm?cg.emit("unhandledRejection",r,n):mg(fg,n,r)})),e.rejection=xm||yg(e)?2:1,t.error))throw t.value}))},yg=function(e){return 1!==e.rejection&&!e.parent},_g=function(e){Pm(Zm,Dm,(function(){var t=e.facade;xm?cg.emit("rejectionHandled",t):mg("rejectionhandled",t,e.value)}))},Eg=function(e,t,n){return function(r){e(t,r,n)}},bg=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,vg(e,!0))},wg=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw og("Promise can't be resolved itself");var i=pg(n);i?qm((function(){var r={done:!1};try{Pm(i,n,Eg(e,r,t),Eg(bg,r,t))}catch(n){bg(r,n,t)}})):(t.value=n,t.state=1,vg(t,!1))}catch(n){bg({done:!1},n,t)}}};$m&&(ag=(ig=function(e){Bm(this,ag),jm(e),Pm(Am,this);var t=tg(this);try{e(Eg(wg,t),Eg(bg,t))}catch(e){bg(t,e)}}).prototype,(Am=function(e){ng(this,{type:Qm,done:!1,notified:!1,parent:!1,reactions:new Km,rejection:!1,state:0,value:void 0})}).prototype=Lm(ag,"then",(function(e,t){var n=tg(this),r=ug(Gm(this,ig));return n.parent=!0,r.ok=!Fm(e)||e,r.fail=Fm(t)&&t,r.domain=xm?cg.domain:void 0,0==n.state?n.reactions.add(r):qm((function(){hg(r,n)})),r.promise})),Om=function(){var e=new Am,t=tg(e);this.promise=e,this.resolve=Eg(wg,t),this.reject=Eg(bg,t)},Xm.f=ug=function(e){return e===ig||void 0===e?new Om(e):lg(e)}),Nm({global:!0,constructor:!0,wrap:!0,forced:$m},{Promise:ig}),Mm(ig,Qm,!1,!0),Um(Qm);var Sg=Fn("iterator"),kg=!1;try{var Tg=0,Ig={next:function(){return{done:!!Tg++}},return:function(){kg=!0}};Ig[Sg]=function(){return this},Array.from(Ig,(function(){throw 2}))}catch(b){}var Cg=sm,Rg=function(e,t){if(!t&&!kg)return!1;var n=!1;try{var r={};r[Sg]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Ag=km.CONSTRUCTOR||!Rg((function(e){Cg.all(e).then(void 0,(function(){}))})),Og=at,Ng=rn,xg=Tm,Dg=om,Pg=Eh;ti({target:"Promise",stat:!0,forced:Ag},{all:function(e){var t=this,n=xg.f(t),r=n.resolve,i=n.reject,a=Dg((function(){var n=Ng(t.resolve),a=[],o=0,s=1;Pg(e,(function(e){var c=o++,u=!1;s++,Og(n,t,e).then((function(e){u||(u=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Lg=ti,Mg=km.CONSTRUCTOR;sm&&sm.prototype,Lg({target:"Promise",proto:!0,forced:Mg,real:!0},{catch:function(e){return this.then(void 0,e)}});var Ug=at,jg=rn,Fg=Tm,Vg=om,Bg=Eh;ti({target:"Promise",stat:!0,forced:Ag},{race:function(e){var t=this,n=Fg.f(t),r=n.reject,i=Vg((function(){var i=jg(t.resolve);Bg(e,(function(e){Ug(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Gg=at,Zg=Tm;ti({target:"Promise",stat:!0,forced:km.CONSTRUCTOR},{reject:function(e){var t=Zg.f(this);return Gg(t.reject,void 0,e),t.promise}});var qg=Ar,Wg=Ct,Hg=Tm,Kg=function(e,t){if(qg(e),Wg(t)&&t.constructor===e)return t;var n=Hg.f(e);return(0,n.resolve)(t),n.promise},zg=ti,Yg=sm,Jg=km.CONSTRUCTOR,Xg=Kg,Qg=Dt("Promise"),$g=!Jg;zg({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Xg($g&&this===Qg?Yg:this,e)}});var ey=at,ty=rn,ny=Tm,ry=om,iy=Eh;ti({target:"Promise",stat:!0,forced:Ag},{allSettled:function(e){var t=this,n=ny.f(t),r=n.resolve,i=n.reject,a=ry((function(){var n=ty(t.resolve),i=[],a=0,o=1;iy(e,(function(e){var s=a++,c=!1;o++,ey(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--o||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--o||r(i))}))})),--o||r(i)}));return a.error&&i(a.value),n.promise}});var ay=at,oy=rn,sy=Dt,cy=Tm,uy=om,ly=Eh,dy="No one promise resolved";ti({target:"Promise",stat:!0,forced:Ag},{any:function(e){var t=this,n=sy("AggregateError"),r=cy.f(t),i=r.resolve,a=r.reject,o=uy((function(){var r=oy(t.resolve),o=[],s=0,c=1,u=!1;ly(e,(function(e){var l=s++,d=!1;c++,ay(r,t,e).then((function(e){d||u||(u=!0,i(e))}),(function(e){d||u||(d=!0,o[l]=e,--c||a(new n(o,dy)))}))})),--c||a(new n(o,dy))}));return o.error&&a(o.value),r.promise}});var fy=ti,py=sm,hy=Ae,vy=Dt,my=et,gy=rv,yy=Kg,_y=py&&py.prototype;fy({target:"Promise",proto:!0,real:!0,forced:!!py&&hy((function(){_y.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=gy(this,vy("Promise")),n=my(e);return this.then(n?function(n){return yy(t,e()).then((function(){return n}))}:e,n?function(n){return yy(t,e()).then((function(){throw n}))}:e)}});var Ey=Rt.Promise,by=ve(Ey),wy=function(){};function Sy(){var e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:wy};return e.promise=new by((function(t,n){e.resolve=function(n){e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=function(t){e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}var ky,Ty,Iy=new Map,Cy=new Map,Ry=new Map;!function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(ky||(ky={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Ty||(Ty={}));var Ay={exports:{}};!function(e,t){!function(n,r){var i="function",a="undefined",o="object",s="string",c="major",u="model",l="name",d="type",f="vendor",p="version",h="architecture",v="console",m="mobile",g="tablet",y="smarttv",_="wearable",E="embedded",b="Amazon",w="Apple",S="ASUS",k="BlackBerry",T="Browser",I="Chrome",C="Firefox",R="Google",A="Huawei",O="LG",N="Microsoft",x="Motorola",D="Opera",P="Samsung",L="Sharp",M="Sony",U="Xiaomi",j="Zebra",F="Facebook",V="Chromium OS",B="Mac OS",G=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},Z=function(e,t){return typeof e===s&&-1!==q(t).indexOf(q(e))},q=function(e){return e.toLowerCase()},W=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,350)},H=function(e,t){for(var n,a,s,c,u,l,d=0;d<t.length&&!u;){var f=t[d],p=t[d+1];for(n=a=0;n<f.length&&!u&&f[n];)if(u=f[n++].exec(e))for(s=0;s<p.length;s++)l=u[++a],typeof(c=p[s])===o&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):r:this[c[0]]=l?c[1].call(this,l,c[2]):r:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):r):this[c]=l||r;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===o&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(Z(t[n][i],e))return"?"===n?r:n}else if(Z(t[n],e))return"?"===n?r:n;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,p],[/opios[\/ ]+([\w\.]+)/i],[p,[l,D+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[l,D]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[l,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+T],p],[/\bfocus\/([\w\.]+)/i],[p,[l,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[l,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[l,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[l,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[p,[l,C]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+T],p],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,F],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[l,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[p,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[l,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,p],[/(cobalt)\/([\w\.]+)/i],[l,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,q]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[f,P],[d,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[f,P],[d,m]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[f,w],[d,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[f,w],[d,g]],[/(macintosh);/i],[u,[f,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[f,L],[d,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[f,A],[d,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[f,A],[d,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[f,U],[d,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[f,U],[d,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[f,"OPPO"],[d,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[f,"Vivo"],[d,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[f,"Realme"],[d,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[f,x],[d,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[f,x],[d,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[f,O],[d,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[f,O],[d,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[f,"Lenovo"],[d,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[f,"Nokia"],[d,m]],[/(pixel c)\b/i],[u,[f,R],[d,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[f,R],[d,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[f,M],[d,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[f,M],[d,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[f,"OnePlus"],[d,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[f,b],[d,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[f,b],[d,m]],[/(playbook);[-\w\),; ]+(rim)/i],[u,f,[d,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[f,k],[d,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[f,S],[d,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[f,S],[d,m]],[/(nexus 9)/i],[u,[f,"HTC"],[d,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[u,/_/g," "],[d,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[f,"Acer"],[d,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[f,"Meizu"],[d,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,u,[d,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,u,[d,g]],[/(surface duo)/i],[u,[f,N],[d,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[f,"Fairphone"],[d,m]],[/(u304aa)/i],[u,[f,"AT&T"],[d,m]],[/\bsie-(\w*)/i],[u,[f,"Siemens"],[d,m]],[/\b(rct\w+) b/i],[u,[f,"RCA"],[d,g]],[/\b(venue[\d ]{2,7}) b/i],[u,[f,"Dell"],[d,g]],[/\b(q(?:mv|ta)\w+) b/i],[u,[f,"Verizon"],[d,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[f,"Barnes & Noble"],[d,g]],[/\b(tm\d{3}\w+) b/i],[u,[f,"NuVision"],[d,g]],[/\b(k88) b/i],[u,[f,"ZTE"],[d,g]],[/\b(nx\d{3}j) b/i],[u,[f,"ZTE"],[d,m]],[/\b(gen\d{3}) b.+49h/i],[u,[f,"Swiss"],[d,m]],[/\b(zur\d{3}) b/i],[u,[f,"Swiss"],[d,g]],[/\b((zeki)?tb.*\b) b/i],[u,[f,"Zeki"],[d,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],u,[d,g]],[/\b(ns-?\w{0,9}) b/i],[u,[f,"Insignia"],[d,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[f,"NextBook"],[d,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],u,[d,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],u,[d,m]],[/\b(ph-1) /i],[u,[f,"Essential"],[d,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[f,"Envizen"],[d,g]],[/\b(trio[-\w\. ]+) b/i],[u,[f,"MachSpeed"],[d,g]],[/\btu_(1491) b/i],[u,[f,"Rotor"],[d,g]],[/(shield[\w ]+) b/i],[u,[f,"Nvidia"],[d,g]],[/(sprint) (\w+)/i],[f,u,[d,m]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[f,N],[d,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[f,j],[d,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[f,j],[d,m]],[/smart-tv.+(samsung)/i],[f,[d,y]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[f,P],[d,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,O],[d,y]],[/(apple) ?tv/i],[f,[u,w+" TV"],[d,y]],[/crkey/i],[[u,I+"cast"],[f,R],[d,y]],[/droid.+aft(\w)( bui|\))/i],[u,[f,b],[d,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[f,L],[d,y]],[/(bravia[\w ]+)( bui|\))/i],[u,[f,M],[d,y]],[/(mitv-\w{5}) bui/i],[u,[f,U],[d,y]],[/Hbbtv.*(technisat) (.*);/i],[f,u,[d,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,W],[u,W],[d,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,u,[d,v]],[/droid.+; (shield) bui/i],[u,[f,"Nvidia"],[d,v]],[/(playstation [345portablevi]+)/i],[u,[f,M],[d,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[f,N],[d,v]],[/((pebble))app/i],[f,u,[d,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[f,w],[d,_]],[/droid.+; (glass) \d/i],[u,[f,R],[d,_]],[/droid.+; (wt63?0{2,3})\)/i],[u,[f,j],[d,_]],[/(quest( 2| pro)?)/i],[u,[f,F],[d,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[d,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[d,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[d,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,m]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[l,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[p,K,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[p,K,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,p],[/\(bb(10);/i],[p,[l,k]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[l,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,V],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,p],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[l,p]]},J=function e(t,v){if(typeof t===o&&(v=t,t=r),!(this instanceof e))return new e(t,v).getResult();var y=typeof n!==a&&n.navigator?n.navigator:r,_=t||(y&&y.userAgent?y.userAgent:""),E=y&&y.userAgentData?y.userAgentData:r,b=v?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(Y,v):Y;return this.getBrowser=function(){var e={};return e[l]=r,e[p]=r,H.call(e,_,b.browser),e[c]=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),y&&y.brave&&typeof y.brave.isBrave==i&&(e[l]="Brave"),e},this.getCPU=function(){var e={};return e[h]=r,H.call(e,_,b.cpu),e},this.getDevice=function(){var e={};return e[f]=r,e[u]=r,e[d]=r,H.call(e,_,b.device),!e[d]&&E&&E.mobile&&(e[d]=m),"Macintosh"==e[u]&&y&&typeof y.standalone!==a&&y.maxTouchPoints&&y.maxTouchPoints>2&&(e[u]="iPad",e[d]=g),e},this.getEngine=function(){var e={};return e[l]=r,e[p]=r,H.call(e,_,b.engine),e},this.getOS=function(){var e={};return e[l]=r,e[p]=r,H.call(e,_,b.os),!e[l]&&E&&"Unknown"!=E.platform&&(e[l]=E.platform.replace(/chrome os/i,V).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _},this.setUA=function(e){return _=typeof e===s&&e.length>350?W(e,350):e,this},this.setUA(_),this};J.VERSION="0.7.34",J.BROWSER=G([l,p,c]),J.CPU=G([h]),J.DEVICE=G([u,f,d,v,m,y,g,_,E]),J.ENGINE=J.OS=G([l,p]),e.exports&&(t=e.exports=J),t.UAParser=J;var X=typeof n!==a&&(n.jQuery||n.Zepto);if(X&&!X.ua){var Q=new J;X.ua=Q.getResult(),X.ua.get=function(){return Q.getUA()},X.ua.set=function(e){Q.setUA(e);var t=Q.getResult();for(var n in t)X.ua[n]=t[n]}}}("object"==typeof window?window:he)}(Ay,Ay.exports);var Oy,Ny=new(ve(Ay.exports)),xy=Ny.getResult(),Dy=null;function Py(e){if(!Dy){e&&Ny.setUA(e);var t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return Ty.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ty.CHROME;case"Safari":case"Mobile Safari":return Ty.SAFARI;case"Edge":return Ty.EDGE;case"Firefox":return Ty.FIREFOX;case"QQBrowser":return Ty.QQ;case"Opera":return Ty.OPERA;case"WeChat":return Ty.WECHAT;default:return e.browser.name||""}}(xy=Ny.getResult()),n=function(e){return("Blink"===e.engine.name?e.engine.version||"":e.browser.version||"").split(".")[0]}(xy),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(xy),i=xy.os.version;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i};Dy={name:t,version:n,os:r,osVersion:i}}return Dy}function Ly(){return Py().os}function My(){var e=Py();return"".concat(e.os," ").concat(e.osVersion)}function Uy(){var e=Py();return!!("WebKit"===xy.engine.name&&e.os===ky.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ty.SAFARI||Zy()&&e.name!==Ty.SAFARI)}function jy(){var e=Py();if(Uy()){if(e.os===ky.MAC_OS)return!0;if(e.os===ky.IOS){var t=xy.os.version&&xy.os.version.split(".");if(t&&14===Number(t[0])&&t[1]&&Number(t[1])>=3)return!0;if(t&&Number(t[0])>14)return!0}}return!1}function Fy(){return"WebKit"===xy.engine.name}function Vy(){return Py().name===Ty.CHROME}function By(){return Py().name===Ty.SAFARI}function Gy(){return Py().name===Ty.FIREFOX}function Zy(){return Py().os===ky.IOS}function qy(e){var t=Py();return!(t.name!==Ty.CHROME||!t.osVersion)&&Number(t.version)>=e}function Wy(e){var t=Py();return!(t.name!==Ty.EDGE||!t.osVersion)&&Number(t.version)>=e}function Hy(e){var t=Py();return!(t.name!==Ty.OPERA||!t.osVersion)&&Number(t.version)>=e}function Ky(){var e=Py();return!(e.name!==Ty.CHROME||!e.osVersion)&&Number(e.version)<=90}function zy(){var e=Py();if(e.os!==ky.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function Yy(){var e=Py();if(e.os!==ky.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])}function Jy(){var e=Py();if(e.os!==ky.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 16===Number(t[0])}function Xy(){var e=Py();if(e.os!==ky.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function Qy(){return By()&&navigator.maxTouchPoints>0}function $y(){return Py().name===Ty.WECHAT}function e_(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function t_(){var e=Py();return e.name!==Ty.EDGE&&e.name!==Ty.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function n_(){return Ly()===ky.ANDROID}function r_(){var e=Py();return n_()&&(e.name===Ty.CHROME||e.name===Ty.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(Oy||(Oy={}));var i_,a_,o_=function(e){p(n,e);var t=h(n);function n(e){var r;l(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;return r=t.call(this,i),kf(f(r),"code",void 0),kf(f(r),"message",void 0),kf(f(r),"data",void 0),kf(f(r),"name","AgoraRTCException"),r.code=e,r.message="AgoraRTCError ".concat(r.code,": ").concat(i),r.data=a,r}return d(n,[{key:"toString",value:function(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}},{key:"throw",value:function(e){throw this.print("error",e),this}}]),n}(v(Error));function s_(e,t){if("boolean"!=typeof e)throw new o_(Oy.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function c_(e,t,n){if(!$i(n).call(n,e))throw new o_(Oy.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function u_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new o_(Oy.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function l_(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new o_(Oy.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&u_(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&u_(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&u_(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&u_(e.ideal,"".concat(t,".ideal"),1,1/0)}else u_(e,t,1,1/0)}function d_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new o_(Oy.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!h_(e,n,r,i))throw new o_(Oy.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function f_(e,t){if(!Array.isArray(e))throw new o_(Oy.INVALID_PARAMS,"".concat(t," should be an array"))}function p_(e){return null==e}function h_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(var t=0;t<e.length;t+=1){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}function v_(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);var r=e.getUint32(t,n),i=e.getUint32(t+4,n),a=Number(!!n),o=Number(!n);return BigInt(r*o+i*a)<<BigInt(32)|BigInt(r*a+i*o)}function m_(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);var i=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,a,r)):(e.setUint32(t,i,r),e.setUint32(t+4,a,r))}!function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"}(i_||(i_={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(a_||(a_={}));var g_=new(function(){function e(){var t=this;l(this,e),kf(this,"_clientSize",null),kf(this,"getClientWidth",(function(){return document.documentElement?document.documentElement.clientWidth:document.body.clientWidth})),kf(this,"getClientHeight",(function(){return document.documentElement?document.documentElement.clientHeight:document.body.clientHeight})),kf(this,"getStyle",(function(e){return window.getComputedStyle(e,null)})),kf(this,"checkCssVisibleProperty",(function(e){var n,r=!0,i=t.getStyle(e),a=i.display,o=i.visibility,s=i.opacity,c=i.filter;return("none"===a||$i(n=["hidden","collapse"]).call(n,o)||Number(s)<.1)&&(r=!1),!!r&&(c&&c.split(" ").filter((function(e){var t,n=e.split("(")[0];return $i(t=["brightness","blur","opacity"]).call(t,n)})).map((function(e){var t=e.split(/\(|\)/),n=u(t,2),r=n[0],i=n[1];return[r,Number(i.match(/^[0-9\.]+/))]})).forEach((function(e){var t=u(e,2),n=t[0],i=t[1];switch(n){case"brightness":(i<.1||i>3)&&(r=!1);break;case"blur":i>3&&(r=!1);break;case"opacity":i<.1&&(r=!1)}})),r)})),kf(this,"checkPropertyUpToAllParentNodes",(function(e,t){for(var n=!0,r=!0,i=function(e){return t(e)},a=e;a&&r;)i(a)||(n=!1,r=!1),(a=a.parentElement)||(r=!1);return n})),kf(this,"checkActualCssVisibleIncludeInherit",(function(e){return t.checkPropertyUpToAllParentNodes(e,t.checkCssVisibleProperty)})),kf(this,"getSizeAboutClient",(function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height,a=n.left,o=n.right,s=n.top,c=n.bottom,u=t.getClientWidth(),l=t.getClientHeight();return{width:r,height:i,left:a,right:o,top:s,bottom:c,clientWidth:u,clientHeight:l,clientMin:Math.min(u,l)}})),kf(this,"checkActualSize",(function(){var e=t._clientSize,n=e.width,r=e.height,i=e.clientMin;return t.checkSizeIsVisible(n,r,i)})),kf(this,"elementFromPoint",(function(e,t){return document.elementFromPoint?document.elementFromPoint(e,t):null})),kf(this,"checkCoverForAPoint",(function(e,n,r){var i=t.elementFromPoint(e,n);return null!==i&&i!==r})),kf(this,"getPointPositionList",(function(){for(var e=t._clientSize,n=e.width,r=e.height,i=e.left,a=e.top,o=n/6,s=r/6,c=[],u=Math.pow(10,6),l=0;l<5;l++)for(var d=0;d<5;d++){var f=(i*u+(0===l?.1:4===l?(o*l*u-1e5)/u:o*l)*u)/u,p=(a*u+(0===d?.1:4===d?(s*d*u-1e5)/u:s*d)*u)/u;c.push({x:f,y:p})}return[].concat(c)})),kf(this,"checkElementCover",(function(e){return t.getPointPositionList().map((function(n){return t.checkCoverForAPoint(n.x,n.y,e)})).filter((function(e){return!!e})).length>6})),kf(this,"checkSizeIsVisible",(function(e,t,n){return(e>50||n/e<=10)&&(t>50||n/t<=10)})),kf(this,"checkSizeOfPartInClient",(function(){var e,n,r=t._clientSize,i=r.left,a=r.right,o=r.top,s=r.bottom,c=r.clientHeight,u=r.clientWidth,l=r.clientMin;if(i<0)e=0;else{if(!(i<u))return!1;e=i}if(a<0)return!1;if(o<0)n=0;else{if(!(o<c))return!1;n=o}if(s<0)return!1;var d=(a<u?a:u)-e,f=(s<c?s:c)-n;return t.checkSizeIsVisible(d,f,l)})),kf(this,"returnHiddenResult",(function(e){return t._clientSize=null,{visible:!1,reason:e}})),kf(this,"checkOneElementVisible",(function(e){if(e instanceof HTMLElement){if(t.checkElementIsMountedOnDom(e)){if(t.checkActualCssVisibleIncludeInherit(e)){if(t._clientSize=t.getSizeAboutClient(e),t.checkElementCover(e))return t.returnHiddenResult(i_.COVERED);var n=t.checkActualSize(),r=t.checkSizeOfPartInClient();return n&&!r?t.returnHiddenResult(i_.POSITION):n?(t._clientSize=null,{visible:!0}):t.returnHiddenResult(i_.SIZE)}return t.returnHiddenResult(i_.STYLE)}return t.returnHiddenResult(a_.UNMOUNTED)}return t.returnHiddenResult(a_.INVALID_HTML_ELEMENT)})),kf(this,"checkElementIsMountedOnDom",(function(e){return t.checkPropertyUpToAllParentNodes(e,(function(e){return"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement}))}))}return d(e)}());function y_(e){return(new TextEncoder).encode(e)}var __,E_,b_,w_,S_,k_,T_,I_,C_=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},R_=function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),e.next=3,window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]);case 3:return r=e.sent,i=y_(t),e.next=7,window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i);case 7:return a=e.sent,e.abrupt("return",function(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(a)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A_=function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=function(e,t){var n="";return new Uint8Array(e).forEach((function(e){n+=e.toString(t).padStart(2,"0")})),n},e.next=3,crypto.subtle.digest("SHA-256",y_(t));case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1,16));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O_=function(){function e(){l(this,e),kf(this,"_events",{}),kf(this,"addListener",this.on)}return d(e,[{key:"getListeners",value:function(e){return this._events[e]?this._events[e].map((function(e){return e.listener})):[]}},{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}},{key:"once",value:function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}},{key:"off",value:function(e,t){if(this._events[e]){var n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}}},{key:"removeAllListeners",value:function(e){e?delete this._events[e]:this._events={}}},{key:"emit",value:function(e){this._events[e]||(this._events[e]=[]);for(var t=this._events[e].map((function(e){return e})),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a+=1){var o=t[a];o.once&&this.off(e,o.listener),o.listener.apply(this,r||[])}}},{key:"safeEmit",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];m(this._events[e]||[]).forEach((function(n){n.once&&t.off(e,n.listener);try{n.listener.apply(t,r)}catch(n){console.error("safeEmit event:".concat(e," error ").concat(null==n?void 0:n.toString()))}}))}},{key:"_indexOfListener",value:function(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}}]),e}(),N_=null;function x_(){if(N_)return N_;if(window.electron)return N_=window.electron;if(!window.require)return null;try{return N_=window.require("electron")}catch(b){return null}}function D_(e){return u_(e.timeout,"config.timeout",0,1e5),u_(e.timeoutFactor,"config.timeoutFactor",0,100,!1),u_(e.maxRetryCount,"config.maxRetryConfig",0,1/0),u_(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function P_(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((function(e){if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function L_(e){return d_(e.turnServerURL,"turnServerURL"),d_(e.username,"username"),d_(e.password,"password"),e.udpport&&u_(e.udpport,"udpport",1,99999,!0),e.forceturn&&s_(e.forceturn,"forceturn"),e.security&&s_(e.security,"security"),e.tcpport&&u_(e.tcpport,"tcpport",1,99999,!0),!0}function M_(e){return void 0!==e.level&&c_(e.level,"level",[1,2,3]),void 0!==e.delay&&u_(e.delay,"delay",0,3e3,!0),!0}function U_(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?by.reject(new o_(Oy.UNEXPECTED_ERROR,"can not emit promise")):new by((function(n,i){e.emit.apply(e,[t].concat(r,[n,i]))}))}function j_(e,t){if(0===e.getListeners(t).length)return by.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return U_.apply(void 0,[e,t].concat(r))}function F_(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return V_.apply(void 0,[e,t].concat(r))}function V_(e,t){for(var n=null,r=null,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];if(e.emit.apply(e,[t].concat(a,[function(e){n=e},function(e){r=e}])),null!==r)throw r;if(null===n)throw new o_(Oy.UNEXPECTED_ERROR,"handler is not sync");return n}!function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(__||(__={})),function(e){e.TRACER="tracer"}(E_||(E_={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(b_||(b_={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE"}(w_||(w_={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(S_||(S_={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(k_||(k_={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(T_||(T_={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(I_||(I_={}));var B_=new(function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"_moduleName","network-indicator"),kf(f(e),"_networkState",T_.ONLINE),kf(f(e),"onlineWaiter",void 0),window.addEventListener("online",(function(){e.networkState=T_.ONLINE})),window.addEventListener("offline",(function(){e.networkState=T_.OFFLINE})),e}return d(n,[{key:"networkState",get:function(){return this._networkState},set:function(e){var t=this;this.emit(I_.NETWORK_STATE_CHANGE,e,this._networkState),e===T_.ONLINE?this.emit(I_.ONLINE):e===T_.OFFLINE&&(this.onlineWaiter=new by((function(e){t.once(I_.ONLINE,(function(){t.onlineWaiter=void 0,e(T_.ONLINE)}))})),this.emit(I_.OFFLINE)),this._networkState=e}},{key:"isOnline",get:function(){return this._networkState===T_.ONLINE}}]),n}(O_));function G_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G_(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q_(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function W_(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),t}function H_(e){void 0!==by?by.resolve().then(e):setTimeout(e,0)}function K_(e){return JSON.parse(JSON.stringify(e))}function z_(e){try{return K_(e)}catch(w){return e}}var Y_={};function J_(e,t){Y_[t]||(Y_[t]=!0,e())}function X_(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Q_(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function $_(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function eE(e){var t=0;return/DingTalk/i.test(navigator.userAgent)&&e.realFormData&&(e=e.realFormData),e.forEach((function(e){t+="string"==typeof e?$_(e):e.size})),t+138}function tE(e){var t=new o_(Oy.TIMEOUT,"timeout");return new by((function(n,r){window.setTimeout((function(){return r(t)}),e)}))}function nE(e){return new by((function(t){window.setTimeout(t,e)}))}function rE(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+rE(e-n.length,"")}function iE(){return rE(32,"").toUpperCase()}var aE=function(){},oE=new(function(){function e(){l(this,e),kf(this,"fnMap",new Map)}return d(e,[{key:"throttleByKey",value:function(e,t,n,r){for(var i=this,a=arguments.length,o=new Array(a>4?a-4:0),s=4;s<a;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){var c=this.fnMap.get(t);if(c.threshold!==n){c.fn.apply(c,m(c.args)),clearTimeout(c.timer);var u=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,m(e.args)),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:o,skipFn:r})}else c.skipFn&&c.skipFn.apply(c,m(c.args)),this.fnMap.set(t,Z_(Z_({},c),{},{fn:e,args:o,skipFn:r}))}else{var l=window.setTimeout((function(){var e=i.fnMap.get(t);e&&e.fn.apply(e,m(e.args)),i.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:o,skipFn:r})}}}]),e}()),sE=oE.throttleByKey.bind(oE);function cE(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function uE(e,t){if(!cE(e)||!cE(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){for(var n=m(e),r=0;r<t.length;r++)n[r]=uE(e[r],t[r]);return n}var i=Z_({},e);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?i[a]=uE(e[a],t[a]):i[a]=t[a]);return i}var lE=1,dE=console,fE=function(){function e(t){l(this,e),kf(this,"lockingPromise",by.resolve()),kf(this,"locks",0),kf(this,"name",""),kf(this,"lockId",void 0),this.lockId=lE++,t&&(this.name=t),dE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}return d(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(e){var t,n=this;this.locks+=1,dE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));var r=new by((function(r){t=function(){n.locks-=1,dE.debug("[lock-".concat(n.name,"-").concat(n.lockId,"] is not locked, current queue ").concat(n.locks,". ").concat("string"==typeof e?e:"")),r()}})),i=this.lockingPromise.then((function(){return t}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),i}}],[{key:"setLogger",value:function(e){dE=e}}]),e}();function pE(e,t){return function(n,r,i){var a=i.value;if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return i.value=c(s().mark((function n(){var i,o,c,u,l,d=arguments;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this[t]){n.next=3;break}throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));case 3:return n.next=5,i.lock("From ".concat(e,".").concat(r));case 5:for(o=n.sent,n.prev=6,c=d.length,u=new Array(c),l=0;l<c;l++)u[l]=d[l];return n.next=10,a.apply(this,u);case 10:return n.abrupt("return",n.sent);case 11:return n.prev=11,o(),n.finish(11);case 14:case"end":return n.stop()}}),n,this,[[6,,11,14]])}))),i}}var hE={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function vE(e,t){var n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function mE(e,t,n,r){var i=Object.assign({},hE,r),a=i.timeout,o=function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(e){return new by((function(t){window.setTimeout(t,e)}))}(a);case 2:a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=!1,l=new by(function(){var r=c(s().mark((function r(a,c){var l,d;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=t||function(){return!1},n=n||function(){return!0},l=0;case 2:if(!(l<i.maxRetryCount)){r.next=28;break}if(!u){r.next=5;break}return r.abrupt("return",c(new o_(Oy.OPERATION_ABORTED)));case 5:return r.prev=5,r.next=8,e();case 8:if(d=r.sent,t(d,l)){r.next=11;break}return r.abrupt("return",a(d));case 11:if(l+1!==i.maxRetryCount){r.next=13;break}return r.abrupt("return",a(d));case 13:return r.next=15,o();case 15:r.next=25;break;case 17:if(r.prev=17,r.t0=r.catch(5),n(r.t0,l)){r.next=21;break}return r.abrupt("return",c(r.t0));case 21:if(l+1!==i.maxRetryCount){r.next=23;break}return r.abrupt("return",c(r.t0));case 23:return r.next=25,o();case 25:l+=1,r.next=2;break;case 28:case"end":return r.stop()}}),r,null,[[5,17]])})));return function(e,t){return r.apply(this,arguments)}}());return l.cancel=function(){return u=!0},l}var gE=rn,yE=wn,_E=gt,EE=pi,bE=TypeError,wE=function(e){return function(t,n,r,i){gE(n);var a=yE(t),o=_E(a),s=EE(a),c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in o){i=o[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw bE("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in o&&(i=n(i,o[c],c,a));return i}},SE=[wE(!1),wE(!0)][0];ti({target:"Array",proto:!0,forced:!Zh&&Bt>79&&Bt<83||!Gf("reduce")},{reduce:function(e){var t=arguments.length;return SE(this,e,t,t>1?arguments[1]:void 0)}});var kE,TE=bi("Array").reduce,IE=Me,CE=TE,RE=Array.prototype,AE=ve((function(e){var t=e.reduce;return e===RE||IE(RE,e)&&t===RE.reduce?CE:t})),OE=function(){function e(t){l(this,e),kf(this,"input",[]),kf(this,"size",void 0),this.size=t}return d(e,[{key:"add",value:function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}},{key:"mean",value:function(){var e;return 0===this.input.length?0:AE(e=this.input).call(e,(function(e,t){return e+t}))/this.input.length}}]),e}(),NE={exports:{}},xE=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},DE=xE,PE=Object.prototype.toString,LE=(kE=Object.create(null),function(e){var t=PE.call(e);return kE[t]||(kE[t]=t.slice(8,-1).toLowerCase())});function ME(e){return e=e.toLowerCase(),function(t){return LE(t)===e}}function UE(e){return Array.isArray(e)}function jE(e){return void 0===e}var FE=ME("ArrayBuffer");function VE(e){return null!==e&&"object"==typeof e}function BE(e){if("object"!==LE(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var GE=ME("Date"),ZE=ME("File"),qE=ME("Blob"),WE=ME("FileList");function HE(e){return"[object Function]"===PE.call(e)}var KE=ME("URLSearchParams");function zE(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),UE(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var YE,JE=(YE="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return YE&&e instanceof YE}),XE={isArray:UE,isArrayBuffer:FE,isBuffer:function(e){return null!==e&&!jE(e)&&null!==e.constructor&&!jE(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||PE.call(e)===t||HE(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&FE(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:VE,isPlainObject:BE,isUndefined:jE,isDate:GE,isFile:ZE,isBlob:qE,isFunction:HE,isStream:function(e){return VE(e)&&HE(e.pipe)},isURLSearchParams:KE,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:zE,merge:function e(){var t={};function n(n,r){BE(t[r])&&BE(n)?t[r]=e(t[r],n):BE(n)?t[r]=e({},n):UE(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)zE(arguments[r],n);return t},extend:function(e,t,n){return zE(t,(function(t,r){e[r]=n&&"function"==typeof t?DE(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,a,o={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)o[a=r[i]]||(t[a]=e[a],o[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:LE,kindOfTest:ME,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(jE(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:JE,isFileList:WE},QE=XE;function $E(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var eb=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(QE.isURLSearchParams(t))r=t.toString();else{var i=[];QE.forEach(t,(function(e,t){null!=e&&(QE.isArray(e)?t+="[]":e=[e],QE.forEach(e,(function(e){QE.isDate(e)?e=e.toISOString():QE.isObject(e)&&(e=JSON.stringify(e)),i.push($E(t)+"="+$E(e))})))})),r=i.join("&")}if(r){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},tb=XE;function nb(){this.handlers=[]}nb.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},nb.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},nb.prototype.forEach=function(e){tb.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var rb,ib,ab=nb,ob=XE;function sb(){if(ib)return rb;ib=1;var e=XE;function t(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}e.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n=t.prototype,r={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){r[e]={value:e}})),Object.defineProperties(t,r),Object.defineProperty(n,"isAxiosError",{value:!0}),t.from=function(r,i,a,o,s,c){var u=Object.create(n);return e.toFlatObject(r,u,(function(e){return e!==Error.prototype})),t.call(u,r.message,i,a,o,s),u.name=r.name,c&&Object.assign(u,c),u},rb=t}var cb,ub,lb,db,fb,pb,hb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function vb(){if(ub)return cb;ub=1;var e=XE;return cb=function(t,n){n=n||new FormData;var r=[];function i(t){return null===t?"":e.isDate(t)?t.toISOString():e.isArrayBuffer(t)||e.isTypedArray(t)?"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}return function t(a,o){if(e.isPlainObject(a)||e.isArray(a)){if(-1!==r.indexOf(a))throw Error("Circular reference detected in "+o);r.push(a),e.forEach(a,(function(r,a){if(!e.isUndefined(r)){var s,c=o?o+"."+a:a;if(r&&!o&&"object"==typeof r)if(e.endsWith(a,"{}"))r=JSON.stringify(r);else if(e.endsWith(a,"[]")&&(s=e.toArray(r)))return void s.forEach((function(t){!e.isUndefined(t)&&n.append(c,i(t))}));t(r,c)}})),r.pop()}else n.append(o,i(a))}(t),n},cb}function mb(){if(db)return lb;db=1;var e=sb();return lb=function(t,n,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?n(new e("Request failed with status code "+r.status,[e.ERR_BAD_REQUEST,e.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):t(r)}}function gb(){if(pb)return fb;pb=1;var e=XE;return fb=e.isStandardBrowserEnv()?{write:function(t,n,r,i,a,o){var s=[];s.push(t+"="+encodeURIComponent(n)),e.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),e.isString(i)&&s.push("path="+i),e.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},fb}var yb,_b,Eb,bb,wb,Sb,kb,Tb,Ib,Cb,Rb,Ab,Ob=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Nb=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},xb=function(e,t){return e&&!Ob(t)?Nb(e,t):t};function Db(){if(_b)return yb;_b=1;var e=XE,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return yb=function(n){var r,i,a,o={};return n?(e.forEach(n.split("\n"),(function(n){if(a=n.indexOf(":"),r=e.trim(n.substr(0,a)).toLowerCase(),i=e.trim(n.substr(a+1)),r){if(o[r]&&t.indexOf(r)>=0)return;o[r]="set-cookie"===r?(o[r]?o[r]:[]).concat([i]):o[r]?o[r]+", "+i:i}})),o):o},yb}function Pb(){if(bb)return Eb;bb=1;var e=XE;return Eb=e.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var t=e;return n&&(r.setAttribute("href",t),t=r.href),r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=i(window.location.href),function(n){var r=e.isString(n)?i(n):n;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}}function Lb(){if(Sb)return wb;Sb=1;var e=sb();function t(t){e.call(this,null==t?"canceled":t,e.ERR_CANCELED),this.name="CanceledError"}return XE.inherits(t,e,{__CANCEL__:!0}),wb=t}function Mb(){return Tb||(Tb=1,kb=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),kb}function Ub(){if(Cb)return Ib;Cb=1;var e=XE,t=mb(),n=gb(),r=eb,i=xb,a=Db(),o=Pb(),s=hb,c=sb(),u=Lb(),l=Mb();return Ib=function(d){return new Promise((function(f,p){var h,v=d.data,m=d.headers,g=d.responseType;function y(){d.cancelToken&&d.cancelToken.unsubscribe(h),d.signal&&d.signal.removeEventListener("abort",h)}e.isFormData(v)&&e.isStandardBrowserEnv()&&delete m["Content-Type"];var _=new XMLHttpRequest;if(d.auth){var E=d.auth.username||"",b=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";m.Authorization="Basic "+btoa(E+":"+b)}var w=i(d.baseURL,d.url);function S(){if(_){var e="getAllResponseHeaders"in _?a(_.getAllResponseHeaders()):null,n={data:g&&"text"!==g&&"json"!==g?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:e,config:d,request:_};t((function(e){f(e),y()}),(function(e){p(e),y()}),n),_=null}}if(_.open(d.method.toUpperCase(),r(w,d.params,d.paramsSerializer),!0),_.timeout=d.timeout,"onloadend"in _?_.onloadend=S:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(S)},_.onabort=function(){_&&(p(new c("Request aborted",c.ECONNABORTED,d,_)),_=null)},_.onerror=function(){p(new c("Network Error",c.ERR_NETWORK,d,_,_)),_=null},_.ontimeout=function(){var e=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",t=d.transitional||s;d.timeoutErrorMessage&&(e=d.timeoutErrorMessage),p(new c(e,t.clarifyTimeoutError?c.ETIMEDOUT:c.ECONNABORTED,d,_)),_=null},e.isStandardBrowserEnv()){var k=(d.withCredentials||o(w))&&d.xsrfCookieName?n.read(d.xsrfCookieName):void 0;k&&(m[d.xsrfHeaderName]=k)}"setRequestHeader"in _&&e.forEach(m,(function(e,t){void 0===v&&"content-type"===t.toLowerCase()?delete m[t]:_.setRequestHeader(t,e)})),e.isUndefined(d.withCredentials)||(_.withCredentials=!!d.withCredentials),g&&"json"!==g&&(_.responseType=d.responseType),"function"==typeof d.onDownloadProgress&&_.addEventListener("progress",d.onDownloadProgress),"function"==typeof d.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(h=function(e){_&&(p(!e||e&&e.type?new u:e),_.abort(),_=null)},d.cancelToken&&d.cancelToken.subscribe(h),d.signal&&(d.signal.aborted?h():d.signal.addEventListener("abort",h))),v||(v=null);var T=l(w);T&&-1===["http","https","file"].indexOf(T)?p(new c("Unsupported protocol "+T+":",c.ERR_BAD_REQUEST,d)):_.send(v)}))},Ib}var jb=XE,Fb=function(e,t){ob.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},Vb=sb(),Bb=hb,Gb=vb(),Zb={"Content-Type":"application/x-www-form-urlencoded"};function qb(e,t){!jb.isUndefined(e)&&jb.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Wb,Hb={transitional:Bb,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Wb=Ub()),Wb),transformRequest:[function(e,t){if(Fb(t,"Accept"),Fb(t,"Content-Type"),jb.isFormData(e)||jb.isArrayBuffer(e)||jb.isBuffer(e)||jb.isStream(e)||jb.isFile(e)||jb.isBlob(e))return e;if(jb.isArrayBufferView(e))return e.buffer;if(jb.isURLSearchParams(e))return qb(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=jb.isObject(e),i=t&&t["Content-Type"];if((n=jb.isFileList(e))||r&&"multipart/form-data"===i){var a=this.env&&this.env.FormData;return Gb(n?{"files[]":e}:e,a&&new a)}return r||"application/json"===i?(qb(t,"application/json"),function(e,t,n){if(jb.isString(e))try{return(t||JSON.parse)(e),jb.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Hb.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&jb.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw Vb.from(e,Vb.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ab?Rb:(Ab=1,Rb=null)},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};jb.forEach(["delete","get","head"],(function(e){Hb.headers[e]={}})),jb.forEach(["post","put","patch"],(function(e){Hb.headers[e]=jb.merge(Zb)}));var Kb,zb,Yb=Hb,Jb=XE,Xb=Yb;function Qb(){return zb?Kb:(zb=1,Kb=function(e){return!(!e||!e.__CANCEL__)})}var $b=XE,ew=function(e,t,n){var r=this||Xb;return Jb.forEach(n,(function(n){e=n.call(r,e,t)})),e},tw=Qb(),nw=Yb,rw=Lb();function iw(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new rw}var aw,ow,sw=XE,cw=function(e,t){t=t||{};var n={};function r(e,t){return sw.isPlainObject(e)&&sw.isPlainObject(t)?sw.merge(e,t):sw.isPlainObject(t)?sw.merge({},t):sw.isArray(t)?t.slice():t}function i(n){return sw.isUndefined(t[n])?sw.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function a(e){if(!sw.isUndefined(t[e]))return r(void 0,t[e])}function o(n){return sw.isUndefined(t[n])?sw.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function s(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s};return sw.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,r=t(e);sw.isUndefined(r)&&t!==s||(n[e]=r)})),n};function uw(){return ow?aw:(ow=1,aw={version:"0.27.2"})}var lw=uw().version,dw=sb(),fw={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){fw[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var pw={};fw.transitional=function(e,t,n){function r(e,t){return"[Axios v"+lw+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,a){if(!1===e)throw new dw(r(i," has been removed"+(t?" in "+t:"")),dw.ERR_DEPRECATED);return t&&!pw[i]&&(pw[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}};var hw,vw,mw,gw,yw,_w,Ew={assertOptions:function(e,t,n){if("object"!=typeof e)throw new dw("options must be an object",dw.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var a=r[i],o=t[a];if(o){var s=e[a],c=void 0===s||o(s,a,e);if(!0!==c)throw new dw("option "+a+" must be "+c,dw.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new dw("Unknown option "+a,dw.ERR_BAD_OPTION)}},validators:fw},bw=XE,ww=eb,Sw=ab,kw=function(e){return iw(e),e.headers=e.headers||{},e.data=ew.call(e,e.data,e.headers,e.transformRequest),e.headers=$b.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),$b.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||nw.adapter)(e).then((function(t){return iw(e),t.data=ew.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return tw(t)||(iw(e),t&&t.response&&(t.response.data=ew.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Tw=cw,Iw=xb,Cw=Ew,Rw=Cw.validators;function Aw(e){this.defaults=e,this.interceptors={request:new Sw,response:new Sw}}Aw.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=Tw(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&Cw.assertOptions(n,{silentJSONParsing:Rw.transitional(Rw.boolean),forcedJSONParsing:Rw.transitional(Rw.boolean),clarifyTimeoutError:Rw.transitional(Rw.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var a,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!i){var s=[kw,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(o),a=Promise.resolve(t);s.length;)a=a.then(s.shift(),s.shift());return a}for(var c=t;r.length;){var u=r.shift(),l=r.shift();try{c=u(c)}catch(e){l(e);break}}try{a=kw(c)}catch(e){return Promise.reject(e)}for(;o.length;)a=a.then(o.shift(),o.shift());return a},Aw.prototype.getUri=function(e){e=Tw(this.defaults,e);var t=Iw(e.baseURL,e.url);return ww(t,e.params,e.paramsSerializer)},bw.forEach(["delete","get","head","options"],(function(e){Aw.prototype[e]=function(t,n){return this.request(Tw(n||{},{method:e,url:t,data:(n||{}).data}))}})),bw.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(Tw(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Aw.prototype[e]=t(),Aw.prototype[e+"Form"]=t(!0)}));var Ow=XE,Nw=xE,xw=Aw,Dw=cw,Pw=function e(t){var n=new xw(t),r=Nw(xw.prototype.request,n);return Ow.extend(r,xw.prototype,n),Ow.extend(r,n),r.create=function(n){return e(Dw(t,n))},r}(Yb);Pw.Axios=xw,Pw.CanceledError=Lb(),Pw.CancelToken=function(){if(vw)return hw;vw=1;var e=Lb();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(e){n=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t((function(t){r.reason||(r.reason=new e(t),n(r.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},hw=t}(),Pw.isCancel=Qb(),Pw.VERSION=uw().version,Pw.toFormData=vb(),Pw.AxiosError=sb(),Pw.Cancel=Pw.CanceledError,Pw.all=function(e){return Promise.all(e)},Pw.spread=gw?mw:(gw=1,mw=function(e){return function(t){return e.apply(null,t)}}),Pw.isAxiosError=function(){if(_w)return yw;_w=1;var e=XE;return yw=function(t){return e.isObject(t)&&!0===t.isAxiosError}}(),NE.exports=Pw,NE.exports.default=Pw;var Lw,Mw=ve(NE.exports);function Uw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uw(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fw(e,t,n,r){return new by((function(i,a){t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$_(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?eE(t.data):$_(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mw.request(t).then((function(e){"string"==typeof e.data?$_(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:$_(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((function(e){Mw.isCancel(e)?a(new o_(Oy.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new o_(Oy.NETWORK_TIMEOUT,e.message)):e.response?a(new o_(Oy.NETWORK_RESPONSE_ERROR,e.response.status)):a(new o_(Oy.NETWORK_ERROR,e.message))}))}))}function Vw(e,t){return Bw.apply(this,arguments)}function Bw(){return Bw=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Blob([n.data],{type:"buffer"}),e.next=3,Fw(t,jw(jw({},n),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),Bw.apply(this,arguments)}var Gw,Zw=function(){return"HTTPS"===(Lw||Lw||(Lw=(window.location.protocol.split(":")[0]||"").toUpperCase()))},qw=function(){return void 0!==window.isSecureContext};function Ww(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ww(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ww(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P"}(Gw||(Gw={}));var Kw=function(){function e(t,n,r,i){l(this,e),kf(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}return d(e,[{key:"dispatch",value:function(e){this.state=function(e,t){switch(t.type){case Gw.SET_SESSION_ID:return Hw(Hw({},e),{},{sessionId:t.sessionId});case Gw.SET_P2P_ID:return Hw(Hw({},e),{},{p2pId:t.p2pId});case Gw.SET_UID:return Hw(Hw({},e),{},{uid:t.uid});case Gw.SET_PUB_ID:return Hw(Hw({},e),{},{pubId:t.pubId});case Gw.KEY_METRIC_CLIENT_CREATED:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{clientCreated:t.metric})});case Gw.KEY_METRIC_JOIN_START:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{joinStart:t.metric})});case Gw.AVOID_JOIN_START:return Hw(Hw({},e),{},{avoidJoinStart:t.avoidJoinStart});case Gw.KEY_METRIC_JOIN_END:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{joinEnd:t.metric})});case Gw.KEY_METRIC_REQUEST_AP_START:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{requestAPStart:t.metric})});case Gw.KEY_METRIC_REQUEST_AP_END:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{requestAPEnd:t.metric})});case Gw.KEY_METRIC_JOIN_GATEWAY_START:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case Gw.KEY_METRIC_JOIN_GATEWAY_END:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case Gw.KEY_METRIC_PEER_CONNECTION_START:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case Gw.KEY_METRIC_PEER_CONNECTION_END:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case Gw.KEY_METRIC_DESCRIPTION_START:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{descriptionStart:t.metric})});case Gw.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case Gw.KEY_METRIC_ICE_CONNECTION_END:return Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case Gw.KEY_METRIC_PUBLISH:var n=e.keyMetrics.publish,r=n.findIndex((function(e){return e.trackId===t.metric.trackId}));return-1!==r?(n[r]=Hw(Hw({},n[r]),t.metric),Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{publish:m(n)})})):Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{publish:[].concat(m(e.keyMetrics.publish),[t.metric])})});case Gw.KEY_METRIC_SUBSCRIBE:var i=e.keyMetrics.subscribe,a=i.findIndex((function(e){return e.userId===t.metric.userId&&e.type===t.metric.type}));return-1!==a?(i[a]=Hw(Hw({},i[a]),t.metric),Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{subscribe:m(i)})})):Hw(Hw({},e),{},{keyMetrics:Hw(Hw({},e.keyMetrics),{},{subscribe:[].concat(m(e.keyMetrics.subscribe),[t.metric])})});case Gw.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case Gw.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[].concat(m(e.joinChannelServiceRecords),[t.record]):(e.joinChannelServiceRecords[t.index]=Hw(Hw({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=m(e.joinChannelServiceRecords)),e;case Gw.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case Gw.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case Gw.SET_USE_DATACHANNEL:return Hw(Hw({},e),{},{useDataChannel:t.val});case Gw.SET_USE_P2P:return Hw(Hw({},e),{},{useP2P:t.val});default:return e}}(this.state,e)}},{key:"sessionId",get:function(){return this.state.sessionId},set:function(e){this.dispatch({type:Gw.SET_SESSION_ID,sessionId:e})}},{key:"codec",get:function(){return this.state.codec}},{key:"audioCodec",get:function(){return this.state.audioCodec}},{key:"clientId",get:function(){return this.state.clientId}},{key:"p2pId",get:function(){return this.state.p2pId},set:function(e){this.dispatch({type:Gw.SET_P2P_ID,p2pId:e})}},{key:"dcId",get:function(){return this.state.dcId},set:function(e){this.dispatch({type:Gw.SET_DC_ID,dcId:e})}},{key:"uid",get:function(){return this.state.uid},set:function(e){this.dispatch({type:Gw.SET_UID,uid:e})}},{key:"pubId",get:function(){return this.state.pubId},set:function(e){this.dispatch({type:Gw.SET_PUB_ID,pubId:e})}},{key:"cloudProxyServerMode",get:function(){return this.state.cloudProxyServerMode},set:function(e){this.dispatch({type:Gw.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}},{key:"useDataChannel",get:function(){return this.state.useDataChannel},set:function(e){this.dispatch({type:Gw.SET_USE_DATACHANNEL,val:e})}},{key:"useP2P",get:function(){return this.state.useP2P},set:function(e){this.dispatch({type:Gw.SET_USE_P2P,val:e})}},{key:"clientCreated",value:function(){this.dispatch({type:Gw.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}},{key:"joinStart",value:function(){this.dispatch({type:Gw.KEY_METRIC_JOIN_START,metric:Date.now()})}},{key:"joinEnd",value:function(){this.dispatch({type:Gw.KEY_METRIC_JOIN_END,metric:Date.now()})}},{key:"requestAPStart",value:function(){this.dispatch({type:Gw.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}},{key:"requestAPEnd",value:function(){this.dispatch({type:Gw.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}},{key:"joinGatewayStart",value:function(){this.dispatch({type:Gw.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}},{key:"joinGatewayEnd",value:function(){this.dispatch({type:Gw.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}},{key:"peerConnectionStart",value:function(){this.dispatch({type:Gw.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}},{key:"peerConnectionEnd",value:function(){this.dispatch({type:Gw.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}},{key:"descriptionStart",value:function(){this.dispatch({type:Gw.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}},{key:"signalChannelOpen",value:function(){this.dispatch({type:Gw.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}},{key:"iceConnectionEnd",value:function(){this.dispatch({type:Gw.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}},{key:"publish",value:function(e,t,n,r){this.dispatch({type:Gw.KEY_METRIC_PUBLISH,metric:Hw(Hw({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}},{key:"subscribe",value:function(e,t,n,r,i,a,o){this.dispatch({type:Gw.KEY_METRIC_SUBSCRIBE,metric:Hw(Hw(Hw(Hw(Hw({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),a&&{streamAdded:a}),o&&{firstDecoded:o})})}},{key:"massSubscribe",value:function(e,t,n,r){var i=this;e.forEach((function(e){i.dispatch({type:Gw.KEY_METRIC_SUBSCRIBE,metric:Hw(Hw(Hw({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}},{key:"keyMetrics",get:function(){return this.state.keyMetrics}},{key:"recordJoinChannelService",value:function(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((function(e){return e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")})));try{return"number"!=typeof t?(this.dispatch({type:Gw.RECORD_JOIN_CHANNEL_SERVICE,record:Hw(Hw({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Gw.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}},{key:"resetJoinChannelServiceRecords",value:function(){this.dispatch({type:Gw.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}},{key:"resetKeyMetrics",value:function(){this.dispatch({type:Gw.RESET_KEY_METRICS})}},{key:"joinChannelServiceRecords",get:function(){try{return this.state.joinChannelServiceRecords}catch(b){return[]}}},{key:"avoidJoinStart",get:function(){return this.state.avoidJoinStart},set:function(e){this.dispatch({type:Gw.AVOID_JOIN_START,avoidJoinStart:e})}}]),e}(),zw=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var n=t[1],r=t[2];return"".concat(n,".").concat(r)}var i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){var a=i[1],o=i[2];return"".concat(a,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.19.1"),Yw=function(){try{return!0===JSON.parse("true")}catch(b){return!0}}(),Jw="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",Xw={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function Qw(e,t,n){var r,i;$i(r=Object.keys(Xw)).call(r,e)&&(!n&&$i(i=Object.keys(eS)).call(i,e)||(Xw[e]=t))}function $w(e){return Xw[e]}var eS={},tS=new(function(e){p(n,e);var t=h(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"reportLogUploadError",value:function(e){this.emit("REPORT_LOG_UPLOAD",e)}}]),n}(O_)),nS=function(){function e(t){l(this,e),kf(this,"logger",void 0),kf(this,"prefixLists",[]),this.logger=t}return d(e,[{key:"debug",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).debug.apply(e,m(this.prefixLists).concat(n))}},{key:"info",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).info.apply(e,m(this.prefixLists).concat(n))}},{key:"warning",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).warning.apply(e,m(this.prefixLists).concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.logger).error.apply(e,m(this.prefixLists).concat(n))}},{key:"prefix",value:function(e){return this.prefixLists.push(e),this}},{key:"popPrefix",value:function(){return this.prefixLists.pop(),this}}]),e}();function rS(){var e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function iS(){var e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var aS,oS,sS={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},cS=Date.now(),uS=function(e){for(var t in sS)if(Object.prototype.hasOwnProperty.call(sS,t)&&sS[t]===e)return t;return"DEFAULT"},lS=new(function(){function e(){var t=this;l(this,e),kf(this,"proxyServerURL",void 0),kf(this,"logLevel",sS.DEBUG),kf(this,"uploadState","collecting"),kf(this,"uploadLogWaitingList",[]),kf(this,"uploadLogUploadingList",[]),kf(this,"uploadErrorCount",0),kf(this,"currentLogID",0),kf(this,"url",void 0),kf(this,"extLog",(function(e,n){t.appendLogToWaitingList.apply(t,[e].concat(m(n)))}))}return d(e,[{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[sS.DEBUG].concat(t);this.log.apply(this,r)}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[sS.INFO].concat(t);this.log.apply(this,r)}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[sS.WARNING].concat(t);this.log.apply(this,r)}},{key:"warn",value:function(){this.warning.apply(this,arguments)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[sS.ERROR].concat(t);this.log.apply(this,r)}},{key:"upload",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[sS.DEBUG].concat(t);this.uploadLog.apply(this,r)}},{key:"setLogLevel",value:function(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}},{key:"enableLogUpload",value:function(){Qw("UPLOAD_LOG",!0)}},{key:"disableLogUpload",value:function(){Qw("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}},{key:"setProxyServer",value:function(e){this.proxyServerURL=e}},{key:"prefix",value:function(e){return new nS(this).prefix(e)}},{key:"log",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-cS<100)setTimeout((function(){e.log.apply(e,n)}),Date.now()-cS);else{var i=Math.max(0,Math.min(4,n[0]));if(n[0]=rS()+" Agora-SDK [".concat(uS(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n)),!(i<this.logLevel)){var a=rS()+" %cAgora-SDK [".concat(uS(i),"]:"),o=[];if(!$w("USE_NEW_LOG"))switch(i){case sS.DEBUG:o=[a,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,o);break;case sS.INFO:o=[a,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,o);break;case sS.WARNING:o=[a,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,o);break;case sS.ERROR:o=[a,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,o)}}}}},{key:"uploadLog",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(Date.now()-cS<100)setTimeout((function(){e.uploadLog.apply(e,n)}),Date.now()-cS);else{var i=Math.max(0,Math.min(4,n[0]));n[0]=rS()+" Agora-SDK [".concat(uS(i),"]:"),this.appendLogToWaitingList.apply(this,[i].concat(n))}}},{key:"appendLogToWaitingList",value:function(e){if($w("UPLOAD_LOG")){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=iS()+" Agora-SDK [".concat(uS(e),"]:"):n[0]=iS()+" Agora-SDK [".concat(uS(e),"]:");var i="";n.forEach((function(e){"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}}},{key:"startUpload",value:function(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}},{key:"uploadLogs",value:function(){var e=c(s().mark((function e(){var t,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.uploadLogUploadingList,n={sdk_version:zw,process_id:$w("PROCESS_ID"),payload:JSON.stringify(t)},e.abrupt("return",mE(c(s().mark((function e(){var t,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mw.post(r.url||(r.proxyServerURL?"https://".concat(r.proxyServerURL,"/ls/?h=").concat($w("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($w("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});case 2:if("OK"===(t=e.sent).data){e.next=6;break}throw(i=new Error("unexpected upload log response")).response=t,i;case 6:case"end":return e.stop()}}),e)}))),(function(){return r.uploadLogUploadingList=[],!1}),(function(e){return e.response?tS.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?tS.reportLogUploadError({status:e.request.status,message:e.message}):tS.reportLogUploadError({status:-1,message:e.message}),!0}),{timeout:$w("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$w("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")}));case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"uploadLogInterval",value:function(){var e=this;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$w("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((function(){e.uploadErrorCount=0,e.uploadLogWaitingList.length>0&&window.setTimeout((function(){return e.uploadLogInterval()}),$w("UPLOAD_LOG_INTERVAL"))})).catch((function(t){e.uploadErrorCount+=1,e.uploadErrorCount<2?window.setTimeout((function(){return e.uploadLogInterval()}),$w("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((function(){return e.uploadLogInterval()}),$w("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}}]),e}());function dS(e){return d_(e.reportId,"params.reportId",0,100,!1),d_(e.category,"params.category",0,100,!1),d_(e.event,"params.event",0,100,!1),d_(e.label,"params.label",0,100,!1),u_(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}!function(e){e.FREE="free",e.UPLOADING="uploading"}(aS||(aS={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(oS||(oS={}));var fS,pS,hS,vS,mS={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};function gS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gS(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"}(fS||(fS={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(pS||(pS={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(hS||(hS={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(vS||(vS={}));var _S=function(){function e(){var t=this;l(this,e),kf(this,"baseInfoMap",new Map),kf(this,"proxyServer",void 0),kf(this,"eventUploadTimer",void 0),kf(this,"setSessionIdTimer",void 0),kf(this,"url",void 0),kf(this,"backupUrl",void 0),kf(this,"_appId",void 0),kf(this,"keyEventUploadPendingItems",[]),kf(this,"normalEventUploadPendingItems",[]),kf(this,"apiInvokeUploadPendingItems",[]),kf(this,"apiInvokeCount",0),kf(this,"ltsList",[]),kf(this,"lastSendNormalEventTime",Date.now()),kf(this,"customReportCounterTimer",void 0),kf(this,"customReportCount",0),kf(this,"extApiInvoke",function(){var e=c(s().mark((function e(n){var r,i,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o(n);try{for(r.s();!(i=r.n()).done;)a=i.value,c=yS(yS({},a),{},{sid:null,invokeId:++t.apiInvokeCount,tag:E_.TRACER}),t.sendApiInvoke(c)}catch(s){r.e(s)}finally{r.f()}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$w("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$w("EVENT_REPORT_SEND_INTERVAL"))}return d(e,[{key:"getBaseInfoBySessionId",value:function(e){return this.baseInfoMap.get(e)}},{key:"adjustSessionStartTime",value:function(e){if(this.baseInfoMap.has(e)||this.baseInfoMap.get(e)){var t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,lS.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}else lS.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"))}},{key:"setAppId",value:function(e){this._appId=e}},{key:"reportApiInvoke",value:function(e,t,n){var r=this;t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;var i=Date.now();this.apiInvokeCount+=1;var a=this.apiInvokeCount,o=function(){return{tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}},s=!!$w("SHOW_REPORT_INVOKER_LOG");s&&lS.info("".concat(t.name," start"),t.options);var c=!1;nE(t.timeout).then((function(){c||(r.sendApiInvoke(yS(yS({},o()),{},{error:Oy.API_INVOKE_TIMEOUT,success:!1})),lS.debug("".concat(t.name," timeout")))}));var u=new o_(Oy.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:function(e){var i=function(){if(c)throw u;return c=!0,r.sendApiInvoke(yS(yS({},o()),{},{success:!0},t.reportResult&&{result:e})),s&&lS.info("".concat(t.name," onSuccess")),e};return n?sE(i,t.name+"Success",n,(function(){return c=!0})):i()},onError:function(e){var i=function(){if(c)throw e;c=!0,r.sendApiInvoke(yS(yS({},o()),{},{success:!1,error:e})),s&&lS.info("".concat(t.name," onFailure"),e.toString())};return n?sE(i,t.name+"Error",n,(function(){return c=!0})):i()}}}},{key:"sessionInit",value:function(e,t){if(!this.baseInfoMap.has(e)){var n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;var i=Object.assign({},{willUploadConsoleLog:$w("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Yw?"global":"oversea",areas:$w("AREAS")&&$w("AREAS").join(",")},t.extend),a=Date.now(),o=yS(yS({},r),{},{eventType:fS.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Jw,lts:a,elapse:a-n,extend:JSON.stringify(i),mode:t.mode,process:$w("PROCESS_ID"),appType:$w("APP_TYPE"),success:!0,version:zw});this.send({type:pS.SESSION,data:o},!0)}}},{key:"joinChooseServer",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.JOIN_CHOOSE_SERVER,lts:i,eventElapse:i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:pS.JOIN_CHOOSE_SERVER,data:a},!0)}}},{key:"reqUserAccount",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:pS.REQ_USER_ACCOUNT,data:a},!0)}}},{key:"joinGateway",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;var i=Date.now(),a=t.firstSuccess,o=t.avoidJoinStartTime,s=t.isProxy,c=t.addr,u=i-(a&&o?o:n.startTime),l=yS(yS({},r),{},{eventType:fS.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:u,eventElapse:i-t.lts,firstSuccess:a,signalChannel:t.signalChannel}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),a)this.send({type:pS.JOIN_GATEWAY,data:l},!0);else{var f;if(c)if(s){var p=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),h=c.match(/p=[0-9]{1,6}/g);f={isSuccess:d,gatewayIp:p&&p.length?p[0].split("=")[1].replace(/-/g,"."):"",port:h&&h.length?h[0].split("=")[1]:"",isProxy:s?1:0}}else{var v=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),m=c.match(/(:|p=)[0-9]{1,6}/g);f={isSuccess:d,gatewayIp:v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",port:m&&m.length?m[0].split(/:|p=/g)[1]:"",isProxy:s?1:0}}else f={isSuccess:d,gatewayIp:"",port:"",isProxy:s?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);var g=Object.assign({},l,f,{eventType:fS.REJOIN_GATEWAY});this.send({type:pS.RE_JOIN_GATEWAY,data:g},!0)}}}},{key:"joinChannelTimeout",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=Date.now(),i=yS(yS({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:pS.JOIN_CHANNEL_TIMEOUT,data:i},!0)}}},{key:"publish",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:pS.PUBLISH,data:a},!0)}}},{key:"subscribe",value:function(e,t,n){var r=this.baseInfoMap.get(e);if(r){var i=r.info,a=Date.now(),o=yS(yS({},i),{},{eventType:fS.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:pS.SUBSCRIBE,data:o},!0)}}},{key:"wsCompressorInit",value:function(e){var t,n=m(xf(t=this.baseInfoMap).call(t)),r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(i){var a=i.info,o=Date.now(),s=yS(yS({},a),{},{eventType:fS.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:pS.WS_COMPRESSOR_INIT,data:s},!0)}}},{key:"firstRemoteVideoDecode",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=yS(yS(yS({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max(o-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}}},{key:"firstRemoteFrame",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=yS(yS(yS({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:s},!0)}}},{key:"pcStats",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS(yS({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:fS.PC_STATS,lts:i});this.send({type:pS.PC_STATS,data:a},!0)}}},{key:"onGatewayStream",value:function(e,t,n,r){var i=this.baseInfoMap.get(e);if(i){var a=i.info,o=Date.now(),s=yS(yS(yS({},a),r),{},{eventType:t,lts:o});this.send({type:n,data:s},!0)}}},{key:"streamSwitch",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:pS.STREAM_SWITCH,data:a},!0)}}},{key:"requestProxyAppCenter",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pS.REQUEST_PROXY_APPCENTER,data:a},!0)}}},{key:"requestProxyWorkerManager",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{eventType:fS.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pS.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}}},{key:"setProxyServer",value:function(e){this.proxyServer=e,e?lS.debug("reportProxyServerurl: ".concat(e)):lS.debug("disable reportProxyServerurl: ".concat(e))}},{key:"peerPublishStatus",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:pS.PEER_PUBLISH_STATUS,data:a},!0)}}},{key:"workerEvent",value:function(e,t){var n=this,r=this.baseInfoMap.get(e);if(r){var i=r.info,a=Date.now(),o=function(e,t,n){var r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";for(var i=$_(JSON.stringify(e)),a=0,o=[],s=0,c=0;c<r.length;c++)(s+=r.charCodeAt(c)<=127?1:3)<=n-i||(o[o.length]=Z_(Z_({},e),{},g({},t,r.substring(a,c))),a=c,s=r.charCodeAt(c)<=127?1:3);return a!==r.length-1&&(o[o.length]=Z_(Z_({},e),{},g({},t,r.substring(a)))),o}(yS(yS(yS({},i),t),{},{elapse:a-r.startTime,lts:a,productType:"WebRTC"}),"payload",1300);o.forEach((function(e){return n.send({type:pS.WORKER_EVENT,data:e},!0)}))}}},{key:"apworkerEvent",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS(yS({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:pS.AP_WORKER_EVENT,data:a},!0)}}},{key:"joinWebProxyAP",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS(yS({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:pS.JOIN_WEB_PROXY_AP,data:a},!0)}}},{key:"WebSocketQuit",value:function(e,t){var n=this.baseInfoMap.get(e);if(n){var r=n.info,i=Date.now(),a=yS(yS(yS({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:pS.WEBSOCKET_QUIT,data:a},!0)}}},{key:"sendCustomReportMessage",value:function(){var e=c(s().mark((function e(t,n){var r,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.customReportCount+=n.length,!(this.customReportCount>$w("CUSTOM_REPORT_LIMIT"))){e.next=2;break}throw new o_(Oy.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);case 2:if(this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((function(){a.customReportCount=0}),5e3)),r=Date.now(),i=n.map((function(e){return{type:pS.USER_ANALYTICS,data:yS(yS({sid:t},e),{},{lts:r})}})),e.prev=4,!$w("NEW_REPORT_SERVER")){e.next=10;break}return e.next=8,this.postDataToStatsCollector2(i);case 8:e.next=12;break;case 10:return e.next=12,this.postDataToStatsCollector(i);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(4),lS.error("send custom report message failed",e.t0.toString()),new o_(Oy.CUSTOM_REPORT_SEND_FAILED,e.t0.message);case 17:case"end":return e.stop()}}),e,this,[[4,14]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"sendApiInvoke",value:function(e){var t=$w("NOT_REPORT_EVENT");if(e.tag&&$i(t)&&$i(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;var n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;var r,i=n.info,a=i.cname,o=i.uid,s=i.cid;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof o_){var c=e.error,u=c.code,l=c.message;r=u||l||e.error.toString()}else r=e.error.toString();var d={invokeId:e.invokeId,sid:e.sid,cname:a,cid:s,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?r:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:pS.API_INVOKE,data:d},!1),!0}},{key:"appendSessionId",value:function(){var t=this;e.__CLIENT_LIST__.forEach((function(e){if(e._sessionId)for(var n=t.apiInvokeUploadPendingItems.length,r=0;r<n;r++){var i=t.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,t.sendApiInvoke(Object.assign({},i)))}}))}},{key:"send",value:function(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>$w("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}},{key:"doSend",value:function(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}},{key:"sendItems",value:function(e,t){for(var n=this,r=[],i=[];e.length;){var a=e.shift();r.length<20?r.push(a):i.push(a)}e.push.apply(e,i);for(var o=0,s=[].concat(r);o<s.length;o++){var c,u=s[o];-1!==this.ltsList.indexOf(u.data.lts)?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),_p(c=this.ltsList).call(c,(function(e,t){return e-t})))}return t||(this.lastSendNormalEventTime=Date.now()),$w("ENABLE_EVENT_REPORT")?(r.length&&($w("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch(function(e){return function(r){$w("EVENT_REPORT_RETRY")&&(t?n.keyEventUploadPendingItems=n.keyEventUploadPendingItems.concat(e):(n.normalEventUploadPendingItems=n.normalEventUploadPendingItems.concat(e),n.normalEventUploadPendingItems.length>$w("NORMAL_EVENT_QUEUE_CAPACITY")&&(n.normalEventUploadPendingItems.splice(0,n.normalEventUploadPendingItems.length-$w("NORMAL_EVENT_QUEUE_CAPACITY")),lS.warning("report: drop normal events"))))}}(r)),e):e}},{key:"postDataToStatsCollector2",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=B_.networkState===T_.OFFLINE,!e.t0){e.next=4;break}return e.next=4,by.race([B_.onlineWaiter,nE(2*hE.maxRetryTimeout)]);case 4:n=function(e){var t=new Uint8Array;return e.forEach((function(e){var n=y_(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=function(e){var t=0;return Object.entries(pS).forEach((function(n){var r=u(n,2),i=r[0];r[1]===e.type&&(t=EventNameToID[i])})),t}(e),a=new DataView(r);a.setUint16(0,n.byteLength,!0),a.setUint8(2,255&i),a.setUint8(3,i>>>8&255),a.setUint8(4,i>>>16&255),t=C_(t,new Uint8Array(r)),t=C_(t,n)})),t},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($w("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat($w("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r),a=0;case 7:if(!(a<2)){e.next=23;break}return 1===a&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($w("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat($w("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r)),e.prev=9,e.next=12,Fw(i,{timeout:1e4,data:n(t),headers:yS(yS({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0);case 12:e.next=19;break;case 14:if(e.prev=14,e.t1=e.catch(9),1!==a){e.next=18;break}throw e.t1;case 18:return e.abrupt("continue",20);case 19:return e.abrupt("return");case 20:a+=1,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"postDataToStatsCollector",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c=this,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]&&u[1],r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((function(e){return JSON.stringify(e)})),vid:function(e){var t=e&&e.data.sid&&c.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0}(t[0])},e.t0=B_.networkState===T_.OFFLINE,!e.t0){e.next=6;break}return e.next=6,by.race([B_.onlineWaiter,nE(2*hE.maxRetryTimeout)]);case 6:i=n?"/events/proto-raws":"/events/messages",a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($w("EVENT_REPORT_DOMAIN"),"&p=").concat($w("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat($w("EVENT_REPORT_DOMAIN"),":").concat($w("STATS_COLLECTOR_PORT")).concat(i)),o=0;case 9:if(!(o<2)){e.next=30;break}if(1===o&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($w("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($w("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat($w("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($w("STATS_COLLECTOR_PORT")).concat(i))),e.prev=11,!n){e.next=17;break}return e.next=15,Vw(a,{timeout:1e4,data:r});case 15:e.next=19;break;case 17:return e.next=19,Fw(a,{timeout:1e4,data:r});case 19:e.next=26;break;case 21:if(e.prev=21,e.t1=e.catch(11),1!==o){e.next=25;break}throw e.t1;case 25:return e.abrupt("continue",27);case 26:return e.abrupt("return");case 27:o+=1,e.next=9;break;case 30:case"end":return e.stop()}}),e,this,[[11,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createBaseInfo",value:function(e,t){var n=Object.assign({},mS);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}},{key:"reportResourceTiming",value:function(e,t){var n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:E_.TRACER}).onSuccess()}}]),e}();function ES(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){var i=r.value;if("function"==typeof i){var a=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];var s=r;if(e.argsMap)try{s=e.argsMap.apply(e,[this].concat(r))}catch(e){lS.warning(e),s=[]}try{JSON.stringify(s)}catch(e){lS.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),s=[]}var c=(e.report||bS).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:s,tag:E_.TRACER,reportResult:e.reportResult},e.throttleTime);try{var u=i.apply(this,r);return u instanceof by?u.then((function(t){return c.onSuccess(e.reportResult&&t),t})).catch((function(e){throw c.onError(e),e})):(c.onSuccess(e.reportResult&&u),u)}catch(e){throw c.onError(e),e}}}return r}}kf(_S,"__CLIENT_LIST__",[]);var bS=new _S;tS.on("REPORT_LOG_UPLOAD",(function(e){e.networkState=B_.networkState,bS.reportApiInvoke(null,{name:"logUploadError",options:e,tag:E_.TRACER})}));var wS=["CHINA","GLOBAL"],SS=function(){var e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");for(var r=n.join(""),i=[],a=0;a<6;a++)i.push("1");var o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=SS,Yw||(Xw.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Xw.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Xw.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Xw.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Xw.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Xw.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Xw.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Xw.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Xw.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Xw.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Xw.AREAS=["NORTH_AMERICA","OVERSEA"]);var kS=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],TS=[];function IS(e,t){return!!t&&TS.some((function(n){return n.uid===e&&n.channelName===t}))}_S.__CLIENT_LIST__=TS;var CS,RS,AS,OS,NS,xS,DS,PS,LS,MS,US,jS,FS,VS,BS,GS,ZS,qS=bi("Array").values,WS=Mi,HS=Tn,KS=Me,zS=qS,YS=Array.prototype,JS={DOMTokenList:!0,NodeList:!0},XS=ve((function(e){var t=e.values;return e===YS||KS(YS,e)&&t===YS.values||HS(JS,WS(e))?zS:t}));function QS(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function $S(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}!function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"}(CS||(CS={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(RS||(RS={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(AS||(AS={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(OS||(OS={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(NS||(NS={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(xS||(xS={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(DS||(DS={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(PS||(PS={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_START="p2p_start",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(LS||(LS={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag"}(MS||(MS={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(US||(US={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(jS||(jS={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(FS||(FS={})),function(e){e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY"}(VS||(VS={})),function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(BS||(BS={}));var ek=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),kf(f(r),"name","AgoraRTCException"),r}return d(n,[{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return i(a(n.prototype),"print",this).call(this,e,lS)}},{key:"throw",value:function(){i(a(n.prototype),"throw",this).call(this,lS)}}]),n}(o_);function tk(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw lS.error("Invalid Channel Name ".concat(e)),new ek(Oy.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nk(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||h_(e,1,255)))throw new ek(Oy.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&lS.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}!function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(GS||(GS={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(ZS||(ZS={}));var rk={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},ik={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ak(e,t){d_(e.url,"".concat(t,".url"),1,1e3,!1),p_(e.x)||u_(e.x,"".concat(t,".x"),0,1e4),p_(e.y)||u_(e.y,"".concat(t,".y"),0,1e4),p_(e.width)||u_(e.width,"".concat(t,".width"),0,1e4),p_(e.height)||u_(e.height,"".concat(t,".height"),0,1e4),p_(e.zOrder)||u_(e.zOrder,"".concat(t,".zOrder"),0,255),p_(e.alpha)||u_(e.alpha,"".concat(t,".alpha"),0,1,!1)}var ok,sk,ck,uk,lk,dk,fk,pk,hk,vk,mk,gk,yk,_k,Ek={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},bk={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};function wk(e){if(!e.channelName)throw new ek(Oy.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new ek(Oy.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&d_(e.token,"info.token",1,2047),nk(e.uid),tk(e.channelName),!0}!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(ok||(ok={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(sk||(sk={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(ck||(ck={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(uk||(uk={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(lk||(lk={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(dk||(dk={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(fk||(fk={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(pk||(pk={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(hk||(hk={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(vk||(vk={})),function(e){e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON"}(mk||(mk={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7"}(gk||(gk={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(yk||(yk={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(_k||(_k={}));var Sk,kk=[_k.AFRICA,_k.ASIA,_k.CHINA,_k.EUROPE,_k.GLOBAL,_k.INDIA,_k.JAPAN,_k.NORTH_AMERICA,_k.OCEANIA,_k.OVERSEA,_k.SOUTH_AMERICA];!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"}(Sk||(Sk={}));var Tk,Ik,Ck,Rk,Ak,Ok,Nk,xk,Dk,Pk,Lk,Mk,Uk,jk,Fk,Vk,Bk,Gk,Zk,qk,Wk,Hk,Kk={CHINA:{},ASIA:{CODE:Sk.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Sk.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Sk.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Sk.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Sk.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Sk.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Sk.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Sk.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Sk.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Sk.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Sk.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Sk.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Sk.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Yw&&(Kk.CHINA={CODE:Sk.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Tk||(Tk={}));var zk=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"onICEConnectionStateChange",void 0),kf(f(i),"onConnectionStateChange",void 0),kf(f(i),"onDTLSTransportStateChange",void 0),kf(f(i),"onDTLSTransportError",void 0),kf(f(i),"onICETransportStateChange",void 0),kf(f(i),"onFirstAudioReceived",void 0),kf(f(i),"onFirstVideoReceived",void 0),kf(f(i),"onFirstAudioDecoded",void 0),kf(f(i),"onFirstVideoDecoded",void 0),kf(f(i),"onFirstVideoDecodedTimeout",void 0),kf(f(i),"onSelectedLocalCandidateChanged",void 0),kf(f(i),"onSelectedRemoteCandidateChanged",void 0),i}return d(n)}(O_),Yk=function(e){p(n,e);var t=h(n);function n(e,r){return l(this,n),t.call(this,e,r)}return d(n)}(zk);!function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"}(Ik||(Ik={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(Ck||(Ck={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(Rk||(Rk={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Ak||(Ak={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(Ok||(Ok={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Nk||(Nk={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PPublish="RequestP2PPublish",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE"}(xk||(xk={})),function(e){e.MUTE_LOCAL_VIDEO="mute_local_video",e.MUTE_LOCAL_AUDIO="mute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.MUTE_REMOTE_VIDEO="mute_remote_video",e.MUTE_REMOTE_AUDIO="mute_remote_audio",e.UNMUTE_REMOTE_VIDEO="unmute_remote_video",e.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(Dk||(Dk={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Pk||(Pk={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Lk||(Lk={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Mk||(Mk={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Uk||(Uk={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(jk||(jk={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Fk||(Fk={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(Vk||(Vk={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Bk||(Bk={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Gk||(Gk={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Zk||(Zk={})),function(e){e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.JOIN="join",e.EXCHANGE_SDP="exchange_sdp",e.DO_SUBSCRIBE="do_subscribe",e.DO_UNSUBSCRIBE="do_unsubscribe"}(qk||(qk={})),function(e){e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Wk||(Wk={})),function(e){e[e.SUCCESS=1]="SUCCESS",e[e.FAILED=0]="FAILED"}(Hk||(Hk={}));var Jk=(g(_={},AS.ACCESS_POINT,(g(e={},xS.NO_FLAG_SET,{desc:"flag is zero",retry:!1}),g(e,xS.FLAG_SET_BUT_EMPTY,{desc:"flag is empty",retry:!1}),g(e,xS.INVALID_FALG_SET,{desc:"invalid flag",retry:!1}),g(e,xS.FLAG_SET_BUT_NO_RE,{desc:"flag set unilbs but no request",retry:!1}),g(e,xS.INVALID_SERVICE_ID,{desc:"invalid service id",retry:!1}),g(e,xS.NO_SERVICE_AVAILABLE,{desc:"no service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_P2P,{desc:"no unilbs p2p service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_VOICE,{desc:"no unilbs voice service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_WEBRTC,{desc:"no unilbs webrtc service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_CDS,{desc:"no cds service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_CDN,{desc:"no cdn dispatcher service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_TDS,{desc:"no tds service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_REPORT,{desc:"no unilbs report service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_APP_CENTER,{desc:"no app center service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_ENV0,{desc:"no unilbs sig env0 service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_VOET,{desc:"no unilbs voet service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_STRING_UID,{desc:"no string uid service available",retry:!0}),g(e,xS.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS,{desc:"no webrtc unilbs service available",retry:!0}),e)),g(_,AS.UNILBS,(g(t={},NS.INVALID_VENDOR_KEY,{desc:"invalid vendor key, can not find appid",retry:!1}),g(t,NS.INVALID_CHANNEL_NAME,{desc:"invalid channel name",retry:!1}),g(t,NS.INTERNAL_ERROR,{desc:"unilbs internal error",retry:!1}),g(t,NS.NO_AUTHORIZED,{desc:"invalid token, authorized failed",retry:!1}),g(t,NS.DYNAMIC_KEY_TIMEOUT,{desc:"dynamic key or token timeout",retry:!1}),g(t,NS.NO_ACTIVE_STATUS,{desc:"no active status",retry:!1}),g(t,NS.DYNAMIC_KEY_EXPIRED,{desc:"dynamic key expired",retry:!1}),g(t,NS.STATIC_USE_DYNAMIC_KEY,{desc:"static use dynamic key",retry:!1}),g(t,NS.DYNAMIC_USE_STATIC_KEY,{desc:"dynamic use static key",retry:!1}),g(t,NS.USER_OVERLOAD,{desc:"amount of users over load",retry:!1}),g(t,NS.FORBIDDEN_REGION,{desc:"the request is forbidden in this area",retry:!1}),g(t,NS.CANNOT_MEET_AREA_DEMAND,{desc:"unable to allocate services in this area",retry:!1}),t)),g(_,AS.STRING_UID_ALLOCATOR,(g(y={},OS.IIIEGAL_APPID,{desc:"invalid appid",retry:!1}),g(y,OS.IIIEGAL_UID,{desc:"invalid string uid",retry:!1}),g(y,OS.INTERNAL_ERROR,{desc:"string uid allocator internal error",retry:!0}),y)),_);function Xk(e){var t=Jk[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};var n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===AS.ACCESS_POINT){var r=e%1e4;if("1"===r.toString()[0])return{desc:e.toString(),retry:!1};if("2"===r.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}var Qk=(g(E={},DS.K_TIMESTAMP_EXPIRED,{desc:"K_TIMESTAMP_EXPIRED",action:"failed"}),g(E,DS.K_CHANNEL_PERMISSION_INVALID,{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"}),g(E,DS.K_CERTIFICATE_INVALID,{desc:"K_CERTIFICATE_INVALID",action:"failed"}),g(E,DS.K_CHANNEL_NAME_EMPTY,{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"}),g(E,DS.K_CHANNEL_NOT_FOUND,{desc:"K_CHANNEL_NOT_FOUND",action:"failed"}),g(E,DS.K_TICKET_INVALID,{desc:"K_TICKET_INVALID",action:"failed"}),g(E,DS.K_CHANNEL_CONFLICTED,{desc:"K_CHANNEL_CONFLICTED",action:"failed"}),g(E,DS.K_SERVICE_NOT_READY,{desc:"K_SERVICE_NOT_READY",action:"tryNext"}),g(E,DS.K_SERVICE_TOO_HEAVY,{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"}),g(E,DS.K_UID_BANNED,{desc:"K_UID_BANNED",action:"failed"}),g(E,DS.K_IP_BANNED,{desc:"K_IP_BANNED",action:"failed"}),g(E,DS.K_AUTO_REBALANCE,{desc:"k_AUTO_REBALANCE",action:"recover"}),g(E,DS.ERR_INVALID_VENDOR_KEY,{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"}),g(E,DS.ERR_INVALID_CHANNEL_NAME,{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"}),g(E,DS.WARN_NO_AVAILABLE_CHANNEL,{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"}),g(E,DS.WARN_LOOKUP_CHANNEL_TIMEOUT,{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"}),g(E,DS.WARN_LOOKUP_CHANNEL_REJECTED,{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"}),g(E,DS.WARN_OPEN_CHANNEL_TIMEOUT,{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"}),g(E,DS.WARN_OPEN_CHANNEL_REJECTED,{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"}),g(E,DS.WARN_REQUEST_DEFERRED,{desc:"WARN_REQUEST_DEFERRED",action:"failed"}),g(E,DS.ERR_DYNAMIC_KEY_TIMEOUT,{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"}),g(E,DS.ERR_NO_AUTHORIZED,{desc:"ERR_NO_AUTHORIZED",action:"failed"}),g(E,DS.ERR_VOM_SERVICE_UNAVAILABLE,{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"}),g(E,DS.ERR_NO_CHANNEL_AVAILABLE_CODE,{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"}),g(E,DS.ERR_MASTER_VOCS_UNAVAILABLE,{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"}),g(E,DS.ERR_INTERNAL_ERROR,{desc:"ERR_INTERNAL_ERROR",action:"tryNext"}),g(E,DS.ERR_NO_ACTIVE_STATUS,{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"}),g(E,DS.ERR_INVALID_UID,{desc:"ERR_INVALID_UID",action:"failed"}),g(E,DS.ERR_DYNAMIC_KEY_EXPIRED,{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"}),g(E,DS.ERR_STATIC_USE_DYANMIC_KE,{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"}),g(E,DS.ERR_DYNAMIC_USE_STATIC_KE,{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"}),g(E,DS.ERR_NO_VOCS_AVAILABLE,{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"}),g(E,DS.ERR_NO_VOS_AVAILABLE,{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"}),g(E,DS.ERR_JOIN_CHANNEL_TIMEOUT,{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"}),g(E,DS.ERR_JOIN_BY_MULTI_IP,{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"}),g(E,DS.ERR_NOT_JOINED,{desc:"ERR_NOT_JOINED",action:"failed"}),g(E,DS.ERR_REPEAT_JOIN_REQUEST,{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"}),g(E,DS.ERR_REPEAT_JOIN_CHANNEL,{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"}),g(E,DS.ERR_INVALID_STRINGUID,{desc:"ERR_INVALID_STRINGUID",action:"failed"}),g(E,DS.ERR_TOO_MANY_USERS,{desc:"ERR_TOO_MANY_USERS",action:"tryNext"}),g(E,DS.ERR_SET_CLIENT_ROLE_TIMEOUT,{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"}),g(E,DS.ERR_SET_CLIENT_ROLE_NO_PERMISSION,{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"}),g(E,DS.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE,{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"}),g(E,DS.ERR_PUBLISH_REQUEST_INVALID,{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"}),g(E,DS.ERR_SUBSCRIBE_REQUEST_INVALID,{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"}),g(E,DS.ERR_NOT_SUPPORTED_MESSAGE,{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"}),g(E,DS.ERR_ILLEAGAL_PLUGIN,{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"}),g(E,DS.ILLEGAL_CLIENT_ROLE_LEVEL,{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"}),g(E,DS.ERR_REJOIN_TOKEN_INVALID,{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"}),g(E,DS.ERR_REJOIN_USER_NOT_JOINED,{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"}),g(E,DS.ERR_INVALID_OPTIONAL_INFO,{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"}),g(E,DS.ERR_TEST_RECOVER,{desc:"ERR_TEST_RECOVER",action:"recover"}),g(E,DS.ERR_TEST_TRYNEXT,{desc:"ERR_TEST_TRYNEXT",action:"recover"}),g(E,DS.ERR_TEST_RETRY,{desc:"ERR_TEST_RETRY",action:"recover"}),g(E,DS.ILLEGAL_AES_PASSWORD,{desc:"ERR_TEST_RETRY",action:"failed"}),g(E,DS.ERR_TOO_MANY_BROADCASTERS,{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"}),g(E,DS.ERR_TOO_MANY_SUBSCRIBERS,{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"}),g(E,DS.ERR_LICENSE_ILLEGAL,{desc:"ERR_LICENSE_ILLEGAL",action:"quit"}),g(E,DS.ERR_LICENSE_MISSING,{desc:"ERR_LICENSE_MISSING",action:"quit"}),g(E,DS.ERR_LICENSE_EXPIRED,{desc:"ERR_LICENSE_EXPIRED",action:"quit"}),g(E,DS.ERR_LICENSE_MINUTES_EXCEEDED,{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"}),g(E,DS.ERR_LICENSE_PERIOD_INVALID,{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"}),g(E,DS.ERR_LICENSE_MULTIPLE_SDK_SERVICE,{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}),E);function $k(e){return Qk[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function eT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eT(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nT(e){return e.every((function(e){return e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING}))}function rT(e,t){if("string"==typeof e)return e;var n=e.proxy,r=e.host,i=e.port;if(t){var a=$w("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===a?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(a,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}var iT=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,aT=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,oT=/wss:\/\/(.+):([0-9]+)\/?/,sT=/wss:\/\/(.[^\/]+)\/?/,cT=0,uT=function(){function e(t,n){l(this,e),kf(this,"id",0),kf(this,"store",void 0),kf(this,"recordIndex",void 0),kf(this,"websockets",[]),kf(this,"try443PortDuration",2e3),kf(this,"forceCloseWSDuration",5e3),kf(this,"try443PortTimeout",null),kf(this,"forceCloseTimeout",null),kf(this,"isTry443PortFailed",!1),kf(this,"isNormalPortFailed",!1),kf(this,"useDoubleDomain",!1),kf(this,"useProxy",!1),kf(this,"startTime",Date.now()),this.id=++cT,this.try443PortDuration=$w("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}return d(e,[{key:"closeAllWebsockets",value:function(){this.websockets.forEach((function(e){e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}))},{key:"logger",value:function(){for(var e,t=Date.now()-this.startTime,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];lS.debug.apply(lS,["[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:")].concat(r))}},{key:"createWebSocket",value:function(e,t,n){var r,i=this;this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});var a=$w("GATEWAY_DOMAINS"),o=Date.now(),s=[],c=a.find((function(t){var n;return $i(n=e.host).call(n,t)}));c||(this.useDoubleDomain=!1);var u=[];if(this.useDoubleDomain)a.forEach((function(n){u.push(rT(tT(tT({},e),{},{host:e.host.replace(c,n)}),t))}));else{var l=tT({},e);if(t&&c){var d=a.find((function(e){return e!==c}));d&&(l.host=l.host.replace(c,d))}u.push(rT(l,t))}try{u.forEach((function(e){var t=new WebSocket(e);t.binaryType="arraybuffer",s.push(t),i.logger("ws is connecting:",t.url)}))}catch(a){if(this.logger("ws create failed"),s.forEach((function(e){return e.close()})),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new ek(Oy.WS_ERR,"init websocket failed! Error: ".concat(a.toString()))}var f=Sy();return this.store&&this.store.recordJoinChannelService({urls:s.map((function(e){return e.url})),service:"gateway"},this.recordIndex),s.forEach((function(e){e.onopen=function(){i.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-o,"ms")),i.websockets.forEach((function(t){t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),i.logger("close backup websocket: ".concat(t.url)))})),i.websockets.length=0,f.resolve(e)},e.onclose=function(n){i.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(e.readyState)),t?i.isTry443PortFailed=nT(s):i.isNormalPortFailed=nT(s),i.logger("443: ".concat(i.useProxy?"not try":i.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(i.isNormalPortFailed?"failed":"trying")),(t&&i.isTry443PortFailed||!t&&(i.isTry443PortFailed||i.useProxy)&&i.isNormalPortFailed)&&(i.logger("onclose: all websocket is closed, ".concat(n.reason)),f.reject({code:n.code,reason:mk.A_ROUND_WS_FAILED}))},e.onmessage=function(t){return i.logger("".concat(e.url," onmessage: ").concat(t.data))}})),(r=this.websockets).push.apply(r,s),n||function(){var n=function(){i.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),i.websockets.forEach((function(e){return e.readyState!==WebSocket.OPEN&&e.close()}))};if(t||i.useProxy)return i.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),i.forceCloseTimeout=window.setTimeout(n,i.forceCloseWSDuration);i.try443PortTimeout=window.setTimeout((function(){if(i.logger("2s timeout, isWebsocket created: ",f.isResolved),f.isResolved)return n();Py().os===ky.MAC_OS&&Gy()&&n(),i.createWebSocket(e,!0,!0).then((function(e){return f.resolve(e)})).catch((function(e){i.isNormalPortFailed&&f.reject(e),i.logger("try 443 port to create ws failed")})),i.forceCloseTimeout=window.setTimeout(n,i.forceCloseWSDuration)}),i.try443PortDuration)}(),f.promise}},{key:"chooseBestWebsocket",value:function(e,t,n,r){var i=this;return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e,t,n,r,i,a,o,s,c){var l,d,f;return t=e.match(iT)||[],l=(n=u(t,4))[1],d=n[2],f=n[3],l||(r=e.match(aT)||[],d=(i=u(r,3))[1],f=i[2]),d&&f||(a=e.match(oT)||[],d=(o=u(a,3))[1],f=o[2]),d&&f||(s=e.match(sT)||[],d=u(s,2)[1]),d||lS.warning("un-destructible url: ",e),{proxy:l,host:d,port:f||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(lS.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((function(){return i.clearTimeout()}))}}]),e}();function lT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var dT=function(e){p(n,e);var t=h(n);function n(e,r){var i;l(this,n);var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5?arguments[5]:void 0;i=t.call(this),kf(f(i),"connectionID",0),kf(f(i),"currentURLIndex",0),kf(f(i),"urls",[]),kf(f(i),"_reconnectMode","tryNext"),kf(f(i),"reconnectReason",void 0),kf(f(i),"_initMutex",new fE("websocket")),kf(f(i),"name",void 0),kf(f(i),"_state","closed"),kf(f(i),"reconnectInterrupter",void 0),kf(f(i),"websocket",void 0),kf(f(i),"retryConfig",void 0),kf(f(i),"reconnectCount",0),kf(f(i),"forceCloseTimeout",5e3),kf(f(i),"onlineReconnectListener",void 0),kf(f(i),"useCompress",void 0),kf(f(i),"tryDoubleDomain",!1),kf(f(i),"use443PortOnly",!1),kf(f(i),"wsInflateLength",0),kf(f(i),"wsDeflateLength",0),kf(f(i),"closeEstablishingWs",(function(){})),kf(f(i),"store",void 0),kf(f(i),"joinGatewayRecordIndex",void 0),i.store=c,i.name=e,i.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lT(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),i.useCompress=a,i.tryDoubleDomain=o,i.use443PortOnly=s;var u=r.timeout,d=r.timeoutFactor,p=Math.max(300,Math.floor(3*u/5)),h=Math.max(1.2,Math.floor(8*d)/10);return T_.ONLINE&&(i.retryConfig.timeout=p,i.retryConfig.timeoutFactor=h),B_.on(I_.NETWORK_STATE_CHANGE,(function(e,t){e!==t&&(i.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===T_.ONLINE?(i.retryConfig.timeout=p,i.retryConfig.timeoutFactor=h):(i.retryConfig.timeout=u,i.retryConfig.timeoutFactor=d))})),i}return d(n,[{key:"url",get:function(){return this.websocket&&this.websocket.url||null}},{key:"reconnectMode",get:function(){return this._reconnectMode},set:function(e){var t;$i(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(BS.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(BS.CONNECTED):"closed"===this._state?this.emit(BS.CLOSED):"failed"===this._state&&this.emit(BS.FAILED))}},{key:"resetReconnectCount",value:function(e){lS.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}},{key:"getConnection",value:function(){return this.websocket||void 0}},{key:"init",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:5e3,e.next=3,this._initMutex.lock();case 3:return r=e.sent,this.forceCloseTimeout=n,this.urls=t,this.state="connecting",e.prev=5,i=Sy(),a=this.urls[this.currentURLIndex],this.createWebSocketConnection(a).then(i.resolve).catch(i.reject),this.once(BS.CLOSED,(function(){i.reject(new o_(Oy.WS_DISCONNECT))})),this.once(BS.CONNECTED,i.resolve),e.next=12,i.promise;case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(5);case 16:return e.prev=16,r(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[5,14,16,19]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"close",value:function(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var n=this.websocket;t?setTimeout((function(){return n.close()}),500):n.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}},{key:"reconnect",value:function(e,t){if(this.websocket){void 0!==e&&(this.reconnectMode=e),lS.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);var n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}else lS.warning("[".concat(this.name,"] can not reconnect, no websocket"))}},{key:"sendMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new o_(Oy.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new o_(Oy.WS_ERR,"send websocket message error"+e.toString())}}},{key:"setWsInflateData",value:function(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}},{key:"getWsInflateData",value:function(){var e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}},{key:"clearWsInflateData",value:function(){this.wsInflateLength=0,this.wsDeflateLength=0}},{key:"createWebSocketConnection",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,u,l,d,f,p,h,v,m,g,y=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Sy(),this.connectionID+=1,this.joinGatewayRecordIndex=void 0,i=function(e){var t;null===(t=y.store)||void 0===t||t.signalChannelOpen(),lS.debug("[".concat(y.name,"] websocket opened:"),e),y.reconnectMode="retry",y.state="connected",y.resetReconnectCount("opened"),r.resolve()},a=function(){var e=c(s().mark((function e(t){var n,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("[".concat(y.name,"] websocket close ").concat(null===(n=y.websocket)||void 0===n?void 0:n.url,", code: ").concat(t.code,", reason: ").concat(t.reason,", current mode: ").concat(y.reconnectMode)),!(y.reconnectCount>=y.retryConfig.maxRetryCount)){e.next=4;break}r.reject(new o_(Oy.WS_DISCONNECT,"websocket close: ".concat(t.code))),y.close(),e.next=14;break;case 4:return"connected"===y.state&&(y.reconnectReason=t.reason,y.state="reconnecting"),i=F_(y,BS.WILL_RECONNECT,y.reconnectMode,t.reason)||y.reconnectMode,e.next=8,y.reconnectWithAction(i);case 8:if(a=e.sent,"closed"!==y.state){e.next=11;break}return e.abrupt("return",void lS.debug("[".concat(y.connectionID,"] ws is closed, no need to reconnect")));case 11:if(a){e.next=13;break}return e.abrupt("return",(r.reject(new o_(Oy.WS_DISCONNECT,"websocket reconnect failed: ".concat(t.code))),y.close(!0)));case 13:r.resolve();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(e){y.emit(BS.ON_MESSAGE,e)},u=function(e){lS.warn("[".concat(y.connectionID,"] ws open error ").concat(e))},this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$w("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$w("GATEWAY_WSS_ADDRESS")),lS.debug("[".concat(this.name,"] start connect, url:"),t),l=null===(n=this.store)||void 0===n?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),e.prev=5,e.next=8,this.chooseBestWebsocketConnection(t);case 8:f=e.sent,this.websocket=f,i&&i(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=o,this.websocket.onerror=u,null===(d=this.store)||void 0===d||d.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),p="closed"===this.state,h=e.t0 instanceof o_,v=h&&e.t0.code===Oy.WS_ABORT,m=h&&e.t0.code===Oy.WS_ERR,g=h?e.t0.message:e.t0&&(e.t0.reason||e.t0.toString()),lS.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(g)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:v?"aborted":"error",errors:[e.t0]},l),p||m?(r.reject(p?new o_(Oy.WS_DISCONNECT,"websocket is closed: ".concat(g)):new o_(Oy.WS_ERR,"init websocket failed: ".concat(g))),m&&lS.error("[".concat(this.name,"] init websocket failed: ").concat(g))):a&&a(e.t0);case 16:return e.abrupt("return",r.promise);case 17:case"end":return e.stop()}}),e,this,[[5,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"reconnectWithAction",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,u,l=this,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(d.length>1&&void 0!==d[1])||d[1],!(this.reconnectCount>=this.retryConfig.maxRetryCount)){e.next=3;break}return e.abrupt("return",!1);case 3:if(0!==this.urls.length){e.next=5;break}return e.abrupt("return",!1);case 5:if("closed"!==this.state){e.next=7;break}return e.abrupt("return",!1);case 7:if(lS.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||B_.isOnline||!B_.onlineWaiter||(this.onlineReconnectListener=B_.onlineWaiter.then((function(){l.onlineReconnectListener=void 0}))),r=!0,this.reconnectInterrupter=function(){return r=!1},!n){e.next=14;break}return i=vE(this.reconnectCount,this.retryConfig),lS.debug("[".concat(this.name,"] wait ").concat(i,"ms to reconnect websocket, mode: ").concat(t)),e.next=14,by.race([nE(i),this.onlineReconnectListener||new by((function(){}))]);case 14:if("closed"!==this._state&&r){e.next=16;break}return e.abrupt("return",!1);case 16:if(this.reconnectCount+=1,a=function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.emit(BS.RECONNECT_CREATE_CONNECTION,n),e.next=3,l.createWebSocketConnection(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=18,"retry"!==t){e.next=25;break}return this.emit(BS.RECONNECT_WAITTING_FINISH,t),e.next=23,a(this.urls[this.currentURLIndex],t);case 23:case 32:e.next=45;break;case 25:if("tryNext"!==t){e.next=34;break}if(this.currentURLIndex+=1,!(this.currentURLIndex>=this.urls.length)){e.next=28;break}return e.abrupt("return",this.reconnectWithAction("recover",!1));case 28:return lS.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(BS.RECONNECT_WAITTING_FINISH,t),e.next=32,a(this.urls[this.currentURLIndex],t);case 34:if(e.t0="recover"===t,!e.t0){e.next=45;break}return lS.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(BS.RECONNECT_WAITTING_FINISH,t),e.next=41,U_(this,BS.REQUEST_NEW_URLS);case 41:return this.urls=e.sent,this.currentURLIndex=0,e.next=45,a(this.urls[this.currentURLIndex],t);case 45:e.next=52;break;case 47:return e.prev=47,e.t1=e.catch(18),lS.error("[".concat(this.name,"] reconnect failed ").concat(e.t1&&e.t1.toString())),u=null==e.t1||null===(o=e.t1.data)||void 0===o?void 0:o.desc,e.abrupt("return",Array.isArray(u)&&$i(u).call(u,"dynamic key expired")?(this.emit(BS.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n));case 52:return e.abrupt("return",!0);case 53:case"end":return e.stop()}}),e,this,[[18,47]])})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(O_),fT=function(e){p(n,e);var t=h(n);function n(e,r){return l(this,n),t.call(this,e,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}return d(n,[{key:"chooseBestWebsocketConnection",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Sy(),i=function(e,t){return new uT(e,t)}(this.forceCloseTimeout,this.store),this.closeEstablishingWs=function(){lS.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new o_(Oy.WS_ABORT,"choose best websocket aborted"))},a=$w("GATEWAY_DOMAINS"),e.abrupt("return",(lS.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally((function(){o.closeEstablishingWs=void 0}))));case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),n}(dT),pT=function(e){p(n,e);var t=h(n);function n(e,r){return l(this,n),t.call(this,e,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}return d(n,[{key:"chooseBestWebsocketConnection",value:function(){var e=c(s().mark((function e(t,n){var r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new by((function(e,i){var a=!1,o=[];r.closeEstablishingWs=function(){lS.debug("[choose-best-ws] close establishing websockets"),o.forEach((function(e){e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),i(new o_(Oy.WS_ABORT,"choose best websocket aborted"))};var s,c=$w("GATEWAY_DOMAINS"),u=t.indexOf("?h="),l=c.find((function(e){return-1!==u?$i(t).call(t,e,u):$i(t).call(t,e)}));lS.debug("[choose-best-ws] currentDomain: ",l,", domains: ",c);var d=!r.tryDoubleDomain||!l;if(!d&&l){var f,p=Date.now();try{c.forEach((function(e){var n=-1===u?t.replace(l,e):t.substr(0,u)+t.substr(u).replace(l,e),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),lS.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(t){for(lS.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((function(e){return e.close()}));o.length;)o.pop();d=!0}null===(f=r.store)||void 0===f||f.recordJoinChannelService({urls:o.map((function(e){return e.url})),service:"gateway"},n),o.forEach((function(t){t.onopen=function(){if(!a){var n=Date.now()-p;lS.debug("[choose-best-ws] ws open cost ".concat(n,"ms")),o.filter((function(e){return e!==t})).forEach((function(e){lS.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),a=!0,e(t)}},t.onclose=function(e){s=e,a||o.find((function(e){return!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}))||(lS.debug("[choose-best-ws] all websocket is closed"),a=!0,i(s))},t.onmessage=function(e){lS.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))}})),nE(r.forceCloseTimeout).then((function(){o.forEach((function(e){e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(d){var h,v;lS.debug("[choose-best-ws] use single url: ",t),null===(h=r.store)||void 0===h||h.recordJoinChannelService({urls:[t],service:"gateway"},n);try{v=new WebSocket(t),o.push(v),v.binaryType="arraybuffer"}catch(t){var m=new o_(Oy.WS_ERR,"init websocket failed! Error: ".concat(t.toString()));return lS.error("[".concat(r.name,"]").concat(m)),void i(m)}v.onopen=function(){e(v)},v.onclose=function(e){i(e)},v.onmessage=function(e){lS.debug("[choose-best-ws]".concat(v.url," onmessage: ").concat(e.data))},nE(r.forceCloseTimeout).then((function(){v&&v.readyState!==WebSocket.OPEN&&v.close()}))}})).then((function(e){return r.closeEstablishingWs=void 0,e})).catch((function(e){throw r.closeEstablishingWs=void 0,e})));case 1:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),n}(dT),hT=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"_disconnectedReason",void 0),kf(f(i),"_websocketReconnectReason",void 0),kf(f(i),"_connectionState",PS.CLOSED),kf(f(i),"reconnectToken",void 0),kf(f(i),"websocket",void 0),kf(f(i),"openConnectionTime",void 0),kf(f(i),"clientId",void 0),kf(f(i),"lastMsgTime",Date.now()),kf(f(i),"uploadCache",[]),kf(f(i),"uploadCacheInterval",void 0),kf(f(i),"rttRolling",new OE(5)),kf(f(i),"pingpongTimer",void 0),kf(f(i),"wsInflateDataTimer",void 0),kf(f(i),"pingpongTimeoutCount",0),kf(f(i),"joinResponse",void 0),kf(f(i),"multiIpOption",void 0),kf(f(i),"initError",void 0),kf(f(i),"spec",void 0),kf(f(i),"store",void 0),kf(f(i),"onWebsocketMessage",(function(e){if(e.data instanceof ArrayBuffer)i.emit(LS.ON_BINARY_DATA,e.data);else{var t=JSON.parse(e.data);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(i.emit(t._type,t._message),t._type===jS.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===jS.ON_USER_BANNED)switch(t._message.error_code){case 14:i.close(w_.UID_BANNED);break;case 15:i.close(w_.IP_BANNED);break;case 16:i.close(w_.CHANNEL_BANNED)}if(t._type===jS.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case DS.ERR_LICENSE_MISSING:i.close(w_.LICENSE_MISSING);break;case DS.ERR_LICENSE_EXPIRED:i.close(w_.LICENSE_EXPIRED);break;case DS.ERR_LICENSE_MINUTES_EXCEEDED:i.close(w_.LICENSE_MINUTES_EXCEEDED);break;case DS.ERR_LICENSE_PERIOD_INVALID:i.close(w_.LICENSE_PERIOD_INVALID);break;case DS.ERR_LICENSE_MULTIPLE_SDK_SERVICE:i.close(w_.LICENSE_MULTIPLE_SDK_SERVICE);break;case DS.ERR_LICENSE_ILLEGAL:i.close(w_.LICENSE_ILLEGAL);break;default:i.close()}}}})),i.clientId=e.clientId,i.spec=e,i.store=r,i.websocket=new fT("gateway-".concat(i.clientId),i.spec.retryConfig,!0,$w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$w("JOIN_GATEWAY_USE_443PORT_ONLY"),r),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===PS.CONNECTED&&i.reconnect("retry",k_.OFFLINE)})),i}return d(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===PS.CONNECTED?this.emit(LS.WS_CONNECTED):e===PS.RECONNECTING?this.emit(LS.WS_RECONNECTING,this._websocketReconnectReason):e===PS.CLOSED&&this.emit(LS.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket&&this.websocket.url||null}},{key:"rtt",get:function(){return this.rttRolling.mean()}},{key:"request",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f,p,h,v=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=rE(6,""),o={_id:a,_type:t,_message:n},c=this.websocket.connectionID,u=function(){return new by((function(e,n){if(v.connectionState===PS.CONNECTED)return e();var r=function(){v.off(LS.WS_CLOSED,i),e()},i=function(){v.off(LS.WS_CONNECTED,r),n(new ek(Oy.WS_ABORT))};v.once(LS.WS_CONNECTED,r),v.once(LS.WS_CLOSED,i),t!==MS.PUBLISH&&t!==MS.SUBSCRIBE&&t!==MS.UNSUBSCRIBE&&t!==MS.UNPUBLISH&&t!==MS.CONTROL&&t!==MS.RESTART_ICE||v.once(LS.DISCONNECT_P2P,(function(){n(new ek(Oy.DISCONNECT_P2P))})),t!==MS.PUBLISH&&t!==MS.RESTART_ICE||v.once(LS.ABORT_P2P_EXECUTION,(function(){n(new ek(Oy.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==PS.CONNECTING&&this.connectionState!==PS.RECONNECTING||t===MS.JOIN||t===MS.REJOIN,e.t0){e.next=5;break}return e.next=5,u();case 5:if(this.websocket.sendMessage(o,!0),!i){e.next=8;break}return e.abrupt("return");case 8:return l=new by((function(e,r){var i=!1,o=function(r,a){i=!0,e({isSuccess:"success"===r,message:a||{}}),v.off(LS.WS_CLOSED,s),v.off(LS.WS_RECONNECTING,s),v.emit(LS.REQUEST_SUCCESS,t,n)};v.once("res-@".concat(a),o);var s=function e(){r(new ek(Oy.WS_ABORT,"type: ".concat(t))),v.off(LS.WS_CLOSED,e),v.off(LS.WS_RECONNECTING,e),v.off("res-@".concat(a),o)};v.once(LS.WS_CLOSED,s),v.once(LS.WS_RECONNECTING,s),nE($w("SIGNAL_REQUEST_TIMEOUT")).then((function(){v.websocket.connectionID!==c||i||(lS.warning("[".concat(v.clientId,"] ws request timeout, type: ").concat(t)),v.emit(LS.REQUEST_TIMEOUT,t,n))}))})),d=null,e.prev=10,e.next=13,l;case 13:d=e.sent,e.next=35;break;case 16:if(e.prev=16,e.t1=e.catch(10),this.connectionState!==PS.CLOSED&&t!==MS.LEAVE){e.next=20;break}throw new ek(Oy.WS_ABORT);case 20:if(this.spec.forceWaitGatewayResponse&&!r){e.next=24;break}e.t2=e.t1.throw(),e.next=34;break;case 24:if(t!==MS.JOIN&&t!==MS.REJOIN){e.next=28;break}e.t3=null,e.next=33;break;case 28:return e.next=30,u();case 30:return e.next=32,this.request(t,n);case 32:e.t3=e.sent;case 33:e.t2=e.t3;case 34:return e.abrupt("return",e.t2);case 35:if(!d.isSuccess){e.next=37;break}return e.abrupt("return",d.message);case 37:if(f=Number(d.message.error_code||d.message.code),p=$k(f),h=new ek(Oy.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(d.message.error_str),{code:f,data:d.message}),"success"!==p.action){e.next=42;break}e.t4=d.message,e.next=67;break;case 42:if(lS.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(p.desc,", action: ").concat(p.action)),f!==DS.ERR_TOO_MANY_BROADCASTERS){e.next=47;break}e.t5=t===MS.JOIN||t===MS.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw(),e.next=66;break;case 47:if("failed"!==p.action){e.next=51;break}e.t6=h.throw(),e.next=65;break;case 51:if("quit"!==p.action){e.next=55;break}e.t7=(this.initError=h,this.close(),h.throw()),e.next=64;break;case 55:if(f===DS.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,lS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",k_.MULTI_IP)):this.reconnect(p.action,k_.SERVER_ERROR),t!==MS.JOIN&&t!==MS.REJOIN){e.next=60;break}e.t8=null,e.next=63;break;case 60:return e.next=62,this.request(t,n);case 62:e.t8=e.sent;case 63:e.t7=e.t8;case 64:e.t6=e.t7;case 65:e.t5=e.t6;case 66:e.t4=e.t5;case 67:return e.abrupt("return",e.t4);case 68:case"end":return e.stop()}}),e,this,[[10,16]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"waitMessage",value:function(e,t){var n=this;return new by((function(r){var i=function i(a){(!t||t(a))&&(n.off(e,i),r(a))};n.on(e,i)}))}},{key:"upload",value:function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=$w("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===PS.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),$w("UPLOAD_CACHE_INTERVAL")||2e3))}}},{key:"send",value:function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)}},{key:"init",value:function(e,t){var n=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new by((function(t,r){n.once(LS.WS_CONNECTED,(function(){return t(n.joinResponse)})),n.once(LS.WS_CLOSED,(function(){return r(n.initError||new ek(Oy.WS_ABORT))})),n.connectionState=PS.CONNECTING,n.websocket.init(e).catch(r),n.wsInflateDataTimer&&window.clearInterval(n.wsInflateDataTimer),n.wsInflateDataTimer=window.setInterval((function(){n.handleWsInflateData()}),2e4)}))}},{key:"close",value:function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||w_.LEAVE,this.connectionState=PS.CLOSED,lS.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===w_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new fT("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$w("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}},{key:"join",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(LS.ABORT_P2P_EXECUTION),e.next=4,U_(this,LS.REQUEST_JOIN_INFO);case 4:return t=e.sent,e.next=7,this.request(MS.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(LS.REPORT_JOIN_GATEWAY,mk.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(LS.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rejoin",value:function(){var e=c(s().mark((function e(){var t,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new ek(Oy.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=V_(this,LS.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(MS.REJOIN,t);case 6:return n=e.sent,e.abrupt("return",!!n&&(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((function(e){r.emit(jS.ON_USER_ONLINE,{uid:e.uid}),e.audio&&r.emit(jS.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&r.emit(jS.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?r.emit(jS.MUTE_AUDIO,{uid:e.uid}):r.emit(jS.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?r.emit(jS.MUTE_VIDEO,{uid:e.uid}):r.emit(jS.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?r.emit(jS.ENABLE_LOCAL_AUDIO,{uid:e.uid}):r.emit(jS.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?r.emit(jS.ENABLE_LOCAL_VIDEO,{uid:e.uid}):r.emit(jS.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||r.emit(jS.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}},{key:"handleNotification",value:function(e){lS.debug("[".concat(this.clientId,"] receive notification: "),e);var t=$k(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(w_.UID_BANNED),void this.close()):void this.reconnect(t.action,k_.SERVER_ERROR);lS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}},{key:"handlePingPong",value:function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=$w("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(lS.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$w("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",k_.TIMEOUT):this.request(MS.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),$w("REPORT_STATS")&&e.send(MS.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}}},{key:"handleWsInflateData",value:function(){var e=this.websocket.getWsInflateData(),t=e.wsInflateLength,n=e.wsDeflateLength;0!==t&&0!==n&&this.upload(US.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}},{key:"handleWebsocketEvents",value:function(){var e=this;this.websocket.on(BS.RECONNECT_WAITTING_FINISH,(function(t){e.emit(LS.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(BS.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(LS.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(BS.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BS.CLOSED,(function(){e.connectionState=PS.CLOSED})),this.websocket.on(BS.FAILED,(function(){e._disconnectedReason=w_.NETWORK_ERROR,e.connectionState=PS.CLOSED})),this.websocket.on(BS.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===PS.CONNECTED?e.connectionState=PS.RECONNECTING:e.connectionState=PS.CONNECTING})),this.websocket.on(BS.WILL_RECONNECT,(function(t,n,r){var i=V_(e,LS.IS_P2P_DISCONNECTED),a=i||"retry"!==t;i&&"retry"===t&&(lS.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=mk.P2P_DISCONNECTED),a&&(lS.debug("".concat(e.clientId," will renewSession, reconnect mode: ").concat(t)),e.emit(LS.REPORT_JOIN_GATEWAY,n||mk.UNKNOWN_REASON,e.url||""),e.reconnectToken=void 0,e.emit(LS.NEED_RENEW_SESSION),e.emit(LS.DISCONNECT_P2P)),r(t)})),this.websocket.on(BS.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){lS.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",k_.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(LS.REPORT_JOIN_GATEWAY,t.message||t.code||mk.UNKNOWN_REASON,e.url||""),t instanceof ek&&t.code===Oy.UNEXPECTED_RESPONSE&&t.data.code===DS.ERR_NO_AUTHORIZED)return lS.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",k_.SERVER_ERROR);lS.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",k_.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(BS.REQUEST_NEW_URLS,(function(t,n){U_(e,LS.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(BS.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit(jS.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}]),n}(O_),vT="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",mT=bt,gT=Fi,yT=vT,_T=Le("".replace),ET=RegExp("^["+yT+"]+"),bT=RegExp("(^|[^"+yT+"])["+yT+"]+$"),wT=function(e){return function(t){var n=gT(mT(t));return 1&e&&(n=_T(n,ET,"")),2&e&&(n=_T(n,bT,"$1")),n}},ST={start:wT(1),end:wT(2),trim:wT(3)},kT=vl.PROPER,TT=Ae,IT=vT,CT=ST.trim;ti({target:"String",proto:!0,forced:function(e){return TT((function(){return!!IT[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||kT&&IT[e].name!==e}))}("trim")},{trim:function(){return CT(this)}});var RT,AT,OT=bi("String").trim,NT=Me,xT=OT,DT=String.prototype,PT=ve((function(e){var t=e.trim;return"string"==typeof e||e===DT||NT(DT,e)&&t===DT.trim?xT:t}));function LT(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function MT(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function UT(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function jT(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}!function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(RT||(RT={})),function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"}(AT||(AT={}));var FT={"90p":MT(160,90),"90p_1":MT(160,90),"120p":MT(160,120,15,30,65),"120p_1":MT(160,120,15,30,65),"120p_3":MT(120,120,15,30,50),"120p_4":MT(212,120),"180p":MT(320,180,15,30,140),"180p_1":MT(320,180,15,30,140),"180p_3":MT(180,180,15,30,100),"180p_4":MT(240,180,15,30,120),"240p":MT(320,240,15,40,200),"240p_1":MT(320,240,15,40,200),"240p_3":MT(240,240,15,40,140),"240p_4":MT(424,240,15,40,220),"360p":MT(640,360,15,80,400),"360p_1":MT(640,360,15,80,400),"360p_3":MT(360,360,15,80,260),"360p_4":MT(640,360,30,80,600),"360p_6":MT(360,360,30,80,400),"360p_7":MT(480,360,15,80,320),"360p_8":MT(480,360,30,80,490),"360p_9":MT(640,360,15,80,800),"360p_10":MT(640,360,24,80,800),"360p_11":MT(640,360,24,80,1e3),"480p":MT(640,480,15,100,500),"480p_1":MT(640,480,15,100,500),"480p_2":MT(640,480,30,100,1e3),"480p_3":MT(480,480,15,100,400),"480p_4":MT(640,480,30,100,750),"480p_6":MT(480,480,30,100,600),"480p_8":MT(848,480,15,100,610),"480p_9":MT(848,480,30,100,930),"480p_10":MT(640,480,10,100,400),"720p":MT(1280,720,15,120,1130),"720p_1":MT(1280,720,15,120,1130),"720p_2":MT(1280,720,30,120,2e3),"720p_3":MT(1280,720,30,120,1710),"720p_5":MT(960,720,15,120,910),"720p_6":MT(960,720,30,120,1380),"1080p":MT(1920,1080,15,120,2080),"1080p_1":MT(1920,1080,15,120,2080),"1080p_2":MT(1920,1080,30,120,3e3),"1080p_3":MT(1920,1080,30,120,3150),"1080p_5":MT(1920,1080,60,120,4780),"1440p":MT(2560,1440,30,120,4850),"1440p_1":MT(2560,1440,30,120,4850),"1440p_2":MT(2560,1440,60,120,7350),"4k":MT(3840,2160,30,120,8910),"4k_1":MT(3840,2160,30,120,8910),"4k_3":MT(3840,2160,60,120,13500)},VT={"480p":UT(640,480,5),"480p_1":UT(640,480,5),"480p_2":UT(640,480,30),"480p_3":UT(640,480,15),"720p":UT(1280,720,5),"720p_1":UT(1280,720,5),"720p_2":UT(1280,720,30),"720p_3":UT(1280,720,15),"1080p":UT(1920,1080,5),"1080p_1":UT(1920,1080,5),"1080p_2":UT(1920,1080,30),"1080p_3":UT(1920,1080,15)},BT={"1SL1TL":jT(1,1),"3SL3TL":jT(3,3),"2SL3TL":jT(2,3)};function GT(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},FT[e]):e}function ZT(e){return"string"==typeof e?Object.assign({},VT[e]):e}function qT(e){return"string"==typeof e?Object.assign({},BT[e]):e}var WT={speech_low_quality:LT(16e3,!1),speech_standard:LT(32e3,!1,18),music_standard:LT(48e3,!1),standard_stereo:LT(48e3,!0,56),high_quality:LT(48e3,!1,128),high_quality_stereo:LT(48e3,!0,192)};function HT(e){return"string"==typeof e?Object.assign({},WT[e]):e}var KT,zT,YT,JT,XT,QT,$T,eI,tI,nI,rI=[];function iI(e){return c_(e,"mediaSource",["screen","window","application"]),!0}!function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(KT||(KT={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(zT||(zT={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(YT||(YT={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(JT||(JT={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(XT||(XT={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(QT||(QT={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}($T||($T={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(eI||(eI={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(tI||(tI={})),function(e){e.UPDATE_TRACK_SOURCE="update-track-source"}(nI||(nI={}));var aI,oI,sI,cI,uI,lI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},dI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},fI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},pI={uplinkNetworkQuality:0,downlinkNetworkQuality:0},hI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};!function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(aI||(aI={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(oI||(oI={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(sI||(sI={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(cI||(cI={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(uI||(uI={}));var vI,mI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};!function(e){e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error"}(vI||(vI={}));var gI=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"_ID",void 0),kf(f(i),"_rtpTransceiver",void 0),kf(f(i),"_lowRtpTransceiver",void 0),kf(f(i),"_hints",[]),kf(f(i),"_isClosed",!1),kf(f(i),"_originMediaStreamTrack",void 0),kf(f(i),"_mediaStreamTrack",void 0),kf(f(i),"_external",{}),i._ID=r||rE(8,"track-"),i._originMediaStreamTrack=e,i._mediaStreamTrack=e,function(e){$i(rI).call(rI,e)||rI.push(e)}(f(i)),i}return d(n,[{key:"toString",value:function(){return this._ID}},{key:"getTrackId",value:function(){return this._ID}},{key:"getMediaStreamTrack",value:function(e){if(!e){var t=bS.reportApiInvoke(null,{name:__.GET_MEDIA_STREAM_TRACK,options:[],tag:E_.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?t.onSuccess(this._mediaStreamTrack.label):t.onSuccess("")}return this._mediaStreamTrack}},{key:"getRTCRtpTransceiver",value:function(e){return e===YT.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}},{key:"getMediaStreamTrackSettings",value:function(){return this.getMediaStreamTrack(!0).getSettings()}},{key:"close",value:function(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){var t=rI.indexOf(e);-1!==t&&rI.splice(t,1)}(this),this.emit($T.CLOSED)}},{key:"_updateRtpTransceiver",value:function(e,t){if(t===YT.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(QT.TRANSCEIVER_UPDATED,e,t)}}]),n}(O_),yI=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this,e,r),kf(f(i),"_enabled",!0),kf(f(i),"_muted",!1),kf(f(i),"_isExternalTrack",!1),kf(f(i),"_isClosed",!1),kf(f(i),"_enabledMutex",void 0),kf(f(i),"processor",void 0),kf(f(i),"_handleTrackEnded",(function(){i.onTrackEnded()})),i._enabledMutex=new fE("".concat(i.getTrackId())),e.addEventListener("ended",i._handleTrackEnded),i}return d(n,[{key:"isExternalTrack",get:function(){return this._isExternalTrack}},{key:"muted",get:function(){return this._muted}},{key:"enabled",get:function(){return this._enabled}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"getTrackLabel",value:function(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}},{key:"close",value:function(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,lS.debug("[".concat(this.getTrackId(),"] close")),this.emit(KT.NEED_CLOSE),i(a(n.prototype),"close",this).call(this))}},{key:"_updateOriginMediaStreamTrack",value:function(){var e=c(s().mark((function e(t,n){var r,i=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]&&i[2],this._isExternalTrack=r,e.t0=t!==this._originMediaStreamTrack,!e.t0){e.next=13;break}return this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=12,j_(this,KT.NEED_REPLACE_TRACK,this);case 12:this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext});case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_getDefaultPlayerConfig",value:function(){return{}}},{key:"onTrackEnded",value:function(){lS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($T.TRACK_ENDED)}},{key:"stateCheck",value:function(e,t){if(lS.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),s_(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new o_(Oy.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",lS);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new o_(Oy.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",lS)}},{key:"getProcessorStats",value:function(){return this.processorContext.gatherStats()}},{key:"getProcessorUsage",value:function(){return this.processorContext.gatherUsage()}}]),n}(gI);function _I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var EI=window.AudioContext||window.webkitAudioContext,bI=null,wI=new(function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.apply(this,arguments),kf(f(e),"prevState",void 0),kf(f(e),"curState",void 0),kf(f(e),"currentTime",void 0),kf(f(e),"currentTimeStuckAt",void 0),kf(f(e),"interruptDetectorTrack",void 0),kf(f(e),"onLocalAudioTrackMute",(function(){lS.info("ios15-interruption-start"),e.emit(AT.IOS_15_16_INTERRUPTION_START)})),kf(f(e),"onLocalAudioTrackUnmute",c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(lS.info("ios15-interruption-end"),"running"===e.curState&&!e.duringInterruption){t.next=5;break}lS.info("ios15-interruption-end-canceled"),t.next=10;break;case 5:if(t.t0=bI,!t.t0){t.next=9;break}return t.next=9,bI.suspend();case 9:e.emit(AT.IOS_15_16_INTERRUPTION_END);case 10:case"end":return t.stop()}}),t)})))),e}return d(n,[{key:"duringInterruption",get:function(){return"running"===this.prevState&&"interrupted"===this.curState}},{key:"bindInterruptDetectorTrack",value:function(e){lS.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}},{key:"unbindInterruptDetectorTrack",value:function(e){lS.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}}]),n}(O_));function SI(){if(EI){lS.info("create audio context");var e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_I(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},$w("WEBAUDIO_INIT_OPTIONS"));lS.debug("audio context init option:",JSON.stringify(e)),bI=new EI(e),wI.curState=bI.state,bI.onstatechange=function(){wI.prevState=wI.curState,wI.curState=bI?bI.state:void 0;var e=wI.prevState,t=wI.curState,n="running"===t,r="interrupted"===t,i="running"===e,a="suspended"===e,o="interrupted"===e,s=Py().osVersion;(Zy()||Qy())&&i&&r&&(lS.info("ios".concat(s,"-interruption-start")),wI.emit(AT.IOS_INTERRUPTION_START)),(Zy()||Qy())&&(a||o)&&n&&(lS.info("ios".concat(s,"-interruption-end")),wI.emit(AT.IOS_INTERRUPTION_END)),e!==t&&(lS.debug("AudioContext State Change","".concat(e,"=>").concat(t)),wI.emit(AT.STATE_CHANGE))},setInterval((function(){var e,t=null===(e=bI)||void 0===e?void 0:e.currentTime;wI.currentTime!==t?(wI.currentTimeStuckAt&&(lS.debug("AudioContext current time resume at ".concat(t)),wI.currentTimeStuckAt=void 0),wI.currentTime=t):(t!==wI.currentTimeStuckAt&&(bS.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:E_.TRACER}).onSuccess(),lS.warning("AudioContext current time stuck at ".concat(t))),wI.currentTimeStuckAt=t)}),5e3),function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c,u,l,d,f,p,h,v,m,g,y;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m=function(){p(!0)},v=function(){r.removeEventListener("playing",v),r.removeEventListener("abort",v),r.removeEventListener("error",v),o=!1,p(!1)},h=function(e){if(a!==e){a=e;for(var t=0,r=n;t<r.length;t++){var i=r[t];e?window.addEventListener(i,m,{capture:!0,passive:!0}):window.removeEventListener(i,m,{capture:!0,passive:!0})}}},p=function(e){if(!o)if(r.paused)if(e){var t;h(!1),o=!0;try{(t=r.play())?t.then(v,v):(r.addEventListener("playing",v),r.addEventListener("abort",v),r.addEventListener("error",v))}catch(e){v()}}else h(!0);else h(!1)},f=function(){c(!0)},d=function(){c(!1)},l=function(){c(!0)},u=function(e){if(i!==e){i=e;for(var t=0,r=n;t<r.length;t+=1){var a=r[t];e?window.addEventListener(a,f,{capture:!0,passive:!0}):window.removeEventListener(a,f,{capture:!0,passive:!0})}}},c=function(e){"running"===t.state?u(!1):Zy()||Qy()?"suspended"===t.state&&(u(!0),e&&t.resume().then(d,d)):"closed"!==t.state&&(u(!0),e&&t.resume().then(d,d))},n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],i=!1,a=!1,o=!1,Zy()&&(g=t.createMediaStreamDestination(),(y=document.createElement("div")).innerHTML="<audio x-webkit-airplay='deny'></audio>",(r=y.children.item(0)).controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=g.stream,p(!0)),wI.on(AT.STATE_CHANGE,l),c(!1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(bI)}else lS.error("your browser is not support web audio")}function kI(){if(!bI){if(SI(),!bI)throw new o_(Oy.NOT_SUPPORTED,"can not create audio context");return bI}return bI}function TI(){return!!bI}function II(e){if(!function(){if(null!==CI)return CI;var e=kI(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);var i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),CI=i,i}()){var t=e.connect,n=e.disconnect;e.connect=function(n,r,i){var a;return e._inputNodes||(e._inputNodes=[]),$i(a=e._inputNodes).call(a,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=function(r,i,a){n.call(e),r?q_(e._inputNodes,r):e._inputNodes=[];var s,c=o(e._inputNodes);try{for(c.s();!(s=c.n()).done;){var u=s.value;t.call(e,u)}}catch(l){c.e(l)}finally{c.f()}}}}var CI=null;function RI(e,t){var n=!1,r=1/t;if($w("DISABLE_WEBAUDIO"))var i=window.setInterval((function(){n?window.clearInterval(i):e(performance.now()/1e3)}),1e3*r);else{var a=kI(),o=a.createGain();o.gain.value=0,o.connect(a.destination);var s=function t(){if(n)o=null;else{var i=a.createOscillator();i.onended=t,i.connect(o),i.start(0),i.stop(a.currentTime+r),e(a.currentTime)}};s()}return function(){n=!0}}var AI={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function OI(){return AI}var NI=function(){function e(){l(this,e),kf(this,"context",void 0),kf(this,"analyserNode",void 0),kf(this,"sourceNode",void 0),this.context=kI(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}return d(e,[{key:"updateSource",value:function(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}},{key:"getVolumeLevel",value:function(){if(!this.sourceNode)return 0;if(!this.context||Zy()||Qy()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;var e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{var t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(var n=0;n<e.length;++n)e[n]=t[n]/128-1}var r=AE(e).call(e,(function(e,t){return e+t*t}),0)/e.length;return Math.max(10*Math.log10(r)+100,0)/100}},{key:"getAnalyserNode",value:function(){return this.analyserNode}},{key:"rebuildAnalyser",value:function(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){lS.warning("rebuild analyser node failed.")}}},{key:"destroy",value:function(){this.updateSource(void 0)}}]),e}(),xI=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"outputNode",void 0),kf(f(e),"outputTrack",void 0),kf(f(e),"isPlayed",!1),kf(f(e),"context",void 0),kf(f(e),"audioBufferNode",void 0),kf(f(e),"destNode",void 0),kf(f(e),"audioOutputLevel",0),kf(f(e),"volumeLevelAnalyser",void 0),kf(f(e),"_processedNode",void 0),kf(f(e),"playNode",void 0),kf(f(e),"isDestroyed",!1),kf(f(e),"onNoAudioInput",void 0),kf(f(e),"isNoAudioInput",!1),kf(f(e),"_noAudioInputCount",0),e.context=kI(),e.playNode=e.context.destination,e.outputNode=e.context.createGain(),II(e.outputNode),e.volumeLevelAnalyser=new NI,e}return d(n,[{key:"processSourceNode",get:function(){return this.sourceNode}},{key:"processedNode",get:function(){return this._processedNode},set:function(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}},{key:"startGetAudioBuffer",value:function(e){var t=this;this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=function(e){t.emit(tI.ON_AUDIO_BUFFER,function(e){for(var t=0;t<e.outputBuffer.numberOfChannels;t+=1)for(var n=e.outputBuffer.getChannelData(t),r=0;r<n.length;r+=1)n[r]=0;return e.inputBuffer}(e))})}},{key:"stopGetAudioBuffer",value:function(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}},{key:"createOutputTrack",value:function(){if(!OI().webAudioMediaStreamDest)throw new o_(Oy.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}},{key:"play",value:function(e){"running"!==this.context.state&&H_((function(){wI.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}},{key:"stop",value:function(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(b){}this.isPlayed=!1}},{key:"getAccurateVolumeLevel",value:function(){return this.volumeLevelAnalyser.getVolumeLevel()}},{key:"checkHasAudioInput",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=o.length>0&&void 0!==o[0]?o[0]:0)>5)){e.next=3;break}return e.abrupt("return",(this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1));case 3:for(Zy()||Qy()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume(),(n=this.volumeLevelAnalyser.getAnalyserNode()).getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r)),i=!1,a=0;a<r.length;a++)0!==r[a]&&(i=!0);if(!i){e.next=12;break}e.t0=(this.isNoAudioInput=!1,!0),e.next=20;break;case 12:return e.next=14,nE(200);case 14:return e.next=16,this.checkHasAudioInput(t?t+1:1);case 16:if(e.t1=e.sent,!e.t1){e.next=19;break}e.t1=i;case 19:e.t0=e.t1;case 20:return e.abrupt("return",e.t0);case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAudioVolume",value:function(){return this.outputNode.gain.value}},{key:"setVolume",value:function(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}},{key:"destroy",value:function(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}},{key:"disconnect",value:function(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}},{key:"connect",value:function(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}]),n}(O_),DI=function(e){p(n,e);var t=h(n);function n(e,i,a){var o,u;if(l(this,n),o=t.call(this),kf(f(o),"sourceNode",void 0),kf(f(o),"track",void 0),kf(f(o),"clonedTrack",void 0),kf(f(o),"audioElement",void 0),kf(f(o),"isCurrentTrackCloned",!1),kf(f(o),"isRemoteTrack",!1),kf(f(o),"originVolumeLevelAnalyser",void 0),kf(f(o),"rebuildWebAudio",c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("ready to rebuild web audio, state:",o.context.state),e.t0=o.isNoAudioInput,!e.t0){e.next=5;break}return e.next=5,o.checkHasAudioInput();case 5:if(o.isNoAudioInput&&!o.isDestroyed){e.next=7;break}return e.abrupt("return",(document.body.removeEventListener("click",o.rebuildWebAudio,!0),void lS.debug("rebuild web audio success, current volume status",o.getAccurateVolumeLevel())));case 7:o.context.resume().then((function(){return lS.info("resume success")})),lS.debug("rebuild web audio because of ios 12 bugs"),o.disconnect(),t=o.track,o.track=o.track.clone(),o.isCurrentTrackCloned?t.stop():o.isCurrentTrackCloned=!0,n=new MediaStream([o.track]),o.sourceNode=o.context.createMediaStreamSource(n),II(o.sourceNode),o.volumeLevelAnalyser.rebuildAnalyser(),r=o.outputNode.gain.value,o.outputNode=o.context.createGain(),o.outputNode.gain.setValueAtTime(r,o.context.currentTime),II(o.outputNode),o.emit(tI.UPDATE_SOURCE),o.connect(),o.audioElement.srcObject=n,o.isPlayed&&o.play(o.playNode),o.checkHasAudioInput();case 14:case"end":return e.stop()}}),e)})))),"audio"!==e.kind)throw new o_(Oy.UNEXPECTED_ERROR);o.track=e;var d=new MediaStream([o.track]);if(o.isRemoteTrack=!!i,o.sourceNode=o.context.createMediaStreamSource(d),II(o.sourceNode),a){var p=a.clone();p.enabled=!0,o.clonedTrack=p,lS.debug("create an unmuted track ".concat(p.id," from the original track ").concat(a.id," to get the volume"));var h=o.context.createMediaStreamSource(new MediaStream([p]));II(h),o.originVolumeLevelAnalyser=new NI,o.originVolumeLevelAnalyser.updateSource(h)}o.connect(),o.audioElement=document.createElement("audio"),o.audioElement.srcObject=d;var v=Py();return i&&v.os===ky.IOS&&Number(null===(u=v.osVersion)||void 0===u?void 0:u.split(".")[0])<15&&(wI.on(AT.STATE_CHANGE,(function(){"suspended"===o.context.state?document.body.addEventListener("click",o.rebuildWebAudio,!0):"running"===o.context.state&&o.rebuildWebAudio()})),o.checkHasAudioInput().then((function(e){e||document.body.addEventListener("click",o.rebuildWebAudio,!0)}))),r(o)}return d(n,[{key:"isFreeze",get:function(){return!1}},{key:"updateTrack",value:function(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;var t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),II(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(tI.UPDATE_SOURCE),this.audioElement.srcObject=t}},{key:"destroy",value:function(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),wI.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,i(a(n.prototype),"destroy",this).call(this)}},{key:"createMediaStreamSourceNode",value:function(e){return this.context.createMediaStreamSource(new MediaStream([e]))}},{key:"updateOriginTrack",value:function(e){var t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),lS.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));var n=this.context.createMediaStreamSource(new MediaStream([t]));II(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}},{key:"getOriginVolumeLevel",value:function(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}]),n}(xI);function PI(e,t,n){return LI.apply(this,arguments)}function LI(){return LI=c(s().mark((function e(t,n,r){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e,t){return e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t},a={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(n.height,1080),maxWidth:i(n.width,1920)}}},n.frameRate&&"number"!=typeof n.frameRate?(a.video.mandatory.maxFrameRate=n.frameRate.max,a.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(a.video.mandatory.maxFrameRate=n.frameRate),e.next=4,navigator.mediaDevices.getUserMedia(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),LI.apply(this,arguments)}function MI(e,t){return UI.apply(this,arguments)}function UI(){return UI=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jI(t.mediaSource);case 2:return r=e.sent,e.next=5,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new by((function(n,r){var i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var a=document.createElement("div");a.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");var u=document.createElement("button");u.innerHTML="cancel",u.setAttribute("style","width: 85px;"),u.onclick=function(){document.body.removeChild(h);var e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};var l=t,d=document.createElement("div");if(t){var f=document.createElement("input");f.setAttribute("type","checkbox");var p=document.createElement("span");f.setAttribute("style","margin-right: 6px;"),p.innerText="Share audio",f.checked=l,f.onchange=function(){l=f.checked},d.appendChild(f),d.appendChild(p)}c.appendChild(d),c.appendChild(u),a.appendChild(o),a.appendChild(s),a.appendChild(c);var h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(a),document.body.appendChild(h),e.map((function(e){if(e.id){var t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var r=e.thumbnail;try{r.getSize().width>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=function(){document.body.removeChild(h),n({sourceId:e.id,audio:l})},s.appendChild(t)}}))}))}(r,n);case 5:return i=e.sent,a=i.sourceId,o=i.audio,e.next=10,PI(a,t,o);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)}))),UI.apply(this,arguments)}function jI(e){return FI.apply(this,arguments)}function FI(){return FI=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=["window","screen"],"application"!==t&&"window"!==t||(n=["window"]),"screen"===t&&(n=["screen"]),r=x_()){e.next=5;break}throw console.error("failed to fetch electron, please mount it to window"),new o_(Oy.ELECTRON_IS_NULL);case 5:i=null;try{i=(null===(a=r.desktopCapturer)||void 0===a?void 0:a.getSources({types:n}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch(t){i=null}return i&&i.then||(i=new by((function(e,t){r.desktopCapturer.getSources({types:n},(function(n,r){n?t(n):e(r)}))}))),e.prev=8,e.next=11,i;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),new o_(Oy.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.t0.toString());case 17:case"end":return e.stop()}}),e,null,[[8,14]])}))),FI.apply(this,arguments)}function VI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var BI=new fE("safari"),GI=!1,ZI=!1;function qI(e,t){return WI.apply(this,arguments)}function WI(){return WI=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,i=null;case 1:if(!(r<2)){e.next=23;break}return e.prev=2,e.next=5,HI(t,n,r>0);case 5:return i=e.sent,e.abrupt("break",23);case 9:if(e.prev=9,e.t0=e.catch(2),!(e.t0 instanceof o_)){e.next=13;break}throw lS.error("[".concat(n,"] ").concat(e.t0.toString())),e.t0;case 13:if((a=zI(e.t0.name||e.t0.code||e.t0,e.t0.message)).code!==Oy.MEDIA_OPTION_INVALID){e.next=20;break}return lS.debug("[".concat(n,"] detect media option invalid, retry")),r+=1,e.next=19,nE(500);case 19:return e.abrupt("continue",21);case 20:throw lS.error("[".concat(n,"] ").concat(a.toString())),a;case 21:e.next=1;break;case 23:if(i){e.next=25;break}throw new o_(Oy.UNEXPECTED_ERROR,"can not find stream after getUserMedia");case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,null,[[2,9]])}))),WI.apply(this,arguments)}function HI(e,t,n){return KI.apply(this,arguments)}function KI(){return KI=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d,f,p,h,v,m,g,y,_,E,b,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=2;break}throw new o_(Oy.NOT_SUPPORTED,"can not find getUserMedia");case 2:if(r&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height)),i=OI(),a=new MediaStream,t.audioSource&&a.addTrack(t.audioSource),t.videoSource&&a.addTrack(t.videoSource),t.audio||t.video||t.screen){e.next=6;break}return e.abrupt("return",(lS.debug("Using Video Source/ Audio Source"),a));case 6:if(!t.screen){e.next=62;break}if(!x_()){e.next=25;break}if(!t.screen.sourceId){e.next=17;break}return e.t0=YI,e.t1=a,e.next=13,PI(t.screen.sourceId,t.screen,t.screenAudio);case 13:e.t2=e.sent,(0,e.t0)(e.t1,e.t2),e.next=23;break;case 17:return e.t3=YI,e.t4=a,e.next=21,MI(t.screen,t.screenAudio);case 21:e.t5=e.sent,(0,e.t3)(e.t4,e.t5);case 23:e.next=62;break;case 25:if(!(Vy()&&t.screen.extensionId&&t.screen.mandatory)){e.next=41;break}if(i.getStreamFromExtension){e.next=28;break}throw new o_(Oy.NOT_SUPPORTED,"This browser does not support screen sharing");case 28:return lS.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"')),e.next=31,g=t.screen.extensionId,y=n,new by((function(e,t){try{chrome.runtime.sendMessage(g,{getStream:!0},(function(n){if(!n||!n.streamId)return lS.error("[".concat(y,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new o_(Oy.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){lS.error("[".concat(y,"] AgoraRTC screensharing plugin is not accessible(").concat(g,")"),e.toString()),t(new o_(Oy.CHROME_PLUGIN_NOT_INSTALL))}}));case 31:return o=e.sent,t.screen.mandatory.chromeMediaSourceId=o,e.t6=YI,e.t7=a,e.next=37,navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}});case 37:e.t8=e.sent,(0,e.t6)(e.t7,e.t8),e.next=62;break;case 41:if(!i.getDisplayMedia){e.next=51;break}return t.screen.mediaSource&&iI(t.screen.mediaSource),u={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:null!==(c=t.screen.displaySurface)&&void 0!==c?c:"screen"===t.screen.mediaSource?"monitor":t.screen.mediaSource},l=t.screen,d=l.selfBrowserSurface,f=l.surfaceSwitching,p=l.systemAudio,h={selfBrowserSurface:d,surfaceSwitching:f,systemAudio:p},!d&&delete h.selfBrowserSurface,!f&&delete h.surfaceSwitching,!p&&delete h.systemAudio,lS.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:u,audio:!!t.screenAudio,controls:h})),e.next=47,navigator.mediaDevices.getDisplayMedia(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VI(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({video:u,audio:!!t.screenAudio},h));case 47:v=e.sent,YI(a,v),e.next=62;break;case 51:if(Gy()){e.next=53;break}throw lS.error("[".concat(n,"] This browser does not support screenSharing")),new o_(Oy.NOT_SUPPORTED,"This browser does not support screen sharing");case 53:return t.screen.mediaSource&&iI(t.screen.mediaSource),m={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}},lS.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(m))),e.t9=YI,e.t10=a,e.next=60,navigator.mediaDevices.getUserMedia(m);case 60:e.t11=e.sent,(0,e.t9)(e.t10,e.t11);case 62:if(t.video||t.audio){e.next=64;break}return e.abrupt("return",a);case 64:if(_={video:t.video,audio:t.audio},E=$w("MEDIA_DEVICE_CONSTRAINTS"))try{"string"==typeof E&&(E=JSON.parse(E)),_=uE(_,E)}catch(t){}if(lS.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),Py(),w=null,e.t12=By()||Zy()||Uy(),!e.t12){e.next=73;break}return e.next=72,BI.lock();case 72:w=e.sent;case 73:return e.prev=73,e.next=76,navigator.mediaDevices.getUserMedia(_);case 76:b=e.sent,e.next=82;break;case 79:throw e.prev=79,e.t13=e.catch(73),w&&w(),e.t13;case 82:return e.abrupt("return",(_.audio&&(GI=!0),_.video&&(ZI=!0),YI(a,b),w&&w(),a));case 83:case"end":return e.stop()}}),e,null,[[73,79]])}))),KI.apply(this,arguments)}function zI(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new o_(Oy.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new o_(Oy.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new o_(Oy.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new o_(Oy.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new o_(Oy.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new o_(Oy.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return lS.error("getUserMedia unexpected error",e),new o_(Oy.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function YI(e,t){var n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}var JI=new(function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"_state",sI.IDLE),kf(f(e),"isAccessMicrophonePermission",!1),kf(f(e),"isAccessCameraPermission",!1),kf(f(e),"lastAccessMicrophonePermission",!1),kf(f(e),"lastAccessCameraPermission",!1),kf(f(e),"checkdeviceMatched",!1),kf(f(e),"deviceInfoMap",new Map),e.init().then((function(){navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",e.updateDevicesInfo.bind(f(e))),window.setInterval((function(){($w("ENUMERATE_DEVICES_INTERVAL")||(n_()||Ly()===ky.HARMONY_OS)&&t_())&&e.updateDevicesInfo()}),$w("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((function(e){return lS.error(e.toString())})),e}return d(n,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this.emit(cI.STATE_CHANGE,e),this._state=e)}},{key:"enumerateDevices",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h,v,m=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>2&&void 0!==m[2]&&m[2],navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return e.abrupt("return",new o_(Oy.NOT_SUPPORTED,"enumerateDevices() not supported.").throw());case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:if(i=e.sent,a=this.checkMediaDeviceInfoIsOk(i),o=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&n,a.audio&&(o=!1),a.video&&(c=!1),u=null,l=null,d=null,r||!o&&!c){e.next=65;break}if(!BI.isLocked){e.next=18;break}return lS.debug("[device manager] wait GUM lock"),e.next=15,BI.lock();case 15:e.t0=e.sent,(0,e.t0)(),lS.debug("[device manager] GUM unlock");case 18:if(GI&&(o=!1,this.isAccessMicrophonePermission=!0),ZI&&(c=!1,this.isAccessCameraPermission=!0),lS.debug("[device manager] check media device permissions",t,n,o,c),!o||!c){e.next=34;break}return e.prev=19,e.next=22,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 22:d=e.sent,e.next=31;break;case 25:if(e.prev=25,e.t1=e.catch(19),(f=zI(e.t1.name||e.t1.code||e.t1,e.t1.message)).code!==Oy.PERMISSION_DENIED){e.next=30;break}throw f;case 30:lS.warning("getUserMedia failed in getDevices",f);case 31:this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0,e.next=64;break;case 34:if(!o){e.next=50;break}return e.prev=35,e.next=38,navigator.mediaDevices.getUserMedia({audio:t});case 38:u=e.sent,e.next=47;break;case 41:if(e.prev=41,e.t2=e.catch(35),(p=zI(e.t2.name||e.t2.code||e.t2,e.t2.message)).code!==Oy.PERMISSION_DENIED){e.next=46;break}throw p;case 46:lS.warning("getUserMedia failed in getDevices",p);case 47:this.isAccessMicrophonePermission=!0,e.next=64;break;case 50:if(!c){e.next=64;break}return e.prev=51,e.next=54,navigator.mediaDevices.getUserMedia({video:n});case 54:l=e.sent,e.next=63;break;case 57:if(e.prev=57,e.t3=e.catch(51),(h=zI(e.t3.name||e.t3.code||e.t3,e.t3.message)).code!==Oy.PERMISSION_DENIED){e.next=62;break}throw h;case 62:lS.warning("getUserMedia failed in getDevices",h);case 63:this.isAccessCameraPermission=!0;case 64:lS.debug("[device manager] mic permission",t,"cam permission",n);case 65:return e.prev=65,e.next=68,navigator.mediaDevices.enumerateDevices();case 68:return v=e.sent,e.abrupt("return",(u&&u.getTracks().forEach((function(e){return e.stop()})),l&&l.getTracks().forEach((function(e){return e.stop()})),d&&d.getTracks().forEach((function(e){return e.stop()})),u=null,l=null,d=null,v));case 72:return e.prev=72,e.t4=e.catch(65),u&&u.getTracks().forEach((function(e){return e.stop()})),l&&l.getTracks().forEach((function(e){return e.stop()})),d&&d.getTracks().forEach((function(e){return e.stop()})),u=null,l=null,d=null,e.abrupt("return",new o_(Oy.ENUMERATE_DEVICES_FAILED,e.t4.toString()).throw());case 76:case"end":return e.stop()}}),e,this,[[19,25],[35,41],[51,57],[65,72]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRecordingDevices",value:function(){var e=c(s().mark((function e(){var t,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audioinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getCamerasDevices",value:function(){var e=c(s().mark((function e(){var t,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!1,!0,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"videoinput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSpeakers",value:function(){var e=c(s().mark((function e(){var t,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.enumerateDevices(!0,!1,t);case 3:return e.abrupt("return",e.sent.filter((function(e){return"audiooutput"===e.kind})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"searchDeviceIdByName",value:function(e){var t=null;return this.deviceInfoMap.forEach((function(n){n.device.label===e&&(t=n.device.deviceId)})),t}},{key:"getDeviceById",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(n=e.sent.find((function(e){return e.deviceId===t}))){e.next=5;break}throw new o_(Oy.DEVICE_NOT_FOUND,"deviceId: ".concat(t));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state=sI.INITING,e.prev=1,e.next=4,this.updateDevicesInfo();case 4:this.state=sI.INITEND,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),lS.warning("Device Detection functionality cannot start properly.",e.t0.toString()),this.state=sI.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new o_(Oy.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e.t0;case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateDevicesInfo",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices(!0,!0,!0);case 2:if(t=e.sent,n=Date.now(),r=[],t[0]&&t[0].label&&!1===this.checkdeviceMatched&&(this.checkdeviceMatched=!0,i=t.find((function(e){return"audioinput"===e.kind&&"default"===e.deviceId})),a=t.find((function(e){return"audiooutput"===e.kind&&"default"===e.deviceId})),i&&a?a.groupId===i.groupId?lS.debug("[device-check] default input ".concat(i.label," and output ").concat(a.label," is the same group")):lS.warning("[device-check] default input ".concat(i.label," and output ").concat(a.label," is not the same group")):lS.debug("[device-check] default input or output not found")),o=this.checkMediaDeviceInfoIsOk(t),t.forEach((function(e){if(e.deviceId){var t=c.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(t?t.state:"INACTIVE")){var i={initAt:n,updateAt:n,device:e,state:"ACTIVE"};c.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),r.push(i)}t&&(t.updateAt=n)}})),this.deviceInfoMap.forEach((function(e,t){"ACTIVE"===e.state&&e.updateAt!==n&&(e.state="INACTIVE",r.push(e))})),this.state===sI.INITEND){e.next=9;break}return e.abrupt("return",(o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0))));case 9:r.forEach((function(e){switch(e.device.kind){case"audioinput":c.lastAccessMicrophonePermission&&c.isAccessMicrophonePermission&&c.emit(cI.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":c.lastAccessCameraPermission&&c.isAccessCameraPermission&&c.emit(cI.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":c.lastAccessMicrophonePermission&&c.isAccessMicrophonePermission&&c.emit(cI.PLAYOUT_DEVICE_CHANGED,e)}})),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkMediaDeviceInfoIsOk",value:function(e){var t,n=e.filter((function(e){return"audioinput"===e.kind})),r=e.filter((function(e){return"videoinput"===e.kind})),i={audio:!1,video:!1},a=o(n);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(s.label&&s.deviceId){i.audio=!0;break}}}catch(d){a.e(d)}finally{a.f()}var c,u=o(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(l.label&&l.deviceId){i.video=!0;break}}}catch(d){u.e(d)}finally{u.f()}return i}}]),n}(O_)),XI=!1,QI=new(function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.apply(this,arguments),kf(f(e),"onAutoplayFailed",void 0),kf(f(e),"onAudioAutoplayFailed",void 0),e}return d(n)}(O_));function $I(){if(Py(),!XI){var e=function e(t){t.preventDefault(),XI=!1,r_()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};XI=!0,r_()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),lS.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),QI.onAutoplayFailed?QI.onAutoplayFailed():QI.onAudioAutoplayFailed?lS.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):lS.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),QI.emit("autoplay-failed")}}function eC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nC(e,t,n,r){if(e){var i=bS.getBaseInfoBySessionId(e);if(i){var a=i.info,o=Date.now(),s=tC(tC({},a),{},{vid:void 0===a.vid?0:Number(a.vid),lts:o,elapse:o-i.startTime,cbRegistered:QI.onAutoplayFailed||QI.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});bS.send({type:pS.AUTOPLAY_FAILED,data:s},!0)}}}var rC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],iC=new(function(){function e(){var t=this;l(this,e),kf(this,"onAutoplayFailed",void 0),kf(this,"elementMap",new Map),kf(this,"elementStateMap",new Map),kf(this,"elementsNeedToResume",[]),kf(this,"sinkIdMap",new Map),kf(this,"autoResumeAfterInterruption",(function(){Array.from(t.elementMap.entries()).forEach((function(e){var n=u(e,2),r=n[0],i=n[1],a=t.elementStateMap.get(r),o=i.srcObject.getAudioTracks()[0];Yy()?o&&"live"===o.readyState&&"running"===wI.curState&&(lS.debug("auto resume after interruption for iOS 15"),i.pause(),i.play()):a&&"paused"===a&&o&&"live"===o.readyState&&"running"===wI.curState&&(lS.debug("auto resume after interruption for iOS"),i.play())}))})),kf(this,"autoResumeAfterInterruptionOnIOS15_16",(function(){Array.from(t.elementMap.entries()).forEach((function(e){var t=u(e,2),n=(t[0],t[1]),r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(lS.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),wI.on(AT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wI.on(AT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),wI.on(AT.STATE_CHANGE,(function(){Zy()&&"suspended"===wI.prevState&&"running"===wI.curState&&t.autoResumeAfterInterruption()}))}return d(e,[{key:"setSinkID",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.elementMap.get(t),this.sinkIdMap.set(t,n),!r){e.next=10;break}return e.prev=2,e.next=5,r.setSinkId(n);case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new o_(Oy.PERMISSION_DENIED,"can not set sink id: "+e.t0.toString());case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"play",value:function(e,t,n,r){var i=this;if(!this.elementMap.has(t)){var a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,uI.INIT),this.setVolume(t,n);var o=this.sinkIdMap.get(t);if(o)try{a.setSinkId(o).catch((function(e){lS.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){lS.warning("[".concat(t,"] set sink id failed"),e.toString())}var s=a.play();s&&s.then&&s.catch((function(e){r&&nC(r,"audio",e.message,t),lS.warning("audio element play warning",e.toString()),i.elementMap.has(t)&&"NotAllowedError"===e.name&&(lS.warning("detected audio element autoplay failed"),i.elementsNeedToResume.push(a),H_((function(){i.onAutoplayFailed&&i.onAutoplayFailed(),$I()})))}))}}},{key:"updateTrack",value:function(e,t){var n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}},{key:"isPlaying",value:function(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}},{key:"setVolume",value:function(e,t){var n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}},{key:"stop",value:function(e){var t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),t){var n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}}},{key:"bindAudioElementEvents",value:function(e,t){var n=this;rC.forEach((function(r){t.addEventListener(r,(function(r){var i=n.elementStateMap.get(e),a="pause"===r.type?"paused":r.type;if(lS.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(a)),"error"===r.type){var o=null==t?void 0:t.error;o&&lS.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}n.elementStateMap.set(e,a)}))}))}},{key:"getPlayerState",value:function(e){return this.elementStateMap.get(e)||"uninit"}},{key:"autoResumeAudioElement",value:function(){var e=this,t=function(){e.elementsNeedToResume.forEach((function(e){e.play().then((function(e){lS.debug("Auto resume audio element success")})).catch((function(e){lS.warning("Auto resume audio element failed!",e)}))})),e.elementsNeedToResume=[]};new by((function(e){document.body?e():window.addEventListener("load",(function(){return e()}))})).then((function(){r_()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))}}]),e}());function aC(){return function(e,t,n){var r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new o_(Oy.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",lS);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=r.apply(this,t);return i instanceof by?new by((function(e,t){i.then(e).catch(t)})):i}),n}}function oC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var cC=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this),kf(f(r),"name","VideoProcessorDestination"),kf(f(r),"ID","0"),kf(f(r),"_source",void 0),kf(f(r),"videoContext",void 0),kf(f(r),"inputTrack",void 0),r.videoContext=e,r}return d(n,[{key:"kind",get:function(){return"video"}},{key:"enabled",get:function(){return!0}},{key:"pipe",value:function(){throw new o_(Oy.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}},{key:"unpipe",value:function(){throw new o_(Oy.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"updateInput",value:function(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(aI.ON_TRACK,e.track))}},{key:"reset",value:function(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(aI.ON_TRACK,void 0)}}]),n}(O_),uC=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"constraintsMap",new Map),kf(f(i),"statsRegistry",[]),kf(f(i),"usageRegistry",[]),kf(f(i),"trackId",void 0),kf(f(i),"direction",void 0),kf(f(i),"_chained",!1),i.trackId=e,i.direction=r,i}return d(n,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}},{key:"getConstraints",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U_(this,oI.REQUEST_CONSTRAINTS);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestApplyConstraints",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(lS.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),j_(this,oI.REQUEST_UPDATE_CONSTRAINTS,Array.from(XS(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestRevertConstraints",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(lS.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),j_(this,oI.REQUEST_UPDATE_CONSTRAINTS,Array.from(XS(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"registerStats",value:function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}},{key:"unregisterStats",value:function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)}},{key:"gatherStats",value:function(){var e,t=[],n=o(this.statsRegistry);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.processorID,a=r.processorName,s=r.type,c=r.cb;try{var u=c();t.push({processorID:i,processorName:a,type:s,stats:u})}catch(t){lS.error(new o_(Oy.UNEXPECTED_ERROR,t.message))}}}catch(l){n.e(l)}finally{n.f()}return t}},{key:"registerUsage",value:function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}},{key:"unregisterUsage",value:function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)}},{key:"gatherUsage",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=o(this.usageRegistry),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=23;break}if(i=r.value.cb,e.prev=8,a=i(),e.t0=a instanceof by,!e.t0){e.next=15;break}return e.next=14,a;case 14:a=e.sent;case 15:t.push(sC(sC({},a),{},{direction:this.direction})),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(8),lS.error("gather extension usage error",e.t1);case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(4),n.e(e.t2);case 28:return e.prev=28,n.f(),e.finish(28);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}}),e,this,[[4,25,28,31],[8,18]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDirection",value:function(){return this.direction}}]),n}(O_),lC=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this),kf(f(r),"name","AudioProcessorDestination"),kf(f(r),"ID","0"),kf(f(r),"inputTrack",void 0),kf(f(r),"inputNode",void 0),kf(f(r),"audioProcessorContext",void 0),kf(f(r),"_source",void 0),r.audioProcessorContext=e,r}return d(n,[{key:"kind",get:function(){return"audio"}},{key:"enabled",get:function(){return!0}},{key:"pipe",value:function(){throw new o_(Oy.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}},{key:"unpipe",value:function(){throw new o_(Oy.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"reset",value:function(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(aI.ON_TRACK,void 0),this.emit(aI.ON_NODE,void 0)}},{key:"updateInput",value:function(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(aI.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(aI.ON_NODE,this.inputNode))}}]),n}(O_),dC=function(e){p(n,e);var t=h(n);function n(e,r,i){var a;return l(this,n),a=t.call(this),kf(f(a),"constraintsMap",new Map),kf(f(a),"statsRegistry",[]),kf(f(a),"audioContext",void 0),kf(f(a),"trackId",void 0),kf(f(a),"direction",void 0),kf(f(a),"usageRegistry",[]),kf(f(a),"_chained",!1),a.audioContext=e,a.trackId=r,a.direction=i,a}return d(n,[{key:"chained",get:function(){return this._chained},set:function(e){this._chained=e}},{key:"getConstraints",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",U_(this,oI.REQUEST_CONSTRAINTS));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAudioContext",value:function(){return this.audioContext}},{key:"requestApplyConstraints",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(lS.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),j_(this,oI.REQUEST_UPDATE_CONSTRAINTS,Array.from(XS(r=this.constraintsMap).call(r)))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestRevertConstraints",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.constraintsMap.has(t)){e.next=2;break}return e.abrupt("return",(this.constraintsMap.delete(t),j_(this,oI.REQUEST_UPDATE_CONSTRAINTS,Array.from(XS(n=this.constraintsMap).call(n)))));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"registerStats",value:function(e,t,n){this.statsRegistry.find((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}},{key:"unregisterStats",value:function(e,t){var n=this.statsRegistry.findIndex((function(n){return n.processorID===e.ID&&n.processorName===e.name&&n.type===t}));-1!==n&&this.statsRegistry.splice(n,1)}},{key:"gatherStats",value:function(){var e,t=[],n=o(this.statsRegistry);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.processorID,a=r.processorName,s=r.type,c=r.cb;try{var u=c();t.push({processorID:i,processorName:a,type:s,stats:u})}catch(t){lS.error(new o_(Oy.UNEXPECTED_ERROR,t.message))}}}catch(l){n.e(l)}finally{n.f()}return t}},{key:"registerUsage",value:function(e,t){this.usageRegistry.find((function(t){return t.processorID===e.ID&&t.processorName===e.name}))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}},{key:"unregisterUsage",value:function(e){var t=this.usageRegistry.findIndex((function(t){return t.processorID===e.ID&&t.processorName===e.name}));-1!==t&&this.usageRegistry.splice(t,1)}},{key:"gatherUsage",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],this.chained){e.next=3;break}return e.abrupt("return",[]);case 3:n=o(this.usageRegistry),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=23;break}if(i=r.value.cb,e.prev=8,a=i(),e.t0=a instanceof by,!e.t0){e.next=15;break}return e.next=14,a;case 14:a=e.sent;case 15:t.push(sC(sC({},a),{},{direction:this.direction})),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(8),lS.error("gather extension usage error",e.t1);case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(4),n.e(e.t2);case 28:return e.prev=28,n.f(),e.finish(28);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}}),e,this,[[4,25,28,31],[8,18]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDirection",value:function(){return this.direction}}]),n}(O_),fC=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"context",void 0),kf(f(e),"processSourceNode",void 0),kf(f(e),"outputTrack",void 0),kf(f(e),"processedNode",void 0),kf(f(e),"clonedTrack",void 0),kf(f(e),"outputNode",void 0),e.outputNode=new pC,e}return d(n,[{key:"isPlayed",get:function(){return!0}},{key:"isFreeze",get:function(){return!1}},{key:"setVolume",value:function(){}},{key:"createOutputTrack",value:function(){throw new o_(Oy.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}},{key:"getOriginVolumeLevel",value:function(){return 0}},{key:"getAccurateVolumeLevel",value:function(){return 0}},{key:"stopGetAudioBuffer",value:function(){}},{key:"startGetAudioBuffer",value:function(){}},{key:"play",value:function(){}},{key:"stop",value:function(){}},{key:"destroy",value:function(){}},{key:"updateTrack",value:function(){}},{key:"updateOriginTrack",value:function(){}},{key:"createMediaStreamSourceNode",value:function(){}}]),n}(O_),pC=function(){function e(){l(this,e)}return d(e,[{key:"disconnect",value:function(){}},{key:"connect",value:function(){}}]),e}(),hC=null,vC=function(){function e(){var t=this;l(this,e),kf(this,"state","open"),kf(this,"trigger",void 0),kf(this,"tasks",[]),lS.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout((function(){t.state="closed",lS.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(t.tasks.map((function(e){return e.key})),"]")),t.trigger=void 0,t.tasks.forEach((function(e){return(0,e.func)()})),t.tasks.length=0,lS.debug("[macro-task-queue] is closed.")}))}return d(e,[{key:"enqueue",value:function(e,t){"closed"!==this.state&&(this.tasks.push({key:e,func:t}),lS.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")))}},{key:"runTask",value:function(e){if("closed"!==this.state){var t=this.tasks.findIndex((function(t){return t.key===e}));if(-1!==t){var n=this.tasks.splice(t,1);lS.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")),n[0].func()}}}},{key:"release",value:function(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,lS.debug("[macro-task-queue] is closed."))}}]),e}();function mC(e){return function(t,n,r){var i,a=null!==(i=r.value)&&void 0!==i?i:r.get,o=function(){hC&&"open"===hC.state&&hC.runTask(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==a?void 0:a.apply.apply(a,[this].concat(n))};return r.value?r.value=o:r.get=o,r}}function gC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _C=function(e){p(n,e);var t=h(n);function n(e,r,i,a,o){var s;l(this,n),s=t.call(this,e,i),kf(f(s),"trackMediaType","audio"),kf(f(s),"_encoderConfig",void 0),kf(f(s),"_trackSource",void 0),kf(f(s),"_enabled",!0),kf(f(s),"_volume",100),kf(f(s),"_useAudioElement",!1),kf(f(s),"_bypassWebAudio",!1),kf(f(s),"processor",void 0),kf(f(s),"_processorContext",void 0),kf(f(s),"_processorDestination",void 0),kf(f(s),"_getOriginVolumeLevel",void 0),s._encoderConfig=r,s._getOriginVolumeLevel=!!a;var c=function(){s.processorContext=new dC(s._source.context,s.getTrackId(),"local"),s.processorDestination=new lC(s.processorContext),s.bindProcessorDestinationEvents(),s._source.on(tI.UPDATE_SOURCE,(function(){s.processor&&s.processor.updateInput({node:s._source.processSourceNode,context:s.processorContext})}))},u=o&&By()&&!TI();return $w("DISABLE_WEBAUDIO")?(s._source=new fC,s._useAudioElement=!0,s._bypassWebAudio=!0):u?s._source=new fC:(s._source=new DI(e,!1,s._getOriginVolumeLevel?e:void 0),$w("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(s._useAudioElement=!0)),c(),!$w("DISABLE_WEBAUDIO")&&u&&(hC||(hC=new vC),hC).enqueue("INIT_WEBAUDIO",(function(){s._source=new DI(e,!1,s._getOriginVolumeLevel?e:void 0),$w("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(s._useAudioElement=!0),c(),s.emit(nI.UPDATE_TRACK_SOURCE)})),s}return d(n,[{key:"_source",get:function(){return this._trackSource},set:function(e){this._trackSource=e}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"processorDestination",get:function(){return this._processorDestination},set:function(e){this._processorDestination=e}},{key:"isPlaying",get:function(){return this._useAudioElement?iC.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"LocalAudioTrack"}},{key:"setVolume",value:function(e){var t=this;u_(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&iC.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void lS.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));var n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,j_(this,KT.NEED_REPLACE_TRACK,this).then((function(){lS.debug("[".concat(t.getTrackId(),"] replace web audio track success"))})).catch((function(e){lS.warning("[".concat(t.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}},{key:"getVolumeLevel",value:function(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}},{key:"setPlaybackDevice",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement){e.next=2;break}throw new o_(Oy.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,iC.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._setEnabled(t,n,r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"_setEnabled",value:function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(lS.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=18;break}return this._originMediaStreamTrack.enabled=!0,e.prev=6,r||(this._enabled=!0),e.next=10,j_(this,KT.NEED_ENABLE_TRACK,this);case 10:lS.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success")),e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(6),r||(this._enabled=!1),lS.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t0.toString()),e.t0;case 16:e.next=27;break;case 18:return this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1),e.prev=19,e.next=22,j_(this,KT.NEED_DISABLE_TRACK,this);case 22:e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(19),r||(this._enabled=!0),lS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 27:case"end":return e.stop()}}),e,this,[[6,13],[19,24]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"setMuted",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,lS.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,j_(this,KT.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,j_(this,KT.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStats",value:function(){return J_((function(){lS.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),F_(this,KT.GET_STATS)||yC({},lI)}},{key:"setAudioFrameCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tI.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tI.ON_AUDIO_BUFFER),this._source.on(tI.ON_AUDIO_BUFFER,(function(t){return e(t)}))}},{key:"play",value:function(){lS.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(lS.debug("[".concat(this.getTrackId(),"] start audio playback in element")),iC.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}},{key:"stop",value:function(){lS.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?iC.stop(this.getTrackId()):this._source.stop()}},{key:"close",value:function(){i(a(n.prototype),"close",this).call(this),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}},{key:"_updatePlayerSource",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lS.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&iC.updateTrack(this.getTrackId(),this._mediaStreamTrack)}},{key:"_updateOriginMediaStreamTrack",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._originMediaStreamTrack!==t,!e.t0){e.next=16;break}if(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack===this._source.outputTrack){e.next=14;break}return this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),e.next=12,j_(this,KT.NEED_REPLACE_TRACK,this);case 12:e.next=15;break;case 14:this._source.updateTrack(this._originMediaStreamTrack);case 15:this._getOriginVolumeLevel&&this._source.updateOriginTrack(t);case 16:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"renewMediaStreamTrack",value:function(e){return by.resolve(void 0)}},{key:"pipe",value:function(e){if(this._bypassWebAudio)throw new o_(Oy.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new o_(Oy.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}},{key:"unpipe",value:function(){var e;if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(aI.ON_TRACK,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=10;break}if(t.t0=n!==e._mediaStreamTrack,!t.t0){t.next=8;break}return e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n),t.next=8,j_(e,KT.NEED_REPLACE_TRACK,e);case 8:t.next=16;break;case 10:if(t.t1=e._mediaStreamTrack!==e._originMediaStreamTrack,!t.t1){t.next=16;break}return e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource(),t.next=16,j_(e,KT.NEED_REPLACE_TRACK,e);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.processorDestination.on(aI.ON_NODE,(function(t){e._source.processedNode=t}))}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(aI.ON_TRACK),this.processorDestination.removeAllListeners(aI.ON_NODE)}},{key:"unbindProcessorContextEvents",value:function(){this.processorContext.removeAllListeners(oI.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(oI.REQUEST_CONSTRAINTS)}}]),n}(yI);QS([mC("INIT_WEBAUDIO"),$S("design:type",Object),$S("design:paramtypes",[Object])],_C.prototype,"_source",null),QS([mC("INIT_WEBAUDIO"),$S("design:type",dC),$S("design:paramtypes",[dC])],_C.prototype,"processorContext",null),QS([mC("INIT_WEBAUDIO"),$S("design:type",lC),$S("design:paramtypes",[lC])],_C.prototype,"processorDestination",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",void 0)],_C.prototype,"setVolume",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],_C.prototype,"setPlaybackDevice",null),QS([pE("LocalAudioTrack","_enabledMutex"),ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Object,Boolean]),$S("design:returntype",by)],_C.prototype,"setEnabled",null),QS([pE("LocalAudioTrack","_enabledMutex"),ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean]),$S("design:returntype",by)],_C.prototype,"setMuted",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",Object)],_C.prototype,"getStats",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[Object,Number]),$S("design:returntype",void 0)],_C.prototype,"setAudioFrameCallback",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],_C.prototype,"play",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],_C.prototype,"stop",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],_C.prototype,"close",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",Object)],_C.prototype,"pipe",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],_C.prototype,"unpipe",null);var EC=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this,e,r.encoderConfig?HT(r.encoderConfig):{},a,$w("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),kf(f(o),"_config",void 0),kf(f(o),"_deviceName","default"),kf(f(o),"_constraints",void 0),kf(f(o),"_originalConstraints",void 0),kf(f(o),"_enabled",!0),o._config=r,o._constraints=i,o._originalConstraints=i,o._deviceName=e.label,"boolean"==typeof r.bypassWebAudio&&(o._bypassWebAudio=r.bypassWebAudio),(Yy()||Jy())&&wI.bindInterruptDetectorTrack(f(o)),o.on(nI.UPDATE_TRACK_SOURCE,(function(){o.bindProcessorContextEvents()})),TI()&&o.bindProcessorContextEvents(),o}return d(n,[{key:"__className__",get:function(){return"MicrophoneAudioTrack"}},{key:"setDevice",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),!this._enabled){e.next=35;break}return e.prev=1,e.next=4,JI.getDeviceById(t);case 4:return n=e.sent,(r={}).audio=yC({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,qI(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),lS.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,qI({audio:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1);case 25:this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=33;break;case 30:throw e.prev=30,e.t1=e.catch(1),lS.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 33:e.next=45;break;case 35:return e.prev=35,e.next=38,JI.getDeviceById(t);case 38:a=e.sent,this._deviceName=a.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t},e.next=45;break;case 42:throw e.prev=42,e.t2=e.catch(35),lS.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 45:lS.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"));case 46:case"end":return e.stop()}}),e,this,[[1,30],[8,14],[35,42]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=c(s().mark((function e(t,r,o){var c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return lS.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),e.next=4,i(a(n.prototype),"_setEnabled",this).call(this,t);case 4:return e.abrupt("return",e.sent);case 5:if(o){e.next=9;break}if(t!==this._enabled){e.next=8;break}return e.abrupt("return");case 8:this.stateCheck("enabled",t);case 9:if(lS.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){e.next=20;break}return this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(c=this._source.clonedTrack)||void 0===c||c.stop(),o||(this._enabled=!1),e.prev=11,e.next=14,j_(this,KT.NEED_DISABLE_TRACK,this);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(11),lS.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.t0.toString()),e.t0;case 19:return e.abrupt("return");case 20:return u=yC({},this._constraints),(l=JI.searchDeviceIdByName(this._deviceName))&&!u.deviceId&&(u.deviceId=l),e.prev=22,o||(this._enabled=!0),e.next=26,qI({audio:this._constraints},this.getTrackId());case 26:return d=e.sent,e.next=29,this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1);case 29:return e.next=31,j_(this,KT.NEED_ENABLE_TRACK,this);case 31:e.next=36;break;case 33:throw e.prev=33,e.t1=e.catch(22),o||(this._enabled=!1),lS.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.t1.toString()),e.t1;case 36:lS.info("[".concat(this.getTrackId(),"] setEnabled success"));case 37:case"end":return e.stop()}}),e,this,[[11,16],[22,33]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){i(a(n.prototype),"close",this).call(this),(Yy()||Jy())&&wI.unbindInterruptDetectorTrack(this)}},{key:"onTrackEnded",value:function(){var e=this;if((Zy()||Qy())&&this._enabled&&!this._isClosed&&wI.duringInterruption){var t=function(){var n=c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(wI.off(AT.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return lS.debug("[".concat(e.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();wI.on(AT.IOS_INTERRUPTION_END,t)}else lS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($T.TRACK_ENDED)}},{key:"renewMediaStreamTrack",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=JI.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId=r),this._constraints=n,!this._enabled){e.next=8;break}return this._originMediaStreamTrack.stop(),e.next=5,qI({audio:this._constraints},this.getTrackId());case 5:return i=e.sent,e.next=8,this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"bindProcessorContextEvents",value:function(){var e=this;this.processorContext.on(oI.REQUEST_UPDATE_CONSTRAINTS,function(){var t=c(s().mark((function t(n,r,i){var a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=Object.assign.apply(Object,[{},e._originalConstraints].concat(m(n))),t.next=4,e.renewMediaStreamTrack(a);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this.processorContext.on(oI.REQUEST_CONSTRAINTS,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e._originMediaStreamTrack.getSettings());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),n}(_C);QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],EC.prototype,"setDevice",null),QS([pE("MicrophoneAudioTrack","_enabledMutex"),ES({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Boolean,Boolean]),$S("design:returntype",by)],EC.prototype,"setEnabled",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],EC.prototype,"close",null);var bC=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;l(this,n),o=t.call(this,r.createOutputTrack(),i,a),kf(f(o),"source",void 0),kf(f(o),"_bufferSource",void 0),o.source=e,o._bufferSource=r,o._bufferSource.on(tI.AUDIO_SOURCE_STATE_CHANGE,(function(e){o.safeEmit($T.SOURCE_STATE_CHANGE,e)}));try{o._mediaStreamTrack=o._source.createOutputTrack()}catch(e){}return o}return d(n,[{key:"__className__",get:function(){return"BufferSourceAudioTrack"}},{key:"currentState",get:function(){return this._bufferSource.currentState}},{key:"duration",get:function(){return this._bufferSource.duration}},{key:"playbackSpeed",get:function(){return this._bufferSource.playbackSpeed}},{key:"getCurrentTime",value:function(){return this._bufferSource.currentTime}},{key:"startProcessAudioBuffer",value:function(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}},{key:"pauseProcessAudioBuffer",value:function(){this._bufferSource.pauseProcessAudioBuffer()}},{key:"seekAudioBuffer",value:function(e){this._bufferSource.seekAudioBuffer(e)}},{key:"resumeProcessAudioBuffer",value:function(){this._bufferSource.resumeProcessAudioBuffer()}},{key:"stopProcessAudioBuffer",value:function(){this._bufferSource.stopProcessAudioBuffer()}},{key:"close",value:function(){this.source=null,this._bufferSource.destroy(),i(a(n.prototype),"close",this).call(this)}},{key:"setAudioBufferPlaybackSpeed",value:function(e){u_(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}]),n}(_C);QS([ES({argsMap:function(e,t){return[e.getTrackId(),t,e.duration]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",void 0)],bC.prototype,"startProcessAudioBuffer",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],bC.prototype,"pauseProcessAudioBuffer",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",void 0)],bC.prototype,"seekAudioBuffer",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],bC.prototype,"resumeProcessAudioBuffer",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],bC.prototype,"stopProcessAudioBuffer",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],bC.prototype,"close",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",void 0)],bC.prototype,"setAudioBufferPlaybackSpeed",null);var wC=function(e){p(n,e);var t=h(n);function n(){var e;l(this,n);var r=kI().createMediaStreamDestination();e=t.call(this,r.stream.getAudioTracks()[0],void 0,rE(8,"track-mix-")),kf(f(e),"trackList",void 0),kf(f(e),"destNode",void 0);try{e._mediaStreamTrack=e._source.createOutputTrack()}catch(r){}return e.destNode=r,e.trackList=[],e}return d(n,[{key:"__className__",get:function(){return"MixingAudioTrack"}},{key:"isActive",get:function(){var e,t=o(this.trackList);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n._enabled&&!n._isClosed&&!n.muted)return!0}}catch(r){t.e(r)}finally{t.f()}return!1}},{key:"hasAudioTrack",value:function(e){return-1!==this.trackList.indexOf(e)}},{key:"addAudioTrack",value:function(e){-1===this.trackList.indexOf(e)?(lS.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):lS.debug("track ".concat(e.getTrackId()," is already added"))}},{key:"removeAudioTrack",value:function(e){if(-1!==this.trackList.indexOf(e)){lS.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}q_(this.trackList,e),this.updateEncoderConfig()}}},{key:"updateEncoderConfig",value:function(){var e={};this.trackList.forEach((function(t){t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}},{key:"_updateRtpTransceiver",value:function(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((function(t){t instanceof n?t.emit(QT.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}]),n}(_C);function SC(e){var t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});var n=GT(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!e_()&&n.frameRate&&(t.frameRate=n.frameRate),Py().name===Ty.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),Gy()&&(t.frameRate={ideal:30,max:30}),t}function kC(e){var t={};if(e_()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Vy()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){var n=HT(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),n_()&&(t.sampleRate=void 0),t}var TC=function(e){p(n,e);var t=h(n);function n(e){var r;l(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=t.call(this),kf(f(r),"audioBuffer",void 0),kf(f(r),"sourceNode",void 0),kf(f(r),"startPlayTime",0),kf(f(r),"startPlayOffset",0),kf(f(r),"pausePlayTime",0),kf(f(r),"options",void 0),kf(f(r),"currentLoopCount",0),kf(f(r),"currentPlaybackSpeed",100),kf(f(r),"_currentState","stopped"),r.audioBuffer=e,r.options=i,r.startPlayOffset=r.options.startPlayTime||0,r}return d(n,[{key:"currentState",get:function(){return this._currentState},set:function(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(tI.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}},{key:"createWebAudioDiagram",value:function(){return this.context.createGain()}},{key:"duration",get:function(){return this.audioBuffer?this.audioBuffer.duration:0}},{key:"playbackSpeed",get:function(){return this.currentPlaybackSpeed}},{key:"currentTime",get:function(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}},{key:"updateOptions",value:function(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):lS.warning("can not set audio source options")}},{key:"startProcessAudioBuffer",value:function(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}},{key:"pauseProcessAudioBuffer",value:function(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}},{key:"seekAudioBuffer",value:function(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}},{key:"resumeProcessAudioBuffer",value:function(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}},{key:"stopProcessAudioBuffer",value:function(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(b){}this.reset()}}},{key:"destroy",value:function(){this.audioBuffer=null,i(a(n.prototype),"destroy",this).call(this)}},{key:"setAudioBufferPlaybackSpeed",value:function(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}},{key:"startSourceNode",value:function(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}},{key:"createSourceNode",value:function(){var e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}},{key:"handleSourceNodeEnded",value:function(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}},{key:"reset",value:function(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}]),n}(xI),IC=new Map;function CC(e,t){return RC.apply(this,arguments)}function RC(){return RC=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,"string"!=typeof t){e.next=16;break}if(!(i=IC.get(t))){e.next=5;break}return e.abrupt("return",(lS.debug("use cached audio resource: ",t),i));case 5:return e.prev=5,e.next=8,mE((function(){return Mw.get(t,{responseType:"arraybuffer"})}),void 0,void 0,{maxRetryCount:3});case 8:r=e.sent.data,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),new o_(Oy.FETCH_AUDIO_FILE_FAILED,e.t0.toString());case 14:e.next=20;break;case 16:return a=new by((function(e,n){var r=new FileReader;r.onload=function(t){t.target?e(t.target.result):n(new o_(Oy.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=function(){n(new o_(Oy.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(t)})),e.next=19,a;case 19:r=e.sent;case 20:return e.next=22,function(e){var t=kI();return new by((function(n,r){t.decodeAudioData(e,(function(e){n(e)}),(function(e){r(new o_(Oy.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(r);case 22:return o=e.sent,e.abrupt("return",("string"==typeof t&&n&&IC.set(t,o),o));case 24:case"end":return e.stop()}}),e,null,[[5,11]])}))),RC.apply(this,arguments)}var AC=function(e){var t=document.createElement("canvas");return t.width=2,t.height=2,new by((function(n,r){t.toBlob(function(){var e=c(s().mark((function e(i){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.remove(),!i){e.next=7;break}return e.next=3,OC(i);case 3:a=e.sent,n({buffer:a,width:t.width,height:t.height}),e.next=8;break;case 7:r(new o_(Oy.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e,1)}))},OC=function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),NC=new(function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"_lastHiddenTime",0),kf(f(e),"_lastVisibleTime",0),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?e._lastHiddenTime=performance.now():e._lastVisibleTime=performance.now(),lS.debug("document visibility went ".concat(document.visibilityState)),e.emit("VISIBILITY_CHANGE",document.visibilityState)})),e}return d(n,[{key:"visibility",get:function(){return document.visibilityState}},{key:"lastHiddenTime",get:function(){return this._lastHiddenTime}},{key:"lastVisibleTime",get:function(){return this._lastVisibleTime}}]),n}(O_));function xC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function DC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var PC=function(){function e(t){var n=this;l(this,e),kf(this,"trackId",void 0),kf(this,"config",void 0),kf(this,"onFirstVideoFrameDecoded",void 0),kf(this,"freezeTimeCounterList",[]),kf(this,"renderFreezeAccTime",0),kf(this,"isKeepLastFrame",!1),kf(this,"timeUpdatedCount",0),kf(this,"freezeTime",0),kf(this,"playbackTime",0),kf(this,"lastTimeUpdatedTime",0),kf(this,"autoplayFailed",!1),kf(this,"videoTrack",void 0),kf(this,"videoElement",void 0),kf(this,"cacheVideoElement",void 0),kf(this,"videoElementCheckInterval",void 0),kf(this,"_videoElementStatus",uI.NONE),kf(this,"isGettingVideoDimensions",!1),kf(this,"startGetVideoDimensions",(function(){var e=function e(){if(n.isGettingVideoDimensions=!0,n.videoElement.videoWidth*n.videoElement.videoHeight>4)return lS.debug("[".concat(n.trackId,"] current video dimensions:"),n.videoElement.videoWidth,n.videoElement.videoHeight),void(n.isGettingVideoDimensions=!1);setTimeout(e,500)};!n.isGettingVideoDimensions&&e()})),kf(this,"autoResumeAfterInterruption",(function(){n.videoTrack&&"live"===n.videoTrack.readyState&&"running"===wI.curState&&(lS.debug("[track-".concat(n.trackId,"] video element paused, auto resume for ").concat(My())),Xy()?(n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):(n.videoElement.pause(),n.videoElement.play()))})),kf(this,"handleVideoEvents",(function(e){switch(e.type){case"play":case"playing":n.startGetVideoDimensions(),n.videoElementStatus=uI.PLAYING;break;case"loadeddata":if(n.onFirstVideoFrameDecoded&&n.onFirstVideoFrameDecoded(),n.cacheVideoElement){try{n.cacheVideoElement.srcObject=null,n.cacheVideoElement.remove()}catch(e){}n.cacheVideoElement=void 0}break;case"canplay":n.videoElementStatus=uI.CANPLAY;break;case"stalled":n.videoElementStatus=uI.STALLED;break;case"suspend":n.videoElementStatus=uI.SUSPEND;break;case"pause":n.videoElementStatus=uI.PAUSED,Zy()||Qy()||By()&&n.autoplayFailed||!n.videoTrack||"live"!==n.videoTrack.readyState||(lS.debug("[track-".concat(n.trackId,"] video element paused, auto resume")),n.videoElement.play());break;case"waiting":n.videoElementStatus=uI.WAITING;break;case"abort":n.videoElementStatus=uI.ABORT;break;case"ended":n.videoElementStatus=uI.ENDED;break;case"emptied":n.videoElementStatus=uI.EMPTIED;break;case"error":n.videoElementStatus=uI.ERROR;var t=n.videoElement.error;t&&lS.error("[".concat(n.trackId,"] media error, code: ").concat(t.code,", message: ").concat(t.message));break;case"timeupdate":var r=performance.now();if(n.timeUpdatedCount+=1,n.timeUpdatedCount<10)return void(n.lastTimeUpdatedTime=r);var i=r-n.lastTimeUpdatedTime,a=n.lastTimeUpdatedTime;if(n.lastTimeUpdatedTime=r,NC.lastVisibleTime<NC.lastHiddenTime||a<NC.lastHiddenTime||a<NC.lastVisibleTime)return;for(i>$w("VIDEO_FREEZE_DURATION")&&(n.freezeTime+=i),n.playbackTime+=i;n.playbackTime>=6e3;){n.playbackTime-=6e3;var o=Math.min(6e3,n.freezeTime);n.freezeTimeCounterList.push(o),n.freezeTime=Math.max(0,n.freezeTime-6e3)}}})),kf(this,"autoResumeAfterInterruptionOnIOS15_16",(function(){n.videoTrack&&"live"===n.videoTrack.readyState&&(lS.debug("[track-".concat(n.trackId,"] video element paused, auto resume for ").concat(My())),Xy()?(n.videoElement.srcObject=null,n.videoElement.srcObject=new MediaStream([n.videoTrack]),n.videoElement.play()):(n.videoElement.pause(),n.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),wI.on(AT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wI.on(AT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}return d(e,[{key:"videoElementStatus",get:function(){return this._videoElementStatus},set:function(e){e!==this._videoElementStatus&&(lS.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}},{key:"getVideoElement",value:function(){return this.videoElement}},{key:"getContainerElement",value:function(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}},{key:"updateConfig",value:function(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}},{key:"updateVideoTrack",value:function(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}},{key:"play",value:function(e){var t=this,n=this.videoElement.play();n&&n.catch&&n.catch((function(n){e&&nC(e,"video",n.message,t.trackId),"NotAllowedError"===n.name?(lS.warning("detected video element autoplay failed",n),t.autoplayFailed=!0,t.handleAutoPlayFailed()):lS.warning("[".concat(t.trackId,"] play warning: "),n)}));var r=Py();if(("Safari"===r.name&&15===Number(r.version)||Yy())&&n&&n.then){var i=function(){t.config.mirror&&(t.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}},{key:"getCurrentFrame",value:function(){var e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");if(!t)return lS.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);var n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}},{key:"getCurrentFrameToUint8Array",value:function(){var e=c(s().mark((function e(t){var n,r,i,a=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:1,(r=document.createElement("canvas")).width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight,!(i=r.getContext("2d"))){e.next=8;break}e.t0=(i.drawImage(this.videoElement,0,0,r.width,r.height),new by((function(e,i){r.toBlob(function(){var t=c(s().mark((function t(n){var a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.remove(),!n){t.next=7;break}return t.next=3,OC(n);case 3:a=t.sent,e({buffer:a,width:r.width,height:r.height}),t.next=8;break;case 7:i(new o_(Oy.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t,n<0?.1:n>1?1:n)}))),e.next=11;break;case 8:return e.next=10,AC(t);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){wI.off(AT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wI.off(AT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}},{key:"initVideoElement",value:function(){var e=this;if(this.videoElementStatus=uI.INIT,!this.videoElementCheckInterval&&(LC.forEach((function(t){e.videoElement.addEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((function(){(function(e){return e!==document.body&&document.body.contains(e)})(e.videoElement)||(e.videoElementStatus=uI.DESTROYED)}),1e3),$w("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n,r,i=function t(n,i){if(e.videoElementStatus===uI.PLAYING){if(r){var a=i.presentationTime-r.presentationTime;a>$w("VIDEO_FREEZE_DURATION")&&NC.lastVisibleTime>=NC.lastHiddenTime&&r.timestamp>NC.lastVisibleTime&&r.timestamp>NC.lastHiddenTime&&(e.renderFreezeAccTime+=a)}r=DC(DC({},i),{},{timestamp:n})}var o,s;$w("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(o=(s=e.videoElement).requestVideoFrameCallback)||void 0===o||o.call(s,t))};null===(t=(n=this.videoElement).requestVideoFrameCallback)||void 0===t||t.call(n,i)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),n_()&&(this.videoElement.poster="noposter");var a=Py();"Safari"===a.name&&15===Number(a.version)||Yy()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gy()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gy()&&this.videoElement.load());var o=this.videoElement.play();void 0!==o&&o.catch((function(t){lS.debug("[".concat(e.trackId,"] playback interrupted"),t.toString())}))}},{key:"resetVideoElement",value:function(){var e=this;LC.forEach((function(t){e.videoElement&&e.videoElement.removeEventListener(t,e.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=uI.NONE}},{key:"handleAutoPlayFailed",value:function(){var e=this,t=function t(n){n.preventDefault(),e.videoElement.play().then((function(){lS.debug("[".concat(e.trackId,"] Video element for trackId:").concat(e.trackId," autoplay resumed."))})).catch((function(e){lS.error(e)})),e.autoplayFailed=!1,r_()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};r_()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),$I()}}]),e}(),LC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],MC=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this,e),kf(f(r),"container",void 0),kf(f(r),"slot",void 0),r.slot=e.element,r.updateConfig(e),r}return d(n,[{key:"updateConfig",value:function(e){this.config=e,this.trackId=e.trackId;var t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}},{key:"updateVideoTrack",value:function(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}},{key:"play",value:function(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&i(a(n.prototype),"play",this).call(this,e)}},{key:"getCurrentFrame",value:function(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?i(a(n.prototype),"getCurrentFrame",this).call(this):new ImageData(2,2)}},{key:"getCurrentFrameToUint8Array",value:function(){var e=c(s().mark((function e(t){var r,o,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=c.length>1&&void 0!==c[1]?c[1]:1,null===(r=this.container)||void 0===r||!r.contains(this.videoElement)){e.next=7;break}return e.next=4,i(a(n.prototype),"getCurrentFrameToUint8Array",this).call(this,t,o);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,AC(t);case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){if(i(a(n.prototype),"destroy",this).call(this),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(b){}this.container=void 0}}},{key:"createElements",value:function(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$w("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}},{key:"mountedVideoElement",value:function(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),i(a(n.prototype),"initVideoElement",this).call(this),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}},{key:"unmountedVideoElement",value:function(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){i(a(n.prototype),"resetVideoElement",this).call(this);try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}},{key:"resetVideoElement",value:function(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(i(a(n.prototype),"resetVideoElement",this).call(this),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}},{key:"getContainerElement",value:function(){return this.container}}]),n}(PC);function UC(e){return new by((function(t,n){var r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);var a=Zy()?"canplay":"playing";i.addEventListener(a,(function(){var e=i.videoWidth,n=i.videoHeight;!e&&Gy()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(aE),setTimeout((function(){r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}var jC=function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(function(e){var t="0123456789abcdef";function n(e){var n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,o)),a),n)}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}var u,l,d,f,p,h=function(e){var t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),v=1732584193,m=-271733879,g=-1732584194,y=271733878;for(u=0;u<h.length;u+=16)l=v,d=m,f=g,p=y,v=a(v,m,g,y,h[u+0],7,-680876936),y=a(y,v,m,g,h[u+1],12,-389564586),g=a(g,y,v,m,h[u+2],17,606105819),m=a(m,g,y,v,h[u+3],22,-1044525330),v=a(v,m,g,y,h[u+4],7,-176418897),y=a(y,v,m,g,h[u+5],12,1200080426),g=a(g,y,v,m,h[u+6],17,-1473231341),m=a(m,g,y,v,h[u+7],22,-45705983),v=a(v,m,g,y,h[u+8],7,1770035416),y=a(y,v,m,g,h[u+9],12,-1958414417),g=a(g,y,v,m,h[u+10],17,-42063),m=a(m,g,y,v,h[u+11],22,-1990404162),v=a(v,m,g,y,h[u+12],7,1804603682),y=a(y,v,m,g,h[u+13],12,-40341101),g=a(g,y,v,m,h[u+14],17,-1502002290),v=o(v,m=a(m,g,y,v,h[u+15],22,1236535329),g,y,h[u+1],5,-165796510),y=o(y,v,m,g,h[u+6],9,-1069501632),g=o(g,y,v,m,h[u+11],14,643717713),m=o(m,g,y,v,h[u+0],20,-373897302),v=o(v,m,g,y,h[u+5],5,-701558691),y=o(y,v,m,g,h[u+10],9,38016083),g=o(g,y,v,m,h[u+15],14,-660478335),m=o(m,g,y,v,h[u+4],20,-405537848),v=o(v,m,g,y,h[u+9],5,568446438),y=o(y,v,m,g,h[u+14],9,-1019803690),g=o(g,y,v,m,h[u+3],14,-187363961),m=o(m,g,y,v,h[u+8],20,1163531501),v=o(v,m,g,y,h[u+13],5,-1444681467),y=o(y,v,m,g,h[u+2],9,-51403784),g=o(g,y,v,m,h[u+7],14,1735328473),v=s(v,m=o(m,g,y,v,h[u+12],20,-1926607734),g,y,h[u+5],4,-378558),y=s(y,v,m,g,h[u+8],11,-2022574463),g=s(g,y,v,m,h[u+11],16,1839030562),m=s(m,g,y,v,h[u+14],23,-35309556),v=s(v,m,g,y,h[u+1],4,-1530992060),y=s(y,v,m,g,h[u+4],11,1272893353),g=s(g,y,v,m,h[u+7],16,-155497632),m=s(m,g,y,v,h[u+10],23,-1094730640),v=s(v,m,g,y,h[u+13],4,681279174),y=s(y,v,m,g,h[u+0],11,-358537222),g=s(g,y,v,m,h[u+3],16,-722521979),m=s(m,g,y,v,h[u+6],23,76029189),v=s(v,m,g,y,h[u+9],4,-640364487),y=s(y,v,m,g,h[u+12],11,-421815835),g=s(g,y,v,m,h[u+15],16,530742520),v=c(v,m=s(m,g,y,v,h[u+2],23,-995338651),g,y,h[u+0],6,-198630844),y=c(y,v,m,g,h[u+7],10,1126891415),g=c(g,y,v,m,h[u+14],15,-1416354905),m=c(m,g,y,v,h[u+5],21,-57434055),v=c(v,m,g,y,h[u+12],6,1700485571),y=c(y,v,m,g,h[u+3],10,-1894986606),g=c(g,y,v,m,h[u+10],15,-1051523),m=c(m,g,y,v,h[u+1],21,-2054922799),v=c(v,m,g,y,h[u+8],6,1873313359),y=c(y,v,m,g,h[u+15],10,-30611744),g=c(g,y,v,m,h[u+6],15,-1560198380),m=c(m,g,y,v,h[u+13],21,1309151649),v=c(v,m,g,y,h[u+4],6,-145523070),y=c(y,v,m,g,h[u+11],10,-1120210379),g=c(g,y,v,m,h[u+2],15,718787259),m=c(m,g,y,v,h[u+9],21,-343485551),v=r(v,l),m=r(m,d),g=r(g,f),y=r(y,p);return n(v)+n(m)+n(g)+n(y)}(""+n+r)).slice(0,16),a=i.slice(0,12),e.next=4,window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);case 4:return o=e.sent,e.t0=Uint8Array,e.next=8,window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,t);case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),FC=function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jC(t.buffer,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function VC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function BC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var GC=function(e){p(n,e);var t=h(n);function n(e,i,a,o,s,c){var u;if(l(this,n),u=t.call(this,e,s),kf(f(u),"trackMediaType","video"),kf(f(u),"_player",void 0),kf(f(u),"_videoVisibleTimer",null),kf(f(u),"_previousVideoVisibleStatus",void 0),kf(f(u),"_clearPreviousVideoVisibleStatus",(function(){return u._previousVideoVisibleStatus=void 0})),kf(f(u),"_encoderConfig",void 0),kf(f(u),"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),kf(f(u),"_optimizationMode",void 0),kf(f(u),"_videoHeight",void 0),kf(f(u),"_videoWidth",void 0),kf(f(u),"_forceBitrateLimit",void 0),kf(f(u),"_enabled",!0),kf(f(u),"processorDestination",void 0),kf(f(u),"_processorContext",void 0),By()){var d=e.getSettings(),p=d.width,h=d.height;u._videoWidth=p,u._videoHeight=h}else u.updateMediaStreamTrackResolution();if(u._encoderConfig=i,u._scalabilityMode=a,u._optimizationMode=o,u._hints=c||[],-1===u._hints.indexOf(zT.SCREEN_TRACK))u.updateBitrateFromProfile();else if(function(e,t,n){var r=Py();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}(Ty.CHROME,115)&&-1!==Ly().indexOf("Windows")){var v=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&OI().supportWebRTCInsertableStream){var n,r,i=new MediaStreamTrackProcessor(e),a=new MediaStreamTrackGenerator({kind:"video"}),o=Date.now(),s=function t(){c&&(clearInterval(c),c=void 0),n&&(n.close(),n=void 0),e.stop(),r=void 0,a.removeEventListener("ended",t)},c=window.setInterval((function(){if(r&&n&&Date.now()-o>(null!=t?t:1e3))try{"live"===a.readyState?r.enqueue(n.clone()):s()}catch(e){s()}}),null!=t?t:1e3),u=new TransformStream({transform:function(e,t){"live"===a.readyState?(r=t,o=Date.now(),void 0===n?(n=e,t.enqueue(e.clone())):(t.enqueue(n),n=e)):e.close()}});return a.addEventListener("ended",s),i.readable.pipeThrough(u).pipeTo(a.writable),a}}(e);v&&(lS.info("local screen video track begin to inject frame"),u._mediaStreamTrack=v)}return i&&-1!==u._hints.indexOf(zT.CUSTOM_TRACK)&&u.setEncoderConfiguration(i),u.processorContext=new uC(u.getTrackId(),"local"),u.processorDestination=new cC(u.processorContext),u.bindProcessorDestinationEvents(),r(u)}return d(n,[{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==uI.PLAYING)}},{key:"processorContext",get:function(){return this._processorContext},set:function(e){this._processorContext=e}},{key:"__className__",get:function(){return"LocalVideoTrack"}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(lS.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}lS.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=BC(BC(BC({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new PC(i):this._player=new MC(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var n=t.getVideoElementVisibleStatus();t.safeEmit($T.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch(e){}}),$w("CHECK_VIDEO_VISIBLE_INTERVAL"))}},{key:"stop",value:function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,lS.debug("[".concat(this.getTrackId(),"] stop video playback")))}},{key:"setEnabled",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(lS.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){e.next=15;break}return this._originMediaStreamTrack.enabled=!1,e.prev=6,e.next=9,j_(this,KT.NEED_DISABLE_TRACK,this);case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(6),lS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t0.toString()),e.t0;case 14:return e.abrupt("return",(n||(this._enabled=!1),void lS.info("[".concat(this.getTrackId(),"] setEnabled to false success"))));case 15:return this._originMediaStreamTrack.enabled=!0,e.prev=16,e.next=19,j_(this,KT.NEED_ENABLE_TRACK,this);case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(16),lS.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.t1.toString()),e.t1;case 24:lS.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0);case 25:case"end":return e.stop()}}),e,this,[[6,11],[16,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setMuted",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==this._muted,!e.t0){e.next=13;break}if(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,lS.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),!t){e.next=11;break}return e.next=9,j_(this,KT.NEED_MUTE_TRACK,this);case 9:e.next=13;break;case 11:return e.next=13,j_(this,KT.NEED_UNMUTE_TRACK,this);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEncoderConfiguration",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new o_(Oy.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:if(t=GT(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),!(t.width||t.height||t.frameRate)){e.next=15;break}return r=SC({encoderConfig:t}),(By()||Zy()||Qy())&&(r.deviceId=void 0),lS.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r)),e.prev=5,e.next=8,this._originMediaStreamTrack.applyConstraints(r);case 8:this.updateMediaStreamTrackResolution(),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),i=new o_(Oy.UNEXPECTED_ERROR,e.t0.toString()),lS.error("[".concat(this.getTrackId(),"] applyConstraints error"),i.toString()),i;case 15:return this._encoderConfig=t,-1===this._hints.indexOf(zT.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=16,e.next=19,j_(this,KT.NEED_UPDATE_VIDEO_ENCODER,this);case 19:e.next=24;break;case 21:return e.prev=21,e.t1=e.catch(16),e.abrupt("return",e.t1.throw(lS));case 24:case"end":return e.stop()}}),e,this,[[5,11],[16,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getStats",value:function(){return J_((function(){lS.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),F_(this,KT.GET_STATS)||BC({},dI)}},{key:"setBeautyEffect",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:lS.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCurrentFrameData",value:function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}},{key:"getCurrentFrameImage",value:function(){var e=c(s().mark((function e(t){var n,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:1,!this._player){e.next=5;break}e.t0=this._player.getCurrentFrameToUint8Array(t,n),e.next=8;break;case 5:return e.next=7,AC(t);case 7:e.t0=e.sent;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setBitrateLimit",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),!t){e.next=10;break}return this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate),e.prev=2,e.next=5,j_(this,KT.NEED_UPDATE_VIDEO_ENCODER,this);case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",e.t0.throw(lS));case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setOptimizationMode",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("motion"===t||"detail"===t||"balanced"===t){e.next=2;break}return e.abrupt("return",void lS.error(Oy.INVALID_PARAMS,"optimization mode must be motion, detail or balanced"));case 2:return n=this._optimizationMode,e.prev=3,this._optimizationMode=t,e.next=7,j_(this,KT.SET_OPTIMIZATION_MODE,this);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._optimizationMode=n,lS.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.t0.toString()),e.t0;case 12:lS.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"));case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setScalabiltyMode",value:function(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return lS.error(Oy.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,lS.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}},{key:"updateMediaStreamTrackResolution",value:function(){var e=this;UC(this._originMediaStreamTrack).then((function(t){var n=u(t,2),r=n[0],i=n[1];e._videoHeight=i,e._videoWidth=r})).catch(aE)}},{key:"_updatePlayerSource",value:function(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}},{key:"_getDefaultPlayerConfig",value:function(){return{fit:"contain"}}},{key:"updateBitrateFromProfile",value:function(){if(this._encoderConfig){var e=this.getMediaStreamTrackSettings(),t=e.width,n=e.height,r=e.frameRate;if(t&&n&&r){var i=function(e,t,n,r){var i,a=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75),o=a;if("STANDARD_BITRATE"===r)i=4*a;else{if("COMPATIABLE_BITRATE"!==r)return;i=2*a}return[Math.floor(i),Math.floor(o)]}(t,n,r,$w("BITRATE_ADAPTER_TYPE"))||[void 0,void 0],a=u(i,2),o=a[0],s=a[1];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=s,this._encoderConfig.bitrateMax=o,lS.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(s,"]")))}}}},{key:"getVideoElementVisibleStatus",value:function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,a=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){var o=g_.checkOneElementVisible(i),s=Object.assign({},o);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(e){throw new o_(Oy.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}},{key:"renewMediaStreamTrack",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"pipe",value:function(e){if(this.processor===e)return e;if(e._source)throw new o_(Oy.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}},{key:"unpipe",value:function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}}},{key:"close",value:function(){i(a(n.prototype),"close",this).call(this),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}},{key:"clone",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;e&&(r=BC(BC({},r),GT(e))),r=z_(r);var i=rE(8,"track-video-cloned-"),a=new n(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,z_(this._scalabilityMode),this._optimizationMode,i,z_(this._hints));return e&&r&&a.setEncoderConfiguration(r),lS.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(t)),a}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof MediaStreamTrack){e.next=2;break}throw new o_(Oy.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");case 2:if("video"===t.kind){e.next=4;break}throw new o_(Oy.INVALID_PARAMS,"track should be a video MediaStreamTrack");case 4:return e.next=6,this._updateOriginMediaStreamTrack(t,n,!0);case 6:this.updateMediaStreamTrackResolution();case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(aI.ON_TRACK,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}if(t.t0=n!==e._mediaStreamTrack,!t.t0){t.next=7;break}return e._mediaStreamTrack=n,e._updatePlayerSource(),t.next=7,j_(e,KT.NEED_REPLACE_TRACK,e);case 7:t.next=15;break;case 9:if(t.t1=e._mediaStreamTrack!==e._originMediaStreamTrack,!t.t1){t.next=15;break}return e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource(),t.next=15,j_(e,KT.NEED_REPLACE_TRACK,e);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(aI.ON_TRACK)}},{key:"unbindProcessorContextEvents",value:function(){this.processorContext.removeAllListeners(oI.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(oI.REQUEST_CONSTRAINTS)}}]),n}(yI);QS([ES({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Object,Object]),$S("design:returntype",void 0)],GC.prototype,"play",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],GC.prototype,"stop",null),QS([pE("LocalVideoTrack","_enabledMutex"),ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Boolean]),$S("design:returntype",by)],GC.prototype,"setEnabled",null),QS([pE("LocalVideoTrack","_enabledMutex"),ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean]),$S("design:returntype",by)],GC.prototype,"setMuted",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Object,Boolean]),$S("design:returntype",by)],GC.prototype,"setEncoderConfiguration",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",Object)],GC.prototype,"getStats",null),QS([ES({argsMap:function(e,t,n){return[e.getTrackId(),t,n]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Object]),$S("design:returntype",by)],GC.prototype,"setBeautyEffect",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",ImageData)],GC.prototype,"getCurrentFrameData",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[String,Number]),$S("design:returntype",by)],GC.prototype,"getCurrentFrameImage",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],GC.prototype,"setBitrateLimit",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],GC.prototype,"setOptimizationMode",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",void 0)],GC.prototype,"setScalabiltyMode",null),QS([aC(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],GC.prototype,"updateMediaStreamTrackResolution",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",Object)],GC.prototype,"pipe",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],GC.prototype,"unpipe",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],GC.prototype,"close",null),QS([ES({argsMap:function(e,t,n){return[e.getTrackId(),t.label,n]}}),$S("design:type",Function),$S("design:paramtypes",[MediaStreamTrack,Boolean]),$S("design:returntype",by)],GC.prototype,"replaceTrack",null);var ZC=function(e){p(n,e);var t=h(n);function n(e,r,i,a,o,u){var d;return l(this,n),d=t.call(this,e,GT(r.encoderConfig),a,o,u),kf(f(d),"_config",void 0),kf(f(d),"_originalConstraints",void 0),kf(f(d),"_constraints",void 0),kf(f(d),"_enabled",!0),kf(f(d),"_deviceName","default"),kf(f(d),"tryResumeVideoForIOS15_16WeChat",c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(Yy()||Jy())&&!function(){var e=Py();if(e.os!==ky.IOS||!e.osVersion)return!1;var t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&$y()&&d._enabled&&!d._isClosed,!e.t0){e.next=5;break}return lS.debug("[".concat(d.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),e.next=5,d.renewMediaStreamTrack();case 5:case"end":return e.stop()}}),e)})))),d._config=r,d._originalConstraints=i,d._constraints=i,d._deviceName=e.label,d._encoderConfig=GT(d._config.encoderConfig),wI.on(AT.IOS_15_16_INTERRUPTION_END,d.tryResumeVideoForIOS15_16WeChat),wI.on(AT.IOS_INTERRUPTION_END,d.tryResumeVideoForIOS15_16WeChat),d.bindProcessorContextEvents(),d}return d(n,[{key:"__className__",get:function(){return"CameraVideoTrack"}},{key:"setDevice",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","string"==typeof t?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setDeviceById",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),!this._enabled){e.next=36;break}return e.prev=1,e.next=4,JI.getDeviceById(t);case 4:return n=e.sent,(r={}).video=BC({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop(),i=null,e.prev=8,e.next=11,qI(r,this.getTrackId());case 11:i=e.sent,e.next=23;break;case 14:return e.prev=14,e.t0=e.catch(8),lS.error("[".concat(this.getTrackId(),"] setDevice failed"),e.t0.toString()),e.next=19,qI({video:this._constraints},this.getTrackId());case 19:return i=e.sent,e.next=22,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 22:throw e.t0;case 23:return e.next=25,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1);case 25:this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(1),lS.error("[".concat(this.getTrackId(),"] setDevice error"),e.t1.toString()),e.t1;case 34:e.next=46;break;case 36:return e.prev=36,e.next=39,JI.getDeviceById(t);case 39:a=e.sent,this._deviceName=a.label,this._config.cameraId=t,this._constraints.deviceId={exact:t},e.next=46;break;case 43:throw e.prev=43,e.t2=e.catch(36),lS.error("[".concat(this.getTrackId(),"] setDevice error"),e.t2.toString()),e.t2;case 46:lS.info("[".concat(this.getTrackId(),"] setDevice success"));case 47:case"end":return e.stop()}}),e,this,[[1,31],[8,14],[36,43]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setDeviceByFacingModel",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t)),n={video:BC(BC({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})},!this._enabled){e.next=23;break}return this._originMediaStreamTrack.stop(),r=null,e.prev=5,e.next=8,qI(n,this.getTrackId());case 8:r=e.sent,e.next=20;break;case 11:return e.prev=11,e.t0=e.catch(5),lS.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),e.t0.toString()),e.next=16,qI({video:this._constraints},this.getTrackId());case 16:return r=e.sent,e.next=19,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 19:throw e.t0;case 20:return e.next=22,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 22:this.updateMediaStreamTrackResolution();case 23:this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=BC({},n.video),lS.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"));case 24:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}if(t!==this._enabled){e.next=3;break}return e.abrupt("return");case 3:this.stateCheck("enabled",t);case 4:if(lS.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){e.next=25;break}if(e.prev=5,!this.isExternalTrack){e.next=10;break}this._originMediaStreamTrack.enabled=!0,e.next=15;break;case 10:return e.next=12,qI({video:this._constraints},this.getTrackId());case 12:return r=e.sent,e.next=15,this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1);case 15:return e.next=17,j_(this,KT.NEED_ENABLE_TRACK,this);case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(5),lS.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.t0.toString()),e.t0;case 22:this.updateMediaStreamTrackResolution(),lS.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0),e.next=35;break;case 25:return this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1),e.prev=26,e.next=29,j_(this,KT.NEED_DISABLE_TRACK,this);case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),lS.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.t1.toString()),e.t1;case 34:lS.info("[".concat(this.getTrackId(),"] setEnabled to false success"));case 35:case"end":return e.stop()}}),e,this,[[5,19],[26,31]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setEncoderConfiguration",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enabled){e.next=2;break}throw new o_(Oy.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");case 2:return t=GT(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),(r=K_(this._config)).encoderConfig=t,i=SC(r),(By()||Zy()||Qy())&&(i.deviceId=void 0),lS.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i)),e.prev=7,e.next=10,this._originMediaStreamTrack.applyConstraints(i);case 10:this.updateMediaStreamTrackResolution(),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),a=new o_(Oy.UNEXPECTED_ERROR,e.t0.toString()),lS.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a;case 17:return this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,-1===this._hints.indexOf(zT.SCREEN_TRACK)&&this.updateBitrateFromProfile(),e.prev=18,e.next=21,j_(this,KT.NEED_UPDATE_VIDEO_ENCODER,this);case 21:e.next=26;break;case 23:return e.prev=23,e.t1=e.catch(18),e.abrupt("return",e.t1.throw(lS));case 26:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_getDefaultPlayerConfig",value:function(){return{mirror:!0,fit:"cover"}}},{key:"onTrackEnded",value:function(){var e=this;if((Zy()||Qy())&&this._enabled&&!this._isClosed&&wI.duringInterruption){var t=function(){var n=c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(wI.off(AT.IOS_INTERRUPTION_END,t),n.t0=e._enabled&&!e._isClosed,!n.t0){n.next=8;break}return lS.debug("[".concat(e.getTrackId(),"] try capture camera media device for interrupted iOS device.")),n.next=6,e.setEnabled(!1);case 6:return n.next=8,e.setEnabled(!0);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();wI.on(AT.IOS_INTERRUPTION_END,t)}else lS.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($T.TRACK_ENDED)}},{key:"renewMediaStreamTrack",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t||this._constraints,(r=JI.searchDeviceIdByName(this._deviceName))&&!n.deviceId&&(n.deviceId={exact:r}),!this._enabled){e.next=9;break}return e.next=4,qI({video:n},this.getTrackId());case 4:return i=e.sent,this._constraints=n,e.next=8,this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0);case 8:this.updateMediaStreamTrackResolution();case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){i(a(n.prototype),"close",this).call(this),wI.off(AT.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wI.off(AT.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}},{key:"clone",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;e&&(r=BC(BC({},r),GT(e))),r=z_(r);var i=rE(8,"track-cam-cloned-"),a=new n(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,z_(BC(BC({},this._config),{},{encoderConfig:r})),z_(this._constraints),z_(this._scalabilityMode),this._optimizationMode,i);return e&&r&&a.setEncoderConfiguration(r),lS.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(t)),a}},{key:"bindProcessorContextEvents",value:function(){var e=this;this.processorContext.on(oI.REQUEST_UPDATE_CONSTRAINTS,function(){var t=c(s().mark((function t(n,r,i){var a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=Object.assign.apply(Object,[{},e._originalConstraints].concat(m(n))),t.next=4,e.renewMediaStreamTrack(a);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this.processorContext.on(oI.REQUEST_CONSTRAINTS,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e._originMediaStreamTrack.getSettings());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),n}(GC);function qC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function WC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function HC(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=WC(WC({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?lS.debug("[".concat(e,"] set content hint to"),n.optimizationMode):lS.debug("[".concat(e,"] set content hint failed")))):lS.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}function KC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KC(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],ZC.prototype,"setDevice",null),QS([pE("CameraVideoTrack","_enabledMutex"),ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Boolean]),$S("design:returntype",by)],ZC.prototype,"setEnabled",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),aC(),$S("design:type",Function),$S("design:paramtypes",[Object,Boolean]),$S("design:returntype",by)],ZC.prototype,"setEncoderConfiguration",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],ZC.prototype,"close",null);var YC=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this,e,"track-".concat(e.kind,"-").concat(r,"-").concat(a.clientId,"_").concat(rE(5,""))),kf(f(o),"_userId",void 0),kf(f(o),"_uintId",void 0),kf(f(o),"_isDestroyed",!1),kf(f(o),"store",void 0),kf(f(o),"processor",void 0),o._userId=r,o._uintId=i,o.store=a,o}return d(n,[{key:"getUserId",value:function(){return this._userId}},{key:"_updateOriginMediaStreamTrack",value:function(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}},{key:"_destroy",value:function(){this._isDestroyed=!0,lS.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),i(a(n.prototype),"close",this).call(this)}},{key:"getProcessorStats",value:function(){return this.processorContext.gatherStats()}},{key:"getProcessorUsage",value:function(){return this.processorContext.gatherUsage()}}]),n}(gI),JC=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this,e,r,i,a),kf(f(o),"_videoVisibleTimer",null),kf(f(o),"_previousVideoVisibleStatus",void 0),kf(f(o),"_clearPreviousVideoVisibleStatus",(function(){return o._previousVideoVisibleStatus=void 0})),kf(f(o),"trackMediaType","video"),kf(f(o),"_videoWidth",void 0),kf(f(o),"_videoHeight",void 0),kf(f(o),"_player",void 0),kf(f(o),"processorDestination",void 0),kf(f(o),"processorContext",void 0),o.updateMediaStreamTrackResolution(),o.processorContext=new uC(o.getTrackId(),"remote"),o.processorDestination=new cC(o.processorContext),o.bindProcessorDestinationEvents(),o}return d(n,[{key:"isPlaying",get:function(){return!(!this._player||this._player.videoElementStatus!==uI.PLAYING)}},{key:"__className__",get:function(){return"RemoteVideoTrack"}},{key:"getStats",value:function(){return J_((function(){lS.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),F_(this,KT.GET_STATS)||zC({},hI)}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){var r=document.getElementById(e);r?e=r:(lS.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}lS.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));var i=zC(zC({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new PC(i):this._player=new MC(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=function(){t.store.subscribe(t.getUserId(),"video",void 0,void 0,Date.now()),t.safeEmit(eI.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((function(){try{var n=t.getVideoElementVisibleStatus();t.safeEmit(eI.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch(e){}}),$w("CHECK_VIDEO_VISIBLE_INTERVAL"))}},{key:"stop",value:function(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,lS.debug("[".concat(this.getTrackId(),"] stop video playback")))}},{key:"getCurrentFrameData",value:function(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}},{key:"updateMediaStreamTrackResolution",value:function(){var e=this;UC(this._originMediaStreamTrack).then((function(t){var n=u(t,2),r=n[0],i=n[1];e._videoHeight=i,e._videoWidth=r})).catch(aE)}},{key:"_updatePlayerSource",value:function(){lS.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}},{key:"getVideoElementVisibleStatus",value:function(){try{var e,t,n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},i=r.element,a=r.slot;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){var o=g_.checkOneElementVisible(i),s=Object.assign({},o);if(s.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=s.visible;var c=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});s.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(s.reason))}return s}return}catch(e){throw new o_(Oy.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}},{key:"pipe",value:function(e){if(this.processor===e)return e;if(e._source)throw new o_(Oy.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}},{key:"unpipe",value:function(){if(this.processor){var e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(aI.ON_TRACK,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource()):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(aI.ON_TRACK)}},{key:"_destroy",value:function(){i(a(n.prototype),"_destroy",this).call(this),this.unbindProcessorDestinationEvents()}}]),n}(YC);QS([ES({argsMap:function(e,t,n){return[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}}),$S("design:type",Function),$S("design:paramtypes",[Object,Object]),$S("design:returntype",void 0)],JC.prototype,"play",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],JC.prototype,"stop",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",Object)],JC.prototype,"pipe",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],JC.prototype,"unpipe",null);var XC=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this,e,r,i,a),kf(f(o),"trackMediaType","audio"),kf(f(o),"_source",void 0),kf(f(o),"_useAudioElement",!0),kf(f(o),"_volume",100),kf(f(o),"processorContext",void 0),kf(f(o),"processorDestination",void 0),kf(f(o),"_played",!1),kf(f(o),"_bypassWebAudio",!1),$w("DISABLE_WEBAUDIO")?(o._source=new fC,o._bypassWebAudio=!0,o._useAudioElement=!0):(o._source=new DI(e,!0),$w("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(o._useAudioElement=!1)),o._source.once(tI.RECEIVE_TRACK_BUFFER,(function(){o.safeEmit(eI.FIRST_FRAME_DECODED)})),o.processorContext=new dC(o._source.context,o.getTrackId(),"remote"),o.processorDestination=new lC(o.processorContext),o.bindProcessorDestinationEvents(),o._source.on(tI.UPDATE_SOURCE,(function(){o.processor&&o.processor.updateInput({node:o._source.processSourceNode,context:o.processorContext})})),o}return d(n,[{key:"isPlaying",get:function(){return this._useAudioElement?iC.isPlaying(this.getTrackId()):this._source.isPlayed}},{key:"__className__",get:function(){return"RemoteAudioTrack"}},{key:"setAudioFrameCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tI.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tI.ON_AUDIO_BUFFER),this._source.on(tI.ON_AUDIO_BUFFER,(function(t){return e(t)}))}},{key:"setVolume",value:function(e){this._volume=e,this._useAudioElement?iC.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}},{key:"setPlaybackDevice",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._useAudioElement){e.next=2;break}throw new o_(Oy.NOT_SUPPORTED,"your browser does not support setting the audio output device");case 2:return e.next=4,iC.setSinkID(this.getTrackId(),t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getVolumeLevel",value:function(){return this._source.getAccurateVolumeLevel()}},{key:"getStats",value:function(){return J_((function(){lS.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),F_(this,KT.GET_STATS)||zC({},fI)}},{key:"play",value:function(){lS.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(lS.debug("[".concat(this.getTrackId(),"] use audio element to play")),iC.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}},{key:"stop",value:function(){lS.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?iC.stop(this.getTrackId()):this._source.stop()}},{key:"_destroy",value:function(){i(a(n.prototype),"_destroy",this).call(this),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}},{key:"_isFreeze",value:function(){return this._source.isFreeze}},{key:"_updatePlayerSource",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lS.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&iC.updateTrack(this.getTrackId(),this._mediaStreamTrack)}},{key:"pipe",value:function(e){if(this._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new o_(Oy.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}},{key:"unpipe",value:function(){var e;if(this._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(this.processor){var t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}}},{key:"bindProcessorDestinationEvents",value:function(){var e=this;this.processorDestination.on(aI.ON_TRACK,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n)):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.processorDestination.on(aI.ON_NODE,(function(t){e._source.processedNode=t;var n=!t;e._useAudioElement!==n&&(e._played?(e.stop(),e._useAudioElement=n,e.play()):e._useAudioElement=n)}))}},{key:"unbindProcessorDestinationEvents",value:function(){this.processorDestination.removeAllListeners(aI.ON_TRACK),this.processorDestination.removeAllListeners(aI.ON_NODE)}}]),n}(YC);function QC(e){for(var t=e.length;--t>=0;)e[t]=0}QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]},throttleTime:300}),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",void 0)],XC.prototype,"setVolume",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t]}}),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],XC.prototype,"setPlaybackDevice",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],XC.prototype,"play",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],XC.prototype,"stop",null),QS([ES({argsMap:function(e,t){return[e.getTrackId(),t.name]}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",Object)],XC.prototype,"pipe",null),QS([ES({argsMap:function(e){return[e.getTrackId()]}}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],XC.prototype,"unpipe",null);var $C=256,eR=286,tR=30,nR=15,rR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),iR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),aR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),oR=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sR=new Array(576);QC(sR);var cR=new Array(60);QC(cR);var uR=new Array(512);QC(uR);var lR=new Array(256);QC(lR);var dR=new Array(29);QC(dR);var fR,pR,hR,vR=new Array(tR);function mR(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function gR(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}QC(vR);var yR=function(e){return e<256?uR[e]:uR[256+(e>>>7)]},_R=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ER=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,_R(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},bR=function(e,t,n){ER(e,n[2*t],n[2*t+1])},wR=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},SR=function(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=nR;r++)o=o+n[r-1]<<1,a[r]=o;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=wR(a[s]++,s))}},kR=function(e){var t;for(t=0;t<eR;t++)e.dyn_ltree[2*t]=0;for(t=0;t<tR;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},TR=function(e){e.bi_valid>8?_R(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},IR=function(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},CR=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&IR(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!IR(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},RR=function(e,t,n){var r,i,a,o,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?bR(e,i,t):(a=lR[i],bR(e,a+$C+1,t),0!==(o=rR[a])&&(i-=dR[a],ER(e,i,o)),r--,a=yR(r),bR(e,a,n),0!==(o=iR[a])&&(r-=vR[a],ER(e,r,o)))}while(s<e.sym_next);bR(e,256,t)},AR=function(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)CR(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],CR(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,CR(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,h=t.stat_desc.max_length,v=0;for(a=0;a<=nR;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=c[2*c[2*(r=e.heap[n])+1]+1]+1)>h&&(a=h,v++),c[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=p&&(o=f[r-p]),s=c[2*r],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(l[2*r+1]+o)));if(0!==v){do{for(a=h-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[h]--,v-=2}while(v>0);for(a=h;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}}(e,t),SR(a,u,e.bl_count)},OR=function(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))},NR=function(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<u)do{bR(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(bR(e,i,e.bl_tree),s--),bR(e,16,e.bl_tree),ER(e,s-3,2)):s<=10?(bR(e,17,e.bl_tree),ER(e,s-3,3)):(bR(e,18,e.bl_tree),ER(e,s-11,7));s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}},xR=!1,DR=function(e,t,n,r){ER(e,0+(r?1:0),3),TR(e),_R(e,n),_R(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},PR=function(e){xR||(function(){var e,t,n,r,i,a=new Array(16);for(n=0,r=0;r<28;r++)for(dR[r]=n,e=0;e<1<<rR[r];e++)lR[n++]=r;for(lR[n-1]=r,i=0,r=0;r<16;r++)for(vR[r]=i,e=0;e<1<<iR[r];e++)uR[i++]=r;for(i>>=7;r<tR;r++)for(vR[r]=i<<7,e=0;e<1<<iR[r]-7;e++)uR[256+i++]=r;for(t=0;t<=nR;t++)a[t]=0;for(e=0;e<=143;)sR[2*e+1]=8,e++,a[8]++;for(;e<=255;)sR[2*e+1]=9,e++,a[9]++;for(;e<=279;)sR[2*e+1]=7,e++,a[7]++;for(;e<=287;)sR[2*e+1]=8,e++,a[8]++;for(SR(sR,287,a),e=0;e<tR;e++)cR[2*e+1]=5,cR[2*e]=wR(e,5);fR=new mR(sR,rR,257,eR,nR),pR=new mR(cR,iR,0,tR,nR),hR=new mR(new Array(0),aR,0,19,7)}(),xR=!0),e.l_desc=new gR(e.dyn_ltree,fR),e.d_desc=new gR(e.dyn_dtree,pR),e.bl_desc=new gR(e.bl_tree,hR),e.bi_buf=0,e.bi_valid=0,kR(e)},LR=function(e,t,n,r){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<$C;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),AR(e,e.l_desc),AR(e,e.d_desc),o=function(e){var t;for(OR(e,e.dyn_ltree,e.l_desc.max_code),OR(e,e.dyn_dtree,e.d_desc.max_code),AR(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*oR[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?DR(e,t,n,r):4===e.strategy||a===i?(ER(e,2+(r?1:0),3),RR(e,sR,cR)):(ER(e,4+(r?1:0),3),function(e,t,n,r){var i;for(ER(e,t-257,5),ER(e,n-1,5),ER(e,r-4,4),i=0;i<r;i++)ER(e,e.bl_tree[2*oR[i]+1],3);NR(e,e.dyn_ltree,t-1),NR(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),RR(e,e.dyn_ltree,e.dyn_dtree)),kR(e),r&&TR(e)},MR=function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(lR[n]+$C+1)]++,e.dyn_dtree[2*yR(t)]++),e.sym_next===e.sym_end},UR={_tr_init:PR,_tr_stored_block:DR,_tr_flush_block:LR,_tr_tally:MR,_tr_align:function(e){ER(e,2,3),bR(e,256,sR),function(e){16===e.bi_valid?(_R(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},jR=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0},FR=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),VR=function(e,t,n,r){var i=FR,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},BR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},GR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},ZR=UR._tr_init,qR=UR._tr_stored_block,WR=UR._tr_flush_block,HR=UR._tr_tally,KR=UR._tr_align,zR=GR.Z_NO_FLUSH,YR=GR.Z_PARTIAL_FLUSH,JR=GR.Z_FULL_FLUSH,XR=GR.Z_FINISH,QR=GR.Z_BLOCK,$R=GR.Z_OK,eA=GR.Z_STREAM_END,tA=GR.Z_STREAM_ERROR,nA=GR.Z_DATA_ERROR,rA=GR.Z_BUF_ERROR,iA=GR.Z_DEFAULT_COMPRESSION,aA=GR.Z_FILTERED,oA=GR.Z_HUFFMAN_ONLY,sA=GR.Z_RLE,cA=GR.Z_FIXED,uA=GR.Z_DEFAULT_STRATEGY,lA=GR.Z_UNKNOWN,dA=GR.Z_DEFLATED,fA=286,pA=30,hA=19,vA=2*fA+1,mA=15,gA=258,yA=262,_A=42,EA=113,bA=666,wA=function(e,t){return e.msg=BR[t],t},SA=function(e){return 2*e-(e>4?9:0)},kA=function(e){for(var t=e.length;--t>=0;)e[t]=0},TA=function(e){var t,n,r,i=e.w_size;r=t=e.hash_size;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);r=t=i;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},IA=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},CA=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},RA=function(e,t){WR(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,CA(e.strm)},AA=function(e,t){e.pending_buf[e.pending++]=t},OA=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},NA=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=jR(e.adler,t,i,n):2===e.state.wrap&&(e.adler=VR(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},xA=function(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-yA?e.strstart-(e.w_size-yA):0,u=e.window,l=e.w_mask,d=e.prev,f=e.strstart+gA,p=u[a+o-1],h=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===h&&u[n+o-1]===p&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<f);if(r=gA-(f-a),a=f-gA,r>o){if(e.match_start=t,o=r,r>=s)break;p=u[a+o-1],h=u[a+o]}}}while((t=d[t&l])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead},DA=function(e){var t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-yA)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),TA(e),n+=i),0===e.strm.avail_in)break;if(t=NA(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=IA(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=IA(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<yA&&0!==e.strm.avail_in)},PA=function(e,t){var n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n>(r=e.strstart-e.block_start)+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==XR||t===zR||n!==r+e.strm.avail_in))break;o=t===XR&&n===r+e.strm.avail_in?1:0,qR(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,CA(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(NA(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return(s-=e.strm.avail_in)&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==zR&&t!==XR&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(NA(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,a=(i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=a||(r||t===XR)&&t!==zR&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=t===XR&&0===e.strm.avail_in&&n===r?1:0,qR(e,e.block_start,n,o),e.block_start+=n,CA(e.strm)),o?3:1)},LA=function(e,t){for(var n,r;;){if(e.lookahead<yA){if(DA(e),e.lookahead<yA&&t===zR)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=IA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-yA&&(e.match_length=xA(e,n)),e.match_length>=3)if(r=HR(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=IA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=IA(e,e.ins_h,e.window[e.strstart+1]);else r=HR(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(RA(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===XR?(RA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(RA(e,!1),0===e.strm.avail_out)?1:2},MA=function(e,t){for(var n,r,i;;){if(e.lookahead<yA){if(DA(e),e.lookahead<yA&&t===zR)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=IA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-yA&&(e.match_length=xA(e,n),e.match_length<=5&&(e.strategy===aA||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=HR(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=IA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(RA(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=HR(e,0,e.window[e.strstart-1]))&&RA(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=HR(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===XR?(RA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(RA(e,!1),0===e.strm.avail_out)?1:2};function UA(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var jA=[new UA(0,0,0,0,PA),new UA(4,4,8,4,LA),new UA(4,5,16,8,LA),new UA(4,6,32,32,LA),new UA(4,4,16,16,MA),new UA(8,16,32,32,MA),new UA(8,16,128,128,MA),new UA(8,32,128,256,MA),new UA(32,128,258,1024,MA),new UA(32,258,258,4096,MA)];function FA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*vA),this.dyn_dtree=new Uint16Array(2*(2*pA+1)),this.bl_tree=new Uint16Array(2*(2*hA+1)),kA(this.dyn_ltree),kA(this.dyn_dtree),kA(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(mA+1),this.heap=new Uint16Array(2*fA+1),kA(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*fA+1),kA(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var VA=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.status!==_A&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==EA&&t.status!==bA?1:0},BA=function(e){if(VA(e))return wA(e,tA);e.total_in=e.total_out=0,e.data_type=lA;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?_A:EA,e.adler=2===t.wrap?0:1,t.last_flush=-2,ZR(t),$R},GA=function(e){var t,n=BA(e);return n===$R&&((t=e.state).window_size=2*t.w_size,kA(t.head),t.max_lazy_match=jA[t.level].max_lazy,t.good_match=jA[t.level].good_length,t.nice_match=jA[t.level].nice_length,t.max_chain_length=jA[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},ZA=function(e,t,n,r,i,a){if(!e)return tA;var o=1;if(t===iA&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==dA||r<8||r>15||t<0||t>9||a<0||a>cA||8===r&&1!==o)return wA(e,tA);8===r&&(r=9);var s=new FA;return e.state=s,s.strm=e,s.status=_A,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=a,s.method=n,GA(e)},qA=function(e,t){if(VA(e)||t>QR||t<0)return e?wA(e,tA):tA;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===bA&&t!==XR)return wA(e,0===e.avail_out?rA:tA);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(CA(e),0===e.avail_out)return n.last_flush=-1,$R}else if(0===e.avail_in&&SA(t)<=SA(r)&&t!==XR)return wA(e,rA);if(n.status===bA&&0!==e.avail_in)return wA(e,rA);if(n.status===_A&&0===n.wrap&&(n.status=EA),n.status===_A){var i=dA+(n.w_bits-8<<4)<<8;if(i|=(n.strategy>=oA||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(i|=32),OA(n,i+=31-i%31),0!==n.strstart&&(OA(n,e.adler>>>16),OA(n,65535&e.adler)),e.adler=1,n.status=EA,CA(e),0!==n.pending)return n.last_flush=-1,$R}if(57===n.status)if(e.adler=0,AA(n,31),AA(n,139),AA(n,8),n.gzhead)AA(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),AA(n,255&n.gzhead.time),AA(n,n.gzhead.time>>8&255),AA(n,n.gzhead.time>>16&255),AA(n,n.gzhead.time>>24&255),AA(n,9===n.level?2:n.strategy>=oA||n.level<2?4:0),AA(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(AA(n,255&n.gzhead.extra.length),AA(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=VR(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(AA(n,0),AA(n,0),AA(n,0),AA(n,0),AA(n,0),AA(n,9===n.level?2:n.strategy>=oA||n.level<2?4:0),AA(n,3),n.status=EA,CA(e),0!==n.pending)return n.last_flush=-1,$R;if(69===n.status){if(n.gzhead.extra){for(var a=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+o>n.pending_buf_size;){var s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=VR(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=s,CA(e),0!==n.pending)return n.last_flush=-1,$R;a=0,o-=s}var c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>a&&(e.adler=VR(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var u,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=VR(e.adler,n.pending_buf,n.pending-l,l)),CA(e),0!==n.pending)return n.last_flush=-1,$R;l=0}u=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,AA(n,u)}while(0!==u);n.gzhead.hcrc&&n.pending>l&&(e.adler=VR(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var d,f=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>f&&(e.adler=VR(e.adler,n.pending_buf,n.pending-f,f)),CA(e),0!==n.pending)return n.last_flush=-1,$R;f=0}d=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,AA(n,d)}while(0!==d);n.gzhead.hcrc&&n.pending>f&&(e.adler=VR(e.adler,n.pending_buf,n.pending-f,f))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(CA(e),0!==n.pending))return n.last_flush=-1,$R;AA(n,255&e.adler),AA(n,e.adler>>8&255),e.adler=0}if(n.status=EA,CA(e),0!==n.pending)return n.last_flush=-1,$R}if(0!==e.avail_in||0!==n.lookahead||t!==zR&&n.status!==bA){var p=0===n.level?PA(n,t):n.strategy===oA?function(e,t){for(var n;;){if(0===e.lookahead&&(DA(e),0===e.lookahead)){if(t===zR)return 1;break}if(e.match_length=0,n=HR(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(RA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===XR?(RA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(RA(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===sA?function(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=gA){if(DA(e),e.lookahead<=gA&&t===zR)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+gA;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=gA-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=HR(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=HR(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(RA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===XR?(RA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(RA(e,!1),0===e.strm.avail_out)?1:2}(n,t):jA[n.level].func(n,t);if(3!==p&&4!==p||(n.status=bA),1===p||3===p)return 0===e.avail_out&&(n.last_flush=-1),$R;if(2===p&&(t===YR?KR(n):t!==QR&&(qR(n,0,0,!1),t===JR&&(kA(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),CA(e),0===e.avail_out))return n.last_flush=-1,$R}return t!==XR?$R:n.wrap<=0?eA:(2===n.wrap?(AA(n,255&e.adler),AA(n,e.adler>>8&255),AA(n,e.adler>>16&255),AA(n,e.adler>>24&255),AA(n,255&e.total_in),AA(n,e.total_in>>8&255),AA(n,e.total_in>>16&255),AA(n,e.total_in>>24&255)):(OA(n,e.adler>>>16),OA(n,65535&e.adler)),CA(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?$R:eA)},WA=function(e,t){var n=t.length;if(VA(e))return tA;var r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==_A||r.lookahead)return tA;if(1===i&&(e.adler=jR(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(kA(r.head),r.strstart=0,r.block_start=0,r.insert=0);var a=new Uint8Array(r.w_size);a.set(t.subarray(n-r.w_size,n),0),t=a,n=r.w_size}var o=e.avail_in,s=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,DA(r);r.lookahead>=3;){var u=r.strstart,l=r.lookahead-2;do{r.ins_h=IA(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++}while(--l);r.strstart=u,r.lookahead=2,DA(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=o,r.wrap=i,$R},HA={deflateInit:function(e,t){return ZA(e,t,dA,15,8,uA)},deflateInit2:ZA,deflateReset:GA,deflateResetKeep:BA,deflateSetHeader:function(e,t){return VA(e)||2!==e.state.wrap?tA:(e.state.gzhead=t,$R)},deflate:qA,deflateEnd:function(e){if(VA(e))return tA;var t=e.state.status;return e.state=null,t===EA?wA(e,nA):$R},deflateSetDictionary:WA,deflateInfo:"pako deflate (from Nodeca project)"},KA=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},zA={assign:function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)KA(n,r)&&(e[r]=n[r])}}return e},flattenChunks:function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),a=0,o=0,s=e.length;a<s;a++){var c=e[a];i.set(c,o),o+=c.length}return i}},YA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(b){YA=!1}for(var JA=new Uint8Array(256),XA=0;XA<256;XA++)JA[XA]=XA>=252?6:XA>=248?5:XA>=240?4:XA>=224?3:XA>=192?2:1;JA[254]=JA[254]=1;var QA={string2buf:function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:function(e,t){var n,r,i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(r=0,n=0;n<i;){var o=e[n++];if(o<128)a[r++]=o;else{var s=JA[o];if(s>4)a[r++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<i;)o=o<<6|63&e[n++],s--;s>1?a[r++]=65533:o<65536?a[r++]=o:(o-=65536,a[r++]=55296|o>>10&1023,a[r++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&YA)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(a,r)},utf8border:function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+JA[e[n]]>t?n:t}},$A=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},eO=Object.prototype.toString,tO=GR.Z_NO_FLUSH,nO=GR.Z_SYNC_FLUSH,rO=GR.Z_FULL_FLUSH,iO=GR.Z_FINISH,aO=GR.Z_OK,oO=GR.Z_STREAM_END,sO=GR.Z_DEFAULT_COMPRESSION,cO=GR.Z_DEFAULT_STRATEGY,uO=GR.Z_DEFLATED;function lO(e){this.options=zA.assign({level:sO,method:uO,chunkSize:16384,windowBits:15,memLevel:8,strategy:cO},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $A,this.strm.avail_out=0;var n=HA.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==aO)throw new Error(BR[n]);if(t.header&&HA.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?QA.string2buf(t.dictionary):"[object ArrayBuffer]"===eO.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=HA.deflateSetDictionary(this.strm,r))!==aO)throw new Error(BR[n]);this._dict_set=!0}}function dO(e,t){var n=new lO(t);if(n.push(e,!0),n.err)throw n.msg||BR[n.err];return n.result}lO.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?iO:tO,"string"==typeof e?i.input=QA.string2buf(e):"[object ArrayBuffer]"===eO.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===nO||r===rO)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((n=HA.deflate(i,r))===oO)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=HA.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===aO;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},lO.prototype.onData=function(e){this.chunks.push(e)},lO.prototype.onEnd=function(e){e===aO&&(this.result=zA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var fO={Deflate:lO,deflate:dO,deflateRaw:function(e,t){return(t=t||{}).raw=!0,dO(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,dO(e,t)},constants:GR},pO=16209,hO=function(e,t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,w,S,k,T,I=e.state;n=e.next_in,k=e.input,r=n+(e.avail_in-5),i=e.next_out,T=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=I.dmax,c=I.wsize,u=I.whave,l=I.wnext,d=I.window,f=I.hold,p=I.bits,h=I.lencode,v=I.distcode,m=(1<<I.lenbits)-1,g=(1<<I.distbits)-1;e:do{p<15&&(f+=k[n++]<<p,p+=8,f+=k[n++]<<p,p+=8),y=h[f&m];t:for(;;){if(f>>>=_=y>>>24,p-=_,0===(_=y>>>16&255))T[i++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=h[(65535&y)+(f&(1<<_)-1)];continue t}if(32&_){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=pO;break e}E=65535&y,(_&=15)&&(p<_&&(f+=k[n++]<<p,p+=8),E+=f&(1<<_)-1,f>>>=_,p-=_),p<15&&(f+=k[n++]<<p,p+=8,f+=k[n++]<<p,p+=8),y=v[f&g];n:for(;;){if(f>>>=_=y>>>24,p-=_,!(16&(_=y>>>16&255))){if(0==(64&_)){y=v[(65535&y)+(f&(1<<_)-1)];continue n}e.msg="invalid distance code",I.mode=pO;break e}if(b=65535&y,p<(_&=15)&&(f+=k[n++]<<p,(p+=8)<_&&(f+=k[n++]<<p,p+=8)),(b+=f&(1<<_)-1)>s){e.msg="invalid distance too far back",I.mode=pO;break e}if(f>>>=_,p-=_,b>(_=i-a)){if((_=b-_)>u&&I.sane){e.msg="invalid distance too far back",I.mode=pO;break e}if(w=0,S=d,0===l){if(w+=c-_,_<E){E-=_;do{T[i++]=d[w++]}while(--_);w=i-b,S=T}}else if(l<_){if(w+=c+l-_,(_-=l)<E){E-=_;do{T[i++]=d[w++]}while(--_);if(w=0,l<E){E-=_=l;do{T[i++]=d[w++]}while(--_);w=i-b,S=T}}}else if(w+=l-_,_<E){E-=_;do{T[i++]=d[w++]}while(--_);w=i-b,S=T}for(;E>2;)T[i++]=S[w++],T[i++]=S[w++],T[i++]=S[w++],E-=3;E&&(T[i++]=S[w++],E>1&&(T[i++]=S[w++]))}else{w=i-b;do{T[i++]=T[w++],T[i++]=T[w++],T[i++]=T[w++],E-=3}while(E>2);E&&(T[i++]=T[w++],E>1&&(T[i++]=T[w++]))}break}}break}}while(n<r&&i<o);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),I.hold=f,I.bits=p},vO=15,mO=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),gO=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yO=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_O=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),EO=function(e,t,n,r,i,a,o,s){var c,u,l,d,f,p,h,v,m,g=s.bits,y=0,_=0,E=0,b=0,w=0,S=0,k=0,T=0,I=0,C=0,R=null,A=new Uint16Array(16),O=new Uint16Array(16),N=null;for(y=0;y<=vO;y++)A[y]=0;for(_=0;_<r;_++)A[t[n+_]]++;for(w=g,b=vO;b>=1&&0===A[b];b--);if(w>b&&(w=b),0===b)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(E=1;E<b&&0===A[E];E++);for(w<E&&(w=E),T=1,y=1;y<=vO;y++)if(T<<=1,(T-=A[y])<0)return-1;if(T>0&&(0===e||1!==b))return-1;for(O[1]=0,y=1;y<vO;y++)O[y+1]=O[y]+A[y];for(_=0;_<r;_++)0!==t[n+_]&&(o[O[t[n+_]]++]=_);if(0===e?(R=N=o,p=20):1===e?(R=mO,N=gO,p=257):(R=yO,N=_O,p=0),C=0,_=0,y=E,f=a,S=w,k=0,l=-1,d=(I=1<<w)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){h=y-k,o[_]+1<p?(v=0,m=o[_]):o[_]>=p?(v=N[o[_]-p],m=R[o[_]-p]):(v=96,m=0),c=1<<y-k,E=u=1<<S;do{i[f+(C>>k)+(u-=c)]=h<<24|v<<16|m|0}while(0!==u);for(c=1<<y-1;C&c;)c>>=1;if(0!==c?(C&=c-1,C+=c):C=0,_++,0==--A[y]){if(y===b)break;y=t[n+o[_]]}if(y>w&&(C&d)!==l){for(0===k&&(k=w),f+=E,T=1<<(S=y-k);S+k<b&&!((T-=A[S+k])<=0);)S++,T<<=1;if(I+=1<<S,1===e&&I>852||2===e&&I>592)return 1;i[l=C&d]=w<<24|S<<16|f-a|0}}return 0!==C&&(i[f+C]=y-k<<24|64<<16|0),s.bits=w,0},bO=GR.Z_FINISH,wO=GR.Z_BLOCK,SO=GR.Z_TREES,kO=GR.Z_OK,TO=GR.Z_STREAM_END,IO=GR.Z_NEED_DICT,CO=GR.Z_STREAM_ERROR,RO=GR.Z_DATA_ERROR,AO=GR.Z_MEM_ERROR,OO=GR.Z_BUF_ERROR,NO=GR.Z_DEFLATED,xO=16180,DO=16190,PO=16191,LO=16192,MO=16194,UO=16199,jO=16200,FO=16206,VO=16209,BO=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function GO(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var ZO,qO,WO=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<xO||t.mode>16211?1:0},HO=function(e){if(WO(e))return CO;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=xO,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,kO},KO=function(e){if(WO(e))return CO;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,HO(e)},zO=function(e,t){var n;if(WO(e))return CO;var r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?CO:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,KO(e))},YO=function(e,t){if(!e)return CO;var n=new GO;e.state=n,n.strm=e,n.window=null,n.mode=xO;var r=zO(e,t);return r!==kO&&(e.state=null),r},JO=!0,XO=function(e){if(JO){ZO=new Int32Array(512),qO=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(EO(1,e.lens,0,288,ZO,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;EO(2,e.lens,0,32,qO,0,e.work,{bits:5}),JO=!1}e.lencode=ZO,e.lenbits=9,e.distcode=qO,e.distbits=5},QO=function(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},$O=function(e,t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,w,S,k,T,I=0,C=new Uint8Array(4),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(WO(e)||!e.output||!e.input&&0!==e.avail_in)return CO;(n=e.state).mode===PO&&(n.mode=LO),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,f=c,S=kO;e:for(;;)switch(n.mode){case xO:if(0===n.wrap){n.mode=LO;break}for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&u,C[1]=u>>>8&255,n.check=VR(n.check,C,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=VO;break}if((15&u)!==NO){e.msg="unknown compression method",n.mode=VO;break}if(l-=4,w=8+(15&(u>>>=4)),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=VO;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:PO,u=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.flags=u,(255&n.flags)!==NO){e.msg="unknown compression method",n.mode=VO;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=VO;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&u,C[1]=u>>>8&255,n.check=VR(n.check,C,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&4&n.wrap&&(C[0]=255&u,C[1]=u>>>8&255,C[2]=u>>>16&255,C[3]=u>>>24&255,n.check=VR(n.check,C,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&4&n.wrap&&(C[0]=255&u,C[1]=u>>>8&255,n.check=VR(n.check,C,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&4&n.wrap&&(C[0]=255&u,C[1]=u>>>8&255,n.check=VR(n.check,C,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+p),w)),512&n.flags&&4&n.wrap&&(n.check=VR(n.check,r,p,a)),s-=p,a+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===s)break e;p=0;do{w=r[a+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<s);if(512&n.flags&&4&n.wrap&&(n.check=VR(n.check,r,p,a)),s-=p,a+=p,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===s)break e;p=0;do{w=r[a+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<s);if(512&n.flags&&4&n.wrap&&(n.check=VR(n.check,r,p,a)),s-=p,a+=p,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=VO;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=PO;break;case 16189:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}e.adler=n.check=BO(u),u=0,l=0,n.mode=DO;case DO:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,IO;e.adler=n.check=1,n.mode=PO;case PO:if(t===wO||t===SO)break e;case LO:if(n.last){u>>>=7&l,l-=7&l,n.mode=FO;break}for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=16193;break;case 1:if(XO(n),n.mode=UO,t===SO){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=VO}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=VO;break}if(n.length=65535&u,u=0,l=0,n.mode=MO,t===SO)break e;case MO:n.mode=16195;case 16195:if(p=n.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;i.set(r.subarray(a,a+p),o),s-=p,a+=p,c-=p,o+=p,n.length-=p;break}n.mode=PO;break;case 16196:for(;l<14;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=VO;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.lens[R[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},S=EO(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,S){e.msg="invalid code lengths set",n.mode=VO;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;g=(I=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&I,!((m=I>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(y<16)u>>>=m,l-=m,n.lens[n.have++]=y;else{if(16===y){for(T=m+2;l<T;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(u>>>=m,l-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=VO;break}w=n.lens[n.have-1],p=3+(3&u),u>>>=2,l-=2}else if(17===y){for(T=m+3;l<T;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}l-=m,w=0,p=3+(7&(u>>>=m)),u>>>=3,l-=3}else{for(T=m+7;l<T;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}l-=m,w=0,p=11+(127&(u>>>=m)),u>>>=7,l-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=VO;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===VO)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=VO;break}if(n.lenbits=9,k={bits:n.lenbits},S=EO(1,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,S){e.msg="invalid literal/lengths set",n.mode=VO;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},S=EO(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,S){e.msg="invalid distances set",n.mode=VO;break}if(n.mode=UO,t===SO)break e;case UO:n.mode=jO;case jO:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,hO(e,f),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===PO&&(n.back=-1);break}for(n.back=0;g=(I=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,y=65535&I,!((m=I>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(g&&0==(240&g)){for(_=m,E=g,b=y;g=(I=n.lencode[b+((u&(1<<_+E)-1)>>_)])>>>16&255,y=65535&I,!(_+(m=I>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=_,l-=_,n.back+=_}if(u>>>=m,l-=m,n.back+=m,n.length=y,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=PO;break}if(64&g){e.msg="invalid literal/length code",n.mode=VO;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(T=n.extra;l<T;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;g=(I=n.distcode[u&(1<<n.distbits)-1])>>>16&255,y=65535&I,!((m=I>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(0==(240&g)){for(_=m,E=g,b=y;g=(I=n.distcode[b+((u&(1<<_+E)-1)>>_)])>>>16&255,y=65535&I,!(_+(m=I>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=_,l-=_,n.back+=_}if(u>>>=m,l-=m,n.back+=m,64&g){e.msg="invalid distance code",n.mode=VO;break}n.offset=y,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(T=n.extra;l<T;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=VO;break}n.mode=16204;case 16204:if(0===c)break e;if(p=f-c,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=VO;break}p>n.wnext?(p-=n.wnext,h=n.wsize-p):h=n.wnext-p,p>n.length&&(p=n.length),v=n.window}else v=i,h=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[o++]=v[h++]}while(--p);0===n.length&&(n.mode=jO);break;case 16205:if(0===c)break e;i[o++]=n.length,c--,n.mode=jO;break;case FO:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=r[a++]<<l,l+=8}if(f-=c,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?VR(n.check,i,f,o-f):jR(n.check,i,f,o-f)),f=c,4&n.wrap&&(n.flags?u:BO(u))!==n.check){e.msg="incorrect data check",n.mode=VO;break}u=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=VO;break}u=0,l=0}n.mode=16208;case 16208:S=TO;break e;case VO:S=RO;break e;case 16210:return AO;default:return CO}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||f!==e.avail_out&&n.mode<VO&&(n.mode<FO||t!==bO))&&QO(e,e.output,e.next_out,f-e.avail_out),d-=e.avail_in,f-=e.avail_out,e.total_in+=d,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?VR(n.check,i,f,e.next_out-f):jR(n.check,i,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===PO?128:0)+(n.mode===UO||n.mode===MO?256:0),(0===d&&0===f||t===bO)&&S===kO&&(S=OO),S},eN={inflateReset:KO,inflateReset2:zO,inflateResetKeep:HO,inflateInit:function(e){return YO(e,15)},inflateInit2:YO,inflate:$O,inflateEnd:function(e){if(WO(e))return CO;var t=e.state;return t.window&&(t.window=null),e.state=null,kO},inflateGetHeader:function(e,t){if(WO(e))return CO;var n=e.state;return 0==(2&n.wrap)?CO:(n.head=t,t.done=!1,kO)},inflateSetDictionary:function(e,t){var n,r=t.length;return WO(e)||0!==(n=e.state).wrap&&n.mode!==DO?CO:n.mode===DO&&jR(1,t,r,0)!==n.check?RO:QO(e,t,r,r)?(n.mode=16210,AO):(n.havedict=1,kO)},inflateInfo:"pako inflate (from Nodeca project)"},tN=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},nN=Object.prototype.toString,rN=GR.Z_NO_FLUSH,iN=GR.Z_FINISH,aN=GR.Z_OK,oN=GR.Z_STREAM_END,sN=GR.Z_NEED_DICT,cN=GR.Z_STREAM_ERROR,uN=GR.Z_DATA_ERROR,lN=GR.Z_MEM_ERROR;function dN(e){this.options=zA.assign({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $A,this.strm.avail_out=0;var n=eN.inflateInit2(this.strm,t.windowBits);if(n!==aN)throw new Error(BR[n]);if(this.header=new tN,eN.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=QA.string2buf(t.dictionary):"[object ArrayBuffer]"===nN.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=eN.inflateSetDictionary(this.strm,t.dictionary))!==aN))throw new Error(BR[n])}function fN(e,t){var n=new dN(t);if(n.push(e),n.err)throw n.msg||BR[n.err];return n.result}dN.prototype.push=function(e,t){var n,r,i,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?iN:rN,"[object ArrayBuffer]"===nN.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(n=eN.inflate(a,r))===sN&&s&&((n=eN.inflateSetDictionary(a,s))===aN?n=eN.inflate(a,r):n===uN&&(n=sN));a.avail_in>0&&n===oN&&a.state.wrap>0&&0!==e[a.next_in];)eN.inflateReset(a),n=eN.inflate(a,r);switch(n){case cN:case uN:case sN:case lN:return this.onEnd(n),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||n===oN))if("string"===this.options.to){var c=QA.utf8border(a.output,a.next_out),u=a.next_out-c,l=QA.buf2string(a.output,c);a.next_out=u,a.avail_out=o-u,u&&a.output.set(a.output.subarray(c,c+u),0),this.onData(l)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==aN||0!==i){if(n===oN)return n=eN.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},dN.prototype.onData=function(e){this.chunks.push(e)},dN.prototype.onEnd=function(e){e===aN&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=zA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pN,hN={Inflate:dN,inflate:fN,inflateRaw:function(e,t){return(t=t||{}).raw=!0,fN(e,t)},ungzip:fN,constants:GR},vN=(fO.Deflate,fO.deflate),mN=(fO.deflateRaw,fO.gzip,hN.Inflate,hN.inflate),gN=(hN.inflateRaw,hN.ungzip,vN),yN=mN;!function(e){e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE"}(pN||(pN={}));var _N=function(){function e(){l(this,e),kf(this,"_sequence",0),kf(this,"_startTime",Date.now()),kf(this,"isUseOneByte",!0)}return d(e,[{key:"startTime",get:function(){var e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}},{key:"sequence",get:function(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}},{key:"serialize",value:function(e){var t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){var n=new Uint8Array(4);n.set([1,0,0,0]);var r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;var a=new ArrayBuffer(t.commonPacketHeader.length),o=new Uint8Array(a),s=new DataView(a),c=0;if(s.setUint16(c,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),c+=2,s.setUint32(c,t.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,t.commonStreamHeader,!0),c+=2,t.extension){var u=this.serializeExtension(t.extension);o.set(new Uint8Array(u),c),c+=u.byteLength}if(o.set(new Uint8Array(t.payload),c),(c+=t.payload.byteLength)!==t.commonPacketHeader.length)throw Error("serialize error!");return a}},{key:"deserialize",value:function(e){if(e.byteLength<4)return new ArrayBuffer(0);var t=new DataView(e),n=0,r=t.getUint16(n,!0);n+=2;var i,a,o=(32768&r)>>15;if(t.getUint16(n+2,!0),t.getUint16(n,!0),n+=4,t.getUint16(n,!0),n+=2,o){n+=2+(a=this.deserializeExtension(e.slice(n))).length,i=e.slice(n);var s=!1;if(a.datas.length>0){var c=a.datas.find((function(e){return 0===e.id}));c&&(s=1==(1&new DataView(c.data).getUint32(0,!0)))}i=s?this.decompress(i):i}else i=e.slice(8);return i}},{key:"serializeExtension",value:function(e){var t=e.profile,n=e.length,r=e.datas,i=new ArrayBuffer(n+2),a=new Uint8Array(i),o=new DataView(i),s=0;if(o.setUint8(s++,t),o.setUint8(s++,n),r.forEach((function(e){t?(o.setUint8(s++,e.id),o.setUint8(s++,e.length),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(o.setUint8(s++,e.id|e.length<<4),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}},{key:"deserializeExtension",value:function(e){var t=new DataView(e),n=0,r=t.getUint8(n);n++;var i=t.getUint8(n);n++;for(var a=r===pN.TWO_BYTE,o=[],s=new DataView(e,2),c=0;c<i;){var u=0,l=0,d=new ArrayBuffer(0);a?(u=s.getUint8(c),c++,l=s.getUint8(c),c++):(u=15&s.getUint8(c),l=s.getUint8(c)>>4,c++),l>0&&(c+=(d=s.buffer.slice(c+2,c+2+l)).byteLength),o.push({id:u,length:l,data:d})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:o}}},{key:"decompress",value:function(e){return yN(new Uint8Array(e))}},{key:"compress",value:function(e){return gN(new Uint8Array(e))}}]),e}(),EN=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"_version",1),kf(f(i),"_type",3),kf(f(i),"_config",void 0),kf(f(i),"_originDataChannel",void 0),kf(f(i),"_dataStreamPacketHeader",new ArrayBuffer(4)),kf(f(i),"_dataStreamPacketHandler",void 0),kf(f(i),"_datachannelEventMap",new Map),i._config=e,r&&(i._originDataChannel=r,i._bandDataChannelEvents(r)),i._initPacketHeader(),i._dataStreamPacketHandler=new _N,i}return d(n,[{key:"id",get:function(){return this._config.id}},{key:"ordered",get:function(){return this._config.ordered}},{key:"maxRetransmits",get:function(){return $w("DATASTREAM_MAX_RETRANSMITS")}},{key:"metadata",get:function(){return this._config.metadata}},{key:"readyState",get:function(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}},{key:"_originDataChannelId",get:function(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}},{key:"getChannelId",value:function(){return this.id}},{key:"getConfig",value:function(){return this._config}},{key:"_close",value:function(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}},{key:"_waitTillOpen",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new by((function(e,n){if(t._originDataChannel){"open"===t._originDataChannel.readyState&&e();var r=setTimeout((function(){var e;n(new o_(Oy.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=t._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);t._originDataChannel.onopen=function(){clearTimeout(r),t._originDataChannel&&t._bandDataChannelEvents(t._originDataChannel),e()},t._originDataChannel.onerror=function(){throw clearTimeout(r),new o_(Oy.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new o_(Oy.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_updateOriginDataChannel",value:function(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}},{key:"_initPacketHeader",value:function(){var e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}},{key:"_bandDataChannelEvents",value:function(e){var t=this;this._unbindDataChannelEvents(e),[vI.OPEN,vI.CLOSE,vI.ERROR].forEach((function(n){var r=function(){t.emit(n)};t._datachannelEventMap.set(n,r),e.addEventListener(n,r)}))}},{key:"_unbindDataChannelEvents",value:function(e){Array.from(this._datachannelEventMap.entries()).forEach((function(t){var n=u(t,2),r=n[0],i=n[1];e.removeEventListener(r,i)})),this._datachannelEventMap.clear()}}]),n}(O_),bN=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this,e),kf(f(r),"_messageListener",void 0),r._messageListener=function(e){if(e.data.byteLength<r._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+r._dataStreamPacketHeader.byteLength);var t=e.data.slice(0,r._dataStreamPacketHeader.byteLength);if(new DataView(t).getUint8(3)===r.id){var n=e.data.slice(r._dataStreamPacketHeader.byteLength);n=r._dataStreamPacketHandler.deserialize(n),r.emit(vI.MESSAGE,n)}},r}return d(n,[{key:"_updateOriginDataChannel",value:function(e){i(a(n.prototype),"_updateOriginDataChannel",this).call(this,e),this._bandRemoteDataChannelEvents()}},{key:"_close",value:function(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),i(a(n.prototype),"_close",this).call(this))}},{key:"_bandRemoteDataChannelEvents",value:function(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}]),n}(EN),wN=function(e){p(n,e);var t=h(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"send",value:function(e){if(this._originDataChannel){var t=e;t=this._dataStreamPacketHandler.serialize(e);var n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}]),n}(EN),SN=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.apply(this,arguments),kf(f(e),"resultStorage",new Map),e}return d(n,[{key:"setLocalAudioStats",value:function(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}},{key:"setLocalVideoStats",value:function(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}},{key:"setRemoteAudioStats",value:function(e,t){var n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}},{key:"setRemoteVideoStats",value:function(e,t){var n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}},{key:"record",value:function(e,t,n){if(!($w("STATS_UPDATE_INTERVAL")>500)){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});var r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i,a=$i(i=r.result).call(i,!0);r.isPrevNormal&&!a&&this.emit("exception",kN[e],e,t),!r.isPrevNormal&&a&&this.emit("exception",kN[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=a,r.result=[]}}}},{key:"checkAudioOutputLevel",value:function(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}},{key:"checkAudioInputLevel",value:function(e,t){return t instanceof wC&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}},{key:"checkFramerateInput",value:function(e,t){var n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=DN(t._encoderConfig.frameRate));var r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}},{key:"checkFramerateSent",value:function(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}},{key:"checkSendVideoBitrate",value:function(e,t){return!!t.muted||0!==e.sendBitrate}},{key:"checkSendAudioBitrate",value:function(e,t){return t instanceof wC&&!t.isActive||!!t.muted||0!==e.sendBitrate}},{key:"checkVideoDecode",value:function(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}]),n}(O_),kN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},TN=new(function(){function e(){l(this,e)}return d(e,[{key:"markSubscribeStart",value:function(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}},{key:"markPublishStart",value:function(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}},{key:"measureFromSubscribeStart",value:function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}},{key:"measureFromPublishStart",value:function(e,t){var n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){var r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}}]),e}());function IN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function CN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IN(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var RN=function(){function e(t){var n=this;l(this,e),kf(this,"store",void 0),kf(this,"onStatsException",void 0),kf(this,"onUploadPublishDuration",void 0),kf(this,"onStatsChanged",void 0),kf(this,"localStats",new Map),kf(this,"remoteStats",new Map),kf(this,"updateStatsInterval",void 0),kf(this,"trafficStats",void 0),kf(this,"trafficStatsPeerList",[]),kf(this,"uplinkStats",void 0),kf(this,"exceptionMonitor",void 0),kf(this,"p2pChannel",void 0),kf(this,"scalabilityMode",CS.L1T1),kf(this,"updateStats",(function(){n.p2pChannel&&(n.updateRemoteStats(n.p2pChannel),n.updateLocalStats(n.p2pChannel))})),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new SN,this.exceptionMonitor.on("exception",(function(e,t,r){n.onStatsException&&n.onStatsException(e,t,r)}))}return d(e,[{key:"reset",value:function(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}},{key:"getLocalAudioTrackStats",value:function(){return this.localStats.get(Ok.LocalAudioTrack)||CN({},lI)}},{key:"getLocalVideoTrackStats",value:function(){return this.localStats.get(Ok.LocalVideoTrack)||CN({},dI)}},{key:"getRemoteAudioTrackStats",value:function(e){var t=this,n=function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppad+(Date.now()-t.trafficStats.timestamp)),n})),r={};if(e){var i,a=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;a&&(r[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=u(e,2),i=t[0],a=t[1].audioStats;a&&(r[i]=n(i,a))}));return r}},{key:"getRemoteNetworkQualityStats",value:function(e){var t={};if(e){var n,r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((function(e){var n=u(e,2),r=n[0],i=n[1].networkStats;i&&(t[r]=i)}));return t}},{key:"getRemoteVideoTrackStats",value:function(e){var t=this,n=function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n){if(!t.trafficStats)return n;var r=t.trafficStats.peer_delay.find((function(t){return t.peer_uid===e}));return r&&(n.publishDuration=r.B_ppvd+(Date.now()-t.trafficStats.timestamp)),n})),r={};if(e){var i,a=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;a&&(r[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach((function(e){var t=u(e,2),i=t[0],a=t[1].videoStats;a&&(r[i]=n(i,a))}));return r}},{key:"getRTCStats",value:function(){var e=0,t=0,n=0,r=0,i=this.localStats.get(Ok.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);var a=this.localStats.get(Ok.LocalVideoTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);var o=this.localStats.get(Ok.LocalVideoLowTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate),this.remoteStats.forEach((function(e){var t=e.audioStats,i=e.videoStats;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));var s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}},{key:"addLocalStats",value:function(e){this.localStats.set(e,void 0)}},{key:"removeLocalStats",value:function(e){e?this.localStats.delete(e):this.localStats.clear()}},{key:"addRemoteStats",value:function(e){this.remoteStats.set(e,{})}},{key:"removeRemoteStats",value:function(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}},{key:"addP2PChannel",value:function(e){this.p2pChannel=e}},{key:"updateTrafficStats",value:function(e){var t=this;e.peer_delay=e.peer_delay.filter((function(e){return void 0!==e.B_ppad||void 0!==e.B_ppvd})),e.peer_delay.filter((function(e){return-1===t.trafficStatsPeerList.indexOf(e.peer_uid)})).forEach((function(e){var n,r=null===(n=t.p2pChannel)||void 0===n?void 0:n.getRemoteMedia(e.peer_uid),i=null!=r&&r.videoSSRC?TN.measureFromSubscribeStart(t.store.clientId,r.videoSSRC):0,a=null!=r&&r.audioSSRC?TN.measureFromSubscribeStart(t.store.clientId,r.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(t.onUploadPublishDuration&&t.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>a?i:a),t.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}},{key:"updateUplinkStats",value:function(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&lS.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}},{key:"isLocalVideoFreeze",value:function(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}},{key:"updateLocalStats",value:function(e){var t=this;Array.from(this.localStats.entries()).forEach((function(n){var r=u(n,2),i=r[0],a=r[1];switch(i){case Ok.LocalVideoTrack:case Ok.LocalVideoLowTrack:var o,s=a,c=CN({},dI),l=e.getStats(),d=e.getLocalMedia(i);if(l){var f=l.videoSend.find((function(e){return e.ssrc===(null==d?void 0:d.ssrcs[0].ssrcId)}));if(f){var p=e.getLocalVideoSize(),h=e.getEncoderConfig(Ok.LocalVideoTrack);"H264"!==f.codec&&"H265"!==f.codec&&"VP8"!==f.codec&&"VP9"!==f.codec&&"AV1X"!==f.codec&&"AV1"!==f.codec||(c.codecType=f.codec),c.sendBytes=f.bytes,c.sendBitrate=s?8*Math.max(0,c.sendBytes-s.sendBytes):0,f.inputFrame?(c.captureFrameRate=f.inputFrame.frameRate,c.captureResolutionHeight=f.inputFrame.height,c.captureResolutionWidth=f.inputFrame.width):p&&(c.captureResolutionWidth=p.width,c.captureResolutionHeight=p.height),f.sentFrame?(c.sendFrameRate=f.sentFrame.frameRate,c.sendResolutionHeight=f.sentFrame.height,c.sendResolutionWidth=f.sentFrame.width):p&&(c.sendResolutionWidth=p.width,c.sendResolutionHeight=p.height),f.avgEncodeMs&&(c.encodeDelay=f.avgEncodeMs),h&&h.bitrateMax&&(c.targetSendBitrate=1e3*h.bitrateMax),c.sendPackets=f.packets,c.sendPacketsLost=f.packetsLost,c.sendJitterMs=f.jitterMs,c.sendRttMs=f.rttMs,c.totalDuration=s?s.totalDuration+1:1,c.totalFreezeTime=s?s.totalFreezeTime:0,t.isLocalVideoFreeze(f)&&(c.totalFreezeTime+=1),f.scalabilityMode&&t.scalabilityMode!==f.scalabilityMode&&(lS.debug("[".concat(t.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),t.scalabilityMode=f.scalabilityMode)}t.trafficStats&&(c.currentPacketLossRate=(t.trafficStats.B_pvlr4||0)/100)}t.localStats.set(i,c),((null==s?void 0:s.sendResolutionWidth)!==c.sendResolutionWidth||(null==s?void 0:s.sendResolutionHeight)!==c.sendResolutionHeight)&&(null===(o=t.onStatsChanged)||void 0===o||o.call(t,"resolution",{width:c.sendResolutionWidth,height:c.sendResolutionHeight})),c&&d&&t.exceptionMonitor.setLocalVideoStats(t.store.uid,d.track,c);break;case Ok.LocalAudioTrack:var v=a,m=CN({},lI),g=e.getStats(),y=e.getLocalMedia(i);if(g){var _=g.audioSend.find((function(e){return e.ssrc===(null==y?void 0:y.ssrcs[0].ssrcId)}));if(_){if("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(m.codecType=_.codec),_.inputLevel)m.sendVolumeLevel=Math.round(32767*_.inputLevel);else{var E=e.getLocalAudioVolume();E&&(m.sendVolumeLevel=Math.round(32767*E))}m.sendBytes=_.bytes,m.sendPackets=_.packets,m.sendPacketsLost=_.packetsLost,m.sendJitterMs=_.jitterMs,m.sendRttMs=_.rttMs,m.sendBitrate=v?8*Math.max(0,m.sendBytes-v.sendBytes):0}}t.trafficStats&&(m.currentPacketLossRate=(t.trafficStats.B_palr4||0)/100),t.localStats.set(Ok.LocalAudioTrack,m),m&&y&&t.exceptionMonitor.setLocalAudioStats(t.store.uid,y.track,m)}}))}},{key:"updateRemoteStats",value:function(t){var n=this;Array.from(this.remoteStats.entries()).forEach((function(r){var i=u(r,2),a=i[0],o=i[1],s=o.videoStats,c=o.audioStats,l=s,d=o.videoPcStats,f=CN({},fI),p=CN({},hI),h=CN({},pI),v=t.getRemoteMedia(a),m=v.audioTrack,g=v.videoTrack,y=v.audioSSRC,_=v.videoSSRC,E=t.getStats(),b=null==E?void 0:E.audioRecv.find((function(e){return e.ssrc===y})),w=null==E?void 0:E.videoRecv.find((function(e){return e.ssrc===_})),S=n.trafficStats&&n.trafficStats.peer_delay.find((function(e){return e.peer_uid===a}));if(b&&("opus"!==b.codec&&"aac"!==b.codec&&"PCMU"!==b.codec&&"PCMA"!==b.codec&&"G722"!==b.codec||(f.codecType=b.codec),b.outputLevel?f.receiveLevel=Math.round(32767*b.outputLevel):m&&(f.receiveLevel=Math.round(32767*m.getVolumeLevel())),f.receiveBytes=b.bytes,f.receivePackets=b.packets,f.receivePacketsLost=b.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.receiveBitrate=c?8*Math.max(0,f.receiveBytes-c.receiveBytes):0,f.totalDuration=c?c.totalDuration+1:1,f.totalFreezeTime=c?c.totalFreezeTime:0,f.freezeRate=f.totalFreezeTime/f.totalDuration,f.receiveDelay=b.jitterBufferMs,f.totalDuration>10&&e.isRemoteAudioFreeze(m)&&(f.totalFreezeTime+=1)),w){"H264"!==w.codec&&"H265"!==w.codec&&"VP8"!==w.codec&&"VP9"!==w.codec&&"AV1X"!==w.codec&&"AV1"!==w.codec||(p.codecType=w.codec),p.receiveBytes=w.bytes,p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.decodeFrameRate=w.decodeFrameRate<0?0:w.decodeFrameRate,p.renderFrameRate=w.decodeFrameRate<0?0:w.decodeFrameRate,w.outputFrame&&(p.renderFrameRate=w.outputFrame.frameRate),w.receivedFrame?(p.receiveFrameRate=w.receivedFrame.frameRate,p.receiveResolutionHeight=w.receivedFrame.height,p.receiveResolutionWidth=w.receivedFrame.width):g&&(p.receiveResolutionHeight=g._videoHeight||0,p.receiveResolutionWidth=g._videoWidth||0),void 0!==w.framesRateFirefox&&(p.receiveFrameRate=Math.round(w.framesRateFirefox)),p.receivePackets=w.packets,p.receivePacketsLost=w.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.receiveDelay=w.jitterBufferMs||0;var k=!!_&&t.getRemoteVideoIsReady(_);g&&k&&e.isRemoteVideoFreeze(g,w,d)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}S&&(f.end2EndDelay=S.B_ad,p.end2EndDelay=S.B_vd,f.transportDelay=S.B_ed,p.transportDelay=S.B_ed,f.currentPacketLossRate=S.B_ealr4/100,p.currentPacketLossRate=S.B_evlr4/100,h.uplinkNetworkQuality=S.B_punq?S.B_punq:0,h.downlinkNetworkQuality=S.B_pdnq?S.B_pdnq:0),n.remoteStats.set(a,{audioStats:f,videoStats:p,videoPcStats:w,networkStats:h}),m&&n.exceptionMonitor.setRemoteAudioStats(m,f),g&&n.exceptionMonitor.setRemoteVideoStats(g,p)}))}}],[{key:"isRemoteVideoFreeze",value:function(e,t,n){if(!e)return!1;var r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}},{key:"isRemoteAudioFreeze",value:function(e){return!!e&&e._isFreeze()}}]),e}();function AN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ON(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AN(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function NN(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($w("TURN_DOMAIN")):(lS.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function xN(e,t){var n,r,i=$w("GATEWAY_DOMAINS"),a=i[1]&&-1!==t.indexOf(i[1])?1:0;e.addresses=e.addresses||[];var o=e.addresses.map((function(e){return e.domain_prefix?{address:"".concat(e.domain_prefix,".").concat(i[a++%i.length],":").concat(e.port)}:e.ip.match(/^[\.\:\d]+$/)?{ip:e.ip,port:e.port,address:"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(i[a++%i.length],":").concat(e.port)}:(lS.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),{ip:e.ip,port:e.port,address:"".concat(e.ip,":").concat(e.port)})}));if(null!==(n=e.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[18]))for(var s=e.detail[18],c=null==s?void 0:s.split(";"),u=0;u<c.length;u++){var l,d=PT(l=c[u]).call(l);o[u]&&d&&(o[u].ip6=d)}return{gatewayAddrs:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function DN(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function PN(e){var t=e._encoderConfig;if(!t)return{};var n={resolution:t.width&&t.height?"".concat(DN(t.width),"x").concat(DN(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function LN(e){var t={connectionType:0,googRtt:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":var n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t.connectionType=1),"tcp"===n&&(t.connectionType=3),"tls"===n&&(t.connectionType=4);break;case"srflx":t.connectionType=2}return t}function MN(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function UN(e,t){var n,r,i;switch(t){case RT.CHOOSE_SERVER:r=4096,i="choose server";break;case RT.CLOUD_PROXY:r=1048576,i="proxy";break;case RT.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case RT.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new ek(Oy.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((function(t){t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((function(e){return ON(ON({},e),{},{ticket:t.buffer.cert})})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:ON(ON({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new ek(Oy.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}function jN(e,t){return FN.apply(this,arguments)}function FN(){return FN=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,by.all(t.addresses.map(function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=NN(t.ip),e.t1=t.port,e.t2=t.port,e.t3=n&&$w("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():SS.username,!(n&&$w("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext)){e.next=10;break}return e.next=7,A_(n.toString());case 7:e.t4=e.sent,e.next=11;break;case 10:e.t4=SS.password;case 11:return e.t5=e.t4,e.abrupt("return",{address:e.t0,tcpport:e.t1,udpport:e.t2,username:e.t3,password:e.t5});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),FN.apply(this,arguments)}function VN(e,t){var n=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return n?Math.max(n/DN(e.height),1):(lS.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function BN(e){var t=e.candidateType,n=e.relayProtocol,r=e.type,i=e.address,a=e.port,o=e.protocol;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:o}:{candidateType:t,relayProtocol:n,address:i,port:a,protocol:o}}function GN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ZN,qN=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this),kf(f(o),"connectionID",0),kf(f(o),"currentURLIndex",0),kf(f(o),"reconnectReason",void 0),kf(f(o),"_reconnectMode","tryNext"),kf(f(o),"_name",void 0),kf(f(o),"_state","closed"),kf(f(o),"_retryConfig",void 0),kf(f(o),"_reconnectCount",0),kf(f(o),"_forceCloseTimeout",5e3),kf(f(o),"_onlineReconnectListener",void 0),kf(f(o),"_closeEstablishingTransmitter",(function(){})),kf(f(o),"_store",void 0),kf(f(o),"_joinChannelServiceRecordIndex",void 0),kf(f(o),"_useCompress",void 0),kf(f(o),"_inflateLength",0),kf(f(o),"_deflateLength",0),o._store=a,o._name=e,o._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GN(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),o._useCompress=i,o}return d(n,[{key:"url",get:function(){return this._url?this._url:null}},{key:"reconnectMode",get:function(){return this._reconnectMode},set:function(e){var t;$i(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(jk.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(jk.CONNECTED):"closed"===this._state?this.emit(jk.CLOSED):"failed"===this._state&&this.emit(jk.FAILED))}},{key:"resetReconnectCount",value:function(e){lS.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}},{key:"close",value:function(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;var n=this._transmitter;t?setTimeout((function(){return n.close()}),500):n.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}},{key:"reconnect",value:function(e,t){if(this._transmitter){var n;void 0!==e&&(this.reconnectMode=e),lS.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));var r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}else lS.warning("[".concat(this._name,"] can not reconnect, no websocket"))}},{key:"getInflateData",value:function(){var e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}},{key:"setInflateData",value:function(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}},{key:"clearInflateData",value:function(){this._inflateLength=0,this._deflateLength=0}}]),n}(O_);!function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"}(ZN||(ZN={}));var WN=function(){function e(t,n,r){l(this,e),kf(this,"version",1),kf(this,"initialRTO",void 0),kf(this,"maxBatchAckCount",void 0),kf(this,"maxRTO",void 0),kf(this,"initialRTT",void 0),kf(this,"ID",void 0),kf(this,"rtt",void 0),kf(this,"packetNumber",1),kf(this,"rtoRatioMap",new Map),kf(this,"timeoutMap",new Map),kf(this,"unorderedPacketQueue",[]),kf(this,"batchAckPacketQueue",[]),kf(this,"lastOrderedPacketNumber",0),kf(this,"batchAckTimer",void 0),kf(this,"sendImpl",void 0),kf(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=rE(7,"transmitter-"),this.initialRTO=void 0!==(null==r?void 0:r.initialRTO)?r.initialRTO:$w("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==r?void 0:r.initialRTT)?r.initialRTT:$w("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==r?void 0:r.initialRTT)?r.initialRTT:$w("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==r?void 0:r.maxBatchAckCount)?r.maxBatchAckCount:$w("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==r?void 0:r.maxRTO)?r.maxRTO:$w("TRANSMITTER_MAX_RTO")}return d(e,[{key:"packetize",value:function(e,t){return{type:ZN.Default,version:this.version,packetNumber:t,payload:e}}},{key:"serialize",value:function(e){switch(e.type){case ZN.Default:var t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;var n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),m_(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n;case ZN.Ack:var i=new ArrayBuffer(16),a=new DataView(i);return a.setUint16(0,e.version),a.setUint8(2,e.type),a.setUint32(3,e.maxAckPacketNumber),a.setUint8(7,e.shift),m_(a,8,BigInt(e.ackSendTs)),i}}},{key:"deserialize",value:function(e){var t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case ZN.Default:var i=t.getUint32(3),a=v_(t,7),o=e.slice(15),s=(new TextDecoder).decode(o);return{version:n,type:r,packetNumber:i,sendTs:Number(a),payload:s};case ZN.Ack:var c=t.getUint32(3),u=t.getUint8(7),l=v_(t,8);return{version:n,type:r,maxAckPacketNumber:c,shift:u,ackSendTs:Number(l)};default:throw lS.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}},{key:"sendMessage",value:function(e){var t=this,n=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;var r=this.calculateRTO(n),i=window.setTimeout((function(){t.resendMessage(n)}),r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}},{key:"onData",value:function(e){var t=this.deserialize(e);t.type===ZN.Default?this.ack(t):t.type===ZN.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}},{key:"close",value:function(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((function(e){var t=u(e,2),n=(t[0],t[1]);window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}},{key:"resendMessage",value:function(e){var t=this,n=this.calculateRTO(e),r=window.setTimeout((function(){t.resendMessage(e)}),n);this.timeoutMap.set(e.packetNumber,r),this.sendPacket(e)}},{key:"calculateRTO",value:function(e){var t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;var n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}},{key:"updateRTT",value:function(e,t){var n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}},{key:"ack",value:function(e){var t=this;if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((function(){t.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){var n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){var r={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:ZN.Ack,version:this.version};this.sendPacket(r)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;var i={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:ZN.Ack,version:this.version};this.sendPacket(i)}}},{key:"batchAck",value:function(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;var e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ZN.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}},{key:"sendPacket",value:function(e){e.type===ZN.Default&&(e.sendTs=Math.round(performance.now()));var t=this.serialize(e);this.sendImpl(t)}},{key:"clearRTO",value:function(e){for(var t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){var n=this.timeoutMap.get(t);void 0!==n&&window.clearTimeout(n),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}]),e}(),HN=function(e){p(n,e);var t=h(n);function n(e,r){var i;l(this,n),i=t.call(this,e,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),kf(f(i),"_initMutex",void 0),kf(f(i),"_reconnectInterrupter",void 0),kf(f(i),"_url",void 0),kf(f(i),"_transmitter",void 0),kf(f(i),"_addresses",void 0),kf(f(i),"_reliableTransmission",void 0),i._initMutex=new fE("datachannel");var a=r.timeout,o=r.timeoutFactor,s=Math.max(300,Math.floor(3*a/5)),c=Math.max(1.2,Math.floor(8*o)/10);return T_.ONLINE&&(i._retryConfig.timeout=s,i._retryConfig.timeoutFactor=c),B_.on(I_.NETWORK_STATE_CHANGE,(function(e,t){e!==t&&(i.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===T_.ONLINE?(i._retryConfig.timeout=s,i._retryConfig.timeoutFactor=c):(i._retryConfig.timeout=a,i._retryConfig.timeoutFactor=o))})),i}return d(n,[{key:"getConnection",value:function(){if(this._reliableTransmission)return this._reliableTransmission}},{key:"init",value:function(){var e=c(s().mark((function e(t){var n,r,i=this,a=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:5e3,this._forceCloseTimeout=n,r=function(e,n){i._addresses=t,i.currentURLIndex=i._addresses.findIndex((function(e){return e.fingerprint||$w("FINGERPRINT")}));var r=i._addresses[i.currentURLIndex];i.state="connecting",i.createTransmitterConnection(r).then(e).catch(n),i.once(jk.CLOSED,(function(){return n(new ek(Oy.WS_DISCONNECT))})),i.once(jk.CONNECTED,(function(){return e()}))},e.abrupt("return",this._initMutex.lock().then((function(e){return new by((function(e,t){r(e,t)})).then((function(){e()})).catch((function(){e()}))})));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendMessage",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ek(Oy.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new ek(Oy.WS_ERR,"send datachannel signal message error"+e.toString())}}},{key:"unbindDcCloseEventListener",value:function(){this._transmitter&&(this._transmitter.onclose=null)}},{key:"sendMessageWithJSON",value:function(e){var t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}},{key:"sendMessageWithUint8Array",value:function(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}},{key:"createTransmitterConnection",value:function(e){var t=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new by((function(n,r){var i,a=function(){lS.debug("[".concat(t._name,"] datachannel opened:"),t._url),t.reconnectMode="retry",t.state="connected",t.resetReconnectCount("opened"),n()},o=function(){var e=c(s().mark((function e(i){var a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(a=t._closeEstablishingTransmitter)||void 0===a||a.call(t),lS.debug("[".concat(t._name,"] datachannel close ").concat(t._url,", code: ").concat(i.code,", reason: ").concat(i.reason,", current mode: ").concat(t.reconnectMode)),!(t._reconnectCount<t._retryConfig.maxRetryCount)){e.next=13;break}return"connected"===t.state&&(t.reconnectReason=i.reason,t.state="reconnecting"),o=F_(t,jk.WILL_RECONNECT,t.reconnectMode)||t.reconnectMode,e.next=5,t.reconnectWithAction(o);case 5:if(c=e.sent,"closed"!==t.state){e.next=8;break}return e.abrupt("return",void lS.debug("[".concat(t.connectionID,"] dc is closed, no need to reconnect")));case 8:if(c){e.next=10;break}return e.abrupt("return",(r(new ek(Oy.WS_DISCONNECT,"datachannel reconnect failed: ".concat(i.code))),void t.close(!0)));case 10:n(),e.next=14;break;case 13:r(new ek(Oy.WS_DISCONNECT,"datachannel close: ".concat(i.code))),t.close();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(e){var n;null===(n=t._reliableTransmission)||void 0===n||n.onData(e.data)};t._transmitter&&(t._transmitter.onclose=null,t._transmitter.close()),t._reliableTransmission&&(t._reliableTransmission.close(),t._reliableTransmission=void 0),lS.debug("[".concat(t._name,"] start connect, address: ").concat(JSON.stringify(e)));var l=null===(i=t._store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),d=Date.now();U_(t,jk.TO_CONNECT_DATACHANNEL,e).then((function(e){var n,r;if(!e)throw new Error("transmissonInfo not exist yet");var i=e.transmitter,s=e.close;t._transmitter=i,null===(n=t._store)||void 0===n||n.signalChannelOpen();var c=Date.now()-d;lS.debug("[choose dc] dc open cost ".concat(c,"ms")),t._reliableTransmission=new WN((function(e){var n;t._transmitter&&"open"===t._transmitter.readyState&&(null===(n=t._transmitter)||void 0===n||n.send(e))}),(function(e){"string"==typeof e&&t.emit(jk.ON_MESSAGE,e)})),t._closeEstablishingTransmitter=function(){var e;null===(e=t._reliableTransmission)||void 0===e||e.close(),t._reliableTransmission=void 0,s()},a&&a(),i.onclose=o,i.onmessage=u,null===(r=t._store)||void 0===r||r.recordJoinChannelService({endTs:Date.now(),status:"success"},l),t._joinChannelServiceRecordIndex=l})).catch((function(e){var n;if(null===(n=t._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:e instanceof ek&&e.code===Oy.WS_ABORT?"aborted":"error",errors:[e]},l),"closed"!==t.state){if(e instanceof ek&&e.code===Oy.WS_ERR){var i=new ek(Oy.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return lS.error("[".concat(t._name,"]").concat(i)),void r(i)}o&&o(e)}else r(new ek(Oy.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}},{key:"reconnectWithAction",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,u,l,d,f,p=this,h=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(h.length>1&&void 0!==h[1])||h[1],!(this._reconnectCount>=this._retryConfig.maxRetryCount)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this._addresses){e.next=5;break}return e.abrupt("return",!1);case 5:if("closed"!==this.state){e.next=7;break}return e.abrupt("return",!1);case 7:if(this._onlineReconnectListener||B_.networkState!==T_.OFFLINE||(this._onlineReconnectListener=B_.onlineWaiter&&B_.onlineWaiter.then((function(){p._onlineReconnectListener=void 0}))),r=!0,this._reconnectInterrupter=function(){r=!1},!n){e.next=14;break}return i=vE(this._reconnectCount,this._retryConfig),lS.debug("[".concat(this._name,"] wait ").concat(i,"ms to reconnect datachannel, mode: ").concat(t)),e.next=14,by.race([nE(i),this._onlineReconnectListener||new by((function(){}))]);case 14:if("closed"!==this.state&&r){e.next=16;break}return e.abrupt("return",!1);case 16:if(this._reconnectCount+=1,a=function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.emit(jk.RECONNECT_CREATE_CONNECTION,n),e.next=3,p.createTransmitterConnection(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=18,"retry"!==t){e.next=26;break}return o=this._addresses[this.currentURLIndex],this.emit(jk.RECONNECT_WAITTING_FINISH,t),e.next=24,a(o,t);case 24:e.next=50;break;case 26:if("tryNext"!==t){e.next=49;break}this.currentURLIndex+=1,u=this.currentURLIndex;case 29:if(!(u<this._addresses.length)){e.next=37;break}if(!this._addresses[u].fingerprint&&!$w("FINGERPRINT")){e.next=33;break}return this.currentURLIndex=u,e.abrupt("break",37);case 33:this.currentURLIndex+=1;case 34:u++,e.next=29;break;case 37:if(!(this.currentURLIndex>=this._addresses.length)){e.next=42;break}return lS.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),e.next=41,this.reconnectWithAction("recover",!1);case 41:return e.abrupt("return",e.sent);case 42:return lS.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex)),l=this._addresses[this.currentURLIndex],this.emit(jk.RECONNECT_WAITTING_FINISH,t),e.next=47,a(l,t);case 47:e.next=50;break;case 49:"recover"===t&&(lS.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(jk.RECONNECT_WAITTING_FINISH,t),this.emit(jk.FAILBACK));case 50:return e.abrupt("return",!0);case 53:if(e.prev=53,e.t0=e.catch(18),lS.error("[".concat(this._name,"] reconnect failed"),e.t0.toString()),!(null!=e.t0&&null!==(d=e.t0.data)&&void 0!==d&&d.desc&&Array.isArray(e.t0.data.desc)&&e.t0.data.desc.length&&$i(f=e.t0.data.desc).call(f,"dynamic key expired"))){e.next=60;break}e.t1=(this.emit(jk.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1),e.next=63;break;case 60:return e.next=62,this.reconnectWithAction(t,n);case 62:e.t1=e.sent;case 63:return e.abrupt("return",e.t1);case 64:case"end":return e.stop()}}),e,this,[[18,53]])})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(qN),KN=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"_disconnectedReason",void 0),kf(f(i),"_websocketReconnectReason",void 0),kf(f(i),"_connectionState",PS.CLOSED),kf(f(i),"reconnectToken",void 0),kf(f(i),"websocket",void 0),kf(f(i),"openConnectionTime",void 0),kf(f(i),"clientId",void 0),kf(f(i),"lastMsgTime",Date.now()),kf(f(i),"uploadCache",[]),kf(f(i),"uploadCacheInterval",void 0),kf(f(i),"rttRolling",new OE(5)),kf(f(i),"pingpongTimer",void 0),kf(f(i),"inflateDataTimer",void 0),kf(f(i),"pingpongTimeoutCount",0),kf(f(i),"joinResponse",void 0),kf(f(i),"multiIpOption",void 0),kf(f(i),"initError",void 0),kf(f(i),"spec",void 0),kf(f(i),"store",void 0),kf(f(i),"onWebsocketMessage",(function(e){if(e instanceof ArrayBuffer)i.emit(LS.ON_BINARY_DATA,e);else{var t=JSON.parse(e);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(i.emit(t._type,t._message),t._type===jS.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===jS.ON_USER_BANNED))switch(t._message.error_code){case 14:i.close(w_.UID_BANNED);break;case 15:i.close(w_.IP_BANNED);break;case 16:i.close(w_.CHANNEL_BANNED)}}})),i.clientId=e.clientId,i.spec=e,i.store=r,i.websocket=new HN("gateway-".concat(i.clientId),i.spec.retryConfig,!0,r),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===PS.CONNECTED&&i.reconnect("retry",Uk.OFFLINE)})),i}return d(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===PS.CONNECTED?this.emit(LS.WS_CONNECTED):e===PS.RECONNECTING?this.emit(LS.WS_RECONNECTING,this._websocketReconnectReason):e===PS.CLOSED&&this.emit(LS.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket?this.websocket.url:null}},{key:"rtt",get:function(){return this.rttRolling.mean()}},{key:"request",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f,p,h,v=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=rE(6,""),o={_id:a,_type:t,_message:n},c=this.websocket.connectionID,u=function(){return new by((function(e,n){if(v.connectionState===PS.CONNECTED)return e();var r=function(){v.off(LS.WS_CLOSED,i),e()},i=function(){v.off(LS.WS_CONNECTED,r),n(new ek(Oy.WS_ABORT))};v.once(LS.WS_CONNECTED,r),v.once(LS.WS_CLOSED,i),t!==MS.PUBLISH&&t!==MS.SUBSCRIBE&&t!==MS.UNSUBSCRIBE&&t!==MS.UNPUBLISH&&t!==MS.CONTROL&&t!==MS.RESTART_ICE||v.once(LS.DISCONNECT_P2P,(function(){n(new ek(Oy.DISCONNECT_P2P))})),t!==MS.PUBLISH&&t!==MS.RESTART_ICE||v.once(LS.ABORT_P2P_EXECUTION,(function(){n(new ek(Oy.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==PS.CONNECTING&&this.connectionState!==PS.RECONNECTING||t===MS.JOIN||t===MS.REJOIN,e.t0){e.next=5;break}return e.next=5,u();case 5:if(t===MS.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),this.websocket.sendMessage(o,!0,!1),!i){e.next=9;break}return e.abrupt("return");case 9:return l=new by((function(e,r){var i=!1,o=function(r,a){i=!0,e({isSuccess:"success"===r,message:a||{}}),v.off(LS.WS_CLOSED,s),v.off(LS.WS_RECONNECTING,s),v.emit(LS.REQUEST_SUCCESS,t,n)};v.once("res-@".concat(a),o);var s=function e(){r(new ek(Oy.WS_ABORT,"type: ".concat(t))),v.off(LS.WS_CLOSED,e),v.off(LS.WS_RECONNECTING,e),v.off("res-@".concat(a),o)};v.once(LS.WS_CLOSED,s),v.once(LS.WS_RECONNECTING,s),nE($w("SIGNAL_REQUEST_TIMEOUT")).then((function(){v.websocket.connectionID!==c||i||(lS.warning("dc request timeout, type: ".concat(t)),v.emit(LS.REQUEST_TIMEOUT,t,n))}))})),d=null,e.prev=11,e.next=14,l;case 14:d=e.sent,e.next=36;break;case 17:if(e.prev=17,e.t1=e.catch(11),this.connectionState!==PS.CLOSED&&t!==MS.LEAVE){e.next=21;break}throw new ek(Oy.WS_ABORT);case 21:if(this.spec.forceWaitGatewayResponse&&!r){e.next=25;break}e.t2=e.t1.throw(),e.next=35;break;case 25:if(t!==MS.JOIN&&t!==MS.REJOIN){e.next=29;break}e.t3=null,e.next=34;break;case 29:return e.next=31,u();case 31:return e.next=33,this.request(t,n);case 33:e.t3=e.sent;case 34:e.t2=e.t3;case 35:return e.abrupt("return",e.t2);case 36:if(!d.isSuccess){e.next=38;break}return e.abrupt("return",d.message);case 38:if(f=Number(d.message.error_code||d.message.code),p=$k(f),h=new ek(Oy.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(d.message.error_str),{code:f,data:d.message}),"success"!==p.action){e.next=43;break}e.t4=d.message,e.next=68;break;case 43:if(lS.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(p.desc,", action: ").concat(p.action)),f!==DS.ERR_TOO_MANY_BROADCASTERS){e.next=48;break}e.t5=t===MS.JOIN||t===MS.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw(),e.next=67;break;case 48:if("failed"!==p.action){e.next=52;break}e.t6=h.throw(),e.next=66;break;case 52:if("quit"!==p.action){e.next=56;break}e.t7=(this.initError=h,this.close(),h.throw()),e.next=65;break;case 56:if(f===DS.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,lS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Uk.MULTI_IP)):this.reconnect(p.action,Uk.SERVER_ERROR),t!==MS.JOIN&&t!==MS.REJOIN){e.next=61;break}e.t8=null,e.next=64;break;case 61:return e.next=63,this.request(t,n);case 63:e.t8=e.sent;case 64:e.t7=e.t8;case 65:e.t6=e.t7;case 66:e.t5=e.t6;case 67:e.t4=e.t5;case 68:return e.abrupt("return",e.t4);case 69:case"end":return e.stop()}}),e,this,[[11,17]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"waitMessage",value:function(e,t){var n=this;return new by((function(r){var i=function i(a){(!t||t(a))&&(n.off(e,i),r(a))};n.on(e,i)}))}},{key:"upload",value:function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=$w("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===PS.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),$w("UPLOAD_CACHE_INTERVAL")||2e3))}}},{key:"send",value:function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)}},{key:"init",value:function(e,t){var n=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new by((function(r,i){n.once(LS.WS_CONNECTED,(function(){return r(n.joinResponse)})),n.once(LS.WS_CLOSED,(function(){return i(n.initError||new ek(Oy.WS_ABORT))})),n.connectionState=PS.CONNECTING,n.websocket.init(e).catch(i),n.websocket.once(jk.FAILBACK,(function(){void 0===n.openConnectionTime&&i(new ek(Oy.INIT_DATACHANNEL_TIMEOUT))})),n.inflateDataTimer&&window.clearInterval(n.inflateDataTimer),n.inflateDataTimer=window.setInterval((function(){n.handleInflateData()}),2e4),setTimeout((function(){t&&void 0===n.openConnectionTime&&(lS.debug("[".concat(n.clientId,"] init datachannel timeout while join with failback to websocket")),i(new ek(Oy.INIT_DATACHANNEL_TIMEOUT)))}),$w("DC_JOIN_WITH_FAILBACK"))}))}},{key:"close",value:function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||w_.LEAVE,this.connectionState=PS.CLOSED,lS.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===w_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new HN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}},{key:"join",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(LS.ABORT_P2P_EXECUTION),e.next=4,U_(this,LS.DATACHANNEL_CONNECTING);case 4:return t=e.sent,e.next=7,this.request(MS.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(LS.REPORT_JOIN_GATEWAY,Oy.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(LS.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rejoin",value:function(){var e=c(s().mark((function e(){var t,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new ek(Oy.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=V_(this,LS.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(MS.REJOIN,t);case 6:return n=e.sent,e.abrupt("return",!!n&&(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((function(e){r.emit(jS.ON_USER_ONLINE,{uid:e.uid}),e.audio&&r.emit(jS.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&r.emit(jS.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?r.emit(jS.MUTE_AUDIO,{uid:e.uid}):r.emit(jS.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?r.emit(jS.MUTE_VIDEO,{uid:e.uid}):r.emit(jS.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?r.emit(jS.ENABLE_LOCAL_AUDIO,{uid:e.uid}):r.emit(jS.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?r.emit(jS.ENABLE_LOCAL_VIDEO,{uid:e.uid}):r.emit(jS.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||r.emit(jS.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}},{key:"handleNotification",value:function(e){lS.debug("[".concat(this.clientId,"] receive notification: "),e);var t=$k(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(w_.UID_BANNED),void this.close()):void this.reconnect(t.action,Uk.SERVER_ERROR);lS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}},{key:"handlePingPong",value:function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=$w("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(lS.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$w("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Uk.TIMEOUT):this.request(MS.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),$w("REPORT_STATS")&&e.send(MS.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}}},{key:"handleInflateData",value:function(){var e=this.websocket.getInflateData(),t=e.inflateLength,n=e.deflateLength;0!==t&&0!==n&&this.upload(US.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}},{key:"handleWebsocketEvents",value:function(){var e=this;this.websocket.on(jk.RECONNECT_WAITTING_FINISH,(function(t){e.emit(LS.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(jk.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(LS.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(jk.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(jk.CLOSED,(function(){e.connectionState=PS.CLOSED})),this.websocket.on(jk.FAILED,(function(){e._disconnectedReason=w_.NETWORK_ERROR,e.connectionState=PS.CLOSED})),this.websocket.on(jk.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===PS.CONNECTED?e.connectionState=PS.RECONNECTING:e.connectionState=PS.CONNECTING})),this.websocket.on(jk.WILL_RECONNECT,(function(t,n){if(V_(e,LS.IS_P2P_DISCONNECTED)&&"retry"===t)return lS.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e.reconnectToken=void 0,e.emit(LS.NEED_RENEW_SESSION),e.emit(LS.DISCONNECT_P2P),n("tryNext");"retry"!==t&&(lS.debug("".concat(e.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),e.reconnectToken=void 0,e.emit(LS.NEED_RENEW_SESSION),e.emit(LS.DISCONNECT_P2P)),n(t)})),this.websocket.on(jk.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){lS.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",Uk.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(LS.REPORT_JOIN_GATEWAY,t.message||t.code,e.url||""),t instanceof ek&&t.code===Oy.UNEXPECTED_RESPONSE&&t.data.code===DS.ERR_NO_AUTHORIZED)return lS.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",Uk.SERVER_ERROR);lS.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",Uk.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(jk.REQUEST_NEW_URLS,(function(t,n){U_(e,LS.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(jk.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit(jS.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(jk.TO_CONNECT_DATACHANNEL,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",U_(e,LS.DATACHANNEL_PRECONNECT,n).then(r).catch(i));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this.websocket.on(jk.FAILBACK,(function(){void 0!==e.openConnectionTime&&e.emit(LS.DATACHANNEL_FAILBACK)}))}}]),n}(O_),zN=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this),kf(f(r),"_signal",void 0),kf(f(r),"_sequence",0),kf(f(r),"_userMap",new Map),kf(f(r),"_encoder",new TextEncoder),r._signal=e,r}return d(n,[{key:"send",value:function(){var e=c(s().mark((function e(t,n,r,i,a){var o,c,u,l,d,f,p=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof n&&(n=JSON.stringify(n)),i=null!==(o=i)&&void 0!==o?o:rE(6,""),a=null!==(c=a)&&void 0!==c?c:this._sequence++,l={_id:i,_type:t,_seq:null!==(u=a)&&void 0!==u?u:this._sequence++,_message:n},$w("SHOW_P2P_LOG")&&lS.debug("send message",l),this.sendStreamMessage(JSON.stringify(l)),!r){e.next=4;break}return e.abrupt("return");case 4:return d=new by((function(e,n){var r=window.setTimeout((function(){p.off("res-@".concat(i),a),lS.warning("[external-signal] request timeout, type: ".concat(t)),0===p._userMap.size?n(new o_(Oy.INVALID_REMOTE_USER)):n(new o_(Oy.TIMEOUT))}),$w("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=function(t,i){r&&window.clearTimeout(r),"success"===t?e({isSuccess:!0,message:i}):n(new o_(Oy.UNEXPECTED_ERROR,i))};p.once("res-@".concat(i),a)})),e.prev=5,e.next=8,d;case 8:f=e.sent,e.next=18;break;case 11:if(e.prev=11,e.t0=e.catch(5),e.t0.code!==Oy.TIMEOUT){e.next=17;break}return e.next=16,this.send(t,n,!1,i,a);case 16:return e.abrupt("return",e.sent);case 17:throw e.t0;case 18:return e.abrupt("return",f.isSuccess?f.message:void 0);case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(t,n,r,i,a){return e.apply(this,arguments)}return t}()},{key:"sendStreamMessage",value:function(e){var t=this;this._splitMessage(e).forEach((function(e){t._signal.request(MS.DATA_STREAM,{payload:Q_(t._encoder.encode(e))})}))}},{key:"onMessage",value:function(e){var t,n=e._uid,r=this._userMap.get(n);if(r?t=r.splitMessageMap:(t=new Map,this._userMap.set(n,{isStart:!1,splitMessageMap:t,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in e&&"total"in e){var i,a=e,o=a.id,s=a.total,c=null!==(i=t.get(o))&&void 0!==i?i:[];if(c.push(e),t.has(o)||t.set(o,c),c.length!==s)return;var u=_p(c).call(c,(function(e,t){return e.index-t.index})).map((function(e){return e.payload})).join("");t.delete(o),(e=JSON.parse(u))._uid=n}this.handleReceivedMessage(e)}},{key:"setStart",value:function(e){this._userMap.has(e)?this._userMap.get(e).isStart=!0:this._userMap.set(e,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}},{key:"setEnd",value:function(e){return this._userMap.delete(e),0===this._userMap.size}},{key:"ack",value:function(e,t,n){this.send(qk.ACK,JSON.stringify({success:!n,message:t}),!0,e)}},{key:"handleReceivedMessage",value:function(e){var t=this,n=function(){t._userMap.forEach((function(e){for(var n=e.receivedMessagesMap,r=e.nextExpectedSequenceNumber;n.has(r);){var i=n.get(r);n.delete(r),t.receiveMessage(i),e.nextExpectedSequenceNumber++}}))};if(e){var r=e._uid,i=e._seq,a=this._userMap.get(r),o=a.receivedMessagesMap,s=a.isStart,c=a.nextExpectedSequenceNumber;i<c?lS.debug("[external-signal] receive old message, seq: ".concat(i)):(o.set(i,e),s&&i===c&&(this.receiveMessage(e),o.delete(c),a.nextExpectedSequenceNumber++,n()))}else n()}},{key:"receiveMessage",value:function(e){var t=this,n=e._id,r=e._type,i=e._message,a=e._uid;if($w("SHOW_P2P_LOG")&&lS.debug("\u6536\u5230\u6d88\u606f",e),n)switch(e._type){case qk.PUBLISH:var o=JSON.parse(i);this._signal.emit(r,o,a),this.ack(e._id);break;case qk.CONTROL:case qk.UNPUBLISH:case qk.DO_SUBSCRIBE:case qk.DO_UNSUBSCRIBE:var s=JSON.parse(i);s.uid=a,U_(this._signal,r,s).then((function(n){t.ack(e._id,n)})).catch((function(n){t.ack(e._id,void 0,!0)}));break;case qk.ACK:var c=JSON.parse(i),u=c.success,l=c.message;this.emit("res-@".concat(n),u?"success":"failed",l);break;case qk.CALL:U_(this,r,i).then((function(e){t.ack(n,e)}));break;case qk.RESTART_ICE:case qk.EXCHANGE_SDP:case qk.SUBSCRIBE:case qk.UNSUBSCRIBE:U_(this._signal,r,i).then((function(e){t.ack(n,e)})).catch((function(n){t.ack(e._id,void 0,!0)}));break;case qk.CANDIDATE:this._signal.emit(r,i),this.ack(n);break;case qk.JOIN:this.emit(r,JSON.parse(i));break;default:this.emit(r,i),this.ack(n)}}},{key:"_splitMessage",value:function(e){if(e.length<n.MAX_MESSAGE_SIZE)return[e];for(var t=[],r=rE(6,""),i=0,a=Math.ceil(e.length/800);e.length>0;){i++;var o=e.slice(0,800);t.push({id:r,index:i,total:a,payload:o}),e=e.slice(800)}return t.map((function(e){return JSON.stringify(e)}))}},{key:"clear",value:function(){this._sequence=0,this._userMap.clear()}}]),n}(O_);kf(zN,"MAX_MESSAGE_SIZE",1024);var YN=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"_disconnectedReason",void 0),kf(f(i),"_websocketReconnectReason",void 0),kf(f(i),"_connectionState",PS.CLOSED),kf(f(i),"reconnectToken",void 0),kf(f(i),"_userInRoom",!1),kf(f(i),"_userOnlineTime",void 0),kf(f(i),"websocket",void 0),kf(f(i),"openConnectionTime",void 0),kf(f(i),"clientId",void 0),kf(f(i),"lastMsgTime",Date.now()),kf(f(i),"uploadCache",[]),kf(f(i),"uploadCacheInterval",void 0),kf(f(i),"rttRolling",new OE(5)),kf(f(i),"pingpongTimer",void 0),kf(f(i),"wsInflateDataTimer",void 0),kf(f(i),"pingpongTimeoutCount",0),kf(f(i),"joinResponse",void 0),kf(f(i),"multiIpOption",void 0),kf(f(i),"initError",void 0),kf(f(i),"spec",void 0),kf(f(i),"store",void 0),kf(f(i),"_external_signal",void 0),kf(f(i),"onWebsocketMessage",(function(e){if(e.data instanceof ArrayBuffer)i.emit(LS.ON_BINARY_DATA,e.data);else{var t=JSON.parse(e.data);if(i.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){var n="res-@".concat(t._id);i.emit(n,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case jS.ON_DATA_STREAM:return void i.handleDataStream(t._message);case jS.MUTE_AUDIO:case jS.MUTE_VIDEO:case jS.ON_P2P_LOST:return;case jS.ON_USER_ONLINE:i.emit(t._type,t._message);var r=t._message.uid;return i._external_signal.setStart(r),void i._external_signal.send(qk.JOIN,{onlineTime:i._userOnlineTime},!0)}if(i.emit(t._type,t._message),t._type===jS.ON_NOTIFICATION&&i.handleNotification(t._message),t._type===jS.ON_USER_BANNED)switch(t._message.error_code){case 14:i.close(w_.UID_BANNED);break;case 15:i.close(w_.IP_BANNED);break;case 16:i.close(w_.CHANNEL_BANNED)}if(t._type===jS.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case DS.ERR_LICENSE_MISSING:i.close(w_.LICENSE_MISSING);break;case DS.ERR_LICENSE_EXPIRED:i.close(w_.LICENSE_EXPIRED);break;case DS.ERR_LICENSE_MINUTES_EXCEEDED:i.close(w_.LICENSE_MINUTES_EXCEEDED);break;case DS.ERR_LICENSE_PERIOD_INVALID:i.close(w_.LICENSE_PERIOD_INVALID);break;case DS.ERR_LICENSE_MULTIPLE_SDK_SERVICE:i.close(w_.LICENSE_MULTIPLE_SDK_SERVICE);break;case DS.ERR_LICENSE_ILLEGAL:i.close(w_.LICENSE_ILLEGAL);break;default:i.close()}}}})),i.clientId=e.clientId,i.spec=e,i.store=r,i.websocket=new fT("gateway-".concat(i.clientId),i.spec.retryConfig,!0,$w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$w("JOIN_GATEWAY_USE_443PORT_ONLY"),r),i.handleWebsocketEvents(),window.addEventListener("offline",(function(){i.connectionState===PS.CONNECTED&&i.reconnect("retry",k_.OFFLINE)})),i._external_signal=new zN(f(i)),i._handleSignalP2PEvents(),i}return d(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){e!==this._connectionState&&(this._connectionState=e,e===PS.CONNECTED?this.emit(LS.WS_CONNECTED):e===PS.RECONNECTING?this.emit(LS.WS_RECONNECTING,this._websocketReconnectReason):e===PS.CLOSED&&this.emit(LS.WS_CLOSED,this._disconnectedReason))}},{key:"currentURLIndex",get:function(){return this.websocket.currentURLIndex}},{key:"url",get:function(){return this.websocket&&this.websocket.url||null}},{key:"rtt",get:function(){return this.rttRolling.mean()}},{key:"request",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f,p,h,v=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=rE(6,""),o={_id:a,_type:t,_message:n},c=this.websocket.connectionID,u=function(){return new by((function(e,n){if(v.connectionState===PS.CONNECTED)return e();var r=function(){v.off(LS.WS_CLOSED,i),e()},i=function(){v.off(LS.WS_CONNECTED,r),n(new o_(Oy.WS_ABORT))};v.once(LS.WS_CONNECTED,r),v.once(LS.WS_CLOSED,i),t!==MS.PUBLISH&&t!==MS.SUBSCRIBE&&t!==MS.UNSUBSCRIBE&&t!==MS.UNPUBLISH&&t!==MS.CONTROL&&t!==MS.RESTART_ICE||v.once(LS.DISCONNECT_P2P,(function(){n(new o_(Oy.DISCONNECT_P2P))})),t!==MS.PUBLISH&&t!==MS.RESTART_ICE||v.once(LS.ABORT_P2P_EXECUTION,(function(){n(new o_(Oy.DISCONNECT_P2P))}))}))},e.t0=this.connectionState!==PS.CONNECTING&&this.connectionState!==PS.RECONNECTING||t===MS.JOIN||t===MS.REJOIN,e.t0){e.next=5;break}return e.next=5,u();case 5:if(this.websocket.sendMessage(o,!0),!i){e.next=8;break}return e.abrupt("return");case 8:return l=new by((function(e,r){var i=!1,o=function(r,a){i=!0,e({isSuccess:"success"===r,message:a||{}}),v.off(LS.WS_CLOSED,s),v.off(LS.WS_RECONNECTING,s),v.emit(LS.REQUEST_SUCCESS,t,n)};v.once("res-@".concat(a),o);var s=function e(){r(new o_(Oy.WS_ABORT,"type: ".concat(t))),v.off(LS.WS_CLOSED,e),v.off(LS.WS_RECONNECTING,e),v.off("res-@".concat(a),o)};v.once(LS.WS_CLOSED,s),v.once(LS.WS_RECONNECTING,s),nE($w("SIGNAL_REQUEST_TIMEOUT")).then((function(){v.websocket.connectionID!==c||i||(lS.warning("[".concat(v.clientId,"] ws request timeout, type: ").concat(t)),v.emit(LS.REQUEST_TIMEOUT,t,n))}))})),d=null,e.prev=10,e.next=13,l;case 13:d=e.sent,e.next=35;break;case 16:if(e.prev=16,e.t1=e.catch(10),this.connectionState!==PS.CLOSED&&t!==MS.LEAVE){e.next=20;break}throw new o_(Oy.WS_ABORT);case 20:if(this.spec.forceWaitGatewayResponse&&!r){e.next=24;break}e.t2=e.t1.throw(),e.next=34;break;case 24:if(t!==MS.JOIN&&t!==MS.REJOIN){e.next=28;break}e.t3=null,e.next=33;break;case 28:return e.next=30,u();case 30:return e.next=32,this.request(t,n);case 32:e.t3=e.sent;case 33:e.t2=e.t3;case 34:return e.abrupt("return",e.t2);case 35:if(!d.isSuccess){e.next=37;break}return e.abrupt("return",d.message);case 37:if(f=Number(d.message.error_code||d.message.code),p=$k(f),h=new o_(Oy.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(d.message.error_str),{code:f,data:d.message}),"success"!==p.action){e.next=42;break}e.t4=d.message,e.next=67;break;case 42:if(lS.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(f,", message: ").concat(p.desc,", action: ").concat(p.action)),f!==DS.ERR_TOO_MANY_BROADCASTERS){e.next=47;break}e.t5=t===MS.JOIN||t===MS.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw(),e.next=66;break;case 47:if("failed"!==p.action){e.next=51;break}e.t6=h.throw(),e.next=65;break;case 51:if("quit"!==p.action){e.next=55;break}e.t7=(this.initError=h,this.close(),h.throw()),e.next=64;break;case 55:if(f===DS.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,lS.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",k_.MULTI_IP)):this.reconnect(p.action,k_.SERVER_ERROR),t!==MS.JOIN&&t!==MS.REJOIN){e.next=60;break}e.t8=null,e.next=63;break;case 60:return e.next=62,this.request(t,n);case 62:e.t8=e.sent;case 63:e.t7=e.t8;case 64:e.t6=e.t7;case 65:e.t5=e.t6;case 66:e.t4=e.t5;case 67:return e.abrupt("return",e.t4);case 68:case"end":return e.stop()}}),e,this,[[10,16]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"waitMessage",value:function(e,t){var n=this;return new by((function(r){var i=function i(a){(!t||t(a))&&(n.off(e,i),r(a))};n.on(e,i)}))}},{key:"upload",value:function(e,t){var n=this,r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(e){var i=$w("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((function(){if(n.connectionState===PS.CONNECTED){var e=n.uploadCache.splice(0,1)[0];0===n.uploadCache.length&&(window.clearInterval(n.uploadCacheInterval),n.uploadCacheInterval=void 0),n.upload(e._type,e._message)}}),$w("UPLOAD_CACHE_INTERVAL")||2e3))}}},{key:"send",value:function(e,t){var n={_type:e,_message:t};this.websocket.sendMessage(n)}},{key:"sendExtensionMessage",value:function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitTillUserOnline();case 2:return e.next=4,this._external_signal.send(t,n,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"init",value:function(e,t){var n=this;return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new by((function(t,r){n.once(LS.WS_CONNECTED,(function(){return t(n.joinResponse)})),n.once(LS.WS_CLOSED,(function(){return r(n.initError||new o_(Oy.WS_ABORT))})),n.connectionState=PS.CONNECTING,n.websocket.init(e).catch(r),n.wsInflateDataTimer&&window.clearInterval(n.wsInflateDataTimer),n.wsInflateDataTimer=window.setInterval((function(){n.handleWsInflateData()}),2e4)}))}},{key:"close",value:function(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||w_.LEAVE,this.connectionState=PS.CLOSED,lS.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===w_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new fT("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$w("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$w("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}},{key:"join",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.joinResponse){e.next=11;break}return this.emit(LS.ABORT_P2P_EXECUTION),e.next=4,U_(this,LS.REQUEST_JOIN_INFO);case 4:return t=e.sent,e.next=7,this.request(MS.JOIN,t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",(this.emit(LS.REPORT_JOIN_GATEWAY,Oy.TIMEOUT,this.url||""),!1));case 10:this.joinResponse=n,this.emit(LS.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token;case 11:return e.abrupt("return",(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=(new Date).getTime(),this._external_signal.clear(),!0));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"rejoin",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnectToken){e.next=2;break}throw new o_(Oy.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");case 2:return(t=V_(this,LS.REQUEST_REJOIN_INFO)).token=this.reconnectToken,e.next=6,this.request(MS.REJOIN,t);case 6:if(e.t0=!!e.sent,!e.t0){e.next=9;break}e.t0=(this.connectionState=PS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0);case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}},{key:"handleDataStream",value:function(e){try{var t,n=X_(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||$i(t=Object.values(qk)).call(t,i._type)?(e.seq&&delete e.seq,i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(jS.ON_DATA_STREAM,e)}catch(e){}}},{key:"handleNotification",value:function(e){lS.debug("[".concat(this.clientId,"] receive notification: "),e);var t=$k(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(w_.UID_BANNED),void this.close()):void this.reconnect(t.action,k_.SERVER_ERROR);lS.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}},{key:"handlePingPong",value:function(){var e=this;if(this.websocket&&"connected"===this.websocket.state){this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var t=$w("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(lS.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>$w("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",k_.TIMEOUT):this.request(MS.PING,void 0,!0).then((function(){e.pingpongTimeoutCount=0;var t=Date.now()-n;e.rttRolling.add(t),$w("REPORT_STATS")&&e.send(MS.PING_BACK,{pingpongElapse:t})})).catch((function(e){}))}}},{key:"handleWsInflateData",value:function(){var e=this.websocket.getWsInflateData(),t=e.wsInflateLength,n=e.wsDeflateLength;0!==t&&0!==n&&this.upload(US.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}},{key:"handleWebsocketEvents",value:function(){var e=this;this.websocket.on(BS.RECONNECT_WAITTING_FINISH,(function(t){e.emit(LS.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(BS.RECONNECT_CREATE_CONNECTION,(function(t){e.emit(LS.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(BS.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(BS.CLOSED,(function(){e.connectionState=PS.CLOSED})),this.websocket.on(BS.FAILED,(function(){e._disconnectedReason=w_.NETWORK_ERROR,e.connectionState=PS.CLOSED})),this.websocket.on(BS.RECONNECTING,(function(t){e._websocketReconnectReason=t,e.joinResponse=void 0,e.connectionState===PS.CONNECTED?e.connectionState=PS.RECONNECTING:e.connectionState=PS.CONNECTING})),this.websocket.on(BS.WILL_RECONNECT,(function(t,n,r){if(V_(e,LS.IS_P2P_DISCONNECTED)&&"retry"===t)return lS.debug("".concat(e.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e.reconnectToken=void 0,e.emit(LS.NEED_RENEW_SESSION),e.emit(LS.DISCONNECT_P2P),r("tryNext");"retry"!==t&&(lS.debug("".concat(e.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),e.reconnectToken=void 0,e.emit(LS.NEED_RENEW_SESSION),e.emit(LS.DISCONNECT_P2P)),r(t)})),this.websocket.on(BS.CONNECTED,(function(){e.openConnectionTime=Date.now(),e.reconnectToken?e.rejoin().catch((function(t){lS.warning("[".concat(e.clientId,"] rejoin failed ").concat(t)),e.reconnect("tryNext",k_.SERVER_ERROR)})):e.join().catch((function(t){if(e.emit(LS.REPORT_JOIN_GATEWAY,t.message||t.code,e.url||""),t instanceof o_&&t.code===Oy.UNEXPECTED_RESPONSE&&t.data.code===DS.ERR_NO_AUTHORIZED)return lS.warning("[".concat(e.clientId,"] reconnect no authorized, recover")),void e.reconnect("recover",k_.SERVER_ERROR);lS.error("[".concat(e.clientId,"] join gateway request failed"),t.toString()),e.spec.forceWaitGatewayResponse?e.reconnect("tryNext",k_.SERVER_ERROR):(e.initError=t,e.close())}))})),this.websocket.on(BS.REQUEST_NEW_URLS,(function(t,n){U_(e,LS.REQUEST_RECOVER,e.multiIpOption).then(t).catch(n)})),this.websocket.on(BS.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){e.emit(jS.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}},{key:"_handleSignalP2PEvents",value:function(){var e=this;this._external_signal.on(qk.JOIN,function(){var t=c(s().mark((function t(n){var r,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._userOnlineTime&&e._userOnlineTime<n.onlineTime)){t.next=8;break}return t.next=3,U_(e,LS.P2P_START,void 0);case 3:return r=t.sent,t.next=6,e._external_signal.send(qk.CALL,r);case 6:i=t.sent,e.emit(LS.P2P_CONNECTION,i,!0);case 8:e._userInRoom=!0,e.emit("user-online");case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.on(jS.ON_USER_OFFLINE,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._external_signal.clear(),e._userInRoom=!1;case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this._external_signal.on(qk.CALL,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._userInRoom=!0,e.emit("user-online"),t.prev=1,t.t0=r,t.next=5,U_(e,LS.P2P_START,n);case 5:t.t1=t.sent,(0,t.t0)(t.t1),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(1),i(t.t2);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e,n,r){return t.apply(this,arguments)}}())}},{key:"waitTillUserOnline",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new by((function(e){if(t._userInRoom)e();else{var n=function n(){t.off("user-online",n),e()};t.on("user-online",n)}})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(O_);function JN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JN(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var QN=new Map,$N=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"store",void 0),kf(f(i),"joinInfo",void 0),kf(f(i),"key",void 0),kf(f(i),"ntpOffset",0),kf(f(i),"signal",void 0),kf(f(i),"role",void 0),kf(f(i),"inChannelInfo",{joinAt:null,duration:0}),kf(f(i),"spec",void 0),kf(f(i),"_state","DISCONNECTED"),kf(f(i),"_statsCollector",void 0),kf(f(i),"_disconnectedReason",void 0),kf(f(i),"isSignalRecover",!1),kf(f(i),"hasChangeBGPAddress",!1),kf(f(i),"trafficStatsInterval",void 0),kf(f(i),"networkQualityInterval",void 0),kf(f(i),"_joinGatewayStartTime",0),kf(f(i),"_signalTimeout",!1),kf(f(i),"_clientRoleOptions",void 0),kf(f(i),"_isProactiveJoin",!1),i.store=e,i.spec=r,i.signal=i.store.useP2P?new YN(XN(XN({},r),{},{retryConfig:r.websocketRetryConfig}),e):i.store.useDataChannel?new KN(XN(XN({},r),{},{retryConfig:r.websocketRetryConfig}),e):new hT(XN(XN({},r),{},{retryConfig:r.websocketRetryConfig}),e),i._statsCollector=r.statsCollector,i.role=r.role||"audience",i._clientRoleOptions=r.clientRoleOptions,i.handleSignalEvents(),i}return d(n,[{key:"state",get:function(){return this._state},set:function(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(vk.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(vk.CONNECTION_STATE_CHANGE,e,t)}}},{key:"joinGatewayStartTime",get:function(){return this._joinGatewayStartTime},set:function(e){lS.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}},{key:"join",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,l,d,f,p,h=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signal instanceof KN&&(i=!1,"disabled"!==t.cloudProxyServer?(lS.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),i=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(lS.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),i=!0):t.apResponse.addresses.some((function(e){return e.fingerprint}))||$w("FINGERPRINT")||(lS.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),i=!0),i&&this.resetSignal()),this.store.joinGatewayStart(),"disabled"!==t.cloudProxyServer&&(this.hasChangeBGPAddress=!0),a=Date.now(),(o=QN.get(t.cname))||(o=new Map,QN.set(t.cname,o)),this._isProactiveJoin=!0,!o.has(t.uid)){e.next=7;break}throw c=new ek(Oy.UID_CONFLICT),bS.joinGateway(t.sid,{lts:a,succ:!1,ec:c.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof KN?"1":"0"}),this._isProactiveJoin=!1,c;case 7:if(o.set(t.uid,!0),this.joinInfo=t,this.key=n,l=0,this.joinGatewayStartTime=a,d=t.proxyServer,e.prev=11,lS.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof KN?"datachannel":"websocket"," join uid ").concat(l)),!(this.signal instanceof KN)){e.next=18;break}return e.next=15,this.signal.init(t.apResponse.addresses,r);case 15:f=e.sent,e.next=22;break;case 18:return p=t.gatewayAddrs.map((function(e){var n=e.address.split(":"),r=u(n,2),i={host:r[0],port:r[1]};return t.proxyServer&&(i.proxy=t.proxyServer),i})),e.next=21,this.signal.init(p,r);case 21:f=e.sent;case 22:l=f.uid,lS.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof KN?"datachannel":"websocket"," join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime)),e.next=32;break;case 25:if(e.prev=25,e.t0=e.catch(11),!e.t0||e.t0.code!==Oy.INIT_WEBSOCKET_TIMEOUT){e.next=29;break}throw lS.warning("[".concat(this.store.clientId,"] User join failed"),e.t0.toString()),e.t0;case 29:if(!e.t0||e.t0.code!==Oy.INIT_DATACHANNEL_TIMEOUT){e.next=31;break}throw lS.warning("[".concat(this.store.clientId,"] User join datachannel failed"),e.t0.toString()),this.resetSignal(),e.t0;case 31:throw lS.error("[".concat(this.store.clientId,"] User join failed"),e.t0.toString()),bS.joinGateway(t.sid,{lts:a,succ:!1,ec:e.t0.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!d,signalChannel:this.signal instanceof KN?"1":"0"}),this._isProactiveJoin=!1,o.delete(t.uid),this.signal.close(),e.t0;case 32:return e.abrupt("return",(this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),lS.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((function(){h.updateTrafficStats().catch((function(e){lS.warning("[".concat(h.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((function(){navigator&&void 0!==navigator.onLine&&!navigator.onLine?h.emit(vk.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):h._signalTimeout?h.emit(vk.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===h.state&&h._statsCollector.trafficStats?h.emit(vk.NETWORK_QUALITY,{uplinkNetworkQuality:MN(h._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:MN(h._statsCollector.trafficStats.B_dnq)}):h.emit(vk.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),l));case 33:case"end":return e.stop()}}),e,this,[[11,25]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"leave",value:function(){var e=c(s().mark((function e(){var t,n,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],n=r.length>1?r[1]:void 0,"DISCONNECTED"===this.state){e.next=14;break}if(n!==w_.FALLBACK&&(this.state="DISCONNECTING"),e.prev=3,e.t0=t||this.signal.connectionState!==PS.CONNECTED,e.t0){e.next=8;break}return e.next=8,function(e,t){return t===1/0?e:by.race([e,tE(t)])}(this.signal.request(MS.LEAVE,void 0,!0),3e3);case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(3),lS.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e.t1);case 13:this.signal.close(n),n!==w_.FALLBACK&&(this.state="DISCONNECTED"),this.reset();case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=c(s().mark((function e(t,n,r){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 2:return i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:$w("PUB_EXTEND"),twcc:!!$w("PUBLISH_TWCC"),rtx:!!$w("USE_PUB_RTX")},e.prev=3,e.next=6,this.signal.request(MS.PUBLISH,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==DS.ERR_PUBLISH_REQUEST_INVALID){e.next=16;break}return lS.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),e.t0.toString()),e.next=15,this.tryUnpubBeforeRepub(t,n);case 15:return e.abrupt("return",this.publish(t,n,!1));case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"publishDataChannel",value:function(){var e=c(s().mark((function e(t,n,r){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 2:return a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:null!==(i=n.maxRetransmits)&&void 0!==i?i:10,channel_id:n.channelId,metadata:n.metadata},e.prev=3,e.next=6,this.signal.request(MS.PUBLISH_DATASTREAM,a,!0);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==DS.ERR_PUBLISH_REQUEST_INVALID){e.next=15;break}return lS.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),e.t0.toString()),e.next=14,this.tryUnpubDataChannelBeforeRepub(t,n);case 14:return e.abrupt("return",this.publishDataChannel(t,n,!1));case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,this.signal.request(MS.UNPUBLISH,{stream_id:n,ortc:t},!0);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),lS.warning("[".concat(this.store.clientId,"] unpublish warning: "),e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unpublishDataChannel",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,by.all(t.map((function(e){return n.signal.request(MS.UNPUBLISH_DATASTREAM,{channel_id:e},!0)})));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),lS.warning("unpublish datachannels warning: ",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=c(s().mark((function e(t,n,r){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));case 2:return i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$w("SUBSCRIBE_TWCC"),rtx:!!$w("USE_SUB_RTX"),extend:$w("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray($w("SVC"))&&0!==$w("SVC").length?$w("SVC"):void 0},e.prev=3,e.next=6,this.signal.request(MS.SUBSCRIBE,i,!0);case 6:return e.abrupt("return",e.sent._message);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==DS.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return lS.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),e.t0.toString()),e.next=15,this.tryUnsubBeforeResub(t,n);case 15:return e.next=17,this.subscribe(t,n,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"subscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n,r){var i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));case 2:return i={uid:t,stream_id:n.id,channel_id:n.datachannelId},e.prev=3,e.next=6,this.signal.request(MS.SUBSCRIBE_DATASTREAM,i,!0);case 6:return e.abrupt("return",void e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!r||!e.t0.data||e.t0.data.code!==DS.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return lS.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),e.t0.toString()),e.next=15,this.tryUnsubDataChannelBeforeResub(t,n);case 15:return e.next=17,this.subscribeDataChannel(t,n,!1);case 17:return e.abrupt("return",e.sent);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"subscribeAll",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));case 2:return r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$w("USE_SUB_RTX")},e.prev=3,e.next=6,this.signal.request(MS.SUBSCRIBE_STREAMS,r,!0);case 6:case 17:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!n||!e.t0.data||e.t0.data.code!==DS.ERR_SUBSCRIBE_REQUEST_INVALID){e.next=18;break}return lS.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),e.t0.toString()),e.next=15,this.tryMassUnsubBeforeResub(t);case 15:return e.next=17,this.subscribeAll(t,!1);case 18:throw e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setVideoProfile",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){if(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width){var t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&((t=t.exact||t.ideal||t.max||t.min||0)||(i=!1)),"number"!=typeof n&&((n=n.exact||n.ideal||n.max||n.min||0)||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}}(t),!n){e.next=3;break}return e.abrupt("return",this.signal.request(MS.SET_VIDEO_PROFILE,n));case 3:lS.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),lS.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unsubscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){var r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"CONNECTED"===this.state||"RECONNECTING"===this.state){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));case 3:return e.next=5,by.all(t.map((function(e){return r.signal.request(MS.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:n},!0)})));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),lS.warning("unsubscribeDataChannel warning: ",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNSUBSCRIBE_STREAMS,t,!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),lS.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"reconnectPC",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iceParameters,r=t.dtlsParameters,i=t.rtpCapabilities,e.next=3,this.signal.request(MS.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0);case 3:return e.t0=e.sent,e.t1=this.getCurrentGatewayAddress(),e.abrupt("return",{gatewayEstablishParams:e.t0,gatewayAddress:e.t1});case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getGatewayInfo",value:function(){return this.signal.request(MS.GATEWAY_INFO)}},{key:"renewToken",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.RENEW_TOKEN,t);case 2:this.key=t.token;case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setClientRole",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&(this._clientRoleOptions=Object.assign({},n)),"CONNECTED"===this.state){e.next=2;break}return e.abrupt("return",void(this.role=t));case 2:return i=0,"audience"===t?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,e.next=6,this.signal.request(MS.SET_CLIENT_ROLE,{role:t,level:i,delay:r,client_ts:Date.now()});case 6:this.role=t;case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setRemoteVideoStreamType",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setDefaultRemoteVideoStreamType",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.DEFAULT_VIDEO_STREAM,{stream_type:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setStreamFallbackOption",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"pickSVCLayer",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer});case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setRTM2Flag",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.SET_RTM2_FLAG,{rtm2_flag:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendExtensionMessage",value:function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.signal instanceof YN)){e.next=2;break}return e.abrupt("return",this.signal.sendExtensionMessage(t,n,r));case 2:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"getInChannelInfo",value:function(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),XN({},this.inChannelInfo)}},{key:"getGatewayVersion",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.GATEWAY_INFO);case 2:return e.abrupt("return",e.sent.version);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reset",value:function(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){var e=QN.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}},{key:"updateTurnConfigFromSignal",value:function(){if(this.joinInfo){var e=function(e){var t;return(t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/))?{username:SS.username,password:SS.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(XN(XN({},SS),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}},{key:"updateTrafficStats",value:function(){var e=c(s().mark((function e(){var t,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.state){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.signal.request(MS.TRAFFIC_STATS,void 0,!0);case 4:(t=e.sent).timestamp=Date.now(),null!=t.ntp_offset&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((function(e){var t=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find((function(t){return t.peer_uid===e.peer_uid}));t&&t.B_st!==e.B_st&&H_((function(){n.emit(vk.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getJoinMessage",value:function(e){if(!this.joinInfo||!this.key)throw new ek(Oy.UNEXPECTED_ERROR,"can not generate join message, no join info");var t=Object.assign({},this.joinInfo.apResponse),n=$w("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);var r=XN({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zw,browser:navigator.userAgent,process_id:$w("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:$w("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:$w("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$w("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof $w("SUBSCRIBE_AUDIO_FILTER_TOPN")?$w("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof $w("ENABLE_PUBLISH_AUDIO_FILTER")?$w("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof $w("ENABLE_USER_LICENSE_CHECK")?$w("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===$w("USE_PUB_RTX")||!0===$w("USE_SUB_RTX")||void 0,disableFEC:$w("DISABLE_FEC"),enableNTPReport:!!$w("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!$w("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof $w("ENABLE_DATASTREAM_2")?$w("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof $w("RTM2_FLAG")?$w("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!$w("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof $w("USE_XR")?$w("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,$w("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}},{key:"getRejoinMessage",value:function(){if(!this.joinInfo)throw new ek(Oy.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}},{key:"handleSignalEvents",value:function(){var e=this;this.signal.on(LS.WS_RECONNECT_WAITTING_FINISH,(function(t){var n;$i(n=["tryNext","recover"]).call(n,t)&&e.joinInfo&&bS.adjustSessionStartTime(e.joinInfo.sid)})),this.signal.on(LS.WS_RECONNECT_CREATE_CONNECTION,(function(t){e.joinGatewayStartTime=Date.now()})),this.signal.on(LS.WS_RECONNECTING,(function(t){e.joinInfo&&bS.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:t||k_.NETWORK_ERROR}),e.joinInfo&&(e.state="RECONNECTING",bS.sessionInit(e.joinInfo.sid,{lts:(new Date).getTime(),extend:e.isSignalRecover?{recover:!0}:{rejoin:!0},cname:e.joinInfo.cname,appid:e.joinInfo.appId,mode:e.spec.mode}),e.isSignalRecover=!1,e.joinGatewayStartTime=Date.now())})),this.signal.on(LS.WS_CLOSED,(function(t){var n;switch(t){case w_.LEAVE:n=k_.LEAVE;break;case w_.UID_BANNED:case w_.IP_BANNED:case w_.CHANNEL_BANNED:case w_.SERVER_ERROR:n=k_.SERVER_ERROR;break;case w_.FALLBACK:n=k_.FALLBACK;break;case w_.LICENSE_MISSING:case w_.LICENSE_EXPIRED:case w_.LICENSE_MINUTES_EXCEEDED:case w_.LICENSE_PERIOD_INVALID:case w_.LICENSE_MULTIPLE_SDK_SERVICE:case w_.LICENSE_ILLEGAL:case w_.TOKEN_EXPIRE:n=t;break;default:n=k_.NETWORK_ERROR}lS.debug("[".concat(e.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+k_.NETWORK_ERROR)),e.joinInfo&&bS.WebSocketQuit(e.joinInfo.sid,{lts:Date.now(),succ:t===w_.LEAVE?1:-1,cname:e.joinInfo.cname,uid:e.joinInfo.uid,cid:e.joinInfo.cid,errorCode:n}),e._disconnectedReason=t,t!==w_.FALLBACK&&(e.state="DISCONNECTED"),e.reset()})),this.signal.on(LS.WS_CONNECTED,(function(){if(e.updateTurnConfigFromSignal(),e.state="CONNECTED",e.joinInfo&&("audience"===e.role&&e._clientRoleOptions&&(e._clientRoleOptions.level||e._clientRoleOptions.delay)&&(lS.debug("[".concat(e.store.clientId,"] patch to send set client role, role: ").concat(e.role,", mode: ").concat(e.spec.mode,", level: ").concat(e._clientRoleOptions.level,", delay: ").concat(e._clientRoleOptions.delay)),e.setClientRole(e.role,e._clientRoleOptions)),bS.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!0,ec:null,vid:e.joinInfo.vid,addr:e.signal.url,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,avoidJoinStartTime:e.store.avoidJoinStart,isProxy:!!e.joinInfo.proxyServer,signalChannel:e.signal instanceof KN?"1":"0"}),e._isProactiveJoin=!1,e.joinInfo.useLocalAccessPoint&&1===e.joinInfo.setLocalAPVersion)){var t=e.signal.url&&e.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void lS.error("[".concat(e.store.clientId,"] set local access point after joined failed: ").concat(t));Qw("EVENT_REPORT_DOMAIN",t[1]),Qw("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Qw("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}})),this.signal.on(jS.ON_UPLINK_STATS,(function(t){e._statsCollector.updateUplinkStats(t)})),this.signal.on(LS.REQUEST_RECOVER,(function(t,n,r){if(!e.joinInfo)return r(new ek(Oy.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(e.joinInfo.multiIP=t,e.hasChangeBGPAddress=!0),e.isSignalRecover=!0,U_(e,vk.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)})),this.signal.on(LS.REQUEST_JOIN_INFO,function(){var t=c(s().mark((function t(n){var r,i,a,o,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.updateTurnConfigFromSignal(),!e.store.useP2P){t.next=2;break}return t.abrupt("return",void n(e.getJoinMessage({ortc:{}})));case 2:return t.next=4,U_(e,vk.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(r=e.joinInfo)||void 0===r?void 0:r.turnServer});case 4:i=t.sent,a=i.iceParameters,o=i.dtlsParameters,c=i.rtpCapabilities,n(e.getJoinMessage({ortc:{iceParameters:a,dtlsParameters:o,rtpCapabilities:c,version:"2"}}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.signal.on(LS.REQUEST_REJOIN_INFO,(function(t){t(e.getRejoinMessage())})),this.signal.on(LS.REPORT_JOIN_GATEWAY,(function(t,n){e.joinInfo&&(bS.joinGateway(e.joinInfo.sid,{lts:e.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:e.joinInfo.uid,cid:e.joinInfo.cid,firstSuccess:e._isProactiveJoin,avoidJoinStartTime:e.store.avoidJoinStart,isProxy:!!e.joinInfo.proxyServer,signalChannel:e.signal instanceof KN?"1":"0"}),e._isProactiveJoin=!1)})),this.signal.on(LS.IS_P2P_DISCONNECTED,(function(t){t(V_(e,vk.IS_P2P_DISCONNECTED))})),this.signal.on(LS.DISCONNECT_P2P,(function(){e.emit(vk.DISCONNECT_P2P)})),this.signal.on(LS.NEED_RENEW_SESSION,(function(){e.emit(vk.NEED_RENEW_SESSION)})),this.signal.on(LS.REQUEST_SUCCESS,(function(){e._signalTimeout=!1})),this.signal.on(LS.REQUEST_TIMEOUT,(function(){e._signalTimeout=!0})),this.signal.on(LS.JOIN_RESPONSE,(function(t){var n=e.getCurrentGatewayAddress();e.emit(vk.JOIN_RESPONSE,t,n)})),this.signal.on(LS.DATACHANNEL_PRECONNECT,function(){var t=c(s().mark((function t(n,r,i){var a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateTurnConfigFromSignal(),a=e.getCurrentGatewayAddress(),t.abrupt("return",U_(e,vk.DATACHANNEL_PRECONNECT,n,a).then(r).catch(i));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this.signal.on(LS.DATACHANNEL_CONNECTING,function(){var t=c(s().mark((function t(n){var r,i,a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U_(e,vk.REQUEST_DC_CONNECTION_PARAMS);case 2:r=t.sent,i=r.iceParameters,a=r.dtlsParameters,o=r.rtpCapabilities,n(e.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:a,rtpCapabilities:o,version:"2"}}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.signal.on(LS.DATACHANNEL_FAILBACK,(function(){lS.warning("[".concat(e.store.clientId,"] User join datachannel failed")),e.reset(),e.resetSignal(),e.emit(vk.DATACHANNEL_FAILBACK)}))}},{key:"tryUnsubBeforeResub",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),lS.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryUnsubDataChannelBeforeResub",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNSUBSCRIBE,{stream_id:n.id},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),lS.warning("unsubscribe datachannel warning",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryUnpubBeforeRepub",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNPUBLISH,{stream_id:t,ortc:n},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),lS.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryUnpubDataChannelBeforeRepub",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.signal.request(MS.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),lS.warning("unpublish datastream warning: ",e.t0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tryMassUnsubBeforeResub",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={users:t.map((function(e){return{stream_id:e.stream_id,stream_type:e.stream_type}}))},e.prev=1,e.next=4,this.signal.request(MS.UNSUBSCRIBE_STREAMS,n,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===hk.Audio}))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(MS.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t.find((function(e){return e.stream_type===hk.Audio}))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n},e.prev=1,e.next=4,this.signal.request(MS.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t===Ck.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n},e.prev=1,e.next=4,this.signal.request(MS.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t===Ck.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n},e.prev=1,e.next=4,this.signal.request(MS.CONTROL,r,!0,!0);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"uploadStats",value:function(e,t){this.signal.upload(e,t)}},{key:"getSignalRTT",value:function(){return this.signal.rtt}},{key:"restartICE",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t},e.prev=1,e.next=4,this.signal.request(MS.RESTART_ICE,n,!0);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(1),lS.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"reconnect",value:function(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,k_.P2P_FAILED)}},{key:"getCurrentGatewayAddress",value:function(){var e;if(!$w("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}},{key:"setPublishAudioFilterEnabled",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.request(MS.SET_PARAMETER,{enablePublishAudioFilter:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetSignal",value:function(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(w_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new hT(XN(XN({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(vk.RESET_SIGNAL,yk.websocket)}}]),n}(O_);function ex(e,t,n,r){return new by((function(i,a){t.timeout=t.timeout||$w("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$_(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?eE(t.data):$_(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mw.request(t).then((function(e){"string"==typeof e.data?$_(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:$_(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((function(e){Mw.isCancel(e)?a(new ek(Oy.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new ek(Oy.NETWORK_TIMEOUT,e.message)):e.response?a(new ek(Oy.NETWORK_RESPONSE_ERROR,e.response.status)):a(new ek(Oy.NETWORK_ERROR,e.message))}))}))}!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof he&&he];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in n))break e;n=n[o]}(t=t(a=n[e=e[e.length-1]]))!=a&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<n.length;a++){var s=i[n[a]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;e:{var u={};try{u.__proto__={a:!0},c=u.a;break e}catch(e){}c=!1}n=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var l=n;function d(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function f(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function h(e){this.g=new d,this.G=e}function v(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var a=i.value}catch(t){return e.g.j=null,e.g.s(t),m(e)}return e.g.j=null,r.call(e.g,a),m(e)}function m(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function g(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){f(e.g);var n=e.g.j;return n?v(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),m(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function y(e,t){return t=new g(new h(t)),l&&e.prototype&&l(t,e.prototype),t}if(d.prototype.o=function(e){this.v=e},d.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},d.prototype.return=function(e){this.l={return:e},this.h=this.u},h.prototype.o=function(e){return f(this.g),this.g.j?v(this,this.g.j.next,e,this.g.o):(this.g.o(e),m(this))},h.prototype.s=function(e){return f(this.g),this.g.j?v(this,this.g.j.throw,e,this.g.o):(this.g.s(e),m(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},S="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,k=S.FormData,T=S.XMLHttpRequest&&S.XMLHttpRequest.prototype.send,I=S.Request&&S.fetch,C=S.navigator&&S.navigator.sendBeacon,R=S.Element&&S.Element.prototype,A=S.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in S&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){S.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},N=function(e){this.i=[];var t=this;e&&_(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?E(e.value):e.value,t.append(e.name,n))}))};if((e=N.prototype).append=function(e,t,n){w(arguments,2),this.i.push(b(e,t,n))},e.delete=function(e){w(arguments,1);var t=[];e=String(e),_(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return y(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){w(arguments,1);for(var n=s(this),r=n.next();!r.done;r=n.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){w(arguments,1);var t=[];return e=String(e),_(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return y(e,(function(e){if(1==e.h&&(t=s(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,s(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){w(arguments,2),e=String(e);var r=[],i=b(e,t,n),a=!0;_(this.i,(function(t){t[0]===e?a&&(a=!r.push(i)):r.push(t)})),a&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,a=this;return y(e,(function(e){if(1==e.h&&(t=s(a),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=s(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},N.prototype._asNative=function(){for(var e=new k,t=s(this),n=t.next();!n.done;n=t.next()){var r=s(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},N.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+O(E(r))+'"\r\n\r\n'+E(e)+"\r\n"):t.push(n+O(E(r))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},N.prototype[Symbol.iterator]=function(){return this.entries()},N.prototype.toString=function(){return"[object FormData]"},R&&!R.matches&&(R.matches=R.matchesSelector||R.mozMatchesSelector||R.msMatchesSelector||R.oMatchesSelector||R.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(N.prototype[A]="FormData"),T){var x=S.XMLHttpRequest.prototype.setRequestHeader;S.XMLHttpRequest.prototype.setRequestHeader=function(e,t){x.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},S.XMLHttpRequest.prototype.send=function(e){e instanceof N?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),T.call(this,e)):T.call(this,e)}}I&&(S.fetch=function(e,t){return t&&t.body&&t.body instanceof N&&(t.body=t.body._blob()),I.call(this,e,t)}),C&&(S.navigator.sendBeacon=function(e,t){return t instanceof N&&(t=t._asNative()),C.call(this,e,t)}),S.FormData=N}}();var tx=function(){var e=$w("AREAS");return 0===e.length&&e.push(_k.GLOBAL),AE(e).call(e,(function(e,t,n){var r=nx(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},nx=function(e){return e===_k.OVERSEA?"".concat(Sk.ASIA,",").concat(Sk.EUROPE,",").concat(Sk.AFRICA,",").concat(Sk.NORTH_AMERICA,",").concat(Sk.SOUTH_AMERICA,",").concat(Sk.OCEANIA):Sk[e]},rx=function(e){var t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((function(e){var n=Kk[e],r=Object.keys(n);r&&r.map((function(e){"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},ix={GLOBAL:{ASIA:[_k.CHINA,_k.JAPAN,_k.INDIA,_k.KOREA,_k.HKMC],EUROPE:[],NORTH_AMERICA:[_k.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},ax=Object.keys(ix[_k.GLOBAL]),ox=[_k.CHINA,_k.NORTH_AMERICA,_k.EUROPE,_k.ASIA,_k.JAPAN,_k.INDIA,_k.OCEANIA,_k.SOUTH_AMERICA,_k.AFRICA,_k.KOREA,_k.HKMC,_k.US],sx=function(e,t){var n,r,i=[];if($i(e).call(e,_k.GLOBAL)){var a=[_k.GLOBAL,_k.OVERSEA],o=Object.keys(Kk);if(t===_k.GLOBAL)throw new ek(Oy.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===_k.CHINA)i=[_k.OVERSEA];else if(r=t,$i(ax).call(ax,r)){var s=(n=t,ix[_k.GLOBAL][n]||[]),c=[].concat(a,[t],m(s));i=o.filter((function(e){return!$i(c).call(c,e)}))}else if(function(e){var t=!1;return ax.forEach((function(n){var r;$i(r=ix[_k.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){var u=function(e){var t;return ax.forEach((function(n){var r;$i(r=ix[_k.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),l=[].concat(a,[u,t]);i=o.filter((function(e){return!$i(l).call(l,e)}))}else i=e;i=function(e){var t=[];return ox.forEach((function(n){$i(e).call(e,n)&&t.push(n)})),t.concat(e.filter((function(e){return!$i(ox).call(ox,e)})))}(i)}else i=e;return i};function cx(e){var t,n;if(!e&&$i(t=$w("AREAS")).call(t,_k.EXTENSIONS))return lS.debug("update area from ap : reset"),void ux(wS,!0);if($i(n=$w("AREAS")).call(n,_k.GLOBAL)&&e){var r=Kk.EXTENSIONS;r&&(r={CODE:nx(_k.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},lS.debug("update area from ap success: ".concat(e,",config is "),r),Qw("AREAS",[_k.EXTENSIONS],!0),Object.keys(r).map((function(e){Qw(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}}function ux(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=bS.reportApiInvoke(null,{name:__.SET_AREA,options:e,tag:E_.TRACER});try{var r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((function(e){if(!$i(kk).call(kk,e))throw new ek(Oy.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){var i=e.areaCode,a=e.excludedArea;if(!i)throw new ek(Oy.INVALID_PARAMS,"area code is needed");var o=i;"string"==typeof i&&(o=[i]),r=a?sx(o,a):o}if(!t){if(eS.AREAS){var s=new ek(Oy.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void lS.warning("setArea is prohibited because of config-distribute")}if($i(r).call(r,_k.GLOBAL)&&$w("AREAS")===_k.EXTENSIONS){var c=new ek(Oy.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void lS.warning("setArea is prohibited because of ap extensions")}}Qw("AREAS",r,t);var u=rx(r);Object.keys(u).map((function(e){Qw(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?u[e][0]:u[e])})),lS.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lx(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fx=1;function px(e,t,n,r,i){fx+=1;var a,o,u={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:fx,requestId:fx,version:zw,cname:n.cname},l={service_name:t,json_body:JSON.stringify(u)},d=e[0];return mE(c(s().mark((function e(){var n,i,c,u,f,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),e.next=3,ex(d,{data:l,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});case 3:if(n=e.sent,o=Date.now()-a,0===n.code){e.next=7;break}throw i=new ek(Oy.UNEXPECTED_RESPONSE,"live streaming ap error, code"+n.code,{retry:!0,responseTime:o}),lS.error(i.toString()),i;case 7:if(200===(c=JSON.parse(n.json_body)).code){e.next=11;break}throw u=new ek(Oy.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(c.code,", reason: ").concat(c.reason),{code:c.code,responseTime:o}),lS.error(u.toString()),u;case 11:if(c.servers&&0!==c.servers.length){e.next=14;break}throw f=new ek(Oy.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:c.code,responseTime:o}),lS.error(f.toString()),f;case 14:return p=function(e,t){return{addressList:e.servers.map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat($w("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))})),workerToken:e.workerToken,vid:e.vid}}(c,t),e.abrupt("return",($w("LIVE_STREAMING_ADDRESS")&&(p.addressList=$w("LIVE_STREAMING_ADDRESS")instanceof Array?$w("LIVE_STREAMING_ADDRESS"):[$w("LIVE_STREAMING_ADDRESS")]),dx(dx({},p),{},{responseTime:o})));case 16:case"end":return e.stop()}}),e)}))),(function(r,i){return bS.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:o,serverIp:e[i%e.length]}),!1}),(function(r,i){return bS.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:o,serverIp:e[i%e.length]}),!!(r.code!==Oy.OPERATION_ABORTED&&r.code!==Oy.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(d=e[(i+1)%e.length],!0)}),i)}var hx=1;function vx(e,t,n,r){var i,a=e.url,o=e.areaCode,l=Date.now(),d=Ex(t,o,[RT.CHOOSE_SERVER]),f=u(d,2),p=f[0],h=f[1],v=B_.networkState;return mE(c(s().mark((function e(){var o,c,u,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=v&&B_.networkState===T_.OFFLINE&&B_.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,by.race([B_.onlineWaiter,nE(r&&r.maxRetryTimeout||hE.maxRetryTimeout)]);case 4:return v=B_.networkState,e.next=7,ex(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return o=e.sent,c=o.data,u=o.headers,i="1"===u.http3?1:-1,bS.reportResourceTiming(a,t.sid),gx(c,a,t,l,[RT.CHOOSE_SERVER],i),d=UN(c,RT.CHOOSE_SERVER),e.abrupt("return",(yx(d),xN(d,a)));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e&&bS.joinChooseServer(t.sid,{lts:l,succ:!0,csAddr:a,opid:h,serverList:e.gatewayAddrs.map((function(e){return e.address})),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[RT.CHOOSE_SERVER].toString(),isHttp3:i}),!1}),(function(e){return e.code!==Oy.OPERATION_ABORTED&&(e.code===Oy.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(bS.joinChooseServer(t.sid,{lts:l,succ:!1,csAddr:a,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[RT.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:i}),lS.warning("[".concat(t.clientId,"] Choose server network error, retry"),e),!0))}),r)}function mx(e,t,n,r){var i,a,o=e.url,l=e.areaCode,d=e.serviceIds,f=Date.now(),p=Ex(t,l,d),h=u(p,2),v=h[0],m=h[1];return mE(c(s().mark((function e(){var c,u,l,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a&&B_.networkState===T_.OFFLINE&&B_.onlineWaiter,!e.t0){e.next=4;break}return e.next=4,by.race([B_.onlineWaiter,nE(r&&r.maxRetryTimeout||hE.maxRetryTimeout)]);case 4:return a=B_.networkState,e.next=7,ex(o,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);case 7:return c=e.sent,u=c.data,l=c.headers,i="1"===l.http3?1:-1,bS.reportResourceTiming(o,t.sid),gx(u,o,t,f,d,i),p=UN(u,RT.CHOOSE_SERVER),h=UN(u,"proxy5"===t.cloudProxyServer?RT.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?RT.CLOUD_PROXY:RT.CLOUD_PROXY_FALLBACK),e.abrupt("return",(yx(p),{gatewayInfo:xN(p,o),proxyInfo:h,url:o}));case 13:case"end":return e.stop()}}),e)}))),(function(e){return e.gatewayInfo&&bS.joinChooseServer(t.sid,{lts:f,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((function(e){return e.address})),ec:null,opid:m,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:i}),e.proxyInfo&&bS.joinWebProxyAP(t.sid,{lts:f,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((function(e){return e.ip})).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1}),(function(e){return e.code!==Oy.OPERATION_ABORTED&&(e.code===Oy.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(bS.joinWebProxyAP(t.sid,{lts:f,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:a})}),lS.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))}),r)}var gx=function(e,t,n,r,i,a){var o=[],s=function(o){4096===o.flag?bS.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||bS.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:o.error.code,eventType:n.cloudProxyServer,unilbsServerIds:i.toString()})};if(e.response_body.forEach((function(t){var n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)lS.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{var r={error:new ek(Oy.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};o.push(r),s(r)}if(0!==n){var i=Xk(n),a={error:new ek(Oy.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?lS.warning(a.error.toString()):o.push(a),s(a)}})),o.length)throw lS.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(o.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)})).join(" | "))),new ek(Oy.CAN_NOT_GET_GATEWAY_SERVER,o.map((function(e){return"flag: ".concat(e.flag,", message: ").concat(e.error.message)})).join(" | "),{retry:!!o.find((function(e){return e.error.data.retry})),csIp:e.detail[502],desc:m(new Set(o.map((function(e){var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((function(e){return!!e}))))})},yx=function(e){var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new ek(Oy.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($w("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?cx(e.detail[23].toLowerCase()):cx()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19]))for(var a=e.detail[19],o=null==a?void 0:a.split(";"),s=0;s<o.length;s++){var c,u=PT(c=o[s]).call(c);e.addresses[s]&&o&&(e.addresses[s].fingerprint=u)}if($w("GATEWAY_ADDRESS")&&$w("GATEWAY_ADDRESS").length>0){lS.debug("assign gateway address to",$w("GATEWAY_ADDRESS"));var l=$w("GATEWAY_ADDRESS").map((function(t){var n,r,i=null!==(n=null===(r=e.addresses.find((function(e){return e.ip===t.ip&&e.port===t.port})))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=l}},_x=function(e,t){if(e.response_body&&e.response_body.length){var n=e.response_body[0];if(0!==n.buffer.code){var r=Xk(n.buffer.code);throw new ek(Oy.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw lS.debug("update ticket request received ap response without response body:",t),new ek(Oy.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Ex=function(e,t,n){var r=Math.floor(Math.random()*Math.pow(10,12)),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:dx({6:e.stringUid,11:t,12:$w("USE_NEW_TOKEN")?"1":void 0,22:t},$w("AP_RTM")?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((function(t){e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));var a=new FormData;return a.append("request",JSON.stringify(i)),[a,r]},bx=function(e,t){var n=Math.floor(Math.random()*Math.pow(10,12)),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((function(e){return{ip:e.ip,port:e.port}}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]},wx=0;function Sx(e){return by.all(e.map((function(e){return e.then((function(e){throw e}),(function(e){return e}))}))).then((function(e){throw e}),(function(e){return e}))}var kx=function(){var e=c(s().mark((function e(t){var n,r,i,a,o,u,l,d,f,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fragementLength,r=t.referenceList,i=t.asyncMapHandler,a=t.allFailedhandler,o=t.promisesCollector,u=0,l=n,f=0,p=function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e=u*l,t=e+l;return r.slice(e,t).map(i)}(),o&&o.push.apply(o,m(t)),e.prev=2,e.next=5,Sx(t);case 5:d=e.sent,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(2),u++,(f+=l)>=r.length){e.next=14;break}return e.next=13,p();case 13:return e.abrupt("return",void e.sent);case 14:a(e.t0);case 15:t.forEach((function(e){return e.cancel()}));case 16:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),e.next=6,p();case 6:return e.abrupt("return",d);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Tx(e,t,n,r){return Ix.apply(this,arguments)}function Ix(){return Ix=c(s().mark((function e(t,n,r,i){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=c(s().mark((function e(t,n,r,i){var a,o,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,o=[],u=function(){var e=c(s().mark((function e(){var a,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=$w("WEBCS_DOMAIN").slice(0,$w("AJAX_REQUEST_CONCURRENT")).map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:tx()}})),c=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=4,kx({fragementLength:$w("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return lS.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),vx(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:o});case 4:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=c(s().mark((function e(){var c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nE(1e3);case 2:if(null===a){e.next=4;break}return e.abrupt("return",a);case 4:return c=$w("WEBCS_DOMAIN_BACKUP_LIST").map((function(e){return{url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:tx()}})),u=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:c.map((function(e){return e.url}))}),e.next=8,kx({fragementLength:$w("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:function(e){return lS.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),vx(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},u),e[0]},promisesCollector:o});case 8:return l=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},u),l));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,Sx([u(),l()]);case 5:return a=e.sent,o.length&&o.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",a);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,n,r,i),e.next=3,a;case 3:return e.t0=e.sent,e.abrupt("return",{gatewayInfo:e.t0});case 5:case"end":return e.stop()}}),e)}))),Ix.apply(this,arguments)}function Cx(e,t,n,r,i){return Rx.apply(this,arguments)}function Rx(){return Rx=c(s().mark((function e(t,n,r,i,a){var o,c,u,l,d,f,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("disabled"!==(o=t.cloudProxyServer)){e.next=18;break}if(i){e.next=4;break}return e.abrupt("return");case 4:if(!t.useLocalAccessPoint){e.next=8;break}return e.next=7,Tx(t,n,r,a);case 7:case 17:return e.abrupt("return",e.sent);case 8:if(!$w("JOIN_WITH_FALLBACK_MEDIA_PROXY")){e.next=15;break}return e.next=11,Dx(t,n,r,a);case 11:return c=e.sent,u=c.gatewayInfo,l=c.proxyInfo,e.abrupt("return",(t.turnServer&&"auto"!==t.turnServer.mode||(t.turnServer={mode:"manual",servers:l.map((function(e){return{turnServerURL:e.address,tcpport:e.tcpport||SS.tcpport,udpport:e.udpport||SS.udpport,username:e.username||SS.username,password:e.password||SS.password,forceturn:!1,security:!0}}))}),{gatewayInfo:u}));case 15:return e.next=17,Tx(t,n,r,a);case 18:return e.next=20,Dx(t,n,r,a);case 20:return d=e.sent,f=d.proxyInfo,p=d.gatewayInfo,h={gatewayInfo:p},e.abrupt("return",(t.turnServer={mode:"manual",servers:f.map((function(e){return{turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:SS.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:SS.udpport,username:e.username||SS.username,password:e.password||SS.password,forceturn:"proxy4"!==o,security:"proxy5"===o}}))},lS.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),h));case 25:case"end":return e.stop()}}),e)}))),Rx.apply(this,arguments)}function Ax(e,t,n,r,i){return Ox.apply(this,arguments)}function Ox(){return Ox=c(s().mark((function e(t,n,r,i,a){var o,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=$w("ACCOUNT_REGISTER").slice(0,$w("AJAX_REQUEST_CONCURRENT")),u=[],u=n.proxyServer?o.map((function(e){return"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1")})):o.map((function(e){return"https://".concat(e,"/api/v1")})),l=null==a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u}),e.prev=4,e.next=7,function(){var e=c(s().mark((function e(t,n,r,i,a){var o,c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Date.now(),c={sid:r.sid,opid:10,appid:r.appId,string_uid:n},u=t[0],e.next=4,mE((function(){return ex(u+"".concat(-1===u.indexOf("?")?"?":"&","action=stringuid"),{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})}),(function(e,r){if(0===e.code){if(e.uid<=0||e.uid>=Math.pow(2,32))throw lS.error("Invalid Uint Uid ".concat(n," => ").concat(e.uid),e),bS.reqUserAccount(c.sid,{lts:o,success:!1,serverAddr:u,stringUid:c.string_uid,uid:e.uid,errorCode:Oy.INVALID_UINT_UID_FROM_STRING_UID,extend:c}),new ek(Oy.INVALID_UINT_UID_FROM_STRING_UID);return bS.reqUserAccount(c.sid,{lts:o,success:!0,serverAddr:u,stringUid:c.string_uid,uid:e.uid,errorCode:null,extend:c}),!1}var i=Xk(e.code);return i.retry&&(u=t[(r+1)%t.length]),bS.reqUserAccount(c.sid,{lts:o,success:!1,serverAddr:u,stringUid:c.string_uid,uid:e.uid,errorCode:i.desc,extend:c}),i.retry}),(function(e,n){return e.code!==Oy.OPERATION_ABORTED&&(bS.reqUserAccount(c.sid,{lts:o,success:!1,serverAddr:u,stringUid:c.string_uid,uid:null,errorCode:e.code,extend:c}),u=t[(n+1)%t.length],!0)}),a);case 4:if(0===(l=e.sent).code){e.next=8;break}throw d=Xk(l.code),new ek(Oy.UNEXPECTED_RESPONSE,d.desc);case 8:return e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()(u,t,n,r,i);case 7:return d=e.sent,e.abrupt("return",(null==a||a.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid));case 11:throw e.prev=11,e.t0=e.catch(4),null==a||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e.t0]},l),e.t0;case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),Ox.apply(this,arguments)}function Nx(e,t,n){return xx.apply(this,arguments)}function xx(){return xx=c(s().mark((function e(t,n,r){var i,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$w("CDS_AP").slice(0,$w("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1?action=config")})).map((function(e){return function(e,t,n,r){var i=Py(),a={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:zw,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return mE((function(){return ex(e,{data:a,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})}),void 0,(function(e){return e.code!==Oy.OPERATION_ABORTED}),r)}(e,t,n,r)})),a=null,o=null,c={},e.prev=2,e.next=5,Sx(i);case 5:a=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),e.t0.code!==Oy.OPERATION_ABORTED){e.next=12;break}throw e.t0;case 12:o=e.t0;case 13:if(i.forEach((function(e){return e.cancel()})),bS.reportApiInvoke(t.sid,{name:__.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:a}}).onSuccess(),a&&a.test_tags)try{c=function(e){if(!e.test_tags)return{};var t=e.test_tags,n=Object.keys(t),r={};return n.forEach((function(e){var n,i=PT(n=e.slice(4)).call(n),a=JSON.parse(t[e])[1];r[i]=a})),r}(a)}catch(t){}return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,null,[[2,8]])}))),xx.apply(this,arguments)}function Dx(e,t,n,r){return Px.apply(this,arguments)}function Px(){return Px=c(s().mark((function e(t,n,r,i){var a,o,u,l,d,f,p,h,v,m,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=$w("PROXY_SERVER_TYPE3"),o=function(e,t,n){var r=n||a;return Array.isArray(r)&&(r=t%2==0?a[1]:a[0]),"https://".concat(r,"/ap/?url=").concat(e)},u=null,l=[],d=function(){var e=c(s().mark((function e(){var a,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=$w("WEBCS_DOMAIN").slice(0,$w("AJAX_REQUEST_CONCURRENT")).map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:tx(),serviceIds:[RT.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?RT.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?RT.CLOUD_PROXY:RT.CLOUD_PROXY_FALLBACK]}})),c=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=4,kx({fragementLength:$w("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return lS.debug("[".concat(t.clientId,"] Connect to choose_server:"),e.url),mx(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:l});case 4:return u=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=c(s().mark((function e(){var a,c,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nE(1e3);case 2:if(null===u){e.next=4;break}return e.abrupt("return",u);case 4:return a=$w("WEBCS_DOMAIN_BACKUP_LIST").map((function(e,n){return{url:"disabled"===t.cloudProxyServer&&t.proxyServer?o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):o("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),areaCode:tx(),serviceIds:[RT.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?RT.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?RT.CLOUD_PROXY:RT.CLOUD_PROXY_FALLBACK]}})),c=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((function(e){return e.url}))}),e.next=8,kx({fragementLength:$w("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:function(e){return lS.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),e.url),mx(e,t,n,r)},allFailedhandler:function(e){throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:l});case 8:return d=e.sent,e.abrupt("return",(i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),d));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,Sx([d(),f()]);case 6:m=e.sent,p=m.gatewayInfo,h=m.proxyInfo,v=m.url,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0[0];case 15:if(l.length&&l.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),p&&h){e.next=17;break}throw new ek(Oy.UNEXPECTED_ERROR,"missing gateway or proxy response").print();case 17:return t.apUrl=v,"disabled"!==t.cloudProxyServer&&Array.isArray(a)&&v&&(g=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1],$i(a).call(a,g)&&(t.proxyServer=g,lS.setProxyServer(g),bS.setProxyServer(g))),e.t1=p,e.next=21,jN(h,p.uid);case 21:return e.t2=e.sent,u={gatewayInfo:e.t1,proxyInfo:e.t2},e.abrupt("return",u);case 24:case"end":return e.stop()}}),e,null,[[3,12]])}))),Px.apply(this,arguments)}function Lx(e,t,n,r){return Mx.apply(this,arguments)}function Mx(){return Mx=c(s().mark((function e(t,n,r,i){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=$w("UAP_AP").slice(0,$w("AJAX_REQUEST_CONCURRENT")).map((function(e){return n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})),e.next=3,px(a,t,n,r,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),Mx.apply(this,arguments)}function Ux(e,t,n){return jx.apply(this,arguments)}function jx(){return jx=c(s().mark((function e(t,n,r){var i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$w("UAP_AP").slice(0,$w("AJAX_REQUEST_CONCURRENT")).map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")})).map((function(e){return function(e,t,n,r){var i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:zw,cname:t.cname,uid:t.uid.toString(),requestId:hx,seq:hx};hx+=1;var a={service_name:"tele_channel",json_body:JSON.stringify(i)};return mE(c(s().mark((function t(){var r,i,o,c,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ex(e,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});case 2:if(0===(r=t.sent).code){t.next=6;break}throw i=new ek(Oy.UNEXPECTED_RESPONSE,"cross channel ap error, code"+r.code,{retry:!0}),lS.error(i.toString()),i;case 6:if(200===(o=JSON.parse(r.json_body)).code){t.next=10;break}throw c=new ek(Oy.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(o.code,", reason: ").concat(o.reason)),lS.error(c.toString()),c;case 10:if(o.servers&&0!==o.servers.length){t.next=13;break}throw u=new ek(Oy.UNEXPECTED_RESPONSE,"cross channel app center empty server"),lS.error(u.toString()),u;case 13:return t.abrupt("return",{vid:o.vid,workerToken:o.workerToken,addressList:($w("CHANNEL_MEDIA_RELAY_SERVERS")||o.servers).map((function(e){return"wss://".concat(e.address.replace(/\./g,"-"),".").concat($w("WORKER_DOMAIN"),":").concat(e.wss)}))});case 14:case"end":return t.stop()}}),t)}))),void 0,(function(e){return!!(e.code!==Oy.OPERATION_ABORTED&&e.code!==Oy.UNEXPECTED_RESPONSE||e.data&&e.data.retry)}),r)}(e,t,n,r)})),e.prev=1,e.next=4,Sx(i);case 4:return a=e.sent,e.abrupt("return",(i.forEach((function(e){return e.cancel()})),a));case 8:throw e.prev=8,e.t0=e.catch(1),e.t0[0];case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),jx.apply(this,arguments)}function Fx(e,t,n){return Vx.apply(this,arguments)}function Vx(){return Vx=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,a=[],o=function(){var e=c(s().mark((function e(o){var l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=$w(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((function(e){return t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2")})),e.t0=o,!e.t0){e.next=6;break}return e.next=5,nE(1e3);case 5:e.t0=null!==i;case 6:if(!e.t0){e.next=10;break}e.t1=i,e.next=13;break;case 10:return e.next=12,kx({fragementLength:$w("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:function(e){return lS.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),e),function(e,t,n,r){var i=bx(t,[RT.CHOOSE_SERVER]),a=u(i,1)[0],o=B_.networkState;return mE(c(s().mark((function t(){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=o&&B_.networkState===T_.OFFLINE&&B_.onlineWaiter,!t.t0){t.next=4;break}return t.next=4,by.race([B_.onlineWaiter,nE(r&&r.maxRetryTimeout||hE.maxRetryTimeout)]);case 4:return o=B_.networkState,t.next=7,ex(e,{data:a,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);case 7:return i=t.sent,t.abrupt("return",_x(i,e));case 9:case"end":return t.stop()}}),t)}))),(function(){return!1}),(function(e){return e.code!==Oy.OPERATION_ABORTED&&(e.code===Oy.UPDATE_TICKET_FAILED?e.data.retry:(lS.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))}),r)}(e,t,n,r)},allFailedhandler:function(e){throw e[0]},promisesCollector:a});case 12:e.t1=e.sent;case 13:return e.abrupt("return",e.t1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,Sx([o(!1),o(!0)]);case 5:return i=e.sent,a.length&&a.forEach((function(e){return e.cancel&&"function"==typeof e.cancel&&e.cancel()})),e.abrupt("return",i);case 10:throw e.prev=10,e.t0=e.catch(2),e.t0[0];case 13:case"end":return e.stop()}}),e,null,[[2,10]])}))),Vx.apply(this,arguments)}function Bx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bx(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Zx=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"configs",void 0),kf(f(e),"joinInfo",void 0),kf(f(e),"cancelToken",void 0),kf(f(e),"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),kf(f(e),"interval",void 0),kf(f(e),"mutex",new fE("config-distribute")),kf(f(e),"mutableParamsRead",!1),e}return d(n,[{key:"startGetConfigDistribute",value:function(e,t){var n=this;this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),$w("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((function(){n.updateConfigDistribute()}),$w("CONFIG_DISTRIBUTE_INTERVAL")))}},{key:"stopGetConfigDistribute",value:function(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}},{key:"awaitConfigDistributeComplete",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutex.isLocked){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.mutex.lock();case 4:e.t0=e.sent,(0,e.t0)();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateConfigDistribute",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mutableParamsRead||(this.mutableParamsRead=!0,bS.reportApiInvoke(null,{options:void 0,name:__.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:E_.TRACER}).onSuccess(JSON.stringify(eS))),this.joinInfo&&this.cancelToken&&this.retryConfig){e.next=3;break}return e.abrupt("return",void lS.debug("[config-distribute] get config distribute interrupted have no joininfo"));case 3:return e.next=5,this.mutex.lock();case 5:return n=e.sent,e.prev=6,e.next=9,Nx(this.joinInfo,this.cancelToken,this.retryConfig);case 9:t=e.sent,lS.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(6),r=new ek(Oy.NETWORK_RESPONSE_ERROR,e.t0),lS.warning("[config-distribute] ".concat(r.toString()));case 20:return e.prev=20,n(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,16,20,23]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getBitrateLimit",value:function(){return this.configs?this.configs.limit_bitrate:void 0}},{key:"handleBitrateLimit",value:function(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(Tk.UPDATE_BITRATE_LIMIT,e):this.emit(Tk.UPDATE_BITRATE_LIMIT,e))}},{key:"getLowStreamConfigDistribute",value:function(){return this.configs&&this.configs.limit_bitrate&&Gx({},this.configs.limit_bitrate.low_stream_uplink)}},{key:"cacheGlobalParameterConfig",value:function(e){for(var t,n=_p(t=Object.keys(e).filter((function(e){return/^webrtc_ng_global_parameter/.test(e)}))).call(t),r=0;r<n.length;r++)for(var i=n.length-1;i>r;i--){var a=n[i];if("number"==typeof e[a].__priority){var o=e[a].__priority,s=n[i-1];if("number"==typeof e[s].__priority){if(!(o>e[s].__priority))continue;var c=a;n[i]=n[i-1],n[i-1]=c}else{var u=a;n[i]=n[i-1],n[i-1]=u}}}var l={};n.forEach((function(t){var n=e[t],r=n.__expires;Object.keys(n).forEach((function(e){"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(l,e)||(l[e]=Gx({value:n[e]},r&&{expires:r}))}))}));try{!function(e){try{var n=Date.now();Object.keys(e).forEach((function(t){switch(t){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(Xw,t)){var r=e[t],i=r.value,a=r.expires;if(a&&a<=n)return;eS[t]=i,Xw[t]=i,lS.debug("Update global parameters from config distribute",t,i)}}}))}catch(t){lS.error("Error update config immediately: ".concat(e),t.message)}}(l);var d=JSON.stringify(l),f=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",f),lS.debug("Caching global parameters ".concat(d))}catch(e){lS.error("Error caching global parameters:",e.message)}}}]),n}(O_);function qx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qx(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Hx=function(e){p(n,e);var t=h(n);function n(e,r,i,a){var o;return l(this,n),o=t.call(this),kf(f(o),"spec",void 0),kf(f(o),"token",void 0),kf(f(o),"websocket",void 0),kf(f(o),"pingpongTimer",void 0),kf(f(o),"reconnectMode","retry"),kf(f(o),"serviceMode",void 0),kf(f(o),"reqId",0),kf(f(o),"commandReqId",0),kf(f(o),"handleWebSocketOpen",(function(){o.reconnectMode="retry",o.startPingPong()})),kf(f(o),"handleWebSocketMessage",(function(e){if(e.data){var t=JSON.parse(e.data);t.requestId?o.emit("@".concat(t.requestId,"-").concat(t.sid),t):o.serviceMode===GS.INJECT?o.emit(ok.INJECT_STREAM_STATUS,t):(bS.workerEvent(o.spec.sid,{actionType:"status",serverCode:t.code,workerType:o.serviceMode===GS.TRANSCODE?1:2}),o.emit(ok.PUBLISH_STREAM_STATUS,t))}})),o.spec=r,o.token=e,o.serviceMode=a,o.websocket=new pT("live-streaming",i),o.websocket.on(BS.CONNECTED,o.handleWebSocketOpen),o.websocket.on(BS.ON_MESSAGE,o.handleWebSocketMessage),o.websocket.on(BS.REQUEST_NEW_URLS,(function(e,t){U_(f(o),ok.REQUEST_NEW_ADDRESS).then(e).catch(t)})),o.websocket.on(BS.RECONNECTING,(function(){o.websocket.reconnectMode=o.reconnectMode})),o}return d(n,[{key:"init",value:function(e){return this.websocket.init(e)}},{key:"request",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f,p=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reqId+=1,"request"===t&&(this.commandReqId+=1),a=this.commandReqId,(o=this.reqId)&&this.websocket){e.next=4;break}throw new ek(Oy.UNEXPECTED_ERROR);case 4:if(c=Wx({command:t,sdkVersion:"4.19.1"===zw?"0.0.1":zw,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n),"closed"!==this.websocket.state){e.next=7;break}throw new ek(Oy.WS_DISCONNECT);case 7:if(u=function(){return new by((function(e,t){p.websocket.once(BS.CLOSED,(function(){return t(new ek(Oy.WS_ABORT))})),p.websocket.once(BS.CONNECTED,e)}))},e.t0="connected"!==this.websocket.state,!e.t0){e.next=12;break}return e.next=12,u();case 12:return c.clientRequest&&(c.clientRequest.workerToken=this.token),l=new by((function(e,t){var n=function(){t(new ek(Oy.WS_ABORT))};p.websocket.once(BS.RECONNECTING,n),p.websocket.once(BS.CLOSED,n),p.once("@".concat(o,"-").concat(p.spec.sid),(function(t){e(t)}))})),i&&bS.workerEvent(this.spec.sid,Wx(Wx({},i),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0})),d=Date.now(),this.websocket.sendMessage(c),f=null,e.prev=18,e.next=21,l;case 21:f=e.sent,e.next=33;break;case 24:if(e.prev=24,e.t1=e.catch(18),"closed"!==this.websocket.state){e.next=28;break}throw e.t1;case 28:return e.next=30,u();case 30:return e.next=32,this.request(t,n,r);case 32:return e.abrupt("return",e.sent);case 33:return e.abrupt("return",(i&&bS.workerEvent(this.spec.sid,Wx(Wx({},i),{},{requestId:a,actionType:"response",payload:JSON.stringify(f.serverResponse),serverCode:f.code,success:200===f.code,responseTime:Date.now()-d})),200!==f.code&&this.handleResponseError(f),f));case 34:case"end":return e.stop()}}),e,this,[[18,24]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"tryNextAddress",value:function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}},{key:"close",value:function(){var e="4.19.1"===zw?"0.0.1":zw;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}},{key:"handleResponseError",value:function(e){switch(e.code){case ck.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void lS.warning("live stream response already exists stream");case ck.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ck.LIVE_STREAM_RESPONSE_BAD_STREAM:case ck.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ek(Oy.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case ck.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ck.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ek(Oy.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case ck.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new ek(Oy.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ok.WARNING,t,e.serverResponse.url);case ck.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:var n=new ek(Oy.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ok.WARNING,n,e.serverResponse.url);case ck.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ck.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ek(Oy.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case ck.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:var r=new ek(Oy.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ok.WARNING,r,e.serverResponse.url);case ck.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case ck.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ck.LIVE_STREAM_RESPONSE_WORKER_LOST:case ck.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ck.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ck.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ek(Oy.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}},{key:"startPingPong",value:function(){var e=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((function(){"connected"===e.websocket.state&&e.request("ping",{}).catch(aE)}),6e3)}}]),n}(O_);function Kx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kx(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yx=function(e){p(n,e);var t=h(n);function n(e){var r;l(this,n);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hE,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hE;return r=t.call(this),kf(f(r),"onLiveStreamWarning",void 0),kf(f(r),"onLiveStreamError",void 0),kf(f(r),"onInjectStatusChange",void 0),kf(f(r),"spec",void 0),kf(f(r),"retryTimeout",1e4),kf(f(r),"connection",void 0),kf(f(r),"httpRetryConfig",void 0),kf(f(r),"wsRetryConfig",void 0),kf(f(r),"streamingTasks",new Map),kf(f(r),"isStartingStreamingTask",!1),kf(f(r),"taskMutex",new fE("live-streaming")),kf(f(r),"cancelToken",Mw.CancelToken.source()),kf(f(r),"transcodingConfig",void 0),kf(f(r),"injectConfig",zx({},bk)),kf(f(r),"injectLoopTimes",0),kf(f(r),"uapResponse",void 0),kf(f(r),"lastTaskId",1),kf(f(r),"statusError",new Map),r.spec=e,r.httpRetryConfig=a,r.wsRetryConfig=i,r}return d(n,[{key:"setTranscodingConfig",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 66!==(n=zx(zx({},Ek),t)).videoCodecProfile&&77!==n.videoCodecProfile&&100!==n.videoCodecProfile&&(lS.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((function(e){return zx(zx(zx({},rk),e),{},{zOrder:e.zOrder?e.zOrder+1:1})}))),function(e){p_(e.width)||u_(e.width,"config.width",0,1e4),p_(e.height)||u_(e.height,"config.height",0,1e4),p_(e.videoBitrate)||u_(e.videoBitrate,"config.videoBitrate",1,1e6),p_(e.videoFrameRate)||u_(e.videoFrameRate,"config.videoFrameRate"),p_(e.lowLatency)||s_(e.lowLatency,"config.lowLatency"),p_(e.audioSampleRate)||c_(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),p_(e.audioBitrate)||u_(e.audioBitrate,"config.audioBitrate",1,128),p_(e.audioChannels)||c_(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),p_(e.videoGop)||u_(e.videoGop,"config.videoGop"),p_(e.videoCodecProfile)||c_(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),p_(e.userCount)||u_(e.userCount,"config.userCount",0,17),p_(e.backgroundColor)||u_(e.backgroundColor,"config.backgroundColor",0,16777215),p_(e.userConfigExtraInfo)||d_(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!p_(e.transcodingUsers)&&(f_(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((function(e,t){nk(e.uid),p_(e.x)||u_(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),p_(e.y)||u_(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),p_(e.width)||u_(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),p_(e.height)||u_(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),p_(e.zOrder)||u_(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),p_(e.alpha)||u_(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),p_(e.watermark)||ak(e.watermark,"watermark"),p_(e.backgroundImage)||ak(e.backgroundImage,"backgroundImage"),e.images&&!p_(e.images)&&(f_(e.images,"config.images"),e.images.forEach((function(e,t){ak(e,"images[".concat(t,"]"))})))}(n),r=[],n.images&&r.push.apply(r,m(n.images.map((function(e){return zx(zx(zx({},ik),e),{},{zOrder:255})})))),n.backgroundImage&&(r.push(zx(zx(zx({},ik),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(zx(zx(zx({},ik),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((function(e){return zx({},e)})),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers),i=(n.userConfigs||[]).map((function(e){return"number"==typeof e.uid?by.resolve(e.uid):Ax(e.uid,c.spec,c.cancelToken.token,c.httpRetryConfig)})),e.next=7,by.all(i);case 7:if(e.sent.forEach((function(e,t){n.userConfigs&&n.userConfigs[t]&&(n.userConfigs[t].uid=e)})),this.transcodingConfig=n,!this.connection){e.next=22;break}return e.prev=10,e.next=13,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(XS(a=this.streamingTasks).call(a)).map((function(e){return e.taskId})).join("#")});case 13:o=e.sent,lS.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig)),e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(10),e.t0.data&&e.t0.data.retry){e.next=21;break}throw e.t0;case 21:e.t0.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((function(t){lS.warning("[".concat(c.spec.clientId,"] live streaming receive error"),e.t0.toString(),"try to republish",t.url),c.startLiveStreamingTask(t.url,t.mode,e.t0).then((function(){lS.debug("[".concat(c.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((function(e){lS.error("[".concat(c.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),c.onLiveStreamError&&c.onLiveStreamError(t.url,e)}))}));case 22:case"end":return e.stop()}}),e,this,[[10,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setInjectStreamConfig",value:function(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}},{key:"startLiveStreamingTask",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.from(XS(i=this.streamingTasks).call(i)).find((function(e){return e.mode===GS.INJECT}))||n!==GS.INJECT){e.next=2;break}return e.abrupt("return",new ek(Oy.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw());case 2:if(this.transcodingConfig||n!==GS.TRANSCODE){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");case 4:return a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},lS.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n)),e.next=8,this.taskMutex.lock();case 8:if(o=e.sent,this.connection||!r){e.next=11;break}return e.abrupt("return",void o());case 11:if(!this.streamingTasks.get(t)||r){e.next=13;break}return e.abrupt("return",(o(),new ek(Oy.LIVE_STREAMING_TASK_CONFLICT).throw()));case 13:if(e.prev=13,e.t0=this.connection,e.t0){e.next=19;break}return e.next=18,this.connect(n);case 18:this.connection=e.sent;case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(13),o(),e.t1;case 24:e.t2=n,e.next=e.t2===GS.TRANSCODE?27:e.t2===GS.RAW?29:e.t2===GS.INJECT?30:31;break;case 27:return a.transcodingConfig=zx({},this.transcodingConfig),e.abrupt("break",31);case 29:return e.abrupt("break",31);case 30:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes};case 31:return this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,c=this.lastTaskId++,e.prev=33,u=new by((function(e,n){nE(d.retryTimeout).then((function(){if(r)return n(r);var e=d.statusError.get(t);return e?(d.statusError.delete(t),n(e)):void 0}))})),e.next=37,by.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===GS.TRANSCODE?1:2,requestByUser:!r,tid:c.toString()}),u]);case 37:l=e.sent,this.isStartingStreamingTask=!1,lS.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:c}),o(),e.next=56;break;case 41:if(e.prev=41,e.t3=e.catch(33),o(),this.isStartingStreamingTask=!1,e.t3.data&&e.t3.data.retry&&!r){e.next=45;break}throw e.t3;case 45:if(!e.t3.data.changeAddress){e.next=52;break}return this.connection.tryNextAddress(),e.next=49,this.startLiveStreamingTask(t,n,e.t3);case 49:e.t4=e.sent,e.next=55;break;case 52:return e.next=54,this.startLiveStreamingTask(t,n,e.t3);case 54:e.t4=e.sent;case 55:return e.abrupt("return",e.t4);case 56:case"end":return e.stop()}}),e,this,[[13,21],[33,41]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"stopLiveStreamingTask",value:function(e){var t=this;return new by((function(n,r){var i=t.streamingTasks.get(e);if(!i||!t.connection)return new ek(Oy.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var a=i.mode;i.abortTask=function(){lS.debug("[".concat(t.spec.clientId,"] stop live streaming success(worker exception)")),t.streamingTasks.delete(e),n()},t.connection.request("request",{clientRequest:{command:a===GS.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:a===GS.TRANSCODE?1:2,requestByUser:!0,tid:(t.lastTaskId++).toString()}).then((function(r){lS.debug("[".concat(t.spec.clientId,"] stop live streaming success, code: ").concat(r.code)),t.streamingTasks.delete(e),0===t.streamingTasks.size&&a!==GS.INJECT&&(t.connection&&t.connection.close(),t.connection=void 0),n(),a===GS.INJECT&&t.onInjectStatusChange&&t.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_STOP_SUCCESS,t.spec.uid,e)})).catch(r)}))}},{key:"controlInjectStream",value:function(){var e=c(s().mark((function e(t,n,r,i){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this.streamingTasks.get(t))&&this.connection&&a.mode===GS.INJECT){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"can not find inject stream task to control");case 3:return e.next=5,this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:i}});case 5:return e.abrupt("return",e.sent.serverResponse);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"resetAllTask",value:function(){var e,t=this,n=Array.from(XS(e=this.streamingTasks).call(e));this.terminate();for(var r=function(){var e=a[i];t.startLiveStreamingTask(e.url,e.mode).catch((function(n){t.onLiveStreamError&&t.onLiveStreamError(e.url,n)}))},i=0,a=n;i<a.length;i++)r()}},{key:"terminate",value:function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mw.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}},{key:"connect",value:function(){var e=c(s().mark((function e(t){var n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connection){e.next=2;break}throw new ek(Oy.UNEXPECTED_ERROR,"live streaming connection has already connected");case 2:return e.next=4,U_(this,sk.REQUEST_WORKER_MANAGER_LIST,t);case 4:return n=e.sent,this.uapResponse=n,this.connection=new Hx(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ok.WARNING,(function(e,t){return r.onLiveStreamWarning&&r.onLiveStreamWarning(t,e)})),this.connection.on(ok.PUBLISH_STREAM_STATUS,(function(e){return r.handlePublishStreamServer(e)})),this.connection.on(ok.INJECT_STREAM_STATUS,(function(e){return r.handleInjectStreamServerStatus(e)})),this.connection.on(ok.REQUEST_NEW_ADDRESS,(function(e,n){if(!r.connection)return n(new ek(Oy.UNEXPECTED_ERROR,"can not get new live streaming address list"));U_(r,sk.REQUEST_WORKER_MANAGER_LIST,t).then((function(t){r.uapResponse=t,e(t.addressList)})).catch(n)})),e.next=13,this.connection.init(n.addressList);case 13:return e.abrupt("return",this.connection);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handlePublishStreamServer",value:function(e){var t=this,n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case ck.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ck.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var a=new ek(Oy.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return lS.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,a);if(!this.isStartingStreamingTask)return;this.statusError.set(n,a);case ck.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var o=new ek(Oy.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o);case ck.LIVE_STREAM_RESPONSE_WORKER_LOST:case ck.LIVE_STREAM_RESPONSE_WORKER_QUIT:var s;if(!this.connection)return;this.connection.tryNextAddress();for(var c=Array.from(XS(s=this.streamingTasks).call(s)),u=function(){var n=d[l];n.abortTask?n.abortTask():(lS.warning("[".concat(t.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),t.startLiveStreamingTask(n.url,n.mode,new ek(Oy.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((function(){lS.debug("[".concat(t.spec.clientId,"] republish live stream success"),n.url)})).catch((function(e){lS.error(e.toString()),t.onLiveStreamError&&t.onLiveStreamError(n.url,e)})))},l=0,d=c;l<d.length;l++)u();return}}},{key:"handleInjectStreamServerStatus",value:function(e){var t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(ZS.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void lS.debug("inject stream server status",e)}}},{key:"hasUrl",value:function(e){return this.streamingTasks.has(e)}}]),n}(O_),Jx=function(){function e(){l(this,e),kf(this,"destChannelMediaInfos",new Map),kf(this,"srcChannelMediaInfo",void 0)}return d(e,[{key:"setSrcChannelInfo",value:function(e){wk(e),this.srcChannelMediaInfo=e}},{key:"addDestChannelInfo",value:function(e){wk(e),this.destChannelMediaInfos.set(e.channelName,e)}},{key:"removeDestChannelInfo",value:function(e){tk(e),this.destChannelMediaInfos.delete(e)}},{key:"getSrcChannelMediaInfo",value:function(){return this.srcChannelMediaInfo}},{key:"getDestChannelMediaInfo",value:function(){return this.destChannelMediaInfos}}]),e}();function Xx(e){if(!(e instanceof Jx))return new ek(Oy.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();var t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new ek(Oy.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new ek(Oy.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}var Qx=function(e){p(n,e);var t=h(n);function n(e,r,i){var a;return l(this,n),a=t.call(this),kf(f(a),"ws",void 0),kf(f(a),"requestId",1),kf(f(a),"heartBeatTimer",void 0),kf(f(a),"joinInfo",void 0),kf(f(a),"clientId",void 0),kf(f(a),"onOpen",(function(){a.emit("open"),a.startHeartBeatCheck()})),kf(f(a),"onClose",(function(e){a.emit("close"),a.dispose()})),kf(f(a),"onMessage",(function(e){var t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(a.emit("status",t.serverStatus),void a.emit(t.serverStatus.command,t.serverStatus)):void 0;a.emit("req_".concat(t.requestId),t)})),a.joinInfo=e,a.clientId=r,a.ws=new pT("cross-channel-".concat(a.clientId),i),a.ws.on(BS.RECONNECTING,(function(){a.ws.reconnectMode="retry",a.emit("reconnecting")})),a.ws.on(BS.CONNECTED,a.onOpen),a.ws.on(BS.ON_MESSAGE,a.onMessage),a.ws.on(BS.CLOSED,a.onClose),a}return d(n,[{key:"isConnect",value:function(){return"connected"===this.ws.state}},{key:"sendMessage",value:function(e){var t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}},{key:"waitStatus",value:function(e){var t=this;return new by((function(n,r){var i=window.setTimeout((function(){r(new ek(Oy.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);t.once(e,(function(t){window.clearTimeout(i),t.state&&0!==t.state?r(new ek(Oy.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)})),t.once("dispose",(function(){window.clearTimeout(i),r(new ek(Oy.WS_ABORT))}))}))}},{key:"request",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("closed"!==this.ws.state){e.next=2;break}throw new ek(Oy.WS_DISCONNECT);case 2:if(n=function(){return new by((function(e,t){o.ws.once(BS.CLOSED,(function(){return t(new ek(Oy.WS_ABORT))})),o.ws.once(BS.CONNECTED,e)}))},e.t0="connected"!==this.ws.state,!e.t0){e.next=7;break}return e.next=7,n();case 7:return r=this.sendMessage(t),i=new by((function(e,t){var n=function(){t(new ek(Oy.WS_ABORT))};o.ws.once(BS.RECONNECTING,n),o.ws.once(BS.CLOSED,n),o.once("req_".concat(r),e),nE(3e3).then((function(){o.removeAllListeners("req_".concat(r)),o.ws.off(BS.RECONNECTING,n),o.ws.off(BS.CLOSED,n),t(new ek(Oy.TIMEOUT,"cross channel ws request timeout"))}))})),e.next=11,i;case 11:if((a=e.sent)&&200===a.code){e.next=14;break}throw new ek(Oy.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ws.removeAllListeners(BS.REQUEST_NEW_URLS),this.ws.on(BS.REQUEST_NEW_URLS,(function(e){e(t)})),e.next=4,this.ws.init(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}},{key:"sendPing",value:function(e){var t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}},{key:"startHeartBeatCheck",value:function(){var e=this;this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((function(){e.sendPing({command:"ping",appId:e.joinInfo.appId,cname:e.joinInfo.cname,uid:e.joinInfo.uid.toString(),sid:e.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}},{key:"clearHeartBeatCheck",value:function(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}]),n}(O_),$x=function(e){p(n,e);var t=h(n);function n(e,r,i,a,o){var u;return l(this,n),u=t.call(this),kf(f(u),"joinInfo",void 0),kf(f(u),"sid",void 0),kf(f(u),"clientId",void 0),kf(f(u),"cancelToken",Mw.CancelToken.source()),kf(f(u),"workerToken",void 0),kf(f(u),"requestId",0),kf(f(u),"signal",void 0),kf(f(u),"prevChannelMediaConfig",void 0),kf(f(u),"httpRetryConfig",void 0),kf(f(u),"_resolution",void 0),kf(f(u),"_state",fk.RELAY_STATE_IDLE),kf(f(u),"errorCode",pk.RELAY_OK),kf(f(u),"onStatus",(function(e){lS.debug("[".concat(u.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&u.emit("event",dk.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&u.emit("event",dk.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(u.errorCode=pk.SRC_TOKEN_EXPIRED,u.state=fk.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(u.errorCode=pk.DEST_TOKEN_EXPIRED,u.state=fk.RELAY_STATE_FAILURE))})),kf(f(u),"onReconnect",c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:lS.debug("[".concat(u.clientId,"] ChannelMediaSocket disconnect, reconnecting")),u.emit("event",dk.NETWORK_DISCONNECTED),u.state=fk.RELAY_STATE_IDLE,u.prevChannelMediaConfig&&u.sendStartRelayMessage(u.prevChannelMediaConfig).catch((function(e){u.state!==fk.RELAY_STATE_IDLE&&(lS.error("auto restart channel media relay failed",e.toString()),u.errorCode=pk.SERVER_CONNECTION_LOST,u.state=fk.RELAY_STATE_FAILURE)}));case 1:case"end":return e.stop()}}),e)})))),u.joinInfo=e,u.clientId=r,u.sid=iE(),u.signal=new Qx(u.joinInfo,u.clientId,i),u.httpRetryConfig=a,u._resolution=o,u}return d(n,[{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(e!==fk.RELAY_STATE_FAILURE&&(this.errorCode=pk.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}},{key:"startChannelMediaRelay",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===fk.RELAY_STATE_IDLE){e.next=2;break}throw new ek(Oy.INVALID_OPERATION);case 2:return this.state=fk.RELAY_STATE_CONNECTING,e.next=5,this.connect();case 5:return lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success")),e.prev=6,e.next=9,this.sendStartRelayMessage(t);case 9:e.next=20;break;case 11:if(e.prev=11,e.t0=e.catch(6),!e.t0.data||!e.t0.data.serverResponse||"SetSourceChannel"!==e.t0.data.serverResponse.command){e.next=15;break}throw new ek(Oy.CROSS_CHANNEL_FAILED_JOIN_SRC);case 15:if(!e.t0.data||!e.t0.data.serverResponse||"SetDestChannelStatus"!==e.t0.serverResponse.command){e.next=17;break}throw new ek(Oy.CROSS_CHANNEL_FAILED_JOIN_DEST);case 17:if(!e.t0.data||!e.t0.data.serverResponse||"StartPacketTransfer"!==e.t0.serverResponse.command){e.next=19;break}throw new ek(Oy.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);case 19:throw e.t0;case 20:this.prevChannelMediaConfig=t;case 21:case"end":return e.stop()}}),e,this,[[6,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateChannelMediaRelay",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===fk.RELAY_STATE_RUNNING){e.next=2;break}throw new ek(Oy.INVALID_OPERATION);case 2:return e.next=4,this.sendUpdateMessage(t);case 4:this.prevChannelMediaConfig=t;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setVideoProfile",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resolution=t,this.state===fk.RELAY_STATE_RUNNING){e.next=2;break}throw new ek(Oy.INVALID_OPERATION);case 2:return n=this.genMessage(lk.SetVideoProfile),e.next=5,this.signal.request(n);case 5:lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopChannelMediaRelay",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendStopRelayMessage();case 2:lS.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=fk.RELAY_STATE_IDLE,this.dispose();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){lS.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mw.CancelToken.source(),this.state=fk.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}},{key:"connect",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ux(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);case 2:return t=e.sent,this.workerToken=t.workerToken,e.next=6,this.signal.connect(t.addressList);case 6:this.emit("event",dk.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendStartRelayMessage",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(lk.StopPacketTransfer),e.next=3,this.signal.request(n);case 3:return e.next=5,this.signal.waitStatus("Normal Quit");case 5:return lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),r=this.genMessage(lk.SetSdkProfile,t),e.next=9,this.signal.request(r);case 9:return lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),i=this.genMessage(lk.SetSourceChannel,t),e.next=13,this.signal.request(i);case 13:return e.next=15,this.signal.waitStatus("SetSourceChannelStatus");case 15:return this.emit("event",dk.PACKET_JOINED_SRC_CHANNEL),lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),a=this.genMessage(lk.SetSourceUserId,t),e.next=20,this.signal.request(a);case 20:return lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),o=this.genMessage(lk.SetDestChannel,t),e.next=24,this.signal.request(o);case 24:return e.next=26,this.signal.waitStatus("SetDestChannelStatus");case 26:return this.emit("event",dk.PACKET_JOINED_DEST_CHANNEL),lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),c=this.genMessage(lk.StartPacketTransfer,t),e.next=31,this.signal.request(c);case 31:this.emit("event",dk.PACKET_SENT_TO_DEST_CHANNEL),this.state=fk.RELAY_STATE_RUNNING,lS.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution);case 35:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendUpdateMessage",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genMessage(lk.UpdateDestChannel,t),e.next=3,this.signal.request(n);case 3:this.emit("event",dk.PACKET_UPDATE_DEST_CHANNEL),lS.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendStopRelayMessage",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.genMessage(lk.StopPacketTransfer),e.next=3,this.signal.request(t);case 3:lS.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"genMessage",value:function(e,t){var n=this,r=[],i=[],a=[];this.requestId+=1;var o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zw,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.1"===o.sdkVersion&&(o.sdkVersion="0.0.1");var s=null,c=null;switch(e){case lk.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case lk.SetSourceChannel:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new ek(Oy.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},o;case lk.SetSourceUserId:if(!(c=t&&t.getSrcChannelMediaInfo()))throw new ek(Oy.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:c.uid+""},o;case lk.SetDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new ek(Oy.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),a.push(e.token||n.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:a},o;case lk.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case lk.Reconnect:return o.clientRequest={command:"Reconnect"},o;case lk.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case lk.UpdateDestChannel:if(!(s=t&&t.getDestChannelMediaInfo()))throw new ek(Oy.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((function(e){r.push(e.channelName),i.push(e.uid+""),a.push(e.token||n.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:a},o;case lk.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}]),n}(O_),eD=function(){function e(t,n){l(this,e),kf(this,"uid",void 0),kf(this,"_uintid",void 0),kf(this,"_trust_in_room_",!0),kf(this,"_trust_audio_enabled_state_",!0),kf(this,"_trust_video_enabled_state_",!0),kf(this,"_trust_audio_mute_state_",!0),kf(this,"_trust_video_mute_state_",!0),kf(this,"_audio_muted_",!1),kf(this,"_video_muted_",!1),kf(this,"_audio_enabled_",!0),kf(this,"_video_enabled_",!0),kf(this,"_audio_added_",!1),kf(this,"_video_added_",!1),kf(this,"_trust_video_stream_added_state_",!0),kf(this,"_trust_audio_stream_added_state_",!0),kf(this,"_audioTrack",void 0),kf(this,"_videoTrack",void 0),kf(this,"_dataChannels",[]),kf(this,"_audioSSRC",void 0),kf(this,"_videoSSRC",void 0),kf(this,"_audioOrtc",void 0),kf(this,"_videoOrtc",void 0),kf(this,"_cname",void 0),kf(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}return d(e,[{key:"hasVideo",get:function(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}},{key:"hasAudio",get:function(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}},{key:"audioTrack",get:function(){if(this.hasAudio)return this._audioTrack}},{key:"videoTrack",get:function(){if(this.hasVideo)return this._videoTrack}},{key:"dataChannels",get:function(){return this._dataChannels}}]),e}(),tD=Ey,nD=Tm;ti({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=nD.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var rD=Tm,iD=om;ti({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=rD.f(this),n=iD(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var aD=ve(tD),oD=os.f("asyncIterator"),sD=ve(oD);function cD(e,t){this.v=e,this.k=t}function uD(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof cD;aD.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new aD((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function lD(e){return function(){return new uD(e.apply(this,arguments))}}function dD(e){return new cD(e,0)}function fD(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new cD(r=new aD((function(n){n(e[t](r))})),1)}}return t[void 0!==nf&&Ef||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}uD.prototype["function"==typeof nf&&sD||"@@asyncIterator"]=function(){return this},uD.prototype.next=function(e){return this._invoke("next",e)},uD.prototype.throw=function(e){return this._invoke("throw",e)},uD.prototype.return=function(e){return this._invoke("return",e)};var pD=ve(oD),hD={exports:{}};!function(e,t){e.exports=function(){var e={8:function(e,t,n){n.r(t),n.d(t,{Parser:function(){return O},Printer:function(){return L},parse:function(){return F},print:function(){return V}});var r,i="\n",a="".concat("\r").concat(i),s=" ";function c(e){return e>="0"&&e<="9"}function v(e){return e>="!"&&e<="~"}function m(e){return v(e)||e>="\x80"&&e<="\xff"}function y(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function _(e){return e>="1"&&e<="9"}function E(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function b(e){return"d"===e||"h"===e||"m"===e||"s"===e}function w(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function S(e){return E(e)||c(e)||"+"===e||"/"===e}function k(e){return c(e)||E(e)||"+"===e||"/"===e||"-"===e||"_"===e}function T(e){return E(e)||c(e)||"+"===e||"/"===e}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(r||(r={}));var A=function(){function e(){l(this,e)}return d(e,[{key:"consumeText",value:function(e,t){for(var n=t;n<e.length;){var r=e[n];if("\0"===r||"\r"===r||r===i)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}},{key:"consumeUnicastAddress",value:function(e,t,n){return this.consumeTill(e,t,s)}},{key:"consumeOneOrMore",value:function(e,t,n){for(var r=t;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}},{key:"consumeSpace",value:function(e,t){if(e[t]===s)return t+1;throw new Error("Invalid space at ".concat(t,"."))}},{key:"consumeIP4Address",value:function(e,t){for(var n=t,r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}},{key:"consumeDecimalUChar",value:function(e,t){for(var n=t,r=0;r<3&&c(e[n]);r++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");var i=parseInt(e.slice(t,n));if(i>=0&&i<=255)return n;throw new Error("Invalid decimal uchar")}},{key:"consumeIP6Address",value:function(e,t){var n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n)):n}},{key:"consumeHexpart",value:function(e,t){var n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(":"===e[n=this.consumeHexseq(e,n)]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}},{key:"consumeHexseq",value:function(e,t){for(var n=t;":"===e[n=this.consumeHex4(e,n)]&&":"!==e[n+1];)n+=1;return n}},{key:"consumeHex4",value:function(e,t){for(var n,r=0;r<4;r++)if(!((n=e[t+r])>="0"&&n<="9"||n>="a"&&n<="f"||n>="A"&&n<="F")){if(0===r)throw new Error("Invalid hex 4");break}return t+r}},{key:"consumeFQDN",value:function(e,t){for(var n=t;c(e[n])||E(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}},{key:"consumeExtnAddr",value:function(e,t){return this.consumeOneOrMore(e,t,m)}},{key:"consumeMulticastAddress",value:function(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}},{key:"consumeIP6MulticastAddress",value:function(e,t){var n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}},{key:"consumeIP4MulticastAddress",value:function(e,t){var n=t+3,r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(var a=0;a<3;a++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),"/"===e[n=this.consumeTTL(e,n)]&&(n=this.consumeInteger(e,n)),n}},{key:"consumeInteger",value:function(e,t){if(!_(e[t]))throw new Error("Invalid integer.");for(t+=1;c(e[t]);)t+=1;return t}},{key:"consumeTTL",value:function(e,t){if("0"===e[t])return t+1;if(!_(e[t]))throw new Error("Invalid TTL.");t+=1;for(var n=0;n<2&&c(e[t]);n++)t+=1;return t}},{key:"consumeToken",value:function(e,t){return this.consumeOneOrMore(e,t,y)}},{key:"consumeTime",value:function(e,t){var n=t;if("0"===e[n])return n+1;for(_(e[n])&&(n+=1);c(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}},{key:"consumeAddress",value:function(e,t){return this.consumeTill(e,t,s)}},{key:"consumeTypedTime",value:function(e,t){var n=t;return b(e[n=this.consumeOneOrMore(e,n,c)])?n+1:n}},{key:"consumeRepeatInterval",value:function(e,t){if(!_(e[t]))throw new Error("Invalid repeat interval");for(t+=1;c(e[t]);)t+=1;return b(e[t])&&(t+=1),t}},{key:"consumePort",value:function(e,t){return this.consumeOneOrMore(e,t,c)}},{key:"consume",value:function(e,t,n){for(var r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}},{key:"consumeTill",value:function(e,t,n){for(var r=t;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}]),e}(),O=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),R(f(e),"records",[]),R(f(e),"currentLine",0),e}return d(n,[{key:"parse",value:function(e){var t=this.probeEOL(e);this.records=e.split(t).filter((function(e){return!!e.trim()})).map(this.parseLine),this.currentLine=0;var n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),a=this.parseInformation(),o=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),d=this.parseTimeFields(),f=this.parseKey(),p=this.parseSessionAttribute(),h=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:a,uri:o,emails:s,phones:c,connection:u,bandwidths:l,timeFields:d,key:f,attributes:p,mediaDescriptions:h}}},{key:"getCurrentRecord",value:function(){var e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}},{key:"probeEOL",value:function(e){for(var t=0;t<e.length;t++)if(e[t]===i)return"\r"===e[t-1]?a:i;throw new Error("Invalid newline character.")}},{key:"parseLine",value:function(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");var n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}},{key:"parseSessionAttribute",value:function(){for(var e=new x;this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==r.ATTRIBUTE)break;var n={attField:this.extractOneOrMore(t,(function(e){return y(e)&&":"!==e})),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,w)),e.parse(n),this.currentLine++}return e.digest()}},{key:"parseMediaAttributes",value:function(e){for(var t=new D(e);this.currentLine<this.records.length;){var n=this.getCurrentRecord();if(n.type!==r.ATTRIBUTE)break;var i={attField:this.extractOneOrMore(n,(function(e){return y(e)&&":"!==e})),_cur:0};":"===n.value[n.cur]&&(n.cur+=1,i.attValue=this.extractOneOrMore(n,w)),t.parse(i),this.currentLine++}return t.digest()}},{key:"parseKey",value:function(){var e=this.getCurrentRecord();if(e.type===r.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}},{key:"parseZone",value:function(){var e=this.getCurrentRecord();if(e.type===r.ZONE_ADJUSTMENTS){for(var t=[];;)try{var n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var i=!1;"-"===e.value[e.cur]&&(i=!0,e.cur+=1);var a=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:a,back:i})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}},{key:"parseRepeat",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.REPEAT)break;var n=this.extract(t,this.consumeRepeatInterval),i=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:i}),this.currentLine++}return e}},{key:"parseTypedTime",value:function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}},{key:"parseTime",value:function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}},{key:"parseBandWidth",value:function(){for(var e=[];this.currentLine<this.records.length;){var t=this.getCurrentRecord();if(t.type!==r.BANDWIDTH)break;var n=this.extractOneOrMore(t,y);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;var i=this.extractOneOrMore(t,c);e.push({bwtype:n,bandwidth:i}),this.currentLine++}return e}},{key:"parseVersion",value:function(){var e=this.getCurrentRecord();if(e.type!==r.VERSION)throw new Error("first sdp record must be version");var t=e.value.slice(0,this.consumeOneOrMore(e.value,0,c));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}},{key:"parseOrigin",value:function(){var e=this.getCurrentRecord();if(e.type!==r.ORIGIN)throw new Error("second line of sdp must be origin");var t=this.extractOneOrMore(e,m);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,c);this.consumeSpaceForRecord(e);var i=this.extractOneOrMore(e,c);this.consumeSpaceForRecord(e);var a=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);var o=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);var s=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:i,nettype:a,addrtype:o,unicastAddress:s}}},{key:"parseSessionName",value:function(){var e=this.getCurrentRecord();if(e.type===r.SESSION_NAME){var t=this.extract(e,this.consumeText);return this.currentLine++,t}}},{key:"parseInformation",value:function(){var e=this.getCurrentRecord();if(e.type===r.INFORMATION){var t=this.extract(e,this.consumeText);return this.currentLine++,t}}},{key:"parseUri",value:function(){var e=this.getCurrentRecord();if(e.type===r.URI)return this.currentLine++,e.value}},{key:"parseEmail",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.EMAIL)break;e.push(t.value),this.currentLine++}return e}},{key:"parsePhone",value:function(){for(var e=[];;){var t=this.getCurrentRecord();if(t.type!==r.PHONE)break;e.push(t.value),this.currentLine++}return e}},{key:"parseConnection",value:function(){var e=this.getCurrentRecord();if(e.type===r.CONNECTION){var t=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);var n=this.extractOneOrMore(e,y);this.consumeSpaceForRecord(e);var i=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:i}}}},{key:"parseMedia",value:function(){var e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);var n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);var r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");var i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}},{key:"parseTimeFields",value:function(){for(var e=[];this.getCurrentRecord().type===r.TIME;){var t=this.parseTime(),n=this.parseRepeat(),i=this.parseZone();e.push({time:t,repeats:n,zones:i})}return e}},{key:"parseMediaDescription",value:function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===r.MEDIA;){var t=this.parseMedia(),n=this.parseInformation(),i=this.parseConnections(),a=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:i,bandwidths:a,key:o,attributes:s})}return e}},{key:"parseConnections",value:function(){for(var e=[];this.currentLine<this.records.length&&this.getCurrentRecord().type===r.CONNECTION;)e.push(this.parseConnection());return e}},{key:"parseFmt",value:function(e){for(var t=[];;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}},{key:"extract",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.call.apply(t,[this,e.value,e.cur].concat(r)),o=e.value.slice(e.cur,a);return e.cur=a,o}},{key:"extractOneOrMore",value:function(e,t){var n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}},{key:"consumeSpaceForRecord",value:function(e){if(e.value[e.cur]!==s)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}]),n}(A),N=function(e){p(n,e);var t=h(n);function n(){var e;l(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),R(f(e),"attributes",void 0),R(f(e),"digested",!1),e}return d(n,[{key:"extractOneOrMore",value:function(e,t,n){var r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),a=u(n||[],2),o=a[0],s=a[1];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i}},{key:"consumeAttributeSpace",value:function(e){if(e.attValue[e._cur]!==s)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}},{key:"extract",value:function(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.call.apply(t,[this,e.attValue,e._cur].concat(r)),o=e.attValue.slice(e._cur,a);return e._cur=a,o}},{key:"atEnd",value:function(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}},{key:"peekChar",value:function(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}},{key:"peek",value:function(e,t){if(!e.attValue)throw new Error;for(var n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}},{key:"parseIceUfrag",value:function(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,S,[4,256])}},{key:"parseIcePwd",value:function(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,S,[22,256])}},{key:"parseIceOptions",value:function(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");for(var t=[];!this.atEnd(e);){t.push(this.extractOneOrMore(e,S));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}},{key:"parseFingerprint",value:function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}},{key:"parseExtmap",value:function(e){var t,n=this.extractOneOrMore(e,c);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeTill,s),i=C(C({entry:parseInt(n,10)},t&&{direction:t}),{},{extensionName:r});this.peekChar(e)===s&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}},{key:"parseSetup",value:function(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");var t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}]),n}(A),x=function(e){p(r,e);var n=h(r);function r(){var e;l(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=n.call.apply(n,[this].concat(i)),R(f(e),"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]}),e}return d(r,[{key:"parse",value:function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}},{key:"digest",value:function(){return this.digested=!0,this.attributes}},{key:"parseGroup",value:function(e){for(var t=this.extract(e,this.consumeToken),n=[];!this.atEnd(e)&&this.peekChar(e)===s;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}},{key:"parseIceLite",value:function(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}},{key:"parseTlsId",value:function(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,k)}},{key:"parseIdentity",value:function(e){for(var t=this.extractOneOrMore(e,T),n=[];!this.atEnd(e)&&this.peekChar(e)===s;){this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");var i=this.extractOneOrMore(e,(function(e){return e!==s&&w(e)}));n.push({name:r,value:i})}this.attributes.identities.push({assertionValue:t,extensions:n})}},{key:"parseMsidSemantic",value:function(e){this.peekChar(e)===s&&this.consumeAttributeSpace(e);for(var t={semantic:this.extract(e,this.consumeToken),identifierList:[]};;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}var n=this.extract(e,this.consumeTill,s);t.identifierList.push(n)}this.attributes.msidSemantic=t}}]),r}(N),D=function(e){p(r,e);var n=h(r);function r(e){var t;return l(this,r),t=n.call(this),R(f(t),"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),t.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]},t}return d(r,[{key:"parse",value:function(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}},{key:"parseCandidate",value:function(e){var t=this.extractOneOrMore(e,S,[1,32]);this.consumeAttributeSpace(e);var n=this.extractOneOrMore(e,c,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var i=this.extractOneOrMore(e,c,[1,10]);this.consumeAttributeSpace(e);var a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var o=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);var u={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:o,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),u.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),u.relPort=this.extract(e,this.consumePort));this.peekChar(e)===s;){this.consumeAttributeSpace(e);var l=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),u.extension[l]=this.extractOneOrMore(e,v)}this.attributes.candidates.push(u)}},{key:"parseRemoteCandidate",value:function(e){for(var t=[];;){var n=this.extractOneOrMore(e,c,[1,5]);this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);var i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}},{key:"parseEndOfCandidates",value:function(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}},{key:"parseRtpmap",value:function(e){var t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");var r={encodingName:n,clockRate:this.extractOneOrMore(e,c)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}},{key:"parsePtime",value:function(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}},{key:"parseMaxPtime",value:function(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}},{key:"parseDirection",value:function(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}},{key:"parseSSRC",value:function(e){var t=this.extractOneOrMore(e,c);this.consumeAttributeSpace(e);var n,r=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),n=this.extract(e,this.consumeTill));var i=this.attributes.ssrcs.find((function(e){return e.ssrcId===parseInt(t,10)}));i?i.attributes[r]=n:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:g({},r,n)})}},{key:"parseFmtp",value:function(e){var t=this.extract(e,this.consumeTill,s);this.consumeAttributeSpace(e);var n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((function(e){var t=e.split("="),n=u(t,2),i=n[0],a=n[1];i=i.trim();var o="string"==typeof a?a.trim():null;"string"==typeof i&&i.length>0&&(r[i]=o)}));var i=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}},{key:"parseFmtParameters",value:function(e){var t={},n=this.extract(e,this.consumeTill,"=");e._cur++;var r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){var i=this.extract(e,this.consumeTill,"=");e._cur++;var a=this.extract(e,this.consumeTill,";");t[i]=a}return t}},{key:"parseRtcpFb",value:function(e){var t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,s),this.consumeAttributeSpace(e);var n,r=this.extract(e,this.consumeTill,s);if("trr-int"===r)n={type:r,interval:this.extract(e,this.consumeTill)};else{var i={type:r};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),i.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===s&&(i.additional=this.extract(e,this.consumeTill))),n=i}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{var a=this.attributes.payloads.find((function(e){return e.payloadType===parseInt(t,10)}));a?a.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}}},{key:"parseRTCPMux",value:function(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}},{key:"parseRTCPMuxOnly",value:function(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}},{key:"parseRTCPRsize",value:function(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}},{key:"parseRTCP",value:function(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");var t={port:this.extract(e,this.consumePort)};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,y),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,y),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}},{key:"parseMsid",value:function(e){var t={id:this.extractOneOrMore(e,y,[1,64])};this.peekChar(e)===s&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,y,[1,64])),this.attributes.msids.push(t)}},{key:"parseImageAttr",value:function(e){this.attributes.imageattr.push(e.attValue)}},{key:"parseRid",value:function(e){var t=this.extractOneOrMore(e,(function(e){return E(e)||c(e)||"_"===e||"-"===e}));this.consumeAttributeSpace(e);var n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===s){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");for(var r=[];;){var i=this.extract(e,this.consumeToken);r.push(i);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=r,this.peekChar(e)===s&&this.extract(e,this.consume,s)}for(;;){var a=this.extract(e,this.consumeToken);if("depend"===a){var o={type:a,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(o)}else{var u={type:a};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),u.val=this.extract(e,this.consumeTill,";")),n.params.push(u)}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}},{key:"parseSimulcast",value:function(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}},{key:"parseSctpPort",value:function(e){this.attributes.sctpPort=this.extractOneOrMore(e,c,[1,5])}},{key:"parseMaxMessageSize",value:function(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,c,[1,void 0])}},{key:"digest",value:function(){return this.digested=!0,this.attributes}},{key:"parseMid",value:function(e){this.attributes.mid=this.extract(e,this.consumeToken)}},{key:"parseSSRCGroup",value:function(e){for(var t=this.extract(e,this.consumeToken),n=[];;)try{this.consumeAttributeSpace(e);var r=this.extract(e,this.consumeInteger);n.push(parseInt(r,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}]),r}(N);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(){function e(){l(this,e),P(this,"eol",a)}return d(e,[{key:"print",value:function(e,t){var n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions)}},{key:"printVersion",value:function(e){return"v=".concat(e).concat(this.eol)}},{key:"printOrigin",value:function(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}},{key:"printSessionName",value:function(e){return e?"s=".concat(e).concat(this.eol):""}},{key:"printInformation",value:function(e){return e?"i=".concat(e).concat(this.eol):""}},{key:"printUri",value:function(e){return e?"u=".concat(e).concat(this.eol):""}},{key:"printEmail",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printPhone",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="e=".concat(i).concat(this.eol)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printConnection",value:function(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}},{key:"printBandwidth",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="b=".concat(i.bwtype,":").concat(i.bandwidth).concat(this.eol)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printTimeFields",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="t=".concat(i.time.startTime," ").concat(i.time.startTime).concat(this.eol);var a,s=o(i.repeats);try{for(s.s();!(a=s.n()).done;){var c=a.value;n+="r=".concat(c.repeatInterval," ").concat(c.typedTimes.join(" ")).concat(this.eol)}}catch(u){s.e(u)}finally{s.f()}i.zoneAdjustments&&(n+="z=",n+="z=".concat(i.zoneAdjustments.map((function(e){return"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)})).join(" ")).concat(this.eol),n+=this.eol)}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"printKey",value:function(e){return e?"k=".concat(e).concat(this.eol):""}},{key:"printAttributes",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="a=".concat(i.attField).concat(i.attValue?":".concat(i.attValue):"").concat(this.eol)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printMediaDescription",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=this.printMedia(i.media),n+=this.printInformation(i.information),n+=this.printConnections(i.connections),n+=this.printBandwidth(i.bandwidths),n+=this.printKey(i.key),n+=this.printMediaAttributes(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printConnections",value:function(e){var t,n="",r=o(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=this.printConnection(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"printMedia",value:function(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}},{key:"printSessionAttributes",value:function(e){return new U(this.eol).print(e)}},{key:"printMediaAttributes",value:function(e){return new j(this.eol).print(e)}}]),e}(),M=function(){function e(t){l(this,e),P(this,"eol",void 0),this.eol=t}return d(e,[{key:"printIceUfrag",value:function(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}},{key:"printIcePwd",value:function(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}},{key:"printIceOptions",value:function(e){return void 0===e?"":"a=ice-options:".concat(e.join(s)).concat(this.eol)}},{key:"printFingerprints",value:function(e){return e.length>0?e.map((function(e){return"a=fingerprint:".concat(e.hashFunction).concat(s).concat(e.fingerprint)})).join(this.eol)+this.eol:""}},{key:"printExtmap",value:function(e){var t=this;return e.map((function(e){return"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(s).concat(e.extensionName).concat(e.extensionAttributes?"".concat(s).concat(e.extensionAttributes):"").concat(t.eol)})).join("")}},{key:"printSetup",value:function(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}},{key:"printUnrecognized",value:function(e){var t=this;return e.map((function(e){return"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(t.eol)})).join("")}}]),e}(),U=function(e){p(n,e);var t=h(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"print",value:function(e){var t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized)}},{key:"printGroups",value:function(e){var t=this,n="";return e.length>0&&(n+=e.map((function(e){return"a=group:".concat(e.semantic).concat(e.identificationTag.map((function(e){return"".concat(s).concat(e)})).join("")).concat(t.eol)})).join("")),n}},{key:"printIceLite",value:function(e){return void 0===e?"":"a=ice-lite"+this.eol}},{key:"printTlsId",value:function(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}},{key:"printIdentity",value:function(e){return 0===e.length?"":e.map((function(e){return"a=identity:".concat(e.assertionValue).concat(e.extensions.map((function(e){return"".concat(s).concat(e.name).concat(e.value?"=".concat(e.value):"")})))})).join(this.eol)+this.eol}},{key:"printMsidSemantic",value:function(e){if(!e)return"";var t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(s,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((function(e){return"".concat(s).concat(e)}))),t+this.eol}}]),n}(M),j=function(e){p(n,e);var t=h(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"print",value:function(e){var t=e.attributes,n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized)}},{key:"printCandidates",value:function(e){var t=this;return e.map((function(e){return"a=candidate:".concat(e.foundation).concat(s).concat(e.componentId).concat(s).concat(e.transport).concat(s).concat(e.priority).concat(s).concat(e.connectionAddress).concat(s).concat(e.port).concat(s,"typ").concat(s).concat(e.type).concat(e.relAddr?"".concat(s,"raddr").concat(s).concat(e.relAddr):"").concat(e.relPort?"".concat(s,"rport").concat(s).concat(e.relPort):"").concat(Object.keys(e.extension).map((function(t){return"".concat(s).concat(t).concat(s).concat(e.extension[t])})).join("")).concat(t.eol)})).join("")}},{key:"printRemoteCandidatesList",value:function(e){var t=this;return e.map((function(e){return"a=remote-candidates:".concat(e.join(s)).concat(t.eol)})).join("")}},{key:"printEndOfCandidates",value:function(e){return void 0===e?"":"a=end-of-candidates"+this.eol}},{key:"printRTPRelated",value:function(e){var t=this;if(!e.payloads)return"";var n=e.payloads,r="";r+=e.rtcpFeedbackWildcards.map((function(e){return t.printRTCPFeedback("*",e)})).join("");var i,a=o(n);try{var s=function(){var e=i.value;r+=t.printRtpMap(e.payloadType,e.rtpMap),r+=t.printFmtp(e.payloadType,e.fmtp),r+=e.rtcpFeedbacks.map((function(n){return t.printRTCPFeedback(e.payloadType,n)})).join("")};for(a.s();!(i=a.n()).done;)s()}catch(c){a.e(c)}finally{a.f()}return r}},{key:"printFmtp",value:function(e,t){if(!t)return"";var n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(s).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(s).concat(Object.keys(t.parameters).map((function(e){return"".concat(e,"=").concat(t.parameters[e])})).join(";")).concat(this.eol)}},{key:"printRtpMap",value:function(e,t){return t?"a=rtpmap:".concat(e).concat(s).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}},{key:"printRTCPFeedback",value:function(e,t){var n="a=rtcp-fb:".concat(e).concat(s),r=t;return"trr-int"===r.type?n+="ttr-int".concat(s).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(s).concat(r.parameter),r.additional&&(n+="".concat(s).concat(r.additional)))),n+this.eol}},{key:"printPtime",value:function(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}},{key:"printMaxPtime",value:function(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}},{key:"printDirection",value:function(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}},{key:"printSSRC",value:function(e){var t=this;return e.map((function(e){return Object.keys(e.attributes).map((function(n){return"a=ssrc:".concat(e.ssrcId.toString(10)).concat(s).concat(n).concat(e.attributes[n]?":".concat(e.attributes[n]):"").concat(t.eol)})).join("")})).join("")}},{key:"printRTCPMux",value:function(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}},{key:"printRTCPMuxOnly",value:function(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}},{key:"printRTCPRsize",value:function(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}},{key:"printRTCP",value:function(e){if(void 0===e)return"";var t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(s).concat(e.netType)),e.addressType&&(t+="".concat(s).concat(e.addressType)),e.address&&(t+="".concat(s).concat(e.address)),t+this.eol}},{key:"printMSId",value:function(e){var t=this;return e.map((function(e){return"a=msid:".concat(e.id).concat(e.appdata?"".concat(s).concat(e.appdata):"").concat(t.eol)})).join("")}},{key:"printImageattr",value:function(e){var t=this;return e.map((function(e){return"a=imageattr:".concat(e).concat(t.eol)})).join("")}},{key:"printRid",value:function(e){var t=this;return e.map((function(e){var n="a=rid:".concat(e.id).concat(s).concat(e.direction);return e.payloads&&(n+="".concat(s,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(n+="".concat(s).concat(e.params.map((function(e){return"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)})).join(";"))),n+t.eol})).join("")}},{key:"printSimulcast",value:function(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}},{key:"printSCTPPort",value:function(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}},{key:"printMaxMessageSize",value:function(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}},{key:"printMid",value:function(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}},{key:"printSSRCGroups",value:function(e){var t=this;return e.map((function(e){return"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((function(e){return"".concat(s).concat(e.toString(10))})).join("")).concat(t.eol)})).join("")}}]),n}(M);function F(e){return(new O).parse(e)}function V(e,t){return(new L).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)}()}(hD);var vD=hD.exports;function mD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mD(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=t.filterRTX,a=t.filterVideoFec,o=t.filterAudioFec,s=t.filterAudioCodec,c=t.filterVideoCodec,u=n.useXR,l=[],d=[],f=[],p=[],h=!1,v=!1;if(vD.parse(e).mediaDescriptions.forEach((function(e){r&&r!==e.attributes.direction||("video"!==e.media.mediaType||h||(d=e.attributes.payloads,p=e.attributes.extmaps,h=!0),"audio"!==e.media.mediaType||v||(l=e.attributes.payloads,f=e.attributes.extmaps,v=!0))})),!p||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!f||0===l.length)throw new Error("Cannot get audio capabilities from SDP.");return d.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),l.forEach((function(e){var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(l=l.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),d=d.filter((function(e){var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),a&&(d=d.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),o&&(l=l.filter((function(e){var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null==s?void 0:s.length)>0&&(l=l.filter((function(e){var t;return $i(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0&&(d=d.filter((function(e){var t;return $i(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),{audioCodecs:l,videoCodecs:d,audioExtensions:f,videoExtensions:p}}function _D(e){var t,n,r,i=vD.parse(e),a=o(i.mediaDescriptions);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(!t){var c=s.attributes.iceUfrag,u=s.attributes.icePwd;if(!c||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:c,icePwd:u}}if(!n){var l=s.attributes.fingerprints;l.length>0&&(n={fingerprints:l})}}}catch(d){a.e(d)}finally{a.f()}if(!n&&i.attributes.fingerprints.length>0&&(n={fingerprints:i.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function ED(e,t){var n=[],r=e.attributes.ssrcGroups.filter((function(e){return"FID"===e.semantic})),i=e.attributes.ssrcGroups.find((function(e){return"SIM"===e.semantic})),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((function(e){var i,a=null===(i=r.find((function(t){return t.ssrcIds[0]===e})))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?a:void 0})}));else if(r.length>0){var o=r[0].ssrcIds[0],s=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?s:void 0})}else{if(0===a.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function bD(e,t){var n,r=e.cname;t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],lS.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),lS.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=e.iceParameters.candidates.map((function(e){return{foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}}));var i,a={fingerprints:e.dtlsParameters.fingerprints.map((function(e){return{hashFunction:e.algorithm,fingerprint:e.fingerprint}}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":i="passive";break;case"client":i="active";break;case"auto":i="actpass"}return{dtlsParameters:a,iceParameters:o,candidates:n,rtpCapabilities:xD(e.rtpCapabilities),setup:i,cname:r}}function wD(e,t,n){var r=[],i=[];return e.forEach((function(e){var a=e.ssrcId,o=e.rtx,s=rE(8,"track-"),c={ssrcId:a,attributes:gD({label:s,mslabel:n=n||rE(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==o){var u={ssrcId:o,attributes:gD({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(u),i.push({semantic:"FID",ssrcIds:[a,o]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((function(e){return e.ssrcId}))}),{ssrcs:r,ssrcGroups:i}}function SD(e,t){t instanceof _C&&e.attributes.payloads.forEach((function(e){var n,r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(r&&-1!==["opus","pcmu","pcma","g722"].indexOf(r)){e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";var i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!Gy()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}}))}function kD(e){var t=e.attributes.unrecognized.findIndex((function(e){return"x-google-flag"===e.attField&&"conference"===e.attValue}));-1!==t&&e.attributes.unrecognized.splice(t,1)}function TD(e,t){var n;if(t instanceof GC&&t._encoderConfig&&-1===t._hints.indexOf(zT.SCREEN_TRACK)){var r=t._encoderConfig;OI().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((function(e){var t,n;$i(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),OI().supportMinBitrate&&!$i(n=t._hints).call(n,zT.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((function(e){var t,n;$i(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat($w("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}}function ID(e){if("video"===e.media.mediaType){var t=Py();if(t.name===Ty.SAFARI||t.os===ky.IOS){var n=e.attributes.extmaps.findIndex((function(e){return/video-orientation/g.test(e.extensionName)}));-1!==n&&e.attributes.extmaps.splice(n,1)}}}function CD(e,t,n){if(t){var r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){var a=r.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));if(a){e.attributes.extmaps.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}))||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});var o=function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))}))}))}(i,e.attributes.payloads);o.forEach((function(e){e.rtcpFeedbacks.find((function(e){return"transport-cc"===e.type}))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){var s=e.attributes.extmaps.findIndex((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));-1!==s&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){var c=r.find((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}));if(c){e.attributes.extmaps.find((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}))||e.attributes.extmaps.push({entry:c.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});var u=function(e,t){return t.filter((function(t){return!!e.find((function(e){return e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))}))}))}(i,e.attributes.payloads);u.forEach((function(e){e.rtcpFeedbacks.find((function(e){return"goog-remb"===e.type}))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){var l=e.attributes.extmaps.findIndex((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName}));-1!==l&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"goog-remb"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}}function RD(e,t,n){if(!Gy()&&"video"===e.media.mediaType&&t instanceof GC&&("vp9"===n||"vp8"===n)&&("vp8"!==n||$w("SIMULCAST"))&&!(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)){for(var r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find((function(e){return"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId})),o={semantic:"SIM",ssrcIds:[i.ssrcId]},s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:K_(i.attributes)}),o.ssrcIds.push(i.ssrcId+s),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+s,attributes:K_(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,a.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(o)}}function AD(){return OD.apply(this,arguments)}function OD(){return OD=c(s().mark((function e(){var t,n,r,i,a,o,c,u,l,d,f,p,h,v,m,g,y,_,E=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&void 0!==E[0]?E[0]:{},n=E.length>1&&void 0!==E[1]?E[1]:{},r=t.filterRTX,i=t.filterVideoFec,a=t.filterAudioFec,o=t.filterAudioCodec,c=t.filterVideoCodec,u=n.useXR,(l=new RTCPeerConnection).addTransceiver("video",{direction:"sendonly"}),l.addTransceiver("audio",{direction:"sendonly"}),l.addTransceiver("video",{direction:"recvonly"}),l.addTransceiver("audio",{direction:"recvonly"}),e.next=5,l.createOffer();case 5:d=e.sent.sdp,f=yD(d,{filterRTX:r,filterVideoFec:i,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c},{useXR:u},"sendonly"),p=yD(d,{filterRTX:r,filterVideoFec:i,filterAudioFec:a,filterAudioCodec:o,filterVideoCodec:c},{useXR:u},"recvonly"),ND(f,p,"videoExtensions",h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}),ND(f,p,"videoCodecs",h,v,m),ND(f,p,"audioExtensions",h,v,m),ND(f,p,"audioCodecs",h,v,m),$w("RAISE_H264_BASELINE_PRIORITY")&&(g=m.videoCodecs.findIndex((function(e){var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])})),-1!==g&&(y=m.videoCodecs.findIndex((function(e){var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())})),y<g&&(lS.debug("raising H264 baseline profile priority"),_=m.videoCodecs[g],m.videoCodecs.splice(g,1),m.videoCodecs.splice(y,0,_)),-1!==y&&(v.videoCodecs=v.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==y&&$w("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter((function(e){var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))));try{l.close()}catch(t){}return e.abrupt("return",{send:h,recv:v,sendrecv:m});case 14:case"end":return e.stop()}}),e)}))),OD.apply(this,arguments)}function ND(e,t,n,r,i,a){if("videoExtensions"===n||"audioExtensions"===n){var o=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.entry===t.entry&&e.extensionName===t.extensionName)return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===o.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){var s=[];return e[n].forEach((function(e){t[n].some((function(t,n){if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach((function(e,t){-1===s.indexOf(t)&&i[n].push(e)}))}}function xD(e){var t,n,r=e.send,i=e.recv,a=e.sendrecv;if(!a){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}return r?((t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(m(r.audioCodecs),m(a.audioCodecs)),t.videoCodecs=[].concat(m(r.videoCodecs),m(a.videoCodecs)),t.audioExtensions=[].concat(m(r.audioExtensions),m(a.audioExtensions)),t.videoExtensions=[].concat(m(r.videoExtensions),m(a.videoExtensions))):t=a,i?((n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[].concat(m(i.audioCodecs),m(a.audioCodecs)),n.videoCodecs=[].concat(m(i.videoCodecs),m(a.videoCodecs)),n.audioExtensions=[].concat(m(i.audioExtensions),m(a.audioExtensions)),n.videoExtensions=[].concat(m(i.videoExtensions),m(a.videoExtensions))):n=a,{send:t,recv:n}}function DD(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((function(e){var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((function(e){e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function PD(e){e.mediaDescriptions.forEach((function(e){"video"!==e.media.mediaType&&"audio"!==e.media.mediaType||e.attributes.payloads.forEach((function(e){-1===e.rtcpFeedbacks.findIndex((function(e){return"rrtr"===e.type}))&&e.rtcpFeedbacks.push({type:"rrtr"})}))}))}function LD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function MD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LD(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function UD(e){if(Array.isArray(e))return e.map((function(e){return e}));if(!jD(e))return e;var t={};for(var n in e){var r=e[n];jD(r)||Array.isArray(r)?t[n]=UD(r):t[n]=r}return t}function jD(e){return!("object"!=typeof e||Array.isArray(e)||!e)}var FD=function(){function e(t){l(this,e),kf(this,"input",[]),kf(this,"size",void 0),this.size=t}return d(e,[{key:"add",value:function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}},{key:"diffMean",value:function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}]),e}(),VD={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},BD={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:VD,remoteCandidate:VD}},GD={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},ZD={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},qD={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},WD={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function HD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HD(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zD=function(){function e(t,n){var r=this;l(this,e),kf(this,"onFirstVideoReceived",void 0),kf(this,"onFirstVideoDecoded",void 0),kf(this,"onFirstAudioReceived",void 0),kf(this,"onFirstVideoDecodedTimeout",void 0),kf(this,"onFirstAudioDecoded",void 0),kf(this,"onSelectedLocalCandidateChanged",void 0),kf(this,"onSelectedRemoteCandidateChanged",void 0),kf(this,"videoIsReady",!1),kf(this,"videoIsReady2",{}),kf(this,"pc",void 0),kf(this,"options",void 0),kf(this,"intervalTimer",void 0),kf(this,"stats",UD(BD)),kf(this,"isFirstVideoReceived",{}),kf(this,"isFirstVideoDecoded",{}),kf(this,"isFirstAudioReceived",{}),kf(this,"isFirstAudioDecoded",{}),kf(this,"isFirstVideoDecodedTimeout",{}),kf(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.updateStats();case 1:case"end":return e.stop()}}),e)}))),this.options.updateInterval)}return d(e,[{key:"getStats",value:function(){return this.stats}},{key:"getSelectedCandidatePair",value:function(){return new by((function(e){e({local:KD({},VD),remote:KD({},VD)})}))}},{key:"setVideoIsReady",value:function(e){this.videoIsReady=e}},{key:"setVideoIsReady2",value:function(e,t){this.videoIsReady2[e]=t}},{key:"getVideoIsReady",value:function(e){return this.videoIsReady2[e]||!1}},{key:"setIsFirstAudioDecoded",value:function(e){}},{key:"destroy",value:function(){window.clearInterval(this.intervalTimer),this.pc=void 0}},{key:"calcLossRate",value:function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,a=0,o=0,s=function(){var s=u[c];e[s].forEach((function(e,c){if(t.lossRateWindowStats[n-1][s][c]&&t.lossRateWindowStats[0][s][c]){var u=t.lossRateWindowStats[n-1][s][c].packets-t.lossRateWindowStats[0][s][c].packets,l=t.lossRateWindowStats[n-1][s][c].packetsLost-t.lossRateWindowStats[0][s][c].packetsLost;"videoSend"===s||"audioSend"===s?(r+=u,a+=l):(i+=u,o+=l),Number.isNaN(u)||Number.isNaN(u)?e.packetLostRate=0:e.packetLostRate=u<=0||l<=0?0:l/(u+l)}}))},c=0,u=["videoSend","audioSend","videoRecv","audioRecv"];c<u.length;c++)s();e.sendPacketLossRate=r<=0||a<=0?0:a/(r+a),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}}]),e}();function YD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YD(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var XD=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.apply(this,arguments),kf(f(e),"_stats",BD),kf(f(e),"lastDecodeVideoReceiverStats",new Map),e}return d(n,[{key:"updateStats",value:function(){var e=c(s().mark((function e(){var t,n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStats();case 2:t=e.sent,n=this.statsResponsesToObjects(t),this._stats=UD(BD),r=n.filter((function(e){return"ssrc"===e.type})),this.processSSRCStats(r),i=n.find((function(e){return"VideoBwe"===e.type})),i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processBandwidthStats",value:function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}},{key:"processSSRCStats",value:function(e){var t=this;e.forEach((function(e){var n,r=$i(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(r?"send":"recv")){case"video_send":var i=UD(ZD);i.codec=e.googCodecName,i.adaptionChangeReason="none",e.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(e.googAvgEncodeMs),i.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.firsCount=Number(e.googFirReceived),i.nacksCount=Number(e.googNacksReceived),i.plisCount=Number(e.googPlisReceived),i.frameCount=Number(e.framesEncoded),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(i),t._stats.rtt=i.rttMs;break;case"video_recv":var a=UD(GD),o=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(a.codec=e.googCodecName,a.targetDelayMs=Number(e.googTargetDelayMs),a.renderDelayMs=Number(e.googRenderDelayMs),a.currentDelayMs=Number(e.googCurrentDelayMs),a.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),a.decodeMs=Number(e.googDecodeMs),a.maxDecodeMs=Number(e.googMaxDecodeMs),a.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},a.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},a.decodeFrameRate=Number(e.googFrameRateDecoded),a.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},a.jitterBufferMs=Number(e.googJitterBufferMs),a.firsCount=Number(e.googFirsSent),a.nacksCount=Number(e.googNacksSent),a.plisCount=Number(e.googPlisSent),a.framesDecodeCount=Number(e.framesDecoded),a.bytes=Number(e.bytesReceived),a.packets=Number(e.packetsReceived),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.packets>0&&!t.isFirstVideoReceived[a.ssrc]&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(a.ssrc),t.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!t.isFirstVideoDecoded[a.ssrc]&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),t.isFirstVideoDecoded[a.ssrc]=!0),o){var s=o.stats,c=Date.now()-o.lts;a.framesDecodeFreezeTime=s.framesDecodeFreezeTime,a.framesDecodeInterval=s.framesDecodeInterval,a.framesDecodeCount>s.framesDecodeCount&&t.isFirstVideoDecoded[a.ssrc]?(o.lts=Date.now(),a.framesDecodeInterval=c,a.framesDecodeInterval>=t.options.freezeRateLimit&&(t.getVideoIsReady(parseInt(e.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:t.setVideoIsReady2(parseInt(e.ssrc,10),!0))):a.framesDecodeCount<o.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:JD({},a),lts:Date.now()}),t._stats.videoRecv.push(a);break;case"audio_recv":var u=UD(WD);u.codec=e.googCodecName,u.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,u.decodingCNG=Number(e.googDecodingCNG),u.decodingCTN=Number(e.googDecodingCTN),u.decodingCTSG=Number(e.googDecodingCTSG),u.decodingNormal=Number(e.googDecodingNormal),u.decodingPLC=Number(e.googDecodingPLC),u.decodingPLCCNG=Number(e.googDecodingPLCCNG),u.expandRate=Number(e.googExpandRate),u.accelerateRate=Number(e.googAccelerateRate),u.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),u.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),u.speechExpandRate=Number(e.googSpeechExpandRate),u.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),u.jitterBufferMs=Number(e.googJitterBufferMs),u.jitterMs=Number(e.googJitterReceived),u.bytes=Number(e.bytesReceived),u.packets=Number(e.packetsReceived),u.packetsLost=Number(e.packetsLost),u.ssrc=Number(e.ssrc),u.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),u.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),u.receivedFrames>0&&!t.isFirstAudioReceived[u.ssrc]&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(u.ssrc),t.isFirstAudioReceived[u.ssrc]=!0),u.decodingNormal>0&&!t.isFirstAudioDecoded[u.ssrc]&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(u.ssrc),t.isFirstAudioDecoded[u.ssrc]=!0),t._stats.audioRecv.push(u);break;case"audio_send":var l=UD(qD);l.codec=e.googCodecName,l.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,l.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(e.bytesSent),l.packets=Number(e.packetsSent),l.packetsLost=Number(e.packetsLost),l.ssrc=Number(e.ssrc),l.rttMs=Number(e.googRtt||0),t._stats.rtt=l.rttMs,t._stats.audioSend.push(l)}}))}},{key:"_getStats",value:function(){var e=this;return new by((function(t,n){e.pc.getStats(t,n)}))}},{key:"statsResponsesToObjects",value:function(e){var t=[];return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t.push(n)})),t}}]),n}(zD);function QD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QD(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var eP=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.apply(this,arguments),kf(f(e),"_stats",BD),kf(f(e),"report",void 0),kf(f(e),"lastDecodeVideoReceiverStats",new Map),kf(f(e),"lastVideoFramesRecv",new Map),kf(f(e),"lastVideoFramesSent",new Map),kf(f(e),"lastVideoFramesDecode",new Map),kf(f(e),"lastVideoJBDelay",new Map),kf(f(e),"lastAudioJBDelay",new Map),kf(f(e),"mediaBytesSent",new Map),kf(f(e),"mediaBytesRetransmit",new Map),kf(f(e),"mediaBytesTargetEncode",new Map),kf(f(e),"lastEncoderMs",new Map),e}return d(n,[{key:"updateStats",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.getStats();case 2:this.report=e.sent,this._stats=UD(BD),this.report.forEach((function(e){switch(e.type){case RS.OUTBOUND:case RS.INBOUND:var n=e.mediaType||e.kind,r=!n&&"frameWidth"in e,i=!n&&!("frameWidth"in e);e.type===RS.OUTBOUND?"audio"===n||i?t.processAudioOutboundStats(e):("video"===n||r)&&t.processVideoOutboundStats(e):e.type===RS.INBOUND&&("audio"===n||i?t.processAudioInboundStats(e):("video"===n||r)&&t.processVideoInboundStats(e));break;case RS.TRANSPORT:var a=t.report.get(e.selectedCandidatePairId);a&&t.processCandidatePairStats(a);break;case RS.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSelectedCandidatePair",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.getStats();case 2:return t=e.sent,n={local:$D({},VD),remote:$D({},VD)},e.abrupt("return",(t.forEach((function(e){var r;if(e.type===RS.TRANSPORT&&(r=t.get(e.selectedCandidatePairId)),e.type===RS.CANDIDATE_PAIR&&e.selected&&(r=e),r){var i=function(e,t){e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){var a=t.get(r.localCandidateId);a&&i(n.local,a)}if(r.remoteCandidateId){var o=t.get(r.remoteCandidateId);o&&i(n.remote,o)}}})),n));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCandidatePairStats",value:function(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((function(t){e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){var t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){var n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}},{key:"processCandidateStats",value:function(e){var t;e.type===RS.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===RS.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===RS.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged($D({},t),$D({},this.stats.selectedCandidatePair.localCandidate)),e.type===RS.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged($D({},t),$D({},this.stats.selectedCandidatePair.remoteCandidate)))}},{key:"processAudioInboundStats",value:function(e){var t=this._stats.audioRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=UD(WD),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}},{key:"processVideoInboundStats",value:function(e){var t=this._stats.videoRecv.find((function(t){return t.ssrc===e.ssrc}));t||(t=UD(GD),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){var a=t.decodedFrame?t.decodedFrame.width:0,o=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,a,o),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){var s=n.stats,c=i-n.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<s.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&i-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:$D({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}},{key:"processVideoOutboundStats",value:function(e){var t=this._stats.videoSend.find((function(t){return t.ssrc===e.ssrc}));t||(t=UD(ZD),this._stats.videoSend.push(t));var n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{var r=new FD(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(void 0!==e.retransmittedBytesSent){var i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{var a=new FD(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){var o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{var s=new FD(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){var c=this.lastEncoderMs.get(e.ssrc);if(!c||c.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{var u=e.framesEncoded-c.lastFrameCount,l=e.totalEncodeTime-c.lastEncoderTime;t.avgEncodeMs=1e3*l/u}}if(e.framesEncoded&&e.qpSum){var d=this.lastEncoderMs.get(e.ssrc);!d||d.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-d.lastQpSum)/(e.framesEncoded-d.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var f=this.findRemoteStatsId(e.ssrc,RS.REMOTE_INBOUND);f&&this.processRemoteInboundStats(f,t)}}},{key:"processAudioOutboundStats",value:function(e){var t=this._stats.audioSend.find((function(t){return t.ssrc===e.ssrc}));if(t||(t=UD(qD),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,RS.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}},{key:"findRemoteStatsId",value:function(e,t){var n,r=Array.from(XS(n=this.report).call(n)).find((function(n){return n.type===t&&n.ssrc===e}));return r?r.id:null}},{key:"processVideoMediaSource",value:function(e,t){var n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}},{key:"processAudioMediaSource",value:function(e,t){var n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}},{key:"processVideoTrackSenderStats",value:function(e,t,n){var r,i,a,o,s=t?this.report.get(t):void 0,c=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"==typeof c){var u=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(a=null==s?void 0:s.frameHeight)&&void 0!==a?a:e.frameHeight,d=null!==(o=null==s?void 0:s.framesPerSecond)&&void 0!==o?o:e.framesPerSecond;if("number"==typeof u&&"number"==typeof l||(u=0,l=0),null==d){var f=Date.now(),p=this.lastVideoFramesSent.get(n.ssrc);p&&f-p.lts>=800?(d=Math.round((c-p.count)/((f-p.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:f,rate:d})):p?d=p.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:f,rate:0})}n.sentFrame={width:u,height:l,frameRate:Math.max(0,d)}}}},{key:"processVideoTrackReceiverStats",value:function(e,t,n){var r,i,a,o,s,c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(a=null==c?void 0:c.frameHeight)&&void 0!==a?a:e.frameHeight,f=null!==(o=null==c?void 0:c.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof u){var h=this.lastVideoFramesRecv.get(n.ssrc),v=Date.now();n.framesReceivedCount=u;var m=0;h&&v-h.lts>=800?(m=Math.round((u-h.count)/((v-h.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:v,rate:m})):h?m=h.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:v,rate:0}),n.receivedFrame={width:l||0,height:d||0,frameRate:m||0},n.decodedFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0}}if(f&&p){var g=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},y=g.jitterBufferMs,_=p-g.jitterBufferEmittedCount;_>0&&(y=1e3*(f-g.jitterBufferDelay)/_),n.jitterBufferMs=y,n.currentDelayMs=Math.round(y),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}},{key:"processAudioTrackSenderStats",value:function(e,t,n){var r,i,a,o,s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(a=null!==(o=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==o?o:e.echoReturnLossEnhancement)&&void 0!==a?a:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}},{key:"processAudioTrackReceiverStats",value:function(e,t,n){var r,i,a,o,s,c,u,l=t?this.report.get(t):void 0,d=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,f=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(a=null==l?void 0:l.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,h=null!==(o=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount,v=null!==(s=null==l?void 0:l.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,m=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,g=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples;if(d&&f&&(n.accelerateRate=d/f),p&&h){var y=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},_=y.jitterBufferMs,E=h-y.jitterBufferEmittedCount;E>0&&(_=1e3*(p-y.jitterBufferDelay)/E),n.jitterBufferMs=Math.round(_),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:h,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=v;var b=1920;m&&f&&(b=f/m/50,n.receivedFrames=Math.round(f/b)),g&&(n.droppedFrames=Math.round(g/b))}},{key:"processRemoteInboundStats",value:function(e,t){var n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}},{key:"getCodecFromCodecStats",value:function(e){var t=this.report.get(e);if(!t)return"";var n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}},{key:"updateSendBitrate",value:function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach((function(t){e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((function(e){t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((function(e){n=null===n?e.diffMean():n+e.diffMean()}));var r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}]),n}(zD),tP=function(e){p(n,e);var t=h(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"updateStats",value:function(){return by.resolve()}}]),n}(zD);function nP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,a=function(){var e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return a?a<76?new XD(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new eP(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){return!!window.RTCStatsReport&&e.getStats()instanceof by}(e)?new eP(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new tP(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function rP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var aP=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this,e,r),kf(f(i),"store",void 0),kf(f(i),"peerConnection",void 0),kf(f(i),"remoteSDP",void 0),kf(f(i),"initialOffer",void 0),kf(f(i),"statsFilter",void 0),kf(f(i),"useRTX",!1),kf(f(i),"localCapabilities",void 0),kf(f(i),"localCandidateCount",0),kf(f(i),"allCandidatesReceived",!1),kf(f(i),"establishPromise",void 0),kf(f(i),"mutex",new fE("P2PConnection-mutex")),i.store=r,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.statsFilter=nP(i.peerConnection,$w("STATS_UPDATE_INTERVAL"),void 0,Gy()?1200:void 0),i.bindPCEvents(),i.bindStatsEvents(),i.store.p2pId=i.store.p2pId+1,i.establishPromise=i.establish(),i}return d(n,[{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"establish",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:if((t=e.sent).sdp){e.next=6;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 6:return n=_D(t.sdp),r=yD(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$w("FILTER_VIDEO_FEC"),filterAudioFec:$w("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]}),e.abrupt("return",(this.localCapabilities=r,this.initialOffer=t,iP(iP({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})));case 10:throw e.prev=10,e.t0=e.catch(0),new o_(Oy.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,c){var u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.remoteSDP=new(function(){function e(t){l(this,e),kf(this,"sessionDesc",void 0),kf(this,"localCapabilities",void 0),kf(this,"rtpCapabilities",void 0),kf(this,"candidates",void 0),kf(this,"iceParameters",void 0),kf(this,"dtlsParameters",void 0),kf(this,"setup",void 0),kf(this,"currentMidIndex",void 0),kf(this,"cname",void 0);var n=t=K_(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,a=n.candidates,o=n.remoteRTPCapabilities,s=n.remoteSetup,c=n.localCapabilities,u=(n.sdkCodec,n.cname),d=vD.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=o,this.candidates=a,this.iceParameters=r,this.dtlsParameters=i,this.setup=s,this.localCapabilities=c,this.cname=u;for(var f=0;f<d.mediaDescriptions.length;f++){var p=d.mediaDescriptions[f];p.attributes.iceUfrag=r.iceUfrag,p.attributes.icePwd=r.icePwd,p.attributes.fingerprints=i.fingerprints,p.attributes.candidates=a,p.attributes.setup=s,"video"===p.media.mediaType&&(p.media.fmts=o.videoCodecs.map((function(e){return e.payloadType.toString(10)})),p.attributes.payloads=o.videoCodecs,p.attributes.extmaps=o.videoExtensions),"audio"===p.media.mediaType&&(p.media.fmts=o.audioCodecs.map((function(e){return e.payloadType.toString(10)})),p.attributes.payloads=o.audioCodecs,p.attributes.extmaps=o.audioExtensions),d.mediaDescriptions[f]=this.mungMediaDesc(p)}this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}return d(e,[{key:"toString",value:function(){return vD.print(this.sessionDesc)}},{key:"send",value:function(e,t,n){var r=wD(t,this.cname),i=r.ssrcs,a=r.ssrcGroups,o=this.sessionDesc.mediaDescriptions.find((function(t){return e===Ck.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType})),s=i[0].attributes.label,c=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(a),{id:s,mslabel:c}}},{key:"batchSend",value:function(e){var t=this;return e.map((function(e){var n=e.kind,r=e.ssrcMsg;return t.send(n,r,void 0)}))}},{key:"stopSending",value:function(e){this.sessionDesc.mediaDescriptions.forEach((function(t){var n=[],r=[],i=[];t.attributes.ssrcs.forEach((function(t){$i(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((function(e){var t;$i(t=i.map((function(e){return e.ssrcId}))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"receive",value:function(e,t,n){var r=this;e.forEach((function(e,t){var n=e._mediaStreamTrack,i=r.sessionDesc.mediaDescriptions.findIndex((function(e){return e.attributes.mid===n.kind})),a=r.mungRecvMediaDsec(r.sessionDesc.mediaDescriptions[i],e);r.sessionDesc.mediaDescriptions[i]=a}))}},{key:"stopReceiving",value:function(e){}},{key:"updateCandidates",value:function(e){var t=this;e===Rk.TCP?this.candidates.forEach((function(e){-1===t.candidates.findIndex((function(t){return"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port}))&&t.candidates.push(MD(MD({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((function(e){return"tcp"!==e.transport}));var n,r=o(this.sessionDesc.mediaDescriptions);try{for(r.s();!(n=r.n()).done;)n.value.attributes.candidates=this.candidates}catch(i){r.e(i)}finally{r.f()}}},{key:"restartICE",value:function(e){e=K_(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"mungRecvMediaDsec",value:function(e,t){var n=K_(e);return SD(n,t),TD(n,t),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"updateTrackLabel",value:function(e,t,n){var r=this.sessionDesc.mediaDescriptions.find((function(t){return e===Ck.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid}));if(r){var i,a=r.attributes.ssrcs.find((function(e){return e.attributes.label===t}));a&&(a.attributes.label=n,null===(i=a.attributes.msid)||void 0===i||i.replace(t,n))}}},{key:"mungMediaDesc",value:function(e){var t=K_(e);return kD(t),function(e){var t=e.attributes.extmaps.find((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName}));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((function(e){var t=e.rtcpFeedbacks.findIndex((function(e){return"transport-cc"===e.type}));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}},{key:"getSSRC",value:function(e){var t,n=o(this.sessionDesc.mediaDescriptions);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=o(i.attributes.ssrcs);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.attributes.label===e)return[s]}}catch(c){a.e(c)}finally{a.f()}}}catch(c){n.e(c)}finally{n.f()}}}]),e}())({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c}),u=this.remoteSDP.toString(),e.next=7,this.peerConnection.setLocalDescription(this.initialOffer);case 7:return e.next=9,this.peerConnection.setRemoteDescription({type:"answer",sdp:u});case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t){var n=this;return lD(s().mark((function r(){var i,a,o,c,u,l,d,f;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,dD(n.mutex.lock());case 2:if(i=r.sent,r.prev=3,n.remoteSDP){r.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:return a=e.map((function(e){return n.peerConnection.addTrack(e._mediaStreamTrack)})),r.next=9,dD(n.peerConnection.createOffer());case 9:return o=r.sent,c=vD.parse(o.sdp),u=e.map((function(e){var t=e._mediaStreamTrack,r=c.mediaDescriptions.find((function(e){return e.attributes.mid===t.kind}));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){var r=e.attributes.ssrcs.filter((function(e){return e.attributes.label===t})),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){var a=i.find((function(e){return-1!==e.ssrcIds.indexOf(r[0].ssrcId)}));return a?[{ssrcId:a.ssrcIds[0],rtx:n?a.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)})),r.prev=12,r.next=15,u;case 15:l=r.sent,r.next=21;break;case 18:throw r.prev=18,r.t0=r.catch(12),a.forEach((function(e){By()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),r.t0;case 21:return d=n.mungSendOfferSDP(o.sdp,e),n.remoteSDP.receive(e,t,l),f=n.remoteSDP.toString(),r.next=26,dD(n.peerConnection.setLocalDescription({type:"offer",sdp:d}));case 26:return r.next=28,dD(n.applySendEncodings(a,e));case 28:return r.next=30,dD(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}));case 30:return r.abrupt("return",e.map((function(e,t){var n=e._mediaStreamTrack.id;return{localSSRC:u[t],id:n}})));case 33:throw r.prev=33,r.t1=r.catch(3),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(r.t1.toString()));case 36:return r.prev=36,i(),r.finish(36);case 39:case"end":return r.stop()}}),r,null,[[3,33,36,39],[12,18]])})))()}},{key:"stopSending",value:function(){var e=c(s().mark((function e(t){var n,r,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 6:return n.map((function(e){By()&&e.replaceTrack(null),a.peerConnection.removeTrack(e)})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return this.remoteSDP.stopReceiving(t),i=this.remoteSDP.toString(),e.next=16,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t0.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:return a=this.remoteSDP.send(t,n,i),o=a.id,c=a.mslabel,u=new by((function(e,n){var r=setTimeout((function(){n(new Error("Cannot receive track, id: ".concat(o)))}),1e4),i=function n(i){var a=Py();if(("Safari"===a.name&&11===Number(a.version)||Zy())&&i.track.id!==o&&i.streams[0].id===c){var s,u=i.streams[0].getTracks()[0];return null===(s=f.remoteSDP)||void 0===s||s.updateTrackLabel(t,o,i.track.id),f.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(u)}if(i.track.id===o)return f.peerConnection.removeEventListener("track",n),clearTimeout(r),void e(i.track)};f.peerConnection.addEventListener("track",i)})),l=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:l});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return d=e.sent,e.next=11,this.peerConnection.setLocalDescription(d);case 11:return e.next=13,u;case 13:return e.t0=e.sent,e.t1=o,e.abrupt("return",{track:e.t0,id:e.t1});case 18:throw e.prev=18,e.t2=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t2.toString()));case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("sender' length doesn't match mids' length.");case 6:n.map((function(e){if(By()&&e.track)e.track.enabled=!1;else{var t=e.getParameters();t.encodings.forEach((function(e){return e.active=!1})),e.setParameters(t)}})),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getSenders().filter((function(e){var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")})),n.length===t.length){e.next=6;break}throw new Error("Senders' length doesn't match mids' length.");case 6:return n.map(function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!By()||!t.track){e.next=4;break}t.track.enabled=!0,e.next=8;break;case 4:return(n=t.getParameters()).encodings.forEach((function(e){return e.active=!0})),e.next=8,t.setParameters(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,e.next=12,this.peerConnection.setLocalDescription(r);case 12:return i=this.remoteSDP.toString(),e.next=15,this.peerConnection.setRemoteDescription({type:"answer",sdp:i});case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(e){var t=this;return lD(s().mark((function n(){var r,i,a,o,c,u,l,d;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,dD(t.mutex.lock("From P2PConnection.restartICE"));case 2:if(r=n.sent,n.prev=3,t.remoteSDP){n.next=6;break}throw new Error("Cannot restartICE before remoteSDP created.");case 6:if(!OI().supportPCSetConfiguration){n.next=11;break}i=t.peerConnection.getConfiguration(),a=e===Rk.RELAY?"relay":"all",i.iceTransportPolicy!==a&&(lS.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(i.iceTransportPolicy,"] to [").concat(a,"]")),i.iceTransportPolicy=a,t.peerConnection.setConfiguration(i)),n.next=13;break;case 11:if(e!==Rk.RELAY){n.next=13;break}return n.abrupt("return");case 13:return e!==Rk.RELAY&&t.remoteSDP.updateCandidates(e),n.next=16,dD(t.peerConnection.createOffer({iceRestart:!0}));case 16:if((o=n.sent).sdp){n.next=19;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 19:return c=_D(o.sdp),n.next=22,c.iceParameters;case 22:return u=n.sent,l=u.remoteIceParameters,t.remoteSDP.restartICE(l),d=t.remoteSDP.toString(),n.next=28,dD(t.peerConnection.setLocalDescription(o));case 28:return n.next=30,dD(t.peerConnection.setRemoteDescription({type:"answer",sdp:d}));case 30:n.next=35;break;case 32:n.prev=32,n.t0=n.catch(3),lS.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),n.t0);case 35:return n.prev=35,r(),n.finish(35);case 38:case"end":return n.stop()}}),n,null,[[3,32,35,38]])})))()}},{key:"close",value:function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n]),this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n),a=this.remoteSDP.toString(),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return e.next=13,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,e.t0.toString());case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().filter((function(e){var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t})),e.t0=1===r.length,!e.t0){e.next=5;break}return e.next=5,this.applySendEncodings(r,[n]);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.id)===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"createDataChannels",value:function(e,t){throw new o_(Oy.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}},{key:"stopDataChannels",value:function(e){throw new o_(Oy.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),$w("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"updateRtpSenderEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.peerConnection.getSenders().find((function(e){var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t._mediaStreamTrack.id}))),n){e.next=3;break}return e.abrupt("return",lS.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(OI().supportSetRtpSenderParameters){e.next=5;break}return e.abrupt("return",lS.warn("Browser not support set rtp-sender parameters"));case 5:if(i={},a={},!(t instanceof GC)){e.next=15;break}e.t0=t._optimizationMode,e.next="motion"===e.t0?10:"detail"===e.t0?12:14;break;case 10:return i.degradationPreference="maintain-framerate",e.abrupt("break",15);case 12:return i.degradationPreference="maintain-resolution",e.abrupt("break",15);case 14:i.degradationPreference="balanced";case 15:return $w("DSCP_TYPE")&&t_()&&(c=$w("DSCP_TYPE"),$i(o=["very-low","low","medium","high"]).call(o,c)&&(a.networkPriority=c)),u=n.getParameters(),(l=null===(r=u.encodings)||void 0===r?void 0:r[0])&&Object.assign(l,a),Object.assign(u,i),lS.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),e.next=22,n.setParameters(u);case 22:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySendEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,OI().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=i&&a,!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),lS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t){var n=vD.parse(e);return t.forEach((function(e,t){var r=e._mediaStreamTrack,i=n.mediaDescriptions.find((function(e){return e.attributes.mid===r.kind}));i&&SD(i,e)})),vD.print(n)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}},{key:"batchReceive",value:function(){var e=c(s().mark((function e(t){var n,r,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:return n=this.remoteSDP.batchSend(t).map((function(e,n){var r=e.id,i=e.mslabel,o=t[n].kind;return new by((function(e,t){var n=setTimeout((function(){t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=function t(s){var c=Py();if("Safari"===c.name&&11===Number(c.version)&&s.track.id!==r&&s.streams[0].id===i){var u,l=s.streams[0].getTracks()[0];return null===(u=a.remoteSDP)||void 0===u||u.updateTrackLabel(o,r,s.track.id),a.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:l,id:r})}if(s.track.id===r)return a.peerConnection.removeEventListener("track",t),clearTimeout(n),void e({track:s.track,id:r})};a.peerConnection.addEventListener("track",s)}))})),r=this.remoteSDP.toString(),e.next=6,this.peerConnection.setRemoteDescription({type:"offer",sdp:r});case 6:return e.next=8,this.peerConnection.createAnswer();case 8:return i=e.sent,e.next=11,this.peerConnection.setLocalDescription(i);case 11:return e.next=13,by.all(n);case 13:return e.abrupt("return",e.sent);case 16:throw e.prev=16,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getRemoteSSRC",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(OI().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(P_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),$w("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(Yk);function oP(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("Locking from P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function sP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([oP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],aP.prototype,"connect",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],aP.prototype,"stopSending",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String,Array,String,Object]),$S("design:returntype",by)],aP.prototype,"receive",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],aP.prototype,"stopReceiving",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],aP.prototype,"muteRemote",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],aP.prototype,"unmuteRemote",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],aP.prototype,"muteLocal",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],aP.prototype,"unmuteLocal",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],aP.prototype,"close",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],aP.prototype,"updateEncoderConfig",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],aP.prototype,"updateSendParameters",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[yI,String]),$S("design:returntype",by)],aP.prototype,"replaceTrack",null),QS([oP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],aP.prototype,"getRemoteSSRC",null);var uP="9",lP=4e4;function dP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pP=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this,e,r),kf(f(i),"store",void 0),kf(f(i),"peerConnection",void 0),kf(f(i),"remoteSDP",void 0),kf(f(i),"initialOffer",void 0),kf(f(i),"transportEventReceiver",void 0),kf(f(i),"statsFilter",void 0),kf(f(i),"useXR",$w("USE_XR")),kf(f(i),"localCapabilities",void 0),kf(f(i),"localCandidateCount",0),kf(f(i),"allCandidatesReceived",!1),kf(f(i),"dataStreamChannelMap",new Map),kf(f(i),"establishPromise",void 0),kf(f(i),"mutex",new fE("P2PConnection-mutex")),i.store=r,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.statsFilter=nP(i.peerConnection,$w("STATS_UPDATE_INTERVAL"),void 0,Gy()?1200:void 0),i.bindPCEvents(),i.bindStatsEvents(),i.store.p2pId=i.store.p2pId+1,i.establishPromise=i.establish(),i}return d(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"dtlsTransportState",get:function(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}},{key:"establish",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.next=4,this.peerConnection.createOffer();case 4:if((t=e.sent).sdp){e.next=7;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 7:return n=_D(t.sdp),e.next=10,AD({filterRTX:!$w("USE_PUB_RTX")&&!$w("USE_SUB_RTX"),filterVideoFec:$w("FILTER_VIDEO_FEC"),filterAudioFec:$w("FILTER_AUDIO_FEC")},{useXR:this.useXR});case 10:return r=e.sent,e.abrupt("return",(this.localCapabilities=xD(r),this.initialOffer=t,fP(fP({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})));case 14:throw e.prev=14,e.t0=e.catch(0),new o_(Oy.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,c){var u,f,p,h,v,g,y,_;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish P2PConnection without initial offer.");case 3:return this.remoteSDP=new(function(){function e(t){l(this,e),kf(this,"sessionDesc",void 0),kf(this,"_localCapabilities",void 0),kf(this,"_rtpCapabilities",void 0),kf(this,"_candidates",void 0),kf(this,"_iceParameters",void 0),kf(this,"_dtlsParameters",void 0),kf(this,"setup",void 0),kf(this,"currentMidIndex",void 0),kf(this,"cname",void 0),kf(this,"firefoxSsrcMidMap",new Map);var n=t=K_(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,a=n.candidates,s=n.remoteRTPCapabilities,c=n.remoteSetup,u=n.localCapabilities,d=n.cname,f=vD.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=s,this._candidates=a,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u,this.setup=c,this.cname=d;var p,h=this.rtpCapabilities.send,v=o(f.mediaDescriptions);try{for(v.s();!(p=v.n()).done;){var m=p.value;if(m.attributes.iceUfrag=r.iceUfrag,m.attributes.icePwd=r.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=a,m.attributes.setup=c,"video"===m.media.mediaType&&(m.media.fmts=h.videoCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=h.videoCodecs,m.attributes.extmaps=h.videoExtensions,$w("PRELOAD_MEDIA_COUNT")>0)){var g=wD([{ssrcId:lP,rtx:$w("USE_SUB_RTX")?40001:void 0}],this.cname),y=g.ssrcs,_=g.ssrcGroups;m.attributes.ssrcs=y,m.attributes.ssrcGroups=_}if("audio"===m.media.mediaType&&(m.media.fmts=h.audioCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=h.audioCodecs,m.attributes.extmaps=h.audioExtensions,DD(m),$w("PRELOAD_MEDIA_COUNT")>0)){var E=wD([{ssrcId:2e4}],this.cname),b=E.ssrcs,w=E.ssrcGroups;m.attributes.ssrcs=b,m.attributes.ssrcGroups=w}}}catch(S){v.e(S)}finally{v.f()}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}return d(e,[{key:"localCapabilities",get:function(){return K_(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return K_(this._rtpCapabilities)}},{key:"candidates",get:function(){return K_(this._candidates)}},{key:"iceParameters",get:function(){return K_(this._iceParameters)}},{key:"dtlsParameters",get:function(){return K_(this._dtlsParameters)}},{key:"preloadRemoteMedia",value:function(){var e=$w("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;for(var t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,a=1;a<e;a++){var o=2*a+lP,s=wD([{ssrcId:2*a+2e4}],this.cname),c=s.ssrcs,u=s.ssrcGroups,l=wD([{ssrcId:o,rtx:$w("USE_SUB_RTX")?o+1:void 0}],this.cname),d=l.ssrcs,f=l.ssrcGroups;this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:uP,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:uP,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}},{key:"toString",value:function(){return vD.print(this.sessionDesc)}},{key:"send",value:function(e,t,n,r){var i=wD(t,this.cname,$w("SYNC_GROUP")?n:void 0),a=i.ssrcs,o=i.ssrcGroups,s=this.findPreloadMediaDesc(a);if(s){if(Gy()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){var c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}var u,l=this.findAvailableMediaIndex(e,a);return-1===l||1===l&&(By()||Ky())||0===l&&$w("USE_SUB_RTX")||zy()?(u=this.createOrRecycleSendMedia(e,a,o,"sendonly",r),this.updateBundleMids()):((u=K_(this.sessionDesc.mediaDescriptions[l])).attributes.direction="sendonly",u.attributes.ssrcs=a,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,r)),Gy()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}},{key:"sendDataChannel",value:function(){var e=this.createOrRecycleDataChannel(),t=e.mediaDesc,n=e.needExchangeSDP;return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:n}}},{key:"batchSend",value:function(e){var t=this,n=e.map((function(e){var n=e.kind,r=e.ssrcMsg,i=e.mslabel;return t.send(n,r,i)})),r=[],i=!1;return n.forEach((function(e){var t=e.mid;e.needExchangeSDP&&(i=!0),r.push(t)})),{mids:r,needExchangeSDP:i}}},{key:"stopSending",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){"0"===e.attributes.mid||Gy()||zy()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"muteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return $i(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))}},{key:"unmuteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return $i(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))}},{key:"receive",value:function(e,t,n,r){var i=this;e.forEach((function(e,a){i.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[a])})),this.updateBundleMids()}},{key:"stopReceiving",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}},{key:"updateCandidates",value:function(e){var t=this._candidates.filter((function(e){return"udp"===e.transport}));if(e===Rk.TCP){if(0===t.length)return;if($w("TCP_CANDIDATE_ONLY")){var n=this._candidates.filter((function(e){return"tcp"===e.transport}));t.forEach((function(e){-1===n.findIndex((function(t){return t.connectionAddress===e.connectionAddress}))&&n.push(cP(cP({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),this._candidates=n}else{var r=[];t.forEach((function(e){r.push(cP(cP({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),this._candidates=[].concat(m(t),r)}}else if(e===Rk.RELAY){if(0!==t.length)return;var i=this._candidates.filter((function(e){return"tcp"===e.transport}));i.forEach((function(e){t.push(cP(cP({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=[].concat(m(t),m(i))}else 0===t.length?(this._candidates.filter((function(e){return"tcp"===e.transport})).forEach((function(e){t.push(cP(cP({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=t):this._candidates=this._candidates.filter((function(e){return"tcp"!==e.transport}));var a,s=o(this.sessionDesc.mediaDescriptions);try{for(s.s();!(a=s.n()).done;)a.value.attributes.candidates=this.candidates}catch(c){s.e(c)}finally{s.f()}}},{key:"restartICE",value:function(e){e=K_(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"findAvailableMediaIndex",value:function(e,t){var n=this;return this.sessionDesc.mediaDescriptions.findIndex((function(r){var i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(Gy()){if(i){var a=n.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!a||a!==r.attributes.mid)}return!1}return i}))}},{key:"createOrRecycleDataChannel",value:function(){var e,t=o(this.sessionDesc.mediaDescriptions);try{for(t.s();!(e=t.n()).done;){var n=e.value;if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1}}}catch(a){t.e(a)}finally{t.f()}this.currentMidIndex+=1;var r="".concat(this.currentMidIndex),i={media:{mediaType:"application",port:uP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(r),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(i),{mediaDesc:i,needExchangeSDP:!0}}},{key:"createOrRecycleRecvMedia",value:function(e,t,n,r,i,a){var o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send,u=[];if(o===Ck.VIDEO){var l,d;if($w("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=s.videoCodecs.filter((function(e){var t,n,i;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,r)&&(null==e||null===(i=e.fmtp)||void 0===i?void 0:i.parameters["profile-level-id"])===$w("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){var f=c.videoCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,r)}));0!==f.length&&(u=s.videoCodecs.filter((function(e){return f.some((function(t){return t.payloadType===e.payloadType}))})))}if($w("USE_PUB_RTX")){var p=u.map((function(e){return e.payloadType.toString()})),h=s.videoCodecs.filter((function(e){var t,n;return"rtx"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)&&$i(p).call(p,(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)||"")}));u=[].concat(m(u),m(h))}0===u.length&&(lS.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(d=s.videoCodecs[0].rtpMap)||void 0===d?void 0:d.encodingName)),u=s.videoCodecs)}else u=s.audioCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,i)})),0===u.length&&(lS.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=s.audioCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,"opus")})));var v=o===Ck.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;var g="".concat(this.currentMidIndex),y={media:{mediaType:o,port:uP,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};y=this.mungRecvMediaDsec(y,e,a);var _=this.findFirstClosedMedia(o);if(_){var E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}},{key:"createOrRecycleSendMedia",value:function(e,t,n,r,i){var a=this.rtpCapabilities.send,o=e===Ck.VIDEO?a.videoCodecs:a.audioCodecs,s=e===Ck.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;var c="".concat(this.currentMidIndex),u={media:{mediaType:e,port:uP,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);var l=this.findFirstClosedMedia(e);if(l){var d=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[d]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}},{key:"updateBundleMids",value:function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))}},{key:"mungRecvMediaDsec",value:function(e,t,n){var r=K_(e);return kD(r),SD(r,t),TD(r,t),ID(r),CD(r,n,this.localCapabilities.send),r}},{key:"mungSendMediaDesc",value:function(e,t){var n=K_(e);return CD(n,t,this.localCapabilities.recv),DD(n),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"findFirstClosedMedia",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return Gy()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))}},{key:"findPreloadMediaDesc",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}},{key:"getSSRC",value:function(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===t?void 0:t.attributes.ssrcs}}]),e}())({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c}),u=this.remoteSDP.toString(),f=vD.parse(this.initialOffer.sdp),(p=f.mediaDescriptions.find((function(e){return"audio"===e.media.mediaType})))&&DD(p),this.useXR&&PD(f),h=vD.print(f),v=this.logSDPExchange(h||"","offer","local","connect"),this.store.descriptionStart(),e.next=10,this.peerConnection.setLocalDescription({type:"offer",sdp:h});case 10:return null==v||v(u),e.next=13,this.peerConnection.setRemoteDescription({type:"answer",sdp:u});case 13:if(null!=(g=this.peerConnection.getTransceivers()[0])&&g.receiver&&this.tryBindTransportEvents(g.receiver),!($w("PRELOAD_MEDIA_COUNT")>0)){e.next=24;break}return this.remoteSDP.preloadRemoteMedia(),y=this.remoteSDP.toString(),e.next=19,this.peerConnection.setRemoteDescription({type:"offer",sdp:y});case 19:return e.next=21,this.peerConnection.createAnswer();case 21:return _=e.sent,e.next=24,this.peerConnection.setLocalDescription(_);case 24:e.next=29;break;case 26:throw e.prev=26,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 29:case"end":return e.stop()}}),e,this,[[0,26]])})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return lD(s().mark((function i(){var a,o,c,u,l,d,f,p,h,v,m;return s().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,dD(r.mutex.lock("From P2PConnection.send"));case 2:if(a=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call P2PConnection.send before remote SDP created");case 6:if(o=[],e.forEach((function(e){var t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)})),i.t0=Gy()&&!0===$w("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,dD(r.applySimulcastForFirefox(o,e));case 12:return i.next=14,dD(r.peerConnection.createOffer());case 14:return c=i.sent,u=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(c.sdp,e,u),d=vD.parse(l),f=u.map((function(e){var t=d.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return ED(t,$w("USE_PUB_RTX"))})),i.prev=19,i.next=22,f;case 22:p=i.sent,i.next=36;break;case 25:return i.prev=25,i.t1=i.catch(19),p=[],r.remoteSDP.receive(e,t,n,p),h=r.remoteSDP.toString(),i.next=31,dD(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 31:return i.next=33,dD(r.peerConnection.setRemoteDescription({type:"answer",sdp:h}));case 33:return i.next=35,dD(r.stopSending(u,!0));case 35:throw i.t1;case 36:return r.remoteSDP.receive(e,t,n,p),v=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send"),i.next=40,dD(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 40:return i.next=42,dD(r.applySimulcastEncodings(o,e));case 42:return i.next=44,dD(r.applySendEncodings(o,e));case 44:return null==m||m(v),i.next=47,dD(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}));case 47:return i.abrupt("return",o.map((function(e,t){var n=u[t];return{localSSRC:f[t],id:n,transceiver:e}})));case 50:throw i.prev=50,i.t2=i.catch(3),i.t2 instanceof o_?i.t2:new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(i.t2.toString()));case 53:return i.prev=53,a(),i.finish(53);case 56:case"end":return i.stop()}}),i,null,[[3,50,53,56],[19,25]])})))()}},{key:"createDataChannels",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");case 3:if((r=this.dataStreamChannelMap.get(t))&&"open"===r.readyState?lS.debug("[P2PConnection] Channels are already available and can be reused directly."):((r=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:$w("DATASTREAM_MAX_RETRANSMITS")})).binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)),n.forEach((function(e){e._updateOriginDataChannel(r)})),!this.remoteSDP.sendDataChannel().needExchangeSDP){e.next=18;break}return i=this.remoteSDP.toString(),e.next=10,this.peerConnection.setRemoteDescription({type:"offer",sdp:i});case 10:return e.next=12,this.peerConnection.createAnswer();case 12:return a=e.sent,e.next=15,this.peerConnection.setLocalDescription(a);case 15:lS.debug("[P2PConnection] createDataChannels by exchanging SDP."),e.next=19;break;case 18:lS.debug("[P2PConnection] createDataChannels no need to exchange SDP.");case 19:return e.abrupt("return");case 22:throw e.prev=22,e.t0=e.catch(0),e.t0 instanceof o_?e.t0:new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.t0.toString()));case 25:case"end":return e.stop()}}),e,this,[[0,22]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"stopDataChannels",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.dataStreamChannelMap.get(t),e.abrupt("return",(null==n||n.close(),void this.dataStreamChannelMap.delete(t)));case 5:throw e.prev=5,e.t0=e.catch(0),e.t0 instanceof o_?e.t0:new o_(Oy.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.t0.toString()));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopSending",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From P2PConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");case 11:if(i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),i.length===t.length){e.next=14;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 14:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return a=e.sent,o=this.logSDPExchange(a.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(a);case 21:return this.remoteSDP.stopReceiving(t),c=this.remoteSDP.toString(),null==o||o(c),e.next=26,this.peerConnection.setRemoteDescription({type:"answer",sdp:c});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));case 3:if(a=this.remoteSDP.send(t,n,r,i),o=a.mid,!a.needExchangeSDP){e.next=18;break}return c=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:c});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return l=e.sent,d=this.mungReceiveAnswerSDP(l.sdp,o,t),null==u||u(d||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:d});case 15:lS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")),e.next=19;break;case 18:lS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));case 19:if(f=this.peerConnection.getTransceivers().find((function(e){return e.mid===o}))){e.next=22;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 22:return e.abrupt("return",{track:f.receiver.track,id:o,transceiver:f});case 25:throw e.prev=25,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");case 3:if(n=this.remoteSDP.batchSend(t),r=n.mids,!n.needExchangeSDP){e.next=17;break}return i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:i});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return o=e.sent,null==a||a(o.sdp||""),e.next=14,this.peerConnection.setLocalDescription(o);case 14:lS.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP.")),e.next=18;break;case 17:lS.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));case 18:return e.abrupt("return",r.map((function(e){var t=c.peerConnection.getTransceivers().find((function(t){return t.mid===e}));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})));case 21:throw e.prev=21,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.mute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.unmute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(e){var t=this;return lD(s().mark((function n(){var r,i,a,o,c,u,l,d,f;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,dD(t.mutex.lock("From P2PConnection.restartICE"));case 2:if(r=n.sent,n.prev=3,t.remoteSDP){n.next=6;break}throw new Error("Cannot restartICE before remoteSDP created.");case 6:if(!OI().supportPCSetConfiguration){n.next=11;break}i=t.peerConnection.getConfiguration(),a=e===Rk.RELAY?"relay":"all",i.iceTransportPolicy!==a&&(lS.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(i.iceTransportPolicy,"] to [").concat(a,"]")),i.iceTransportPolicy=a,t.peerConnection.setConfiguration(i)),n.next=13;break;case 11:if(e!==Rk.RELAY){n.next=13;break}return n.abrupt("return");case 13:return t.remoteSDP.updateCandidates(e),n.next=16,dD(t.peerConnection.createOffer({iceRestart:!0}));case 16:if((o=n.sent).sdp){n.next=19;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 19:return c=_D(o.sdp),n.next=22,c.iceParameters;case 22:return u=n.sent,l=u.remoteIceParameters,t.remoteSDP.restartICE(l),d=t.remoteSDP.toString(),f=t.logSDPExchange(o.sdp||"","offer","local","restartICE"),t.store.descriptionStart(),n.next=29,dD(t.peerConnection.setLocalDescription(o));case 29:return null==f||f(d),n.next=32,dD(t.peerConnection.setRemoteDescription({type:"answer",sdp:d}));case 32:n.next=37;break;case 34:n.prev=34,n.t0=n.catch(3),lS.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),n.t0);case 37:return n.prev=37,r(),n.finish(37);case 40:case"end":return n.stop()}}),n,null,[[3,34,37,40]])})))()}},{key:"close",value:function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),a=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==o||o(a),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=Gy(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getSelectedCandidatePair",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.peerConnection.getReceivers()).length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair())){e.next=4;break}return n=t[0].transport.iceTransport,r=n.getSelectedCandidatePair(),i=r.local,a=r.remote,e.abrupt("return",{local:fP(fP({},VD),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:fP(fP({},VD),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})});case 4:return e.abrupt("return",this.statsFilter.getSelectedCandidatePair());case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),$w("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"tryBindTransportEvents",value:function(e){var t=this,n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=function(){var e;null!=n&&n.state&&(null===(e=t.onDTLSTransportStateChange)||void 0===e||e.call(t,n.state))},n.onerror=function(e){var n;null===(n=t.onDTLSTransportError)||void 0===n||n.call(t,"error"in e?e.error:e)};var r=n.iceTransport;r&&(r.onstatechange=function(){var e,r=null==n?void 0:n.iceTransport.state;r&&(null===(e=t.onICETransportStateChange)||void 0===e||e.call(t,r))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=function(){if(r.getSelectedCandidatePair()){var e=r.getSelectedCandidatePair(),n=e.local,i=e.remote;lS.info("[".concat(t.store.clientId,"] [pc-").concat(t.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}},{key:"tryUnbindTransportEvents",value:function(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}},{key:"updateRtpSenderEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.peerConnection.getSenders().find((function(e){return e.track===t._mediaStreamTrack}))),n){e.next=3;break}return e.abrupt("return",lS.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(!this.isVP8Simulcast(t)){e.next=5;break}return e.abrupt("return",lS.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings"));case 5:if(OI().supportSetRtpSenderParameters){e.next=7;break}return e.abrupt("return",lS.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters"));case 7:i={},a={},e.t0=t._optimizationMode,e.next="motion"===e.t0?11:"detail"===e.t0?13:15;break;case 11:return i.degradationPreference="maintain-framerate",e.abrupt("break",16);case 13:return i.degradationPreference="maintain-resolution",e.abrupt("break",16);case 15:i.degradationPreference="balanced";case 16:return t._encoderConfig&&(c=t._encoderConfig,u=c.bitrateMax,l=c.frameRate,d=c.scaleResolutionDownBy,u&&(a.maxBitrate=1e3*u),$i(o=t._hints).call(o,zT.LOW_STREAM)&&(l&&(a.maxFramerate=DN(l)),d&&d>=1&&(a.scaleResolutionDownBy=d))),$w("DSCP_TYPE")&&t_()&&(p=$w("DSCP_TYPE"),$i(f=["very-low","low","medium","high"]).call(f,p)&&(a.networkPriority=p)),h=n.getParameters(),v=null===(r=h.encodings)||void 0===r?void 0:r[0],Gy()&&!v&&(i.encodings=[a]),v&&Object.assign(v,a),Object.assign(h,i),lS.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),e.next=25,n.setParameters(h);case 25:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySendEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,OI().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=a instanceof GC&&!this.isVP8Simulcast(a),!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i.sender);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),lS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t,n){var r=this,i=vD.parse(e);return t.forEach((function(e,t){var a=n[t],o=i.mediaDescriptions.find((function(e){return e.attributes.mid===a}));o&&(SD(o,e),RD(o,e,r.store.codec))})),vD.print(i)}},{key:"mungReceiveAnswerSDP",value:function(e,t,n){var r=vD.parse(e),i=r.mediaDescriptions.find((function(e){return e.attributes.mid===t}));return i&&(n===Ck.AUDIO&&"audio"===i.media.mediaType&&DD(i),this.useXR&&PD(r)),vD.print(r)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}},{key:"applySimulcastForFirefox",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(l=t[r],!((d=n[r])instanceof GC&&!$i(i=d._hints).call(i,zT.LOW_STREAM)&&null!==(a=d._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(o=d._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(c=d._scalabilityMode)&&void 0!==c&&c.numSpatialLayers&&(null===(u=d._scalabilityMode)||void 0===u?void 0:u.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return f={},p={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4},f.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}],h=l.sender.getParameters(),e.next=10,l.sender.setParameters(Object.assign(h,f));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySimulcastEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gy()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof GC&&this.isVP8Simulcast(i))){e.next=10;break}return a=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}],u=a.sender.getParameters(),e.next=10,a.sender.setParameters(Object.assign(u,o));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"isVP8Simulcast",value:function(e){var t,n,r,i,a;return!!(e instanceof GC&&$w("SIMULCAST")&&"vp8"===this.store.codec&&!$i(t=e._hints).call(t,zT.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if($w("SDP_LOGGING"))return lS.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"getRemoteSSRC",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(OI().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(P_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),$w("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),$w("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),$w("ENABLE_ENCODED_TRANSFORM")&&OI().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(NN(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$w("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(Yk);function hP(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function vP(e,t){var n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=DN(t.width),r.height=DN(t.height);var i=DN(t.framerate||15);document.body.append(n),document.body.append(r);var a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();var o=r.getContext("2d");if(!o)throw new ek(Oy.UNEXPECTED_ERROR,"can not get canvas context");var s=OI(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=function(){if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){var t=n.videoWidth,i=n.videoHeight/t,s=r.width*i;Math.abs(s-r.height)>=2&&(lS.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(s)),r.height=s)}o.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=RI((function(){return r.startCapture&&r.startCapture()}),i);var u=c.stop;return c.stop=function(){u.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),lS.debug("clean low stream renderer")},c}function mP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([hP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],pP.prototype,"connect",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[Object,Array]),$S("design:returntype",by)],pP.prototype,"createDataChannels",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String,Array,String,Object]),$S("design:returntype",by)],pP.prototype,"receive",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],pP.prototype,"batchReceive",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],pP.prototype,"stopReceiving",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],pP.prototype,"muteRemote",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],pP.prototype,"unmuteRemote",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],pP.prototype,"muteLocal",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],pP.prototype,"unmuteLocal",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],pP.prototype,"close",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],pP.prototype,"updateEncoderConfig",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],pP.prototype,"updateSendParameters",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[yI,String]),$S("design:returntype",by)],pP.prototype,"replaceTrack",null),QS([hP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],pP.prototype,"getRemoteSSRC",null);var yP="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",_P="9",EP=2e4,bP=4e4,wP=function(){function e(t){l(this,e),kf(this,"sessionDesc",void 0),kf(this,"_localCapabilities",void 0),kf(this,"_rtpCapabilities",void 0),kf(this,"_candidates",void 0),kf(this,"_iceParameters",void 0),kf(this,"_dtlsParameters",void 0),kf(this,"setup",void 0),kf(this,"currentMidIndex",void 0),kf(this,"cname",void 0),kf(this,"firefoxSsrcMidMap",new Map);var n=t=K_(t),r=n.remoteIceParameters,i=n.remoteDtlsParameters,a=n.candidates,s=n.remoteRTPCapabilities,c=n.remoteSetup,u=n.localCapabilities,d=n.cname,f=vD.parse(yP);this._rtpCapabilities=s,this._candidates=a,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u,this.setup=c,this.cname=d;var p,h=this.rtpCapabilities.send,v=o(f.mediaDescriptions);try{for(v.s();!(p=v.n()).done;){var m=p.value;if(m.attributes.iceUfrag=r.iceUfrag,m.attributes.icePwd=r.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=a,m.attributes.setup=c,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=h.videoCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=h.videoCodecs,m.attributes.extmaps=h.videoExtensions,$w("PRELOAD_MEDIA_COUNT")>0)){var g=wD([{ssrcId:bP,rtx:$w("USE_SUB_RTX")?40001:void 0}],this.cname),y=g.ssrcs,_=g.ssrcGroups;m.attributes.ssrcs=y,m.attributes.ssrcGroups=_}if("audio"===m.media.mediaType&&(m.media.fmts=h.audioCodecs.map((function(e){return e.payloadType.toString(10)})),m.attributes.payloads=h.audioCodecs,m.attributes.extmaps=h.audioExtensions,DD(m),$w("PRELOAD_MEDIA_COUNT")>0)){var E=wD([{ssrcId:EP}],this.cname),b=E.ssrcs,w=E.ssrcGroups;m.attributes.ssrcs=b,m.attributes.ssrcGroups=w}}}catch(S){v.e(S)}finally{v.f()}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}return d(e,[{key:"localCapabilities",get:function(){return K_(this._localCapabilities)}},{key:"rtpCapabilities",get:function(){return K_(this._rtpCapabilities)}},{key:"candidates",get:function(){return K_(this._candidates)}},{key:"iceParameters",get:function(){return K_(this._iceParameters)}},{key:"dtlsParameters",get:function(){return K_(this._dtlsParameters)}},{key:"updateRemoteRTPCapabilities",value:function(e){var t=vD.parse(yP);this._rtpCapabilities=e;var n,r=this.rtpCapabilities.send,i=o(t.mediaDescriptions);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.attributes.iceUfrag=this._iceParameters.iceUfrag,a.attributes.icePwd=this._iceParameters.icePwd,a.attributes.fingerprints=this._dtlsParameters.fingerprints,a.attributes.candidates=this._candidates,a.attributes.setup=this.setup,"application"===a.media.mediaType&&(a.attributes.sctpPort="5000"),"video"===a.media.mediaType&&(a.media.fmts=r.videoCodecs.map((function(e){return e.payloadType.toString(10)})),a.attributes.payloads=r.videoCodecs,a.attributes.extmaps=r.videoExtensions,$w("PRELOAD_MEDIA_COUNT")>0)){var s=wD([{ssrcId:bP,rtx:$w("USE_SUB_RTX")?40001:void 0}],this.cname),c=s.ssrcs,u=s.ssrcGroups;a.attributes.ssrcs=c,a.attributes.ssrcGroups=u}if("audio"===a.media.mediaType&&(a.media.fmts=r.audioCodecs.map((function(e){return e.payloadType.toString(10)})),a.attributes.payloads=r.audioCodecs,a.attributes.extmaps=r.audioExtensions,$w("PRELOAD_MEDIA_COUNT")>0)){var l=wD([{ssrcId:EP}],this.cname),d=l.ssrcs,f=l.ssrcGroups;a.attributes.ssrcs=d,a.attributes.ssrcGroups=f}}}catch(p){i.e(p)}finally{i.f()}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}},{key:"preloadRemoteMedia",value:function(e){this.rtpCapabilities;for(var t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,a=1;a<e;a++){var o=2*a+bP,s=wD([{ssrcId:2*a+EP}],this.cname),c=s.ssrcs,u=s.ssrcGroups,l=wD([{ssrcId:o,rtx:$w("USE_SUB_RTX")?o+1:void 0}],this.cname),d=l.ssrcs,f=l.ssrcGroups;this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:_P,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:_P,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a)}}),this.currentMidIndex+=2}this.updateBundleMids()}},{key:"toString",value:function(){return vD.print(this.sessionDesc)}},{key:"send",value:function(e,t,n,r){var i=wD(t,this.cname,$w("SYNC_GROUP")?n:void 0),a=i.ssrcs,o=i.ssrcGroups,s=this.findPreloadMediaDesc(a);if(s){if(Gy()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){var c=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}var u,l=this.findAvailableMediaIndex(e,a);return-1===l||By()||Zy()||Ky()||0===l&&$w("USE_SUB_RTX")?(u=this.createOrRecycleSendMedia(e,a,o,"sendonly",r),this.updateBundleMids()):((u=K_(this.sessionDesc.mediaDescriptions[l])).attributes.direction="sendonly",u.attributes.ssrcs=a,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,r)),Gy()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}},{key:"batchSend",value:function(e){var t=this,n=e.map((function(e){var n=e.kind,r=e.ssrcMsg,i=e.mslabel;return t.send(n,r,i)})),r=[],i=!1;return n.forEach((function(e){var t=e.mid;e.needExchangeSDP&&(i=!0),r.push(t)})),{mids:r,needExchangeSDP:i}}},{key:"stopSending",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((function(e){"0"===e.attributes.mid||Gy()||By()||Zy()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}},{key:"mute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}},{key:"unmute",value:function(e){var t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}},{key:"muteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return $i(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="inactive"}))}},{key:"unmuteRemote",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return $i(e).call(e,t.attributes.mid||"")}));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((function(e){e.attributes.direction="recvonly"}))}},{key:"receive",value:function(e,t,n,r){var i=this;e.forEach((function(e,a){i.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[a])})),this.updateBundleMids()}},{key:"stopReceiving",value:function(e){var t=this.sessionDesc.mediaDescriptions.filter((function(t){return-1!==e.indexOf(t.attributes.mid)}));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((function(e){e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}},{key:"updateCandidates",value:function(e){var t=this;e===Rk.TCP?this._candidates.forEach((function(e){-1===t._candidates.findIndex((function(t){return"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port}))&&t._candidates.push(gP(gP({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((function(e){return"tcp"!==e.transport}));var n,r=o(this.sessionDesc.mediaDescriptions);try{for(r.s();!(n=r.n()).done;)n.value.attributes.candidates=this.candidates}catch(i){r.e(i)}finally{r.f()}}},{key:"restartICE",value:function(e){e=K_(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((function(t){t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}},{key:"predictReceivingMids",value:function(e){for(var t=[],n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}},{key:"findAvailableMediaIndex",value:function(e,t){var n=this;return this.sessionDesc.mediaDescriptions.findIndex((function(r){var i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(Gy()){if(i){var a=n.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!a||a!==r.attributes.mid)}return!1}return i}))}},{key:"createOrRecycleRecvMedia",value:function(e,t,n,r,i,a){var o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send,u=[];if(o===Ck.VIDEO){var l,d;if($w("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=s.videoCodecs.filter((function(e){var t,n,i;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,r)&&(null==e||null===(i=e.fmtp)||void 0===i?void 0:i.parameters["profile-level-id"])===$w("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){var f=c.videoCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,r)}));0!==f.length&&(u=s.videoCodecs.filter((function(e){return f.some((function(t){return t.payloadType===e.payloadType}))})))}if($w("USE_PUB_RTX")){var p=u.map((function(e){return e.payloadType.toString()})),h=s.videoCodecs.filter((function(e){var t,n;return"rtx"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)&&$i(p).call(p,(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)||"")}));u=[].concat(m(u),m(h))}0===u.length&&(lS.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(d=s.videoCodecs[0].rtpMap)||void 0===d?void 0:d.encodingName)),u=s.videoCodecs)}else u=s.audioCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,i)})),0===u.length&&(lS.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=s.audioCodecs.filter((function(e){var t,n;return $i(t=(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"").call(t,"opus")})));var v=o===Ck.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;var g="".concat(this.currentMidIndex),y={media:{mediaType:o,port:_P,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};y=this.mungRecvMediaDsec(y,e,a);var _=this.findFirstClosedMedia(o);if(_){var E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}},{key:"createOrRecycleSendMedia",value:function(e,t,n,r,i){var a=this.rtpCapabilities.send,o=e===Ck.VIDEO?a.videoCodecs:a.audioCodecs,s=e===Ck.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;var c="".concat(this.currentMidIndex),u={media:{mediaType:e,port:_P,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((function(e){return e.payloadType.toString(10)}))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);var l=this.findFirstClosedMedia(e);if(l){var d=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[d]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}},{key:"updateBundleMids",value:function(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((function(e){return"0"!==e.media.port})).map((function(e){return e.attributes.mid}))}},{key:"mungRecvMediaDsec",value:function(e,t,n){var r=K_(e);return kD(r),SD(r,t),TD(r,t),ID(r),CD(r,n,this.localCapabilities.send),r}},{key:"mungSendMediaDesc",value:function(e,t){var n=K_(e);return CD(n,t,this.localCapabilities.recv),DD(n),n}},{key:"updateRecvMedia",value:function(e,t){var n=this.sessionDesc.mediaDescriptions.findIndex((function(t){return t.attributes.mid===e}));if(-1!==n){var r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}},{key:"bumpMid",value:function(e){this.currentMidIndex+=e}},{key:"findFirstClosedMedia",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){return Gy()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port}))}},{key:"findPreloadMediaDesc",value:function(e){return this.sessionDesc.mediaDescriptions.find((function(t){var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}},{key:"getSSRC",value:function(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===t?void 0:t.attributes.ssrcs}}]),e}();function SP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var TP=function(e){p(n,e);var t=h(n);function n(e,r,i){var a;return l(this,n),a=t.call(this,e,r),kf(f(a),"store",void 0),kf(f(a),"peerConnection",void 0),kf(f(a),"remoteSDP",void 0),kf(f(a),"initialOffer",void 0),kf(f(a),"transportEventReceiver",void 0),kf(f(a),"statsFilter",void 0),kf(f(a),"useXR",$w("USE_XR")),kf(f(a),"localCapabilities",void 0),kf(f(a),"localCandidateCount",0),kf(f(a),"allCandidatesReceived",!1),kf(f(a),"dataStreamChannelMap",new Map),kf(f(a),"establishPromise",void 0),kf(f(a),"mutex",new fE("NVExtentionsConnection-mutex")),kf(f(a),"rtcMedia",void 0),a.store=r,a.peerConnection=i,a.statsFilter=nP(a.peerConnection,$w("STATS_UPDATE_INTERVAL"),void 0,Gy()?1200:void 0),a.bindPCEvents(),a.bindStatsEvents(),a.store.p2pId=a.store.p2pId+1,a.establishPromise=a.establish(),a}return d(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"establish",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer();case 3:if((n=e.sent).sdp){e.next=6;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 6:return r=_D(n.sdp),e.next=9,AD({filterRTX:!$w("USE_PUB_RTX")&&!$w("USE_SUB_RTX"),filterVideoFec:$w("FILTER_VIDEO_FEC"),filterAudioFec:$w("FILTER_AUDIO_FEC")},{useXR:this.useXR});case 9:return i=e.sent,e.abrupt("return",(this.localCapabilities=i,this.initialOffer=n,kP(kP({},r),{},{rtpCapabilities:i,offerSDP:n.sdp})));case 13:throw e.prev=13,e.t0=e.catch(0),new ek(Oy.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 16:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){var c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.initialOffer){e.next=3;break}throw new Error("Cannot establish NVConnection without initial offer.");case 3:return this.remoteSDP=new wP({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:a,localCapabilities:xD(this.localCapabilities),cname:o}),c=this.remoteSDP.toString(),u=vD.parse(this.initialOffer.sdp),l=u.mediaDescriptions.find((function(e){return"audio"===e.media.mediaType})),l&&DD(l),this.useXR&&PD(u),d=vD.print(u),f=this.logSDPExchange(d||"","offer","local","connect"),e.next=9,this.peerConnection.setLocalDescription({type:"offer",sdp:d});case 9:return null==f||f(c),e.next=12,this.peerConnection.setRemoteDescription({type:"answer",sdp:c});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.t0.toString()));case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"updateRemoteConnect",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=this.remoteSDP)||void 0===n||n.updateRemoteRTPCapabilities(t),null===(r=this.remoteSDP)||void 0===r||r.preloadRemoteMedia(2),a=null===(i=this.remoteSDP)||void 0===i?void 0:i.toString(),e.next=4,this.peerConnection.setRemoteDescription({type:"offer",sdp:a});case 4:return e.next=6,this.peerConnection.createAnswer();case 6:return o=e.sent,e.next=9,this.peerConnection.setLocalDescription(o);case 9:lS.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.");case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return lD(s().mark((function i(){var a,o,c,u,l,d,f,p,h,v,m;return s().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,dD(r.mutex.lock("From NVExtentionsConnection.send"));case 2:if(a=i.sent,i.prev=3,r.remoteSDP){i.next=6;break}throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");case 6:if(o=[],e.forEach((function(e){var t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t)})),i.t0=Gy()&&!0===$w("SIMULCAST"),!i.t0){i.next=12;break}return i.next=12,dD(r.applySimulcastForFirefox(o,e));case 12:return i.next=14,dD(r.peerConnection.createOffer());case 14:return c=i.sent,u=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(c.sdp,e,u),d=vD.parse(l),f=u.map((function(e){var t=d.mediaDescriptions.find((function(t){return t.attributes.mid===e}));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return ED(t,$w("USE_PUB_RTX"))})),i.prev=19,i.next=22,f;case 22:p=i.sent,i.next=36;break;case 25:return i.prev=25,i.t1=i.catch(19),p=[],r.remoteSDP.receive(e,t,n,p),h=r.remoteSDP.toString(),i.next=31,dD(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 31:return i.next=33,dD(r.peerConnection.setRemoteDescription({type:"answer",sdp:h}));case 33:return i.next=35,dD(r.stopSending(u,!0));case 35:throw i.t1;case 36:return r.remoteSDP.receive(e,t,n,p),v=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send"),i.next=40,dD(r.peerConnection.setLocalDescription({type:"offer",sdp:l}));case 40:return i.next=42,dD(r.applySimulcastEncodings(o,e));case 42:return i.next=44,dD(r.applySendEncodings(o,e));case 44:return null==m||m(v),i.next=47,dD(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}));case 47:return i.abrupt("return",o.map((function(e,t){var n=u[t];return{localSSRC:f[t],id:n,transceiver:e}})));case 50:throw i.prev=50,i.t2=i.catch(3),i.t2 instanceof ek?i.t2:new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(i.t2.toString()));case 53:return i.prev=53,a(),i.finish(53);case 56:case"end":return i.stop()}}),i,null,[[3,50,53,56],[19,25]])})))()}},{key:"stopSending",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From NVExtentionsConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,this.remoteSDP){e.next=11;break}throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");case 11:if(i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),i.length===t.length){e.next=14;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");case 14:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=17,this.peerConnection.createOffer();case 17:return a=e.sent,o=this.logSDPExchange(a.sdp||"","offer","local","stopSending"),e.next=21,this.peerConnection.setLocalDescription(a);case 21:return this.remoteSDP.stopReceiving(t),c=this.remoteSDP.toString(),null==o||o(c),e.next=26,this.peerConnection.setRemoteDescription({type:"answer",sdp:c});case 26:e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(8),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.t1.toString()));case 31:return e.prev=31,r&&r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[8,28,31,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"createDataChannels",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");case 3:return r=this.dataStreamChannelMap.get(t),e.abrupt("return",(r&&"open"===r.readyState?lS.debug("[P2PConnection] Channels are already available and can be reused directly."):((r=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:$w("DATASTREAM_MAX_RETRANSMITS")})).binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)),void n.forEach((function(e){e._updateOriginDataChannel(r)}))));case 7:throw e.prev=7,e.t0=e.catch(0),e.t0 instanceof ek?e.t0:new ek(Oy.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(e.t0.toString()));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"stopDataChannels",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.dataStreamChannelMap.get(t),e.abrupt("return",(null==n||n.close(),void this.dataStreamChannelMap.delete(t)));case 5:throw e.prev=5,e.t0=e.catch(0),e.t0 instanceof ek?e.t0:new ek(Oy.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.t0.toString()));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));case 3:if(a=this.remoteSDP.send(t,n,r,i),o=a.mid,!a.needExchangeSDP){e.next=18;break}return c=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:c});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return l=e.sent,d=this.mungReceiveAnswerSDP(l.sdp,o,t),null==u||u(d||""),e.next=15,this.peerConnection.setLocalDescription({type:"answer",sdp:d});case 15:lS.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP.")),e.next=19;break;case 18:lS.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));case 19:if(f=this.peerConnection.getTransceivers().find((function(e){return e.mid===o})),f){e.next=22;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 22:return e.abrupt("return",{track:f.receiver.track,id:o});case 25:throw e.prev=25,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.t0.toString()));case 28:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");case 3:if(n=this.remoteSDP.batchSend(t),r=n.mids,!n.needExchangeSDP){e.next=17;break}return i=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","remote","receive"),e.next=8,this.peerConnection.setRemoteDescription({type:"offer",sdp:i});case 8:return e.next=10,this.peerConnection.createAnswer();case 10:return o=e.sent,null==a||a(o.sdp||""),e.next=14,this.peerConnection.setLocalDescription(o);case 14:lS.debug("[NVExtentionsConnection] batchReceive by exchanging SDP."),e.next=18;break;case 17:lS.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");case 18:return e.abrupt("return",r.map((function(e){var t=c.peerConnection.getTransceivers().find((function(t){return t.mid===e}));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}})));case 21:throw e.prev=21,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.t0.toString()));case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");case 3:return this.remoteSDP.stopSending(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.mute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));case 3:return this.remoteSDP.unmute(t),n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote"),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,null==r||r(i.sdp||""),e.next=13,this.peerConnection.setLocalDescription(i);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.t0.toString()));case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map((function(e){e.direction="inactive"})),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.muteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");case 3:if(n=this.peerConnection.getTransceivers().filter((function(e){return e.mid&&-1!==t.indexOf(e.mid)})),n.length===t.length){e.next=6;break}throw new Error("Transceivers' length doesn't match mids' length.");case 6:return n.map(function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.direction="sendonly";case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=9,this.peerConnection.createOffer();case 9:return r=e.sent,i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal"),e.next=13,this.peerConnection.setLocalDescription(r);case 13:return this.remoteSDP.unmuteRemote(t),a=this.remoteSDP.toString(),null==i||i(a),e.next=18,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(e){var t=this;return lD(s().mark((function n(){var r,i,a,o,c,u,l,d,f;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,dD(t.mutex.lock("From NVExtentionsConnection.restartICE"));case 2:if(r=n.sent,n.prev=3,t.remoteSDP){n.next=6;break}throw new Error("Cannot restartICE before remoteSDP created.");case 6:if(!OI().supportPCSetConfiguration){n.next=11;break}i=t.peerConnection.getConfiguration(),a=e===Rk.RELAY?"relay":"all",i.iceTransportPolicy!==a&&(lS.debug("restartICE change iceTransportPolicy from [".concat(i.iceTransportPolicy,"] to [").concat(a,"]")),i.iceTransportPolicy=a,t.peerConnection.setConfiguration(i)),n.next=13;break;case 11:if(e!==Rk.RELAY){n.next=13;break}return n.abrupt("return");case 13:return e!==Rk.RELAY&&t.remoteSDP.updateCandidates(e),n.next=16,dD(t.peerConnection.createOffer({iceRestart:!0}));case 16:if((o=n.sent).sdp){n.next=19;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 19:return c=_D(o.sdp),n.next=22,c.iceParameters;case 22:return u=n.sent,l=u.remoteIceParameters,t.remoteSDP.restartICE(l),d=t.remoteSDP.toString(),f=t.logSDPExchange(o.sdp||"","offer","local","restartICE"),n.next=28,dD(t.peerConnection.setLocalDescription(o));case 28:return null==f||f(d),n.next=31,dD(t.peerConnection.setRemoteDescription({type:"answer",sdp:d}));case 31:n.next=36;break;case 33:n.prev=33,n.t0=n.catch(3),lS.warning("restart ICE failed, abort operation",n.t0);case 36:return n.prev=36,r(),n.finish(36);case 39:case"end":return n.stop()}}),n,null,[[3,33,36,39]])})))()}},{key:"close",value:function(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.remoteSDP){e.next=3;break}throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");case 3:return e.next=5,this.peerConnection.createOffer();case 5:return r=e.sent,i=this.mungSendOfferSDP(r.sdp,[n],[t]),this.remoteSDP.updateRecvMedia(t,n),a=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig"),e.next=11,this.peerConnection.setLocalDescription({type:"offer",sdp:i});case 11:return null==o||o(a),e.next=14,this.peerConnection.setRemoteDescription({type:"answer",sdp:a});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(0),new ek(Oy.EXCHANGE_SDP_FAILED,e.t0.toString());case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=Gy(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getP2PConnectionParams",value:function(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return kP(kP({},_D(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,lS.debug("[pc-".concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,lS.debug("[pc-".concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),$w("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"applySendEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h,v,m,g,y,_;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,OI().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=32;break}if(i=t[r],!((a=n[r])&&a instanceof GC)){e.next=29;break}if(!this.isVP8Simulcast(a)){e.next=11;break}return e.abrupt("continue",29);case 11:l={},d={},e.t0=a._optimizationMode,e.next="motion"===e.t0?15:"detail"===e.t0?17:19;break;case 15:return l.degradationPreference="maintain-framerate",e.abrupt("break",20);case 17:return l.degradationPreference="maintain-resolution",e.abrupt("break",20);case 19:l.degradationPreference="balanced";case 20:return null!==(o=a._encoderConfig)&&void 0!==o&&o.bitrateMax&&(d.maxBitrate=1e3*(null===(f=a._encoderConfig)||void 0===f?void 0:f.bitrateMax)),$i(c=a._hints).call(c,zT.LOW_STREAM)&&(null!==(p=a._encoderConfig)&&void 0!==p&&p.frameRate&&(d.maxFramerate=DN(a._encoderConfig.frameRate)),null!==(h=a._encoderConfig)&&void 0!==h&&h.scaleResolutionDownBy&&(null===(v=a._encoderConfig)||void 0===v?void 0:v.scaleResolutionDownBy)>1&&(d.scaleResolutionDownBy=a._encoderConfig.scaleResolutionDownBy)),$w("DSCP_TYPE")&&t_()&&(g=$w("DSCP_TYPE"),$i(m=["very-low","low","medium","high"]).call(m,g)&&(d.networkPriority=g)),y=i.sender.getParameters(),_=null===(u=y.encodings)||void 0===u?void 0:u[0],Gy()&&!_&&(l.encodings=[d]),_&&Object.assign(_,d),Object.assign(y,l),e.next=29,i.sender.setParameters(y);case 29:r++,e.next=6;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),lS.debug("Apply RTPSendEncodings failed.");case 37:case"end":return e.stop()}}),e,this,[[0,34]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t,n){var r=this,i=vD.parse(e);return t.forEach((function(e,t){var a=n[t],o=i.mediaDescriptions.find((function(e){return e.attributes.mid===a}));o&&(SD(o,e),RD(o,e,r.store.codec))})),vD.print(i)}},{key:"mungReceiveAnswerSDP",value:function(e,t,n){var r=vD.parse(e),i=r.mediaDescriptions.find((function(e){return e.attributes.mid===t}));return i&&n===Ck.AUDIO&&"audio"===i.media.mediaType&&DD(i),this.useXR&&PD(r),vD.print(r)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}},{key:"applySimulcastForFirefox",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(l=t[r],!((d=n[r])instanceof GC&&!$i(i=d._hints).call(i,zT.LOW_STREAM)&&null!==(a=d._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(o=d._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(c=d._scalabilityMode)&&void 0!==c&&c.numSpatialLayers&&(null===(u=d._scalabilityMode)||void 0===u?void 0:u.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return f={},p={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4},f.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}],h=l.sender.getParameters(),e.next=10,l.sender.setParameters(Object.assign(h,f));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySimulcastEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gy()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof GC&&this.isVP8Simulcast(i))){e.next=10;break}return a=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}],u=a.sender.getParameters(),e.next=10,a.sender.setParameters(Object.assign(u,o));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"isVP8Simulcast",value:function(e){var t,n,r,i,a;return!!(e instanceof GC&&$w("SIMULCAST")&&"vp8"===this.store.codec&&!$i(t=e._hints).call(t,zT.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if($w("SDP_LOGGING"))return lS.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"getRemoteSSRC",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remoteSDP){e.next=2;break}return e.abrupt("return");case 2:return n=this.remoteSDP.getSSRC(t),e.abrupt("return",null==n?void 0:n[0].ssrcId);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setConfiguration",value:function(e){if(OI().supportPCSetConfiguration){var t=n.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(P_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),$w("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),$w("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(NN(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$w("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(Yk);function IP(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From NVExtentionsConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function CP(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=pD,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new RP(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function RP(e){function t(e){if(Object(e)!==e)return by.reject(new TypeError(e+" is not an object."));var t=e.done;return by.resolve(e.value).then((function(e){return{value:e,done:t}}))}return RP=function(e){this.s=e,this.n=e.next},RP.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?by.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?by.reject(e):t(n.apply(this.s,arguments))}},new RP(e)}QS([IP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],TP.prototype,"connect",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],TP.prototype,"updateRemoteConnect",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Object,Array]),$S("design:returntype",by)],TP.prototype,"createDataChannels",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String,Array,String,Object]),$S("design:returntype",by)],TP.prototype,"receive",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],TP.prototype,"batchReceive",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],TP.prototype,"stopReceiving",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],TP.prototype,"muteRemote",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],TP.prototype,"unmuteRemote",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],TP.prototype,"muteLocal",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],TP.prototype,"unmuteLocal",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],TP.prototype,"close",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],TP.prototype,"updateEncoderConfig",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],TP.prototype,"updateSendParameters",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[yI,String]),$S("design:returntype",by)],TP.prototype,"replaceTrack",null),QS([IP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],TP.prototype,"getRemoteSSRC",null);var AP=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this,e,r),kf(f(i),"store",void 0),kf(f(i),"peerConnection",void 0),kf(f(i),"cname",void 0),kf(f(i),"mutex",new fE("DataChannelConnection-mutex")),kf(f(i),"dataChannel",void 0),kf(f(i),"_p2pConnection",void 0),kf(f(i),"establishPromise",void 0),kf(f(i),"_nvMedia",void 0),i.store=r,i.store.dcId=i.store.dcId+1,i.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),i.dataChannel=i.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),i.dataChannel.binaryType="arraybuffer",i._p2pConnection=new TP(e,r,i.peerConnection),i.bindPCEvents(),i.establishPromise=i._p2pConnection.establishPromise,i}return d(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"establish",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(t=this._nvMedia)||void 0===t?void 0:t.getLocalRtpCapabilities(),e.next=3,this._p2pConnection.establish(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getP2PConnectionParams",value:function(){return this._p2pConnection.getP2PConnectionParams()}},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){var c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cname=o,e.next=3,this._p2pConnection.connect(t,n,r,i,a,o);case 3:return e.next=5,new by((function(e,t){var n=setTimeout((function(){c.closeSignal(),t(new ek(Oy.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))}),2e3);c.dataChannel.onopen=function(){if("open"===c.dataChannel.readyState)return clearTimeout(n),void e()},c.dataChannel.onerror=function(e){c.closeSignal(),t(e)}}));case 5:return e.abrupt("return",{transmitter:this.dataChannel,close:this.closeSignal.bind(this)});case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"send",value:function(e,t,n){var r=this;return lD(s().mark((function i(){var a;return s().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,dD(r.mutex.lock("From DataChannelConnection.send"));case 2:return a=i.sent,i.prev=3,i.delegateYield(fD(CP(r._p2pConnection.send(e,t,n))),"t0",5);case 5:return i.abrupt("return",i.t0);case 6:return i.prev=6,a(),i.finish(6);case 9:case"end":return i.stop()}}),i,null,[[3,,6,9]])})))()}},{key:"stopSending",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.stopSending(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"createDataChannels",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.createDataChannels(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"stopDataChannels",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.stopDataChannels(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=c(s().mark((function e(t,n,r,i){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._nvMedia){e.next=7;break}return lS.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),e.next=4,this._nvMedia.reveiveByRTCMedia(t,n,this.cname);case 4:e.t0=e.sent,e.next=11;break;case 7:return lS.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),e.next=10,this._p2pConnection.receive(t,n,r,i);case 10:e.t0=e.sent;case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"batchReceive",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,this._p2pConnection.batchReceive(t);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.stopReceiving(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.muteRemote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.unmuteRemote(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteLocal",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.muteLocal(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unmuteLocal",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.unmuteLocal(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(e){var t=this;return lD(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(fD(CP(t._p2pConnection.restartICE(e))),"t0",1);case 1:return n.abrupt("return",n.t0);case 2:case"end":return n.stop()}}),n)})))()}},{key:"close",value:function(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}},{key:"getStats",value:function(){return this._p2pConnection.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this._p2pConnection.getRemoteVideoIsReady(e)}},{key:"updateRemoteConnect",value:function(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}},{key:"updateEncoderConfig",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.updateEncoderConfig(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.updateSendParameters(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._p2pConnection.replaceTrack(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteSSRC",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._p2pConnection.getRemoteSSRC(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if($w("SDP_LOGGING"))return lS.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"bindPCEvents",value:function(){var e=this;this._p2pConnection.onICEConnectionStateChange=function(t){var n;return null===(n=e.onICEConnectionStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onConnectionStateChange=function(t){var n;return null===(n=e.onConnectionStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onDTLSTransportStateChange=function(t){var n;return null===(n=e.onDTLSTransportStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onDTLSTransportError=function(t){var n;return null===(n=e.onDTLSTransportError)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onICETransportStateChange=function(t){var n;return null===(n=e.onICETransportStateChange)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstAudioReceived=function(t){var n;return null===(n=e.onFirstAudioReceived)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstVideoReceived=function(t){var n;return null===(n=e.onFirstVideoReceived)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstAudioDecoded=function(t){var n;return null===(n=e.onFirstAudioDecoded)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onFirstVideoDecoded=function(t,n,r){var i;return null===(i=e.onFirstVideoDecoded)||void 0===i?void 0:i.call(e,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=function(t){var n;return null===(n=e.onFirstVideoDecodedTimeout)||void 0===n?void 0:n.call(e,t)},this._p2pConnection.onSelectedLocalCandidateChanged=function(t,n){var r;return null===(r=e.onSelectedLocalCandidateChanged)||void 0===r?void 0:r.call(e,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=function(t,n){var r;return null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r?void 0:r.call(e,t,n)}}},{key:"closeSignal",value:function(){this.dataChannel.close(),this.peerConnection.close()}},{key:"unbindConnectionEvents",value:function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}},{key:"setConfiguration",value:function(e){this._p2pConnection.setConfiguration(e)}}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(P_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),$w("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),$w("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(NN(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!$w("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}}]),n}(Yk);function OP(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From DataChannelConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function NP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([OP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],AP.prototype,"connect",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[Object,Array]),$S("design:returntype",by)],AP.prototype,"createDataChannels",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String,Array,String,Object]),$S("design:returntype",by)],AP.prototype,"receive",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],AP.prototype,"stopReceiving",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],AP.prototype,"muteRemote",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],AP.prototype,"unmuteRemote",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],AP.prototype,"muteLocal",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],AP.prototype,"unmuteLocal",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],AP.prototype,"close",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],AP.prototype,"updateEncoderConfig",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],AP.prototype,"updateSendParameters",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[yI,String]),$S("design:returntype",by)],AP.prototype,"replaceTrack",null),QS([OP,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],AP.prototype,"getRemoteSSRC",null);var DP=function(e){p(n,e);var t=h(n);function n(){var e;return l(this,n),e=t.call(this),kf(f(e),"uplinkStatsUploadInterval",void 0),kf(f(e),"uplinkRelatedStatsUploadInterval",void 0),kf(f(e),"uplinkDenoiserStatsUploadInterval",void 0),kf(f(e),"transportStatsUploadInterval",void 0),kf(f(e),"uplinkExtensionStatsUploadInterval",void 0),kf(f(e),"downlinkExtensionStatsUploadInterval",void 0),kf(f(e),"extensionUsageStatsUploadInterval",void 0),kf(f(e),"downlinkStatsUploadInterval",void 0),kf(f(e),"downlinkRelatedStatsUploadInterval",void 0),kf(f(e),"lastStats",void 0),kf(f(e),"uploadUnplinkStarted",!1),kf(f(e),"uploadDownlinkStarted",!1),kf(f(e),"uploadTransportStarted",!1),kf(f(e),"uploadExtensionUsageStarted",!1),kf(f(e),"requestStats",void 0),kf(f(e),"requestTransportStats",void 0),kf(f(e),"requestLocalMedia",void 0),kf(f(e),"requestRemoteMedia",void 0),kf(f(e),"requestAllTracks",void 0),kf(f(e),"requestVideoIsReady",void 0),kf(f(e),"requestUpload",void 0),e}return d(n,[{key:"startUploadTransportStats",value:function(e){var t=this;this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((function(){var n,r=null===(n=t.requestStats)||void 0===n?void 0:n.call(t);if(r){var i=LN(r);if(e){var a,o=null===(a=t.requestStats)||void 0===a?void 0:a.call(t,!0);if(o){var s=LN(o);i.connectionType+=s.connectionType<<3}i.connectionType+=110}else i.connectionType+=100;H_((function(){var e;null===(e=t.requestUpload)||void 0===e||e.call(t,US.TRANSPORT_STATS,i)}))}}),1e3))}},{key:"startUploadExtensionUsageStats",value:function(){var e=this;if(!this.uploadExtensionUsageStarted){this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);var t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(c(s().mark((function n(){var r,i,a,c,l,d,f,p,h,v,m,g,y,_,E,b,w,S;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:c=Date.now(),l={connectionInterval:$w("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:c},d=[],f=(null===(r=e.requestAllTracks)||void 0===r?void 0:r.call(e))||[],p=o(f),n.prev=4,p.s();case 6:if((h=p.n()).done){n.next=17;break}if(v=h.value,n.t0=!v.muted&&v.enabled,!n.t0){n.next=15;break}return n.t1=d,n.next=13,v.getProcessorUsage();case 13:n.t2=n.sent,d=n.t1.concat.call(n.t1,n.t2);case 15:n.next=6;break;case 17:n.next=22;break;case 19:n.prev=19,n.t3=n.catch(4),p.e(n.t3);case 22:return n.prev=22,p.f(),n.finish(22);case 25:m=(null===(i=e.requestRemoteMedia)||void 0===i?void 0:i.call(e))||[],g=o(m),n.prev=27,g.s();case 29:if((y=g.n()).done){n.next=47;break}if(_=u(y.value,2),E=_[0],b=_[1],n.t4=b.has(Ck.VIDEO)&&E.videoTrack,!n.t4){n.next=38;break}return n.t5=d,n.next=36,E.videoTrack.getProcessorUsage();case 36:n.t6=n.sent,d=n.t5.concat.call(n.t5,n.t6);case 38:if(n.t7=b.has(Ck.AUDIO)&&E.audioTrack,!n.t7){n.next=45;break}return n.t8=d,n.next=43,E.audioTrack.getProcessorUsage();case 43:n.t9=n.sent,d=n.t8.concat.call(n.t8,n.t9);case 45:n.next=29;break;case 47:n.next=52;break;case 49:n.prev=49,n.t10=n.catch(27),g.e(n.t10);case 52:return n.prev=52,g.f(),n.finish(52);case 55:if(0!==d.length){n.next=57;break}return n.abrupt("return");case 57:l.details=function(e,t){var n,r={},i=o(e);try{for(i.s();!(n=i.n()).done;){var a,s,c,u=n.value,l=u.id,d=u.value,f=u.level,p=u.direction,h=null!==(a=t.get(l))&&void 0!==a?a:0,v=2===d?h+$w("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:h;t.set(l,v),r[l]?(2===d&&(r[l].value=d),f>r[l].level&&(r[l].level=f),"remote"===p&&(r[l].remoteUidCount+=1),r[l].totalTs=null!==(s=t.get(l))&&void 0!==s?s:0):r[l]={value:d,level:f,remoteUidCount:"local"===p?0:1,totalTs:null!==(c=t.get(l))&&void 0!==c?c:0}}}catch(m){i.e(m)}finally{i.f()}return Object.keys(r).map((function(e){var t=r[e];return{id:e,level:t.level,value:t.value,totalTs:t.totalTs}}))}(d,t),w=Date.now(),S=w>c?w:c+1,null===(a=e.requestUpload)||void 0===a||a.call(e,US.EXTENSION_USAGE_STATS,{usageStats:l,sendTs:S});case 60:case"end":return n.stop()}}),n,null,[[4,19,22,25],[27,49,52,55]])}))),$w("EXTENSION_USAGE_UPLOAD_INTERVAL"))}}},{key:"startUploadUplinkStats",value:function(){var e=this;this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&(e.uploadUplinkStats(n),e.lastStats=n)}),3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e);n&&e.uploadRelatedUplinkStats(n,e.lastStats),e.lastStats=n}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestAllTracks)||void 0===t?void 0:t.call(e);n&&e.uploadDenoiserStats(n)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestAllTracks)||void 0===t?void 0:t.call(e);n&&e.uploadExtensionStats(n)}),2e3))}},{key:"uploadUplinkStats",value:function(e){var t,n=this;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).forEach((function(t){var r=u(t,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs;switch(i){case Ok.LocalVideoLowTrack:case Ok.LocalVideoTrack:var c=function(e,t,n){var r,i=t.videoSend.find((function(t){return t.ssrc===e}));if(!i)return null;var a={id:rE(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:i.ssrc.toString()};switch(a.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.sentFrame&&(a.A_fhs=i.sentFrame.height.toString(),a.A_frs=i.sentFrame.frameRate.toString(),a.A_fws=i.sentFrame.width.toString()),i.adaptionChangeReason){case"none":a.A_ac="0";break;case"cpu":a.A_ac="1";break;case"bandwidth":a.A_ac="2";break;case"other":a.A_ac="3"}return a.A_lvps=mI[n._player?n._player.videoElementStatus:"uninit"].toString(),a.A_nr=null===(r=i.nacksCount)||void 0===r?void 0:r.toString(),i.avgEncodeMs&&(a.A_aem=i.avgEncodeMs.toFixed(0).toString()),$w("P2P")&&(i.bytes&&(a.bytesSent=i.bytes.toString()),"number"==typeof i.packetsLost&&(a.packetsLost=i.packetsLost.toString()),i.packets&&(a.packetsSent=i.packets.toString())),a}(s[0].ssrcId,e,o),l=i===Ok.LocalVideoTrack?function(e,t,n){var r,i,a,o,s,c,u,l,d=t.videoSend.find((function(t){return t.ssrc===e}));if(!d)return null;var f={id:rE(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()},p=null!==(r=null!==(i=null===(a=d.inputFrame)||void 0===a?void 0:a.height)&&void 0!==i?i:null==n?void 0:n._videoHeight)&&void 0!==r?r:0,h=null!==(o=null!==(s=null===(c=d.inputFrame)||void 0===c?void 0:c.width)&&void 0!==s?s:null==n?void 0:n._videoWidth)&&void 0!==o?o:0,v=null!==(u=null===(l=d.inputFrame)||void 0===l?void 0:l.frameRate)&&void 0!==u?u:0;return p&&(f.A_fhi=p+""),h&&(f.A_fwi=h+""),v&&(f.A_fri=v+""),f}(s[0].ssrcId,e,o):null;c&&H_((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,US.PUBLISH_STATS,{stream_type:i===Ok.LocalVideoLowTrack?"low":"high",stats:xP(xP({},c),l)})}));var d=function(e){var t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);d&&setTimeout((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,US.PUBLISH_STATS,{stream_type:i===Ok.LocalVideoLowTrack?"low":"high",stats:d})}),1e3);break;case Ok.LocalAudioTrack:var f=function(e,t,n){var r=t.audioSend.find((function(t){return t.ssrc===e}));if(!r)return null;var i={id:rE(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};return i.A_astd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",r.inputLevel?i.A_ail=Math.round(100*r.inputLevel).toString():i.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.aecReturnLoss&&(i.A_ecrl=Math.round(r.aecReturnLoss).toString()),r.aecReturnLossEnhancement&&(i.A_ecrle=Math.round(r.aecReturnLossEnhancement).toString()),$w("P2P")&&(r.bytes&&(i.bytesSent=r.bytes.toString()),"number"==typeof r.packetsLost&&(i.packetsLost=r.packetsLost.toString()),r.packets&&(i.packetsSent=r.packets.toString())),i}(s[0].ssrcId,e,o);f&&H_((function(){var e;return null===(e=n.requestUpload)||void 0===e?void 0:e.call(n,US.PUBLISH_STATS,{stream_type:"high",stats:f})}))}}))}},{key:"uploadRelatedUplinkStats",value:function(e,t){var n,r=this;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((function(e){var t=u(e,1)[0];return t===Ok.LocalVideoLowTrack||t===Ok.LocalVideoTrack})).forEach((function(t){var n=u(t,2),i=n[0],a=function(e,t){var n=t.videoSend.find((function(t){return t.ssrc===e}));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(n[1].ssrcs[0].ssrcId,e);a&&H_((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,US.PUBLISH_RELATED_STATS,{stream_type:i===Ok.LocalVideoLowTrack?"low":"high",stats:a})}))}))}},{key:"uploadDenoiserStats",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n instanceof EC){var r,i,a,o=null===(r=(i=n._external).getDenoiserStats)||void 0===r?void 0:r.call(i);return void(o&&(null===(a=this.requestUpload)||void 0===a||a.call(this,US.DENOISER_STATS,o)))}}}},{key:"uploadExtensionStats",value:function(e){for(var t=this,n=0;n<e.length;n++)e[n].getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)}))}},{key:"stopUploadUplinkStats",value:function(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}},{key:"startUploadDownlinkStats",value:function(){var e=this;if(!this.uploadDownlinkStarted){var t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);var n=!1;this.downlinkStatsUploadInterval=window.setInterval((function(){var r,i=null===(r=e.requestStats)||void 0===r?void 0:r.call(e,!0);i&&(e.uploadDownlinkStats(i,n,t),t=i),n=!n}),3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestStats)||void 0===t?void 0:t.call(e,!0);n&&(e.uploadRelatedDownlinkStats(n,e.lastStats),e.lastStats=n)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((function(){var t,n=null===(t=e.requestRemoteMedia)||void 0===t?void 0:t.call(e);n&&e.uploadDownlinkExtensionStats(n)}),2e3)}}},{key:"uploadDownlinkStats",value:function(e,t,n){var r,i=this;((null===(r=this.requestRemoteMedia)||void 0===r?void 0:r.call(this))||[]).forEach((function(r){var a=u(r,2),o=a[0],s=a[1];if(s.has(Ck.VIDEO)&&o.videoTrack){var c=o.videoTrack?function(e,t,n,r,i){var a=t.videoRecv.find((function(t){return t.ssrc===e}));if(!a)return null;var o,s,c={id:rE(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:a.ssrc.toString()};if(c.bytesReceived=a.bytes.toString(),c.packetsLost=a.packetsLost.toString(),c.packetsReceived=a.packets.toString(),a.framesRateFirefox&&(c.A_frr=a.framesRateFirefox.toString()),a.receivedFrame?(c.A_frr=a.receivedFrame.frameRate.toString(),c.A_fhr=a.receivedFrame.height.toString(),c.A_fwr=a.receivedFrame.width.toString()):(c.A_fhr=null===(o=r._videoHeight)||void 0===o?void 0:o.toString(),c.A_fwr=null===(s=r._videoWidth)||void 0===s?void 0:s.toString()),c.A_frd=a.decodeFrameRate.toString(),a.outputFrame&&(c.A_fro=a.outputFrame.frameRate.toString()),void 0!==a.jitterBufferMs&&(c.A_jbm=Math.floor(a.jitterBufferMs).toString()),void 0!==a.currentDelayMs&&(c.A_cdm=Math.floor(a.currentDelayMs).toString()),c.A_fs=a.firsCount.toString(),c.A_ns=a.nacksCount.toString(),c.A_ps=a.plisCount.toString(),r&&(c.A_vrtd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),r._player&&r._player.freezeTimeCounterList.length>0&&(c.A_vrft=Math.round(r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),i&&r._player&&"visible"===NC.visibility){var u=Math.min(6e3,r._player.renderFreezeAccTime);c.A_vrrft=Math.round(u).toString(),r._player.renderFreezeAccTime=Math.max(0,r._player.renderFreezeAccTime-u)}if(c.A_rvps=mI[r._player?r._player.videoElementStatus:"uninit"].toString(),n){var l=n.videoRecv.find((function(t){return t.ssrc===e}));if(l&&void 0!==a.totalInterFrameDelay&&void 0!==a.totalSquaredInterFrameDelay&&void 0!==l.totalInterFrameDelay&&void 0!==l.totalSquaredInterFrameDelay){var d=a.totalInterFrameDelay-l.totalInterFrameDelay,f=a.totalSquaredInterFrameDelay-l.totalSquaredInterFrameDelay,p=a.framesDecodeCount-l.framesDecodeCount,h=d/p*1e3,v=Math.round(1e3*Math.sqrt((f-Math.pow(d,2)/p)/p));!isNaN(v)&&h+v>Math.max(3*h,h+150)&&(c.A_ifdsd=v.toString())}}return c}(o._videoSSRC,e,n,o.videoTrack,t):void 0;c&&H_((function(){var e;return null===(e=i.requestUpload)||void 0===e?void 0:e.call(i,US.SUBSCRIBE_STATS,{stream_id:o.uid,stats:c})}))}if(s.has(Ck.AUDIO)&&o.audioTrack){var l=o.audioTrack?function(e,t,n,r){var i=t.audioRecv.find((function(t){return t.ssrc===e}));if(!i)return null;var a={id:rE(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};if(a.bytesReceived=i.bytes.toString(),a.packetsLost=i.packetsLost.toString(),a.packetsReceived=i.packets.toString(),i.outputLevel?a.A_aol=Math.round(100*i.outputLevel).toString():a.A_aol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),a.A_apol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),r&&(a.A_artd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),a.A_jr=i.jitterMs.toString(),a.A_jbm=Math.floor(i.jitterBufferMs).toString(),a.A_cdm=Math.floor(i.jitterBufferMs).toString(),a.A_raps=mI[iC.getPlayerState(r.getTrackId())].toString(),n){var o=n.audioRecv.find((function(t){return t.ssrc===e}));if(o){var s=i.concealedSamples-o.concealedSamples;s>0&&(a.A_cs=Math.round(s).toString())}}return a}(o._audioSSRC,e,n,o.audioTrack):void 0;l&&H_((function(){var e;return null===(e=i.requestUpload)||void 0===e?void 0:e.call(i,US.SUBSCRIBE_STATS,{stream_id:o.uid,stats:l})}))}}))}},{key:"uploadRelatedDownlinkStats",value:function(e,t){var n,r=this;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((function(n){var i=u(n,2),a=i[0],o=i[1];if(o.has(Ck.VIDEO)&&a.videoTrack){var s,c=!0===(a._videoSSRC&&(null===(s=r.requestVideoIsReady)||void 0===s?void 0:s.call(r,a._videoSSRC))||!1),l=function(e,t,n,r,i,a){var o=n.videoRecv.find((function(t){return t.ssrc===e})),s=i?i.videoRecv.find((function(t){return t.ssrc===e})):void 0;if(!o)return null;var c=RN.isRemoteVideoFreeze(a,o,s)&&t,u={mediaType:"video",isVideoMute:!1,peerId:r,frameRateReceived:o.receivedFrame&&o.receivedFrame.frameRate.toString(),frameRateDecoded:o.decodedFrame&&o.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:o.bytes.toString(),packetsReceived:o.packets.toString(),packetsLost:o.packetsLost.toString(),qpSumPerFrame:Math.floor(o.qpSumPerFrame).toString()};return o.framesRateFirefox&&(u.frameRateDecoded=o.framesRateFirefox.toString(),u.frameRateReceived=o.framesRateFirefox.toString()),u}(a._videoSSRC,c,e,a.uid,t,a.videoTrack);l&&H_((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,US.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:l})}))}if(o.has(Ck.AUDIO)&&a.audioTrack){var d=function(e,t,n,r){var i=t.audioRecv.find((function(t){return t.ssrc===e}));if(!i)return null;var a=RN.isRemoteAudioFreeze(r);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:i.jitterMs.toString(),isFreeze:a,bytesReceived:i.bytes.toString(),packetsReceived:i.packets.toString(),packetsLost:i.packetsLost.toString(),frameReceived:i.receivedFrames.toString(),frameDropped:i.droppedFrames.toString()}}(a._audioSSRC,e,a.uid,a.audioTrack);d&&H_((function(){var e;null===(e=r.requestUpload)||void 0===e||e.call(r,US.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:d})}))}}))}},{key:"stopUploadDownlinkStats",value:function(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}},{key:"stopUploadTransportStats",value:function(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}},{key:"stopUploadExtensionUsageStats",value:function(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}},{key:"uploadDownlinkExtensionStats",value:function(e){var t=this;e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1];i.has(Ck.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)})),i.has(Ck.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach((function(e){var n;null===(n=t.requestUpload)||void 0===n||n.call(t,e.type,e.stats)}))}))}}]),n}(O_);function PP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function LP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PP(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function MP(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=pD,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new UP(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function UP(e){function t(e){if(Object(e)!==e)return by.reject(new TypeError(e+" is not an object."));var t=e.done;return by.resolve(e.value).then((function(e){return{value:e,done:t}}))}return UP=function(e){this.s=e,this.n=e.next},UP.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?by.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?by.reject(e):t(n.apply(this.s,arguments))}},new UP(e)}var jP=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"store",void 0),kf(f(i),"statsUploader",void 0),kf(f(i),"connection",void 0),kf(f(i),"localTrackMap",new Map),kf(f(i),"remoteUserMap",new Map),kf(f(i),"localDataChannels",[]),kf(f(i),"remoteDataChannelMap",new Map),kf(f(i),"pendingLocalTracks",[]),kf(f(i),"pendingRemoteTracks",[]),kf(f(i),"pendingLocalDataChannels",[]),kf(f(i),"pendingRemoteDataChannels",[]),kf(f(i),"statsCollector",void 0),kf(f(i),"isPlanB",!1),kf(f(i),"shouldForwardP2PCreation",void 0),kf(f(i),"iceFailedCount",0),kf(f(i),"dtlsFailedCount",0),kf(f(i),"mutex",new fE("P2PChannel-mutex")),kf(f(i),"_state",Nk.Disconnected),kf(f(i),"_pcStatsUploadType",$w("NEW_ICE_RESTART")?Ak.FIRST_CONNECTION:Ak.OLD_FIRST_CONNECTION),kf(f(i),"_isInRestartIce",!1),kf(f(i),"_isStartRestartIce",!1),kf(f(i),"_restartStates",["disconnected","failed"]),kf(f(i),"_restartTimer",void 0),kf(f(i),"_isFirstConnected",!0),kf(f(i),"handleMuteLocalTrack",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");case 2:if(a=e.sent,e.prev=3,i.connection&&i.state===Nk.Connected){e.next=6;break}return e.abrupt("return",void r(new o_(Oy.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established.")));case 6:if(0!==(o=i.filterTobeMutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return c=o.find((function(e){return"videoLowTrack"===e[0]})),c&&c[1].track._originMediaStreamTrack.stop(),e.next=13,i.connection.muteLocal(o.map((function(e){return u(e,2)[1].id})));case 13:return l=i.createMuteMessage(o),e.next=16,j_(f(i),xk.RequestMuteLocal,l);case 16:n(),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),r(e.t0);case 22:return e.prev=22,a(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,19,22,25]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleUnmuteLocalTrack",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,l,d,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");case 2:if(a=e.sent,e.prev=3,i.connection&&i.state===Nk.Connected){e.next=6;break}return e.abrupt("return",void r(new o_(Oy.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established.")));case 6:if(0!==(o=i.filterTobeUnmutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:if(c=o.find((function(e){return"videoLowTrack"===e[0]})),!c){e.next=15;break}return(l=c[1]).track._originMediaStreamTrack.stop(),!$w("DISABLE_DUAL_STREAM_USE_ENCODING")&&OI().supportDualStreamEncoding?(d=t._mediaStreamTrack.clone(),l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d):(p=vP(t,V_(f(i),xk.RequestLowStreamParameter)),l.track._mediaStreamTrack=p,l.track._originMediaStreamTrack=p),e.next=15,new by((function(e,t){i.handleReplaceTrack(l.track,e,t,!0)}));case 15:return e.next=17,i.connection.unmuteLocal(o.map((function(e){return u(e,2)[1].id})));case 17:return h=i.createUnmuteMessage(o),e.next=20,j_(f(i),xk.RequestUnmuteLocal,h);case 20:n(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),r(e.t0);case 26:return e.prev=26,a(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[3,23,26,29]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleUpdateVideoEncoder",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(Ok.LocalVideoTrack),i.connection&&o&&o.track===t&&i.state===Nk.Connected){e.next=7;break}return e.abrupt("return",void n());case 7:return c=o.id,u=o.track,e.next=10,i.connection.updateSendParameters(c,u);case 10:return e.next=12,i.connection.updateEncoderConfig(c,u);case 12:i.emit(xk.UpdateVideoEncoder,u),n(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),r(e.t0);case 19:return e.prev=19,a(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[3,16,19,22]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleSetOptimizationMode",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(Ok.LocalVideoTrack),i.connection&&o&&o.track===t&&i.state===Nk.Connected){e.next=7;break}return e.abrupt("return");case 7:return c=o.id,u=o.track,e.next=10,i.connection.updateSendParameters(c,u);case 10:n(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),r(e.t0);case 16:return e.prev=16,a(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleReplaceTrack",function(){var e=c(s().mark((function e(t,n,r,a){var o,c,l,d,f,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("[".concat(i.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),e.t0="boolean"==typeof a&&a,e.t0){e.next=6;break}return e.next=5,i.mutex.lock("From P2PChannel.handleReplaceTrack");case 5:o=e.sent;case 6:if(e.prev=6,l=Array.from(i.localTrackMap.entries()).find((function(e){var n=u(e,2)[1].track;return t===n})),i.connection&&l&&i.state===Nk.Connected){e.next=10;break}return e.abrupt("return",void n());case 10:return e.next=12,null===(c=i.connection)||void 0===c?void 0:c.replaceTrack(t,l[1].id);case 12:if(!i.isPlanB){e.next=15;break}(d=l[1]).id=t._mediaStreamTrack.id,i.localTrackMap.set(l[0],d);case 15:if(l[0]!==Ok.LocalVideoTrack||$w("DISABLE_DUAL_STREAM_USE_ENCODING")||!OI().supportDualStreamEncoding){e.next=24;break}if(!(f=i.localTrackMap.get(Ok.LocalVideoLowTrack))){e.next=24;break}return p=t._mediaStreamTrack.clone(),f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p,e.next=24,new by((function(e,t){i.handleReplaceTrack(f.track,e,t,!0)}));case 24:n(),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(6),r(e.t1);case 30:return e.prev=30,null===(h=o)||void 0===h||h(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[6,27,30,33]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),kf(f(i),"handleGetLocalVideoStats",(function(e){e(i.statsCollector.getLocalVideoTrackStats())})),kf(f(i),"handleGetLocalAudioStats",(function(e){e(i.statsCollector.getLocalAudioTrackStats())})),kf(f(i),"handleGetRemoteVideoStats",(function(e){return i.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]})),kf(f(i),"handleGetRemoteAudioStats",(function(e){return i.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]})),i.store=e,i.statsCollector=r,i.statsCollector.addP2PChannel(f(i)),i.statsUploader=new DP,i.bindStatsUploaderEvents(),i.isPlanB=!OI().supportUnifiedPlan||$w("CHROME_FORCE_PLAN_B")&&t_(),i.shouldForwardP2PCreation=$w("FORWARD_P2P_CREATION")&&OI().supportPCSetConfiguration&&function(){var e=Ly();return e===ky.ANDROID||e===ky.IOS||e===ky.HARMONY_OS}(),i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new AP({},i.store):i.isPlanB?new aP({},i.store):new pP({},i.store),i.bindConnectionEvents(i.connection)),i}return d(n,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(xk.StateChange,t,this._state)}},{key:"startP2PConnection",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=Nk.New,i=this.shouldForwardP2PCreation&&"closed"===(null===(r=this.connection)||void 0===r?void 0:r.peerConnectionState),this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(lS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new AP(t,this.store):this.isPlanB?new aP(t,this.store):new pP(t,this.store),this.bindConnectionEvents(this.connection)),this.connection){e.next=4;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");case 4:return e.abrupt("return",(this._pcStatsUploadType=$w("NEW_ICE_RESTART")?Ak.FIRST_CONNECTION:Ak.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise));case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");case 2:if(!(this.connection instanceof AP)){e.next=6;break}this.connection.updateRemoteConnect(i),e.next=12;break;case 6:return this.store.peerConnectionStart(),e.next=9,this.connection.connect(t,n,r,i,a,o);case 9:this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Nk.Connected;case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"preConnect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){var c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");case 2:return this.store.peerConnectionStart(),e.next=5,this.connection.connect(t,n,r,i,a,o);case 5:return c=e.sent,e.abrupt("return",(this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Nk.Connected,c));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"getEstablishParams",value:function(){if(this.connection instanceof AP)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}},{key:"publishDataChannel",value:function(){var e=c(s().mark((function e(t){var n,r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=5;break}if(this.state!==Nk.Disconnected){e.next=3;break}throw new o_(Oy.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 3:return n=t.filter((function(e){return-1!==i.pendingLocalDataChannels.findIndex((function(t){return t.id===e.id}))})),e.abrupt("return",void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(n)));case 5:if(r=this.filterTobePublishedDataChannels(t),e.t0=0!==r.length,!e.t0){e.next=12;break}return r.forEach((function(e){var t=Date.now();i.store.publish(e.id.toString(),"datachannel",t)})),e.next=11,this.connection.createDataChannels(this.store.uid,r);case 11:r.forEach((function(e){i.localDataChannels.push(e);var t=Date.now();i.store.publish(e.id+"","datachannel",void 0,t)}));case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(e,t,n){var r=this;return lD(s().mark((function i(){var a,o,c;return s().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,dD(r.mutex.lock("From P2PChannel.publish"));case 2:if(a=i.sent,i.prev=3,r.connection&&r.state===Nk.Connected){i.next=10;break}if(r.state!==Nk.Disconnected){i.next=7;break}throw new o_(Oy.UNEXPECTED_ERROR,"PeerConnection already disconnected.");case 7:return r.throwIfTrackTypeNotMatch(e),o=e.filter((function(e){return-1===r.pendingLocalTracks.indexOf(e)})),i.abrupt("return",void(r.pendingLocalTracks=r.pendingLocalTracks.concat(o)));case 10:if(r.store.pubId=r.store.pubId+1,TN.markPublishStart(r.store.clientId,r.store.pubId),0!==(c=r.filterTobePublishedTracks(e,t,n)).length){i.next=16;break}return i.next=15,dD(r.tryToUnmuteAudio(e));case 15:return i.abrupt("return",void i.sent);case 16:return i.delegateYield(fD(MP(r.doPublish(r.connection,c))),"t0",17);case 17:return i.prev=17,a(),i.finish(17);case 20:case"end":return i.stop()}}),i,null,[[3,,17,20]])})))()}},{key:"doPublish",value:function(e,t){var n=this;return lD(s().mark((function r(){var i,a,o,c,u,l;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===Ok.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t),r.next=3,dD(e.send(t.map((function(e){return e.track})),n.store.codec,n.store.audioCodec));case 3:return i=r.sent,r.next=6,dD(i.next());case 6:return a=r.sent.value,o=n.createGatewayPublishMessage(t,a),r.prev=8,r.next=11,o;case 11:c=r.sent,r.next=17;break;case 14:throw r.prev=14,r.t0=r.catch(8),i.throw(r.t0),(null==r.t0?void 0:r.t0.code)===Oy.WS_ABORT&&t.forEach((function(e){var t=e.track;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),r.t0;case 17:return u=n.mapPubResToRemoteConfig(o,c),r.next=20,dD(i.next(u));case 20:l=r.sent.value,t.forEach((function(e){var t=e.type;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,l),n.statsUploader.startUploadUplinkStats(),t.forEach((function(e){var t=e.track,r=e.type,i=Date.now();n.store.publish(t.getTrackId(),r===Ok.LocalAudioTrack?"audio":"video",void 0,i)}));case 22:case"end":return r.stop()}}),r,null,[[8,14]])})))()}},{key:"updateVideoStreamParameter",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.localTrackMap.get(n)){e.next=3;break}return e.abrupt("return");case 3:if(r.track instanceof GC){e.next=5;break}return e.abrupt("return",lS.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack"));case 5:if(this.connection instanceof pP||this.connection instanceof aP){e.next=7;break}return e.abrupt("return",lS.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB"));case 7:if(i=r.track,a=function(e,t){var n={};return e.height&&e.width&&(n.scaleResolutionDownBy=VN(e,t)),n.maxFramerate=e.framerate?DN(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(t,i),i._encoderConfig||(i._encoderConfig={}),n===Ok.LocalVideoLowTrack&&($w("DISABLE_DUAL_STREAM_USE_ENCODING")||!OI().supportDualStreamEncoding)){e.next=12;break}null!=a.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy),e.next=16;break;case 12:if((o=i._originMediaStreamTrack).canvas){e.next=15;break}return e.abrupt("return",lS.warn("[".concat(i.getTrackId(),"] no canvas on track")));case 15:!function(e,t){var n=e.canvas;t.width&&(n.width=DN(t.width)),t.height&&(n.height=DN(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=RI((function(){!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),DN(t.framerate)))}(o,t);case 16:return null!=a.maxBitrate&&(i._encoderConfig.bitrateMax=a.maxBitrate/1e3),null!=a.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=a.maxFramerate:i._encoderConfig.frameRate={max:a.maxFramerate}),lS.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),e.next=21,this.connection.updateRtpSenderEncodings(i);case 21:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"publishLowStream",value:function(e){var t=this;return lD(s().mark((function n(){var r,i,a,o,c;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.connection&&t.state===Nk.Connected){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,dD(t.mutex.lock("Locking from P2PChannel.publishLowStream"));case 4:if(r=n.sent,n.prev=5,i=t.localTrackMap.get(Ok.LocalVideoTrack)){n.next=9;break}throw new o_(Oy.UNEXPECTED_ERROR,"Could not find high stream");case 9:if(!t.localTrackMap.has(Ok.LocalVideoLowTrack)){n.next=11;break}throw new o_(Oy.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));case 11:return a=[{track:t.getLowVideoTrack(i.track,e),type:Ok.LocalVideoLowTrack}],n.delegateYield(fD(MP(t.doPublish(t.connection,a))),"t0",13);case 13:if(!i.track.muted&&i.track.enabled){n.next=19;break}if(c=null===(o=t.localTrackMap.get(Ok.LocalVideoLowTrack))||void 0===o?void 0:o.id,n.t1=void 0!==c,!n.t1){n.next=19;break}return n.next=19,dD(t.connection.muteLocal([c]));case 19:return n.prev=19,r(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[5,,19,22]])})))()}},{key:"republish",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.pendingLocalTracks.length>0,!e.t0){e.next=7;break}return lS.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),e.next=5,U_(this,xk.RequestRePublish,this.pendingLocalTracks);case 5:this.emit(xk.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[];case 7:if(e.t1=this.pendingLocalDataChannels.length>0,!e.t1){e.next=13;break}return lS.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),e.next=12,U_(this,xk.RequestRePublishDataChannel,this.pendingLocalDataChannels);case 12:this.pendingLocalDataChannels=[];case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reSubscribe",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,c,u,l,d,f,p=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.pendingRemoteTracks.length-1;n>=0;n--)r=this.pendingRemoteTracks[n],i=r.user,((a=r.kind)!==Ck.AUDIO||i._audio_added_&&i._audioSSRC)&&(a!==Ck.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1);if(!t){e.next=6;break}return e.next=4,U_(this,xk.RequestReSubscribe,this.pendingRemoteTracks);case 4:e.next=23;break;case 6:c=o(this.pendingRemoteTracks),e.prev=7,c.s();case 9:if((u=c.n()).done){e.next=15;break}return l=u.value,d=l.user,f=l.kind,e.next=13,this.subscribe(d,f,f===Ck.VIDEO?d._videoSSRC:d._audioSSRC);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),c.e(e.t0);case 20:return e.prev=20,c.f(),e.finish(20);case 23:this.pendingRemoteTracks.forEach((function(e){var t=e.user;p.emit(xk.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[];case 24:case"end":return e.stop()}}),e,this,[[7,17,20,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=c(s().mark((function e(t){var n,r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return",void t.forEach((function(e){var t=i.pendingLocalTracks.indexOf(e);-1!==t&&i.pendingLocalTracks.splice(t,1)})));case 2:if(0!==(n=this.filterTobeUnpublishedTracks(t)).length){e.next=5;break}return e.abrupt("return");case 5:return r=n.find((function(e){return"videoLowTrack"===e[0]})),r&&r[1].track.close(),e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublishDataChannel",value:function(){var e=c(s().mark((function e(t){var n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return",void t.forEach((function(e){var t=r.pendingLocalDataChannels.indexOf(e);-1!==t&&r.pendingLocalDataChannels.splice(t,1)})));case 2:if(0===(n=this.filterTobeUnpublishedDataChannels(t)).length){e.next=12;break}if(n.forEach((function(e){var t=r.localDataChannels.indexOf(e);-1!==t&&r.localDataChannels.splice(t,1)})),e.t1=0===this.localDataChannels.length,!e.t1){e.next=9;break}return e.next=9,this.connection.stopDataChannels(this.store.uid);case 9:e.t0=n.map((function(e){return e.id})),e.next=13;break;case 12:e.t0=void 0;case 13:return e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublishLowStream",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return");case 2:if(t=this.localTrackMap.get(Ok.LocalVideoLowTrack)){e.next=5;break}return e.abrupt("return");case 5:return t.track.close(),n=[[Ok.LocalVideoLowTrack,t]],e.abrupt("return",this.doUnpublish(this.connection,n));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"doUnpublish",value:function(){var e=c(s().mark((function e(t,n){var r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createGatewayUnpublishMessage(n),e.next=3,t.stopSending(n.map((function(e){return u(e,2)[1].id})));case 3:return this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map((function(e){var t=u(e,2);return{type:t[0],track:t[1].track}}))),n.forEach((function(e){var t=u(e,1)[0];i.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"subscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){var r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}throw new o_(Oy.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");case 2:if(0===(r=n.filter((function(e){var n;return!(null!==(n=i.remoteDataChannelMap.get(t))&&void 0!==n&&n.get(e.id))}))).length){e.next=8;break}return e.next=6,this.connection.createDataChannels(t.uid,r);case 6:return r.forEach((function(e){var n;i.remoteDataChannelMap.has(t)?null===(n=i.remoteDataChannelMap.get(t))||void 0===n||n.set(e.id,e):i.remoteDataChannelMap.set(t,new Map([[e.id,e]]));var r=i.pendingRemoteDataChannels.findIndex((function(n){var r=n.user,i=n.id;return r.uid===t.uid&&i===e.id}));-1!==r&&i.pendingRemoteDataChannels.splice(r,1)})),e.abrupt("return",r.map((function(e){return e.id})));case 8:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=c(s().mark((function e(t,n,r,i,a){var o,c,u,l,d,f,p,h,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}throw new o_(Oy.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");case 2:if(null===(o=this.remoteUserMap.get(t))||void 0===o||!o.has(n)){e.next=4;break}return e.abrupt("return");case 4:if(!a){e.next=14;break}if(d=a.find((function(e){return e.stream_type===n})),d){e.next=8;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));case 8:return e.next=10,this.connection.receive(n,d.ssrcs,String(t._uintid),d.attributes);case 10:f=e.sent,this.connection instanceof pP&&(l=f.transceiver),c=f.track,u=f.id,e.next=18;break;case 14:return e.next=16,this.connection.receive(n,[{ssrcId:r,rtx:i}],String(t._uintid),void 0);case 16:p=e.sent,this.connection instanceof pP&&(l=p.transceiver),c=p.track,u=p.id;case 18:n===Ck.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new XC(c,t.uid,t._uintid,this.store),lS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new JC(c,t.uid,t._uintid,this.store),lS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack)),(h=this.remoteUserMap.get(t))?h.set(n,u):this.remoteUserMap.set(t,new Map([[n,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),v=this.pendingRemoteTracks.findIndex((function(e){var r=e.user,i=e.kind;return r.uid===t.uid&&n===i})),-1!==v&&(this.pendingRemoteTracks.splice(v,1),this.emit(xk.MediaReconnectEnd,t.uid));case 23:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,a){return e.apply(this,arguments)}return t}()},{key:"massSubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massSubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massSubscribeNoLock",value:function(){var e=c(s().mark((function e(t){var n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection&&this.state===Nk.Connected){e.next=2;break}throw new o_(Oy.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");case 2:return t=t.filter((function(e){var t,n=e.user,i=e.mediaType;return!(null!==(t=r.remoteUserMap.get(n))&&void 0!==t&&t.has(i))})),e.next=5,this.connection.batchReceive(t.map((function(e){var t=e.user;return{kind:e.mediaType,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtxSsrcId}],mslabel:String(t._uintid)}})));case 5:n=e.sent,t.forEach((function(e,t){var i=e.user,a=e.mediaType,o=n[t],s=o.track,c=o.id,u=o.transceiver;a===Ck.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(s):(i._audioTrack=new XC(s,i.uid,i._uintid,r.store),lS.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),u&&i._audioTrack._updateRtpTransceiver(u),r.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(s):(i._videoTrack=new JC(s,i.uid,i._uintid,r.store),lS.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),u&&i._videoTrack._updateRtpTransceiver(u),r.bindRemoteTrackEvents(i,i._videoTrack));var l=r.remoteUserMap.get(i);l?l.set(a,c):r.remoteUserMap.set(i,new Map([[a,c]])),r.statsCollector.addRemoteStats(i.uid),r.statsUploader.startUploadDownlinkStats();var d=r.pendingRemoteTracks.findIndex((function(e){var t=e.user,n=e.kind;return t.uid===i.uid&&a===n}));-1!==d&&(r.pendingRemoteTracks.splice(d,1),r.emit(xk.MediaReconnectEnd,i.uid))}));case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pendingRemoteTracks.filter((function(e){var r=e.user,i=e.kind;return void 0!==n?r.uid===t.uid&&n===i:r.uid===t.uid})),i.forEach((function(e){var t=c.pendingRemoteTracks.indexOf(e);c.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===Nk.Connected||r||i.forEach((function(e){var n,r=e.kind;if(r===Ck.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(r===Ck.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}})),this.connection&&this.state===Nk.Connected){e.next=3;break}return e.abrupt("return");case 3:if(0!==(a=this.filterTobeUnSubscribedTracks(t,n)).length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this.connection.stopReceiving(a.map((function(e){return u(e,2)[1].id})));case 8:return o=this.createUnsubscribeMessage(a),e.abrupt("return",(this.withdrawRemoteTracks(a),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),a.forEach((function(e){var t,n,i=u(e,2),a=i[0],o=i[1].kind;if(o===Ck.VIDEO&&a._videoSSRC&&(null===(t=c.connection)||void 0===t||t.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),o===Ck.VIDEO)c.unbindRemoteTrackEvents(a._videoTrack),r||(null===(n=a._videoTrack)||void 0===n||n._destroy(),a._videoTrack=void 0);else if(o===Ck.AUDIO){var s;c.unbindRemoteTrackEvents(a._audioTrack),r||(null===(s=a._audioTrack)||void 0===s||s._destroy(),a._audioTrack=void 0)}})),o));case 10:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"unsubscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){var r,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.forEach((function(e){var t=a.pendingRemoteDataChannels.findIndex((function(t){return t.id===e.id}));-1!==t&&a.pendingRemoteDataChannels.splice(t,1)})),this.connection){e.next=2;break}return e.abrupt("return");case 2:if(0!==(r=this.filterTobeUnSubscribedDataChannels(t,n)).length){e.next=5;break}return e.abrupt("return");case 5:if(n.forEach((function(e){e._close()})),i=this.remoteDataChannelMap.get(t),r.forEach((function(e){i&&i.delete(e.id)})),e.t0=i&&0===i.size,!e.t0){e.next=13;break}return this.remoteDataChannelMap.delete(t),e.next=13,this.connection.stopDataChannels(t.uid);case 13:return e.abrupt("return",r.map((function(e){return e.id})));case 14:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.massUnsubscribeNoLock(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribeNoLock",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,c,l,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=o(t),e.prev=2,a=s().mark((function e(){var t,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.value,r=t.user,a=t.mediaType,o=d.pendingRemoteTracks.filter((function(e){var t=e.user,n=e.kind;return void 0!==a?t.uid===r.uid&&a===n:t.uid===r.uid})),o.forEach((function(e){var t=d.pendingRemoteTracks.indexOf(e);d.pendingRemoteTracks.splice(t,1)})),n=n.concat(o);case 3:case"end":return e.stop()}}),e)})),r.s();case 5:if((i=r.n()).done){e.next=9;break}return e.delegateYield(a(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:if(this.connection&&this.state===Nk.Connected){e.next=19;break}return e.abrupt("return",void n.forEach((function(e){var t,n=e.user,r=e.kind;if(r===Ck.AUDIO)null===(t=n._audioTrack)||void 0===t||t._destroy(),n._audioTrack=void 0;else if(r===Ck.VIDEO){var i;null===(i=n._videoTrack)||void 0===i||i._destroy(),n._videoTrack=void 0}})));case 19:if(c=AE(t).call(t,(function(e,t){var n=t.user,r=t.mediaType,i=d.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]),0!==c.length){e.next=22;break}return e.abrupt("return");case 22:return e.next=24,this.connection.stopReceiving(c.map((function(e){return u(e,2)[1].id})));case 24:return l=this.createUnsubscribeAllMessage(c),e.abrupt("return",(this.withdrawRemoteTracks(c),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),c.forEach((function(e){var t,n,r=u(e,2),i=r[0],a=r[1].kind;if(a===Ck.VIDEO&&i._videoSSRC&&(null===(t=d.connection)||void 0===t||t.setStatsRemoteVideoIsReady(i._videoSSRC,!1)),a===Ck.VIDEO)d.unbindRemoteTrackEvents(i._videoTrack),null===(n=i._videoTrack)||void 0===n||n._destroy(),i._videoTrack=void 0;else if(a===Ck.AUDIO){var o;d.unbindRemoteTrackEvents(i._audioTrack),null===(o=i._audioTrack)||void 0===o||o._destroy(),i._audioTrack=void 0}})),l));case 26:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,".")));case 5:if(r.get(n)){e.next=7;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(n,".")));case 7:void 0!==(i=n===Ck.VIDEO?t._videoSSRC:t._audioSSRC)&&this.connection.setStatsRemoteVideoIsReady(i,!1);case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.unmuteRemoteNoLock(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemoteNoLock",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,".")));case 5:r.get(n)||lS.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(n,"."));case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getAllTracks",value:function(e){var t=this.localTrackMap.get(Ok.LocalAudioTrack);if((null==t?void 0:t.track)instanceof wC){var n=t.track;return Array.from(this.localTrackMap.entries()).filter((function(e){return u(e,1)[0]!==Ok.LocalAudioTrack})).filter((function(t){var n=u(t,1)[0];return!(e&&n===Ok.LocalVideoLowTrack)})).map((function(e){return u(e,2)[1].track})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((function(t){var n=u(t,1)[0];return!(e&&n===Ok.LocalVideoLowTrack)})).map((function(e){return u(e,2)[1].track}))}},{key:"getAllDataChannels",value:function(){return this.localDataChannels}},{key:"reportPublishEvent",value:function(e,t,n,r,i){if(e){var a=this.localTrackMap.get(Ok.LocalAudioTrack),o=r?this.localTrackMap.get(Ok.LocalVideoLowTrack):this.localTrackMap.get(Ok.LocalVideoTrack);bS.publish(this.store.sessionId,{eventElapse:TN.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(zT.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);var c=n.find((function(e){return e instanceof _C})),u=r?null===(s=this.localTrackMap.get(Ok.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((function(e){return e instanceof GC}));bS.publish(this.store.sessionId,{eventElapse:TN.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==c?void 0:c.getTrackLabel(),videoName:null==u?void 0:u.getTrackLabel(),screenshare:-1!==(null==u?void 0:u._hints.indexOf(zT.SCREEN_TRACK)),audio:!!c,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}},{key:"reportSubscribeEvent",value:function(e,t,n,r){var i=r===Ck.VIDEO?n._videoSSRC:n._audioSSRC;i&&bS.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Ck.VIDEO,audio:r===Ck.AUDIO,peerid:n.uid,subscribeRequestid:r===Ck.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:TN.measureFromSubscribeStart(this.store.clientId,i)})}},{key:"reset",value:function(){lS.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new fE("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new AP({},this.store):this.isPlanB?new aP({},this.store):new pP({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();var e=this.localTrackMap.get(Ok.LocalAudioTrack);if((null==e?void 0:e.track)instanceof wC){if(e.track.trackList.length>0){var t=e.track;e.track.trackList.forEach((function(e){t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Nk.Disconnected}},{key:"getStats",value:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}},{key:"getLocalAudioVolume",value:function(){var e=this.localTrackMap.get(Ok.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}},{key:"getLocalVideoSize",value:function(){var e=this.localTrackMap.get(Ok.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}},{key:"getEncoderConfig",value:function(e){var t=this.localTrackMap.get(e);return t&&t.track instanceof GC||t&&t.track instanceof _C?t.track._encoderConfig:void 0}},{key:"getLocalMedia",value:function(e){return this.localTrackMap.get(e)}},{key:"hasLocalMedia",value:function(){return this.localTrackMap.size>0}},{key:"hasRemoteMedia",value:function(e,t){if(!e)return this.remoteUserMap.size>0;var n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}},{key:"hasRemoteMediaWithLock",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this.remoteUserMap.size>0);case 2:return r=this.remoteUserMap.get(t),e.abrupt("return",!!r&&(!n||r.has(n)));case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteMedia",value:function(e){var t,n=Array.from(xf(t=this.remoteUserMap).call(t)).find((function(t){return t.uid===e}));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}},{key:"getAudioLevels",value:function(){var e=Array.from(this.remoteUserMap.entries()).map((function(e){var t=u(e,1)[0];return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(Ok.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_p(e).call(e,(function(e,t){return e.level-t.level})),e}},{key:"disconnectForReconnect",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connection&&(lS.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Nk.Reconnecting,$w("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var t,n=u(e,1)[0];n._videoTrack&&n._videoTrack._player&&(null===(t=n._videoTrack._player.getVideoElement())||void 0===t||t.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new AP({},this.store):this.isPlanB?new aP({},this.store):new pP({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((function(e){var n,r=u(e,2),i=r[0],a=r[1].track;switch(i){case Ok.LocalVideoTrack:$i(n=a._hints).call(n,zT.LOW_STREAM)?a.close():t.pendingLocalTracks.push(a);break;case Ok.LocalAudioTrack:a instanceof wC?t.pendingLocalTracks=t.pendingLocalTracks.concat(a.trackList):t.pendingLocalTracks.push(a);case Ok.LocalVideoLowTrack:}})),this.emit(xk.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var n=u(e,2),r=n[0],i=n[1];Array.from(xf(i).call(i)).forEach((function(e){t.setPendingRemoteMedia(r,e)})),t.emit(xk.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((function(e){t.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((function(e){var n=u(e,2),r=n[0],i=n[1];Array.from(xf(i).call(i)).forEach((function(e){t.setPendingRemoteDataChannel(r,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),lS.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hasPendingRemoteDataChannel",value:function(e,t){var n,r=o(this.pendingRemoteDataChannels);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.user,s=i.id;if((e instanceof eD?e.uid:e)===a.uid&&s===t)return!0}}catch(c){r.e(c)}finally{r.f()}return!1}},{key:"setPendingRemoteDataChannel",value:function(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}},{key:"hasPendingRemoteMedia",value:function(e,t){var n,r=o(this.pendingRemoteTracks);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.user,s=i.kind;if((e instanceof eD?e.uid:e)===a.uid&&t===s)return!0}}catch(c){r.e(c)}finally{r.f()}return!1}},{key:"setPendingRemoteMedia",value:function(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}},{key:"restartICE",value:function(e){var t=this;return lD(s().mark((function n(){var r,i,a,o,c,u;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.connection&&t.state===Nk.Connected&&!(t.connection instanceof AP)){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,dD(t.mutex.lock("From P2PChannel.restartICE"));case 4:return r=n.sent,n.prev=5,n.next=8,dD(t.connection.restartICE(e));case 8:return i=n.sent,n.next=11,dD(i.next());case 11:if(!(a=n.sent).done){n.next=14;break}return n.abrupt("return");case 14:return o=a.value,n.next=17,o;case 17:c=n.sent,n.t0=(t.reportPCDisconnectedOrFailed(e),e),n.next=n.t0===Rk.TCP?21:n.t0===Rk.RELAY?23:25;break;case 21:return t._pcStatsUploadType=Ak.TCP_RESTART,n.abrupt("break",26);case 23:return t._pcStatsUploadType=Ak.RELAY_RESTART,n.abrupt("break",26);case 25:t._pcStatsUploadType=Ak.OLD_RESTART;case 26:t._isInRestartIce=!0,i.next(c),n.next=32;break;case 29:n.prev=29,n.t1=n.catch(5),null===(u=i)||void 0===u||u.throw(n.t1);case 32:return n.prev=32,r(),n.finish(32);case 35:case"end":return n.stop()}}),n,null,[[5,29,32,35]])})))()}},{key:"getUplinkNetworkQuality",value:function(){if(!this.connection)return 0;var e=this.connection.getStats(),t=this.localTrackMap.get(Ok.LocalVideoTrack),n=this.localTrackMap.get(Ok.LocalAudioTrack),r=e.videoSend.find((function(e){return e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)})),i=e.audioSend.find((function(e){return e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)}));if(!r||!i)return 1;var a=F_(this,xk.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,f=null==t?void 0:t.track;if(f&&f._encoderConfig&&-1===f._hints.indexOf(zT.SCREEN_TRACK)){var p=f._encoderConfig.bitrateMax,h=e.bitrate.actualEncoded;if(p&&h){var v=(1e3*p-h)/(1e3*p);return kS[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][d]}}return d}},{key:"getDownlinkNetworkQuality",value:function(){var e=this;if(!this.connection)return 0;var t=this.connection.getStats(),n=0;return Array.from(this.remoteUserMap.entries()).forEach((function(r){var i=u(r,1)[0],a=i._audioSSRC,o=i._videoSSRC,s=t.audioRecv.find((function(e){return e.ssrc===a})),c=t.videoRecv.find((function(e){return e.ssrc===o}));if(s||c){var l=F_(e,xk.NeedSignalRTT),d=t.rtt,f=(d&&l?(d+l)/2:d||l)||0,p=s?s.jitterMs:void 0,h=t.recvPacketLossRate,v=.7*h*100/50+.3*f/1500;p&&(v=.6*h*100/50+.2*f/1500+.2*p/400),n+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}else n+=1})),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}},{key:"muteLocalTrack",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new by((function(e,r){n.handleMuteLocalTrack(t,e,r)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"filterTobePublishedTracks",value:function(e,t,n){var r=[],i=OI(),a=this.getAllTracks();e=W_(e=e.filter((function(e){return-1===a.indexOf(e)})));var s,c=!1,u=!1,l=o(e);try{for(l.s();!(s=l.n()).done;){var d=s.value;if(d instanceof GC&&(this.localTrackMap.has(Ok.LocalVideoTrack)||c?new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:Ok.LocalVideoTrack}),c=!0),t)){var f=this.getLowVideoTrack(d,n);r.push({track:f,type:Ok.LocalVideoLowTrack})}if(d instanceof _C){var p=this.localTrackMap.get(Ok.LocalAudioTrack);if(p){if(!(p.track instanceof wC))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(u){var h=r.find((function(e){return e.type===Ok.LocalAudioTrack}));if(!(h.track instanceof wC))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d)}else{if(!i.webAudioMediaStreamDest||d instanceof wC||d._bypassWebAudio)r.push({track:d,type:Ok.LocalAudioTrack});else{var v=new wC;v.addAudioTrack(d),r.push({track:v,type:Ok.LocalAudioTrack})}u=!0}}}}catch(m){l.e(m)}finally{l.f()}return r}},{key:"filterTobeUnpublishedTracks",value:function(e){var t=[],n=this.getAllTracks();e=W_(e=e.filter((function(e){return-1!==n.indexOf(e)})));var r,i=o(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a instanceof _C){var s=this.localTrackMap.get(Ok.LocalAudioTrack);if(!s)continue;s.track instanceof wC?(s.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===s.track.trackList.length&&(t.push([Ok.LocalAudioTrack,s]),s.track.close())):t.push([Ok.LocalAudioTrack,s])}if(a instanceof GC){var c=this.localTrackMap.get(Ok.LocalVideoTrack);if(!c)continue;t.push([Ok.LocalVideoTrack,c]);var u=this.localTrackMap.get(Ok.LocalVideoLowTrack);u&&t.push([Ok.LocalVideoLowTrack,u])}}}catch(l){i.e(l)}finally{i.f()}return t}},{key:"filterTobePublishedDataChannels",value:function(e){var t=this;return(e=W_(e)).filter((function(e){return-1===t.localDataChannels.findIndex((function(t){return t.id===e.id}))}))}},{key:"filterTobeUnpublishedDataChannels",value:function(e){var t=this;return(e=(e=W_(e)).filter((function(e){return-1!==t.localDataChannels.indexOf(e)}))).filter((function(e){return e._originDataChannel}))}},{key:"bindLocalTrackEvents",value:function(e){var t=this;e.forEach((function(e){var n=e.track;switch(e.type){case Ok.LocalVideoTrack:n.addListener(KT.GET_STATS,t.handleGetLocalVideoStats),n.addListener(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.addListener(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.addListener(KT.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.addListener(KT.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.addListener(KT.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.addListener(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.addListener(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case Ok.LocalAudioTrack:t.bindLocalAudioTrackEvents(n);case Ok.LocalVideoLowTrack:}}))}},{key:"bindLocalAudioTrackEvents",value:function(e,t){var n=this;e instanceof wC?e.trackList.forEach((function(e){e.addListener(KT.NEED_DISABLE_TRACK,n.handleMuteLocalTrack),e.addListener(KT.NEED_ENABLE_TRACK,n.handleUnmuteLocalTrack),e.addListener(KT.GET_STATS,n.handleGetLocalAudioStats),e.addListener(KT.NEED_MUTE_TRACK,n.handleMuteLocalTrack),e.addListener(KT.NEED_UNMUTE_TRACK,n.handleUnmuteLocalTrack)})):(e.addListener(KT.GET_STATS,this.handleGetLocalAudioStats),e.addListener(KT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(KT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(KT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(KT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(KT.NEED_REPLACE_TRACK,this.handleReplaceTrack))}},{key:"unbindLocalTrackEvents",value:function(e){var t=this;e||(e=Array.from(this.localTrackMap.entries()).map((function(e){var t=u(e,2),n=t[0];return{track:t[1].track,type:n}}))),e.forEach((function(e){var n=e.track;switch(e.type){case Ok.LocalVideoTrack:n.off(KT.GET_STATS,t.handleGetLocalVideoStats),n.off(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.off(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.off(KT.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.off(KT.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.off(KT.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.off(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.off(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case Ok.LocalAudioTrack:t.unbindLocalAudioTrackEvents(n);case Ok.LocalVideoLowTrack:}}))}},{key:"unbindLocalAudioTrackEvents",value:function(e){var t=this;e instanceof wC?e.trackList.forEach((function(e){e.off(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),e.off(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),e.off(KT.GET_STATS,t.handleGetLocalAudioStats),e.off(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),e.off(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack)})):(e.off(KT.GET_STATS,this.handleGetLocalAudioStats),e.off(KT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(KT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(KT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(KT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(KT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}},{key:"bindRemoteTrackEvents",value:function(e,t){var n=this;t instanceof JC&&t.addListener(KT.GET_STATS,(function(t){t(n.handleGetRemoteVideoStats(e))})),t instanceof XC&&t.addListener(KT.GET_STATS,(function(t){t(n.handleGetRemoteAudioStats(e))}))}},{key:"unbindRemoteTrackEvents",value:function(e){e&&e.removeAllListeners(KT.GET_STATS)}},{key:"unbindAllRemoteTrackEvents",value:function(){var e=this;Array.from(this.remoteUserMap.entries()).forEach((function(t){var n=u(t,2),r=n[0],i=n[1];i.has(Ck.AUDIO)&&e.unbindRemoteTrackEvents(r._audioTrack),i.has(Ck.VIDEO)&&e.unbindRemoteTrackEvents(r._videoTrack)}))}},{key:"createGatewayPublishMessage",value:function(e,t){var n=this;return e.map((function(e,r){var i,a,o,s=e.track;switch(e.type){case Ok.LocalAudioTrack:a=hk.Audio,o={dtx:s instanceof EC&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ok.LocalVideoTrack:a=$i(i=s._hints).call(i,zT.SCREEN_TRACK)?hk.Screen:hk.High,o=LP(LP({},PN(s)),{},{codec:n.store.codec});break;case Ok.LocalVideoLowTrack:a=hk.Low,o=LP(LP({},PN(s)),{},{codec:n.store.codec})}return{stream_type:a,attributes:o,ssrcs:t[r]}}))}},{key:"createGatewayUnpublishMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"assignLocalTracks",value:function(e,t){var n=this;e.forEach((function(e,r){var i=e.track,a=e.type;n.localTrackMap.set(a,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})}))}},{key:"withdrawLocalTracks",value:function(e){var t=this;e.forEach((function(e){var n=u(e,1)[0];t.localTrackMap.delete(n)}))}},{key:"bindConnectionEvents",value:function(e){var t=this;e.onConnectionStateChange=function(){var n=c(s().mark((function n(r){var i,a,o,c;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),t.emit(xk.PeerConnectionStateChange,r),"connected"!==r||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"connected"===r&&(t._restartTimer&&(clearTimeout(t._restartTimer),t._restartTimer=void 0),(t._isFirstConnected||t._isInRestartIce)&&t.reportPCStats(Date.now(),!0,t._pcStatsUploadType),t._isInRestartIce=!1,t._isFirstConnected=!1,t._isStartRestartIce=!1),!$w("NEW_ICE_RESTART")){n.next=9;break}if(!$i(i=t._restartStates).call(i,r)){n.next=7;break}if(!t._isStartRestartIce){n.next=4;break}return n.abrupt("return");case 4:return t._isStartRestartIce=!0,a=function(n){"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(lS.debug("[".concat(t.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(n)),"CONNECTED"===F_(t,xk.QueryClientConnectionState)&&t.emit(xk.RequestRestartICE,n))},o=function(){"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),lS.debug("[".concat(t.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((function(){return t.emit(xk.P2PLost)}),0),t.iceFailedCount+=1,t.requestReconnect())},c=$w("ICE_RESTART_INTERVAL"),n.abrupt("return",void(t._restartTimer=window.setTimeout((function(){if($w("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&OI().supportPCSetConfiguration)a(Rk.RELAY),t._restartTimer=window.setTimeout(o,c);else if(Gy())a(Rk.UDP),t._restartTimer=window.setTimeout(o,4e3);else{if(a(Rk.TCP),OI().supportPCSetConfiguration)return void(t._restartTimer=window.setTimeout((function(){a(Rk.RELAY),t._restartTimer=window.setTimeout(o,c)}),c));t._restartTimer=window.setTimeout(o,c)}}),800)));case 7:n.next=19;break;case 9:if("disconnected"!==r||"disconnected"!==e.iceConnectionState){n.next=11;break}return n.abrupt("return",(setTimeout((function(){"disconnected"===e.iceConnectionState&&$w("ICE_RESTART")&&"CONNECTED"===F_(t,xk.QueryClientConnectionState)&&t.emit(xk.RequestRestartICE)}),800),void setTimeout((function(){"disconnected"===e.peerConnectionState&&(lS.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),t._isInRestartIce=!1,setTimeout((function(){return t.emit(xk.P2PLost)}),0),t.iceFailedCount+=1,t.requestReconnect())}),4e3)));case 11:if(n.t0="failed"===r,!n.t0){n.next=19;break}return lS.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection state failed, force reconnect")),t.reportPCDisconnectedOrFailed(),setTimeout((function(){return t.emit(xk.P2PLost)}),0),t.iceFailedCount+=1,n.next=19,t.requestReconnect();case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.onICEConnectionStateChange=function(e){"connected"!==e||t.store.keyMetrics.iceConnectionEnd||t.store.iceConnectionEnd(),lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),bS.reportApiInvoke(t.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:E_.TRACER}).onSuccess(),t.emit(xk.IceConnectionStateChange,e)},e.onICETransportStateChange=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=function(e){var n,r,i=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));i&&(t.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(eI.FIRST_FRAME_DECODED),bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_AUDIO_DECODE,pS.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId}))},e.onFirstAudioReceived=function(e){var n,r=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));r&&bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_AUDIO_RECEIVED,pS.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onFirstVideoDecoded=function(e,n,r){t.reportVideoFirstFrameDecoded(e,n,r)},e.onFirstVideoReceived=function(e){var n,r=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._videoSSRC===e}));r&&bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_VIDEO_RECEIVED,pS.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onSelectedLocalCandidateChanged=function(e,n){var r="relay"===e.candidateType,i="relay"===n.candidateType;"unknown"!==n.candidateType&&r===i||t.emit(xk.ConnectionTypeChange,r),lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(BN(n))," -> ").concat(JSON.stringify(BN(e)),")"))},e.onSelectedRemoteCandidateChanged=function(e,n){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(BN(n))," -> ").concat(JSON.stringify(BN(e)),")"))},e.onFirstVideoDecodedTimeout=function(e){t.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}},{key:"unbindConnectionEvents",value:function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}},{key:"filterTobeMutedTracks",value:function(e){var t=[];if(-1===this.getAllTracks().indexOf(e))return t;var n=this.localTrackMap.get(Ok.LocalAudioTrack);if(e instanceof _C&&(null==n?void 0:n.track)instanceof wC)return n.track.isActive||t.push([Ok.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=u(t,2)[1].track;return e===n}));if(r&&(t.push(r),r[0]===Ok.LocalVideoTrack)){var i=this.localTrackMap.get(Ok.LocalVideoLowTrack);i&&t.push([Ok.LocalVideoLowTrack,i])}return t}},{key:"filterTobeUnmutedTracks",value:function(e){var t=[],n=this.localTrackMap.get(Ok.LocalAudioTrack);if(e instanceof _C&&(null==n?void 0:n.track)instanceof wC)return n.track.isActive&&t.push([Ok.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=u(t,2)[1].track;return e===n}));if(r)if(r[0]===Ok.LocalVideoTrack){t.push(r);var i=this.localTrackMap.get(Ok.LocalVideoLowTrack);i&&t.push([Ok.LocalVideoLowTrack,i])}else t.push(r);return t}},{key:"createMuteMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"createUnmuteMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"filterTobeUnSubscribedTracks",value:function(e,t){var n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){var i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((function(t){var r=u(t,2),i=r[0],a=r[1];n.push([e,{kind:i,id:a}])}));return n}},{key:"filterTobeUnSubscribedDataChannels",value:function(e,t){var n=this,r=[];return t.forEach((function(t){var i;null!==(i=n.remoteDataChannelMap.get(e))&&void 0!==i&&i.has(t.id)&&r.push(t)})),r}},{key:"createUnsubscribeMessage",value:function(e){var t=[];return e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1],a=i.kind;switch(i.id,a){case Ck.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Ck.VIDEO,ssrcId:r._videoSSRC}));case Ck.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Ck.AUDIO,ssrcId:r._audioSSRC}))}})),t}},{key:"createUnsubscribeAllMessage",value:function(e){var t=new Map;return e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1].kind;if(t.has(r)){var a=t.get(r);i===Ck.VIDEO?a|=gk.Video:a|=gk.Audio,t.set(r,a)}else i===Ck.VIDEO?t.set(r,gk.Video):t.set(r,gk.Audio)})),{users:Array.from(t.entries()).map((function(e){var t=u(e,2),n=t[0],r=t[1];return{stream_id:n.uid,stream_type:r}}))}}},{key:"withdrawRemoteTracks",value:function(e){var t=this;e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1].kind,a=t.remoteUserMap.get(r);a&&(a.delete(i),0===Array.from(a.entries()).length&&t.remoteUserMap.delete(r))}))}},{key:"updateBitrateLimit",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.localTrackMap.get(Ok.LocalVideoTrack),r=this.localTrackMap.get(Ok.LocalVideoLowTrack),e.t0=n,!e.t0){e.next=5;break}return e.next=5,n.track.setBitrateLimit(t.uplink);case 5:if(e.t1=r&&t.low_stream_uplink,!e.t1){e.next=9;break}return e.next=9,r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isP2PDisconnected",value:function(){return!this.connection||"connected"!==this.connection.peerConnectionState}},{key:"mapPubResToRemoteConfig",value:function(e,t){return e.map((function(e,n){var r,i=e.stream_type;return null===(r=t.find((function(e){var t=e.stream_type;return i===t})))||void 0===r?void 0:r.attributes}))}},{key:"tryToUnmuteAudio",value:function(){var e=c(s().mark((function e(t){var n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=15;break}if(!(t[n]instanceof _C)){e.next=12;break}if(0!==(i=this.filterTobeUnmutedTracks(t[n])).length){e.next=6;break}return e.abrupt("continue",12);case 6:return e.next=8,null===(r=this.connection)||void 0===r?void 0:r.unmuteLocal(i.map((function(e){return u(e,2)[1].id})));case 8:return a=this.createUnmuteMessage(i),e.next=11,j_(this,xk.RequestUnmuteLocal,a);case 11:return e.abrupt("return",void e.sent);case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"bindStatsUploaderEvents",value:function(){var e=this;this.statsUploader.requestStats=function(){return e.getStats()},this.statsUploader.requestLocalMedia=function(){return Array.from(e.localTrackMap.entries())},this.statsUploader.requestRemoteMedia=function(){return Array.from(e.remoteUserMap.entries())},this.statsUploader.requestVideoIsReady=function(t){var n;return!(null===(n=e.connection)||void 0===n||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=function(t,n){return e.emit(xk.RequestUploadStats,t,n)},this.statsUploader.requestAllTracks=function(){return e.getAllTracks()}}},{key:"unbindStatsUploaderEvents",value:function(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}},{key:"requestReconnect",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dtlsFailedCount+=1,e.next=3,nE(vE(this.dtlsFailedCount,hE));case 3:this.emit(xk.RequestReconnect);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnectP2P",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(t),Array.from(this.remoteUserMap.entries()),e.t0=n.length>0,!e.t0){e.next=6;break}return e.next=6,U_(this,xk.RequestUnpublishForReconnectPC,n);case 6:this.disconnectForReconnect(),this.emit(xk.RequestReconnectPC);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"canPublishLowStream",value:function(){return this.localTrackMap.has(Ok.LocalVideoTrack)||this.pendingLocalTracks.some((function(e){return e instanceof GC}))}},{key:"throwIfTrackTypeNotMatch",value:function(e){if(e.filter((function(e){return e instanceof GC})).length>1)throw new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((function(e){return e instanceof _C})).length>1&&(e.some((function(e){return e instanceof _C&&e._bypassWebAudio}))||!OI().webAudioMediaStreamDest))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r instanceof GC&&this.pendingLocalTracks.some((function(e){return e instanceof GC})))throw new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof _C&&this.pendingLocalTracks.some((function(e){return e instanceof _C}))&&(!OI().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((function(e){return e instanceof _C&&e._bypassWebAudio}))))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}catch(i){n.e(i)}finally{n.f()}}},{key:"getLowVideoTrack",value:function(e,t){var n,r=!$w("DISABLE_DUAL_STREAM_USE_ENCODING")&&OI().supportDualStreamEncoding,i=LP(LP({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():vP(e,i);var a=rE(8,"track-low-"),o=new GC(n,LP(LP({},r&&{scaleResolutionDownBy:VN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(QT.TRANSCEIVER_UPDATED,(function(t){e._updateRtpTransceiver(t,YT.LOW_STREAM)})),o._hints.push(zT.LOW_STREAM),e.addListener(KT.NEED_CLOSE,(function(){o.close()})),o}},{key:"globalLock",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutex.lock("From P2PChannel.globalLock"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reportPCStats",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d,f,p,h,v,m,g,y=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=y.length>3&&void 0!==y[3]?y[3]:null,!(this.connection&&this.connection instanceof pP)){e.next=13;break}return l=this.store.keyMetrics.descriptionStart||0,d=this.connection,f=d.iceConnectionState,p=d.dtlsTransportState,h=d.peerConnectionState,e.next=9,this.connection.getSelectedCandidatePair();case 9:v=e.sent,m=v.local,g=v.remote,bS.pcStats(this.store.sessionId,{startTime:l,eventElapse:t-l||0,iceconnectionsate:f,dtlsstate:p,connectionstate:h,intSucc:n?1:2,error:i,selectedLocalCandidateProtocol:null!==(a=null==m?void 0:m.protocol)&&void 0!==a?a:"",selectedLocalCandidateType:null!==(o=m.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:null!==(c=g.protocol)&&void 0!==c?c:"",selectedRemoteCandidateType:null!==(u=g.candidateType)&&void 0!==u?u:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:r});case 13:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"reportVideoFirstFrameDecoded",value:function(e,t,n,r){var i,a=Array.from(xf(i=this.remoteUserMap).call(i)).find((function(t){return t._videoSSRC===e}));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());var o=this.store.keyMetrics,s=o.subscribe.find((function(e){return e.userId===a.uid&&"video"===e.type}));bS.firstRemoteVideoDecode(this.store.sessionId,fS.FIRST_VIDEO_DECODE,pS.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:TN.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}},{key:"remoteMediaSsrcChanged",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connection){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",!1);case 5:if(a=i.get(n)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.connection.getRemoteSSRC(a);case 10:return o=e.sent,e.abrupt("return",void 0!==o&&o!==r);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"resetConnection",value:function(e){lS.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Nk.Connected?(lS.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===yk.datachannel?new AP({},this.store):this.isPlanB?new aP({},this.store):new pP({},this.store),this.bindConnectionEvents(this.connection)))}},{key:"unbindRtpTransceiver",value:function(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((function(e){var t=u(e,2),n=t[0],r=t[1].track;n===Ok.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,YT.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}},{key:"reportPCDisconnectedOrFailed",value:function(e){this.connection&&this.connection instanceof pP&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ak.TCP_RESTART&&e===Rk.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ak.DISCONNECTED_OR_FAILED)))}}]),n}(O_);function FP(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PChannel.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function VP(e){var t=XP();return function(e,t){var n=e.appId;void 0!==n&&(dL(t,10),iL(t,n));var r=e.cid;void 0!==r&&(dL(t,16),dL(t,r));var i=e.cname;void 0!==i&&(dL(t,26),iL(t,i));var a=e.deviceId;void 0!==a&&(dL(t,34),iL(t,a));var s=e.elapse;void 0!==s&&(dL(t,40),fL(t,s));var c=e.fileSize;void 0!==c&&(dL(t,48),fL(t,YP(c)));var u=e.height;void 0!==u&&(dL(t,56),fL(t,YP(u)));var l=e.jpg;void 0!==l&&(dL(t,66),dL(t,l.length),function(e,t){var n=tL(e,t.length);e.bytes.set(t,n)}(t,l));var d=e.networkType;void 0!==d&&(dL(t,72),fL(t,YP(d)));var f=e.osType;void 0!==f&&(dL(t,80),fL(t,YP(f)));var p=e.requestId;void 0!==p&&(dL(t,90),iL(t,p));var h=e.sdkVersion;void 0!==h&&(dL(t,98),iL(t,h));var v=e.sequence;void 0!==v&&(dL(t,104),fL(t,YP(v)));var m=e.sid;void 0!==m&&(dL(t,114),iL(t,m));var g=e.timestamp;void 0!==g&&(dL(t,120),fL(t,g));var y=e.uid;void 0!==y&&(dL(t,128),dL(t,y));var _=e.vid;void 0!==_&&(dL(t,136),dL(t,_));var E=e.width;void 0!==E&&(dL(t,144),fL(t,YP(E)));var b=e.service;void 0!==b&&(dL(t,152),dL(t,b));var w=e.callbackData;void 0!==w&&(dL(t,162),iL(t,w));var S=e.jpgEncryption;void 0!==S&&(dL(t,168),dL(t,S));var k=e.requestType;void 0!==k&&(dL(t,176),dL(t,k));var T=e.scorePorn;void 0!==T&&(dL(t,185),uL(t,T));var I=e.scoreSexy;void 0!==I&&(dL(t,193),uL(t,I));var C=e.scoreNeutral;void 0!==C&&(dL(t,201),uL(t,C));var R=e.scene;void 0!==R&&(dL(t,208),dL(t,R));var A=e.ossFilePrefix;void 0!==A&&(dL(t,218),iL(t,A));var O=e.serviceVendor;if(void 0!==O){var N,x=o(O);try{for(x.s();!(N=x.n()).done;){var D=N.value;dL(t,226);var P=XP();ZP(D,P),dL(t,P.limit),aL(t,P),QP(P)}}catch(L){x.e(L)}finally{x.f()}}}(e,t),function(e){var t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function BP(e){return function(e){var t={};e:for(;!eL(e);){var n=lL(e);switch(n>>>3){case 0:break e;case 1:t.code=lL(e);break;case 2:t.msg=rL(e,lL(e));break;case 3:var r=qP(e);t.data=GP(e),e.limit=r;break;default:WP(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function GP(e){var t={};e:for(;!eL(e);){var n=lL(e);switch(n>>>3){case 0:break e;case 1:t.requestId=rL(e,lL(e));break;case 2:t.requestType=lL(e)>>>0;break;case 3:t.scorePorn=cL(e);break;case 4:t.scoreSexy=cL(e);break;case 5:t.scoreNeutral=cL(e);break;case 6:t.requestScene=lL(e)>>>0;break;case 7:t.scene=lL(e)>>>0;break;default:WP(e,7&n)}}return t}function ZP(e,t){var n=e.service;void 0!==n&&(dL(t,8),dL(t,n));var r=e.vendor;void 0!==r&&(dL(t,16),dL(t,r));var i=e.token;void 0!==i&&(dL(t,26),iL(t,i));var a=e.callbackUrl;void 0!==a&&(dL(t,34),iL(t,a))}function qP(e){var t=lL(e),n=e.limit;return e.limit=e.offset+t,n}function WP(e,t){switch(t){case 0:for(;128&oL(e););break;case 2:$P(e,lL(e));break;case 5:$P(e,4);break;case 1:$P(e,8);break;default:throw new Error("Unimplemented type: "+t)}}QS([FP,$S("design:type",Function),$S("design:paramtypes",[Object,Boolean]),$S("design:returntype",by)],jP.prototype,"startP2PConnection",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],jP.prototype,"connect",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Object,Object,Array,Object,String,String]),$S("design:returntype",by)],jP.prototype,"preConnect",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],jP.prototype,"publishDataChannel",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],jP.prototype,"unpublish",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],jP.prototype,"unpublishDataChannel",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],jP.prototype,"unpublishLowStream",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,Array]),$S("design:returntype",by)],jP.prototype,"subscribeDataChannel",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String,Number,Number,Array]),$S("design:returntype",by)],jP.prototype,"subscribe",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],jP.prototype,"massSubscribe",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String,Boolean]),$S("design:returntype",by)],jP.prototype,"unsubscribe",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,Array]),$S("design:returntype",by)],jP.prototype,"unsubscribeDataChannel",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],jP.prototype,"massUnsubscribe",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],jP.prototype,"muteRemote",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],jP.prototype,"unmuteRemote",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],jP.prototype,"hasRemoteMediaWithLock",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],jP.prototype,"disconnectForReconnect",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],jP.prototype,"updateBitrateLimit",null),QS([FP,$S("design:type",Function),$S("design:paramtypes",[eD,String,Number]),$S("design:returntype",by)],jP.prototype,"remoteMediaSsrcChanged",null);var HP=new Float32Array(1);new Uint8Array(HP.buffer);var KP=new Float64Array(1),zP=new Uint8Array(KP.buffer);function YP(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var JP=[];function XP(){var e=JP.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function QP(e){JP.push(e)}function $P(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function eL(e){return e.offset>=e.limit}function tL(e,t){var n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){var o=new Uint8Array(2*a);o.set(n),e.bytes=o}return e.offset=a,a>i&&(e.limit=a),r}function nL(e,t){var n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function rL(e,t){for(var n=nL(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="",s=0;s<t;s++){var c=void 0,u=void 0,l=void 0,d=void 0,f=i[s+n];0==(128&f)?o+=r(f):192==(224&f)?s+1>=t||128!=(192&(c=i[s+n+1]))||(d=(31&f)<<6|63&c)<128?o+=a:(o+=r(d),s++):224==(240&f)?s+2>=t||32896!=(49344&((c=i[s+n+1])|(u=i[s+n+2])<<8))||(d=(15&f)<<12|(63&c)<<6|63&u)<2048||d>=55296&&d<=57343?o+=a:(o+=r(d),s+=2):240==(248&f)?s+3>=t||8421504!=(12632256&((c=i[s+n+1])|(u=i[s+n+2])<<8|(l=i[s+n+3])<<16))||(d=(7&f)<<18|(63&c)<<12|(63&u)<<6|63&l)<65536||d>1114111?o+=a:(o+=r(55296+((d-=65536)>>10),56320+(1023&d)),s+=3):o+=a}return o}function iL(e,t){for(var n=t.length,r=0,i=0;i<n;i++){var a=t.charCodeAt(i);a>=55296&&a<=56319&&i+1<n&&(a=(a<<10)+t.charCodeAt(++i)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}dL(e,r);for(var o=tL(e,r),s=e.bytes,c=0;c<n;c++){var u=t.charCodeAt(c);u>=55296&&u<=56319&&c+1<n&&(u=(u<<10)+t.charCodeAt(++c)-56613888),u<128?s[o++]=u:(u<2048?s[o++]=u>>6&31|192:(u<65536?s[o++]=u>>12&15|224:(s[o++]=u>>18&7|240,s[o++]=u>>12&63|128),s[o++]=u>>6&63|128),s[o++]=63&u|128)}}function aL(e,t){for(var n=tL(e,t.limit),r=e.bytes,i=t.bytes,a=0,o=t.limit;a<o;a++)r[a+n]=i[a]}function oL(e){return e.bytes[nL(e,1)]}function sL(e,t){var n=tL(e,1);e.bytes[n]=t}function cL(e){var t=nL(e,8),n=e.bytes;return zP[0]=n[t++],zP[1]=n[t++],zP[2]=n[t++],zP[3]=n[t++],zP[4]=n[t++],zP[5]=n[t++],zP[6]=n[t++],zP[7]=n[t++],KP[0]}function uL(e,t){var n=tL(e,8),r=e.bytes;KP[0]=t,r[n++]=zP[0],r[n++]=zP[1],r[n++]=zP[2],r[n++]=zP[3],r[n++]=zP[4],r[n++]=zP[5],r[n++]=zP[6],r[n++]=zP[7]}function lL(e){var t,n=0,r=0;do{t=oL(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function dL(e,t){for(t>>>=0;t>=128;)sL(e,127&t|128),t>>>=7;sL(e,t)}function fL(e,t){var n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=tL(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}function pL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var hL=new Map([["moderation",1],["supervise",2]]),vL=function(e){p(n,e);var t=h(n);function n(e){var r;return l(this,n),r=t.call(this),kf(f(r),"name","AgoraRTCVideoContentInspect"),kf(f(r),"_connectionState",Pk.CONNECTING),kf(f(r),"_innerConnectionState",void 0),kf(f(r),"sequence",0),kf(f(r),"inspectStartTime",void 0),kf(f(r),"workerManagerConnection",void 0),kf(f(r),"workerConnection",void 0),kf(f(r),"workerMessageLengthLimit",void 0),kf(f(r),"inspectIntervalMinimum",void 0),kf(f(r),"qualityRatio",void 0),kf(f(r),"_connectInfo",void 0),kf(f(r),"_cancelTokenSource",Mw.CancelToken.source()),kf(f(r),"_retryConfig",void 0),kf(f(r),"wmSequence",0),kf(f(r),"inspectInterval",void 0),kf(f(r),"inspectTimer",null),kf(f(r),"ossFilePrefix",void 0),kf(f(r),"extraInfo",void 0),kf(f(r),"_inspectType",void 0),kf(f(r),"_inspectMode",void 0),kf(f(r),"_quality",1),kf(f(r),"qualityTimer",null),kf(f(r),"_inspectId",void 0),kf(f(r),"_needWorkUrlOnly",!1),kf(f(r),"inspectImage",(function(){if(r.connectionState!==Pk.CONNECTED)throw new ek(Oy.OPERATION_ABORTED,"content inspect service connection status is ".concat(r.connectionState));r.inspectTimer&&(window.clearInterval(r.inspectTimer),r.inspectTimer=null),r.inspectTimer=window.setInterval((function(){r.connectionState===Pk.CONNECTED?r.requestToInspectImage():lS.debug("[".concat(r._inspectId,"] Inspect State is not connected , "),r.connectionState)}),r.inspectInterval<r.inspectIntervalMinimum?r.inspectIntervalMinimum:r.inspectInterval),r.requestToInspectImage()})),r._inspectId=rE(5,"inspect-"),r.workerMessageLengthLimit=$w("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),r.inspectIntervalMinimum=$w("VIDEO_INSPECT_INTERVAL_MINIMUM"),r.qualityRatio=$w("VIDEO_INSPECT_QUALITY_RATIO"),r.inspectInterval=e.interval,r.ossFilePrefix=e.ossFilePrefix,r.extraInfo=e.extraInfo,r.inspectType=e.inspectType,r.inspectStartTime=Number(Date.now()),r.workerManagerConnection=new pT("worker-manager-"+r._inspectId,hE),r.on(Mk.STATE_CHANGE,(function(e,t){r._innerConnectionState=e,lS.debug("[".concat(r._inspectId,"] Inspect operation :").concat(Lk[e]," ").concat(t||""))})),r.handleWorkerManagerEvents(),r.workerConnection=new pT("worker-"+r._inspectId,hE),r.handleWorkerEvents(),r}return d(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){if(this._connectionState!==e){var t=this._connectionState;this._connectionState=e,this.emit(Mk.CONNECTION_STATE_CHANGE,t,e)}}},{key:"inspectType",get:function(){return this._inspectType},set:function(e){var t;this._inspectMode=AE(t=e.map((function(e){return hL.get(e)||0}))).call(t,(function(e,t){return e+t})),this._inspectType=e}},{key:"quality",get:function(){return this._quality},set:function(e){var t=this;this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((function(){t.quality=t._quality/t.qualityRatio}),6e4))}},{key:"init",value:function(){var e=c(s().mark((function e(t,n){var r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(Mk.STATE_CHANGE,Lk.CONNECT_AP),this._connectInfo=t,r=this._cancelTokenSource.token,e.abrupt("return",(this._retryConfig=n,new by((function(e,a){i.on(Mk.CONNECTION_STATE_CHANGE,(function(t,n){n===Pk.CONNECTED&&e()})),i.requestAP(t,r,n).then((function(e){i.connectWorkerManager(e)})).catch((function(e){a(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"requestAP",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$w("WEBCS_DOMAIN").map((function(e){return"https://".concat(e,"/api/v1")})),e.next=3,function(e,t,n,r){var i=t.appId,a=t.areaCode,o=t.cname,u=t.sid,l=t.token,d=t.uid;wx++;var f,p,h="image_moderation_api",v={service_name:h,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:wx,seq:wx,sid:u,token:l,ts:Date.now(),uid:d+""})},m=e[0];return mE(c(s().mark((function e(){var t,r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=Date.now(),e.next=3,ex(m,{data:v,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});case 3:if(t=e.sent,p=Date.now()-f,0===t.code){e.next=7;break}throw r=new ek(Oy.UNEXPECTED_RESPONSE,"image inspect ap error, code"+t.code,{retry:!0,responseTime:p}),lS.error(r.toString()),r;case 7:if(200===(i=JSON.parse(t.json_body)).code){e.next=11;break}throw a=new ek(Oy.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(i.code,", reason: ").concat(i.reason),{code:i.code,responseTime:p}),lS.error(a.toString()),a;case 11:if(i.servers&&Array.isArray(i.servers)&&0!==i.servers.length){e.next=14;break}throw o=new ek(Oy.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:i.code,responseTime:p}),lS.error(o.toString()),o;case 14:return c=$w("VIDEO_INSPECT_WORKER_MANAGER_HOST"),u=$w("VIDEO_INSPECT_WORKER_MANAGER_PORT"),e.abrupt("return",{addressList:i.servers.map((function(e){var t=e.address,n=e.wss;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(c,":").concat(u||n)})).filter((function(e){return!!e})),workerToken:i.workerToken,vid:i.vid,responseTime:p});case 16:case"end":return e.stop()}}),e)}))),(function(t,n){return bS.apworkerEvent(u,{success:!0,sc:200,serviceName:h,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1}),(function(t,n){return bS.apworkerEvent(u,{success:!1,sc:t.data&&t.data.code||200,serviceName:h,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==Oy.OPERATION_ABORTED&&t.code!==Oy.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)}),r)}(i,t,n,r);case 3:return a=e.sent,this.emit(Mk.STATE_CHANGE,Lk.AP_CONNECTED),o=a.addressList,e.abrupt("return",(this.wmSequence++,o));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"connectWorkerManager",value:function(){var e=c(s().mark((function e(t){var n,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],this._needWorkUrlOnly=n,this.emit(Mk.STATE_CHANGE,Lk.CONNECT_WORKER_MANAGER),e.next=5,this.workerManagerConnection.init(t,1e4);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connectWorker",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.workerConnection.init([t]);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleWorkerManagerEvents",value:function(){var e=this;this.workerManagerConnection.on(BS.CONNECTED,c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(Mk.STATE_CHANGE,Lk.WORKER_MANAGER_CONNECTED,e.workerManagerConnection.url),e.workerManagerConnection.sendMessage({appId:e._connectInfo.appId,cname:e._connectInfo.cname,uid:e._connectInfo.uid+"",sdkVersion:"4.19.1",sid:e._connectInfo.sid,seq:e.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0);case 1:case"end":return t.stop()}}),t)})))),this.workerManagerConnection.on(BS.CLOSED,(function(){e._innerConnectionState<Lk.GET_WORKER_MANAGER_RESPONSE&&lS.debug("[".concat(e._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(BS.FAILED,(function(){e._innerConnectionState<Lk.GET_WORKER_MANAGER_RESPONSE&&lS.debug("[".concat(e._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(BS.RECONNECTING,(function(){e._innerConnectionState<Lk.GET_WORKER_MANAGER_RESPONSE&&lS.debug("[".concat(e._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(BS.ON_MESSAGE,function(){var t=c(s().mark((function t(n){var r,i,a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit(Mk.STATE_CHANGE,Lk.GET_WORKER_MANAGER_RESPONSE),r=e.workerManagerConnection.url,e.workerManagerConnection.close(),200===(i=JSON.parse(n.data)).code){t.next=6;break}throw lS.error("[".concat(e._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new ek(Oy.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);case 6:if(i.serverResponse&&i.serverResponse.portWss&&r){t.next=8;break}throw lS.error("[".concat(e._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new ek(Oy.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);case 8:if(a=$w("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=r.replace(/:\d+\/?$/,":".concat(a)),e.emit(Mk.STATE_CHANGE,Lk.CONNECT_WORKER,o),!e._needWorkUrlOnly){t.next=14;break}e.emit(Mk.REQUEST_NEW_WORKER_URL,o),t.next=16;break;case 14:return t.next=16,e.connectWorker(o);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.workerManagerConnection.on(BS.WILL_RECONNECT,(function(e,t,n){n(e)})),this.workerManagerConnection.on(BS.REQUEST_NEW_URLS,(function(t,n){e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then(t).catch(n)}))}},{key:"handleWorkerEvents",value:function(){var e=this;this.workerConnection.on(BS.CONNECTED,c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(Mk.STATE_CHANGE,Lk.WORKER_CONNECTED,e.workerConnection.url),e.connectionState=Pk.CONNECTED;case 1:case"end":return t.stop()}}),t)})))),this.workerConnection.on(BS.ON_MESSAGE,function(){var t=c(s().mark((function t(n){var r,i,a,o,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.data instanceof ArrayBuffer)){t.next=11;break}if(r=BP(new Uint8Array(n.data)),$w("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&lS.debug("[".concat(e._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),200!==r.code){t.next=8;break}if(!Array.isArray(e.inspectType)||1!==e.inspectType.length||"supervise"!==e.inspectType[0]){t.next=5;break}return t.abrupt("return",void e.emit(Mk.INSPECT_RESULT,void 0,void 0));case 5:r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral?(a={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},o=AE(i=Object.keys(a)).call(i,(function(e,t){return a[e]>a[t]?e:t}),"porn"),c=Object.keys(a).find((function(e){return e===o})),e.emit(Mk.INSPECT_RESULT,c)):e.emit(Mk.INSPECT_RESULT,void 0,new ek(Oy.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message")),t.next=9;break;case 8:e.emit(Mk.INSPECT_RESULT,void 0,new ek(Oy.UNEXPECTED_RESPONSE,r.code+"",r.msg));case 9:t.next=12;break;case 11:lS.error("[".concat(e._inspectId,"] Unexpected message type from worker")),e.emit(Mk.INSPECT_RESULT,void 0,new ek(Oy.UNEXPECTED_RESPONSE,"invalid worker message type"));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.workerConnection.on(BS.CLOSED,(function(){e.connectionState=Pk.CLOSED})),this.workerConnection.on(BS.FAILED,(function(){e.connectionState=Pk.CLOSED})),this.workerConnection.on(BS.RECONNECTING,(function(){e.connectionState=e.connectionState===Pk.CONNECTED?Pk.RECONNECTING:Pk.CONNECTING})),this.workerConnection.on(BS.WILL_RECONNECT,(function(e,t,n){"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(BS.REQUEST_NEW_URLS,(function(t,n){e.workerManagerConnection.close(),e.once(Mk.REQUEST_NEW_WORKER_URL,(function(e){t([e])})),e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then((function(t){e.connectWorkerManager(t,!0)})).catch((function(e){n(e)}))}))}},{key:"requestToInspectImage",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sequence++,t=F_(this,Mk.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid},!t){e.next=11;break}if(t.isPlaying){e.next=5;break}return e.abrupt("return",void this.emit(Mk.INSPECT_RESULT,void 0,new ek(Oy.INVALID_OPERATION,"Only the track being played can be inspected")));case 5:return e.next=7,this.generateRequestData(t,n);case 7:r=e.sent,this.workerConnection.sendMessage(r,!0,!0),e.next=12;break;case 11:this.emit(Mk.INSPECT_RESULT,void 0,new ek(Oy.INVALID_OPERATION,"Only the track being published can be inspected"));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"generateRequestData",value:function(){var e=c(s().mark((function e(t,r){var i,a,o,c,u,l,d,f,p,h,v,m,g,y;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.appId,a=r.cname,o=r.cid,c=r.vid,u=r.sid,l=r.uid,d=Date.now(),e.next=4,t.getCurrentFrameImage("image/jpeg",this.quality);case 4:return f=e.sent,e.next=7,FC(f,i,a);case 7:if(p=e.sent,h=this.sequence+"-"+o+"-"+l+"-"+d+"-"+rE(12,""),v={appId:i,cid:o,cname:a,deviceId:"",elapse:n.intToLong(Number(d-this.inspectStartTime)),fileSize:p.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:p,networkType:6,osType:7,requestId:h,sdkVersion:"4.19.1",sequence:this.sequence,sid:u,timestamp:n.intToLong(d),uid:l,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix},void 0===this.extraInfo&&delete v.callbackData,void 0===this.ossFilePrefix&&delete v.ossFilePrefix,!((m=VP(v)).byteLength<this.workerMessageLengthLimit)){e.next=15;break}return $w("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&(g=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pL(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},v),delete g.jpg,lS.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(g))),e.abrupt("return",m);case 15:return y=this.quality*this.qualityRatio,this.quality=y,e.next=19,this.generateRequestData(t,{appId:i,cname:a,cid:o,vid:c,sid:u,uid:l});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mw.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Pk.CLOSED,this.emit(Mk.STATE_CHANGE,Lk.CLOSED)}}],[{key:"intToLong",value:function(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}}]),n}(O_);function mL(e){var t=function(){var e=EL.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){var n=e.appId;void 0!==n&&(NL(t,10),CL(t,n));var r=e.cid;void 0!==r&&(NL(t,16),NL(t,r));var i=e.cname;void 0!==i&&(NL(t,26),CL(t,i));var a=e.deviceId;void 0!==a&&(NL(t,34),CL(t,a));var o=e.elapse;void 0!==o&&(NL(t,40),DL(t,o));var s=e.fileSize;void 0!==s&&(NL(t,48),DL(t,_L(s)));var c=e.height;void 0!==c&&(NL(t,56),DL(t,_L(c)));var u=e.jpg;void 0!==u&&(NL(t,66),NL(t,u.length),TL(t,u));var l=e.networkType;void 0!==l&&(NL(t,72),DL(t,_L(l)));var d=e.osType;void 0!==d&&(NL(t,80),DL(t,_L(d)));var f=e.requestId;void 0!==f&&(NL(t,90),CL(t,f));var p=e.sdkVersion;void 0!==p&&(NL(t,98),CL(t,p));var h=e.sequence;void 0!==h&&(NL(t,104),DL(t,_L(h)));var v=e.sid;void 0!==v&&(NL(t,114),CL(t,v));var m=e.timestamp;void 0!==m&&(NL(t,120),DL(t,m));var g=e.uid;void 0!==g&&(NL(t,128),NL(t,g));var y=e.vid;void 0!==y&&(NL(t,136),NL(t,y));var _=e.width;void 0!==_&&(NL(t,144),DL(t,_L(_)));var E=e.service;void 0!==E&&(NL(t,152),NL(t,E));var b=e.callbackData;void 0!==b&&(NL(t,162),NL(t,b.length),TL(t,b));var w=e.ticket;void 0!==w&&(NL(t,170),CL(t,w))}(e,t),function(e){var t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function gL(e){return function(e){var t={};e:for(;!wL(e);){var n=OL(e);switch(n>>>3){case 0:break e;case 1:t.code=OL(e);break;case 2:t.msg=IL(e,OL(e));break;case 3:t.requestId=IL(e,OL(e));break;case 4:t.timestamp=xL(e,!1);break;default:yL(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function yL(e,t){switch(t){case 0:for(;128&RL(e););break;case 2:bL(e,OL(e));break;case 5:bL(e,4);break;case 1:bL(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function _L(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var EL=[];function bL(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function wL(e){return e.offset>=e.limit}function SL(e,t){var n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){var o=new Uint8Array(2*a);o.set(n),e.bytes=o}return e.offset=a,a>i&&(e.limit=a),r}function kL(e,t){var n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function TL(e,t){var n=SL(e,t.length);e.bytes.set(t,n)}function IL(e,t){for(var n=kL(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="",s=0;s<t;s++){var c=void 0,u=void 0,l=void 0,d=void 0,f=i[s+n];0==(128&f)?o+=r(f):192==(224&f)?s+1>=t||128!=(192&(c=i[s+n+1]))||(d=(31&f)<<6|63&c)<128?o+=a:(o+=r(d),s++):224==(240&f)?s+2>=t||32896!=(49344&((c=i[s+n+1])|(u=i[s+n+2])<<8))||(d=(15&f)<<12|(63&c)<<6|63&u)<2048||d>=55296&&d<=57343?o+=a:(o+=r(d),s+=2):240==(248&f)?s+3>=t||8421504!=(12632256&((c=i[s+n+1])|(u=i[s+n+2])<<8|(l=i[s+n+3])<<16))||(d=(7&f)<<18|(63&c)<<12|(63&u)<<6|63&l)<65536||d>1114111?o+=a:(o+=r(55296+((d-=65536)>>10),56320+(1023&d)),s+=3):o+=a}return o}function CL(e,t){for(var n=t.length,r=0,i=0;i<n;i++){var a=t.charCodeAt(i);a>=55296&&a<=56319&&i+1<n&&(a=(a<<10)+t.charCodeAt(++i)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}NL(e,r);for(var o=SL(e,r),s=e.bytes,c=0;c<n;c++){var u=t.charCodeAt(c);u>=55296&&u<=56319&&c+1<n&&(u=(u<<10)+t.charCodeAt(++c)-56613888),u<128?s[o++]=u:(u<2048?s[o++]=u>>6&31|192:(u<65536?s[o++]=u>>12&15|224:(s[o++]=u>>18&7|240,s[o++]=u>>12&63|128),s[o++]=u>>6&63|128),s[o++]=63&u|128)}}function RL(e){return e.bytes[kL(e,1)]}function AL(e,t){var n=SL(e,1);e.bytes[n]=t}function OL(e){var t,n=0,r=0;do{t=RL(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function NL(e,t){for(t>>>=0;t>=128;)AL(e,127&t|128),t>>>=7;AL(e,t)}function xL(e,t){var n,r=0,i=0,a=0;return r=127&(n=RL(e)),128&n&&(r|=(127&(n=RL(e)))<<7,128&n&&(r|=(127&(n=RL(e)))<<14,128&n&&(r|=(127&(n=RL(e)))<<21,128&n&&(i=127&(n=RL(e)),128&n&&(i|=(127&(n=RL(e)))<<7,128&n&&(i|=(127&(n=RL(e)))<<14,128&n&&(i|=(127&(n=RL(e)))<<21,128&n&&(a=127&(n=RL(e)),128&n&&(a|=(127&(n=RL(e)))<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function DL(e,t){var n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=SL(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}var PL={},LL={},ML=4294967296,UL=ML*ML,jL=UL/2,FL=qL(0,!0),VL=qL(0),BL=WL(0,-2147483648,!1),GL=WL(-1,2147483647,!1),ZL=WL(-1,-1,!0);function qL(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=LL[e])?r:(n=WL(e,0,!0),i&&(LL[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=PL[e])?r:(n=WL(e,e<0?-1:0,!1),i&&(PL[e]=n),n)}function WL(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function HL(e,t){if(isNaN(e))return t?FL:VL;if(t){if(e<0)return FL;if(e>=UL)return ZL}else{if(e<=-jL)return BL;if(e+1>=jL)return GL}return e<0?t?FL:VL:WL(e%ML|0,e/ML|0,t)}function KL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var zL=function(e){p(n,e);var t=h(n);function n(e){var r,i;return l(this,n),r=t.call(this),kf(f(r),"name","AgoraRTCImageModeration"),kf(f(r),"_connectionState",Bk.CONNECTING),kf(f(r),"_sequence",0),kf(f(r),"_moderationStartTime",void 0),kf(f(r),"_workerConnection",void 0),kf(f(r),"_workerMessageLengthLimit",void 0),kf(f(r),"_qualityRatio",void 0),kf(f(r),"_connectInfo",void 0),kf(f(r),"_cancelTokenSource",Mw.CancelToken.source()),kf(f(r),"_retryConfig",void 0),kf(f(r),"_moderationInterval",void 0),kf(f(r),"_moderationTimer",null),kf(f(r),"_moderationMode",1),kf(f(r),"_quality",1),kf(f(r),"_qualityTimer",null),kf(f(r),"_ticket",void 0),kf(f(r),"_moderationIntervalMinimum",void 0),kf(f(r),"_uploadFailedNum",0),kf(f(r),"_uploadNum",0),kf(f(r),"_uploadTimer",null),kf(f(r),"_moderationId",void 0),kf(f(r),"inspectImage",(function(){if(r.connectionState!==Bk.CONNECTED)throw new ek(Oy.OPERATION_ABORTED,"image moderation service connection status is ".concat(r.connectionState));r._moderationTimer&&(window.clearInterval(r._moderationTimer),r._moderationTimer=null),r._moderationTimer=window.setInterval((function(){r.connectionState===Bk.CONNECTED?r.requestToInspectImage():lS.debug("[".concat(r._moderationId,"] Moderation State is not connected , "),r.connectionState)}),r._moderationInterval<r._moderationIntervalMinimum?r._moderationIntervalMinimum:r._moderationInterval),r.requestToInspectImage()})),r._moderationId=rE(5,"image-moderation-"),r._workerMessageLengthLimit=$w("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),r._moderationIntervalMinimum=$w("IMAGE_MODERATION_INTERVAL_MINIMUM"),r._moderationInterval=null!==(i=e.interval)&&void 0!==i?i:1e3,r._qualityRatio=$w("IMAGE_MODERATION_QUALITY_RATIO"),r._moderationStartTime=Number(Date.now()),r._workerConnection=new pT("worker-"+r._moderationId,hE),r.on(Gk.STATE_CHANGE,(function(e,t){lS.debug("[".concat(r._moderationId,"] Moderation operation :").concat(Zk[e]," ").concat(t||""))})),r.handleWorkerEvents(),r}return d(n,[{key:"connectionState",get:function(){return this._connectionState},set:function(e){if(this._connectionState!==e){var t=this._connectionState;this._connectionState=e,this.emit(Gk.CONNECTION_STATE_CHANGE,e,t)}}},{key:"quality",get:function(){return this._quality},set:function(e){var t=this;this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((function(){t.quality=t._quality/t._qualityRatio}),6e4))}},{key:"init",value:function(){var e=c(s().mark((function e(t,n){var r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(Gk.STATE_CHANGE,Zk.CONNECT_AP),this._connectInfo=t,r=this._cancelTokenSource.token,e.abrupt("return",(this._retryConfig=n,new by((function(e,a){i.on(Gk.CONNECTION_STATE_CHANGE,(function(t,n){t===Bk.CONNECTED&&e()})),i.requestAP(t,r,n).then((function(e){i.connectWorker(e)})).catch((function(e){a(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateConfig",value:function(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,lS.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Bk.CONNECTED&&this.inspectImage()}},{key:"requestAP",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$w("WEBCS_DOMAIN").map((function(e){return"https://".concat(e,"/api/v1")})),e.next=3,function(e,t,n,r){var i=t.appId,a=t.areaCode,o=t.cname,u=t.sid,l=t.token,d=t.uid;wx++;var f,p,h="moderation_plugin",v={service_name:h,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:wx,seq:wx,sid:u,appToken:l,ts:Date.now(),uid:d+""})},m=e[0];return mE(c(s().mark((function e(){var t,r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=Date.now(),e.next=3,ex(m,{data:v,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});case 3:if(t=e.sent,p=Date.now()-f,0===t.code){e.next=7;break}throw r=new ek(Oy.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+t.code,{retry:!0,responseTime:p}),lS.error(r.toString()),r;case 7:if(200===(i=JSON.parse(t.json_body)).code){e.next=11;break}throw a=new ek(Oy.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(i.code,", reason: ").concat(i.reason),{code:i.code,responseTime:p}),lS.error(a.toString()),a;case 11:if(i.servers&&Array.isArray(i.servers)&&0!==i.servers.length){e.next=14;break}throw o=new ek(Oy.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:i.code,responseTime:p}),lS.error(o.toString()),o;case 14:if(i.servers.some((function(e){return!!e.wss}))){e.next=17;break}throw c=new ek(Oy.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:i.code,responseTime:p}),lS.error(c.toString()),c;case 17:return u=$w("IMAGE_MODERATION_WORKER_HOST"),e.abrupt("return",{addressList:i.servers.map((function(e){var t=e.address,n=e.wss;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(u,":").concat(n,"/moderation")})).filter((function(e){return!!e})),workerToken:i.workerToken,vid:i.vid,ticket:i.appTicket,responseTime:p});case 19:case"end":return e.stop()}}),e)}))),(function(t,n){return bS.apworkerEvent(u,{success:!0,sc:200,serviceName:h,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1}),(function(t,n){return bS.apworkerEvent(u,{success:!1,sc:t.data&&t.data.code||200,serviceName:h,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==Oy.OPERATION_ABORTED&&t.code!==Oy.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(m=e[(n+1)%e.length],!0)}),r)}(i,t,n,r);case 3:return a=e.sent,this.emit(Gk.STATE_CHANGE,Zk.AP_CONNECTED),o=a.addressList,u=a.ticket,e.abrupt("return",(this._ticket=u,o));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"connectWorker",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.emit(Gk.STATE_CHANGE,Zk.CONNECT_WORKER),e.next=3,this._workerConnection.init(t,1e4);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleWorkerEvents",value:function(){var e=this;this._workerConnection.on(BS.CONNECTED,c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.emit(Gk.STATE_CHANGE,Zk.WORKER_CONNECTED,e._workerConnection.url),e.connectionState=Bk.CONNECTED;case 1:case"end":return t.stop()}}),t)})))),this._workerConnection.on(BS.CLOSED,(function(){e.connectionState=Bk.CLOSED})),this._workerConnection.on(BS.FAILED,(function(){e.connectionState=Bk.CLOSED})),this._workerConnection.on(BS.RECONNECTING,(function(){e.connectionState=e.connectionState===Bk.CONNECTED?Bk.RECONNECTING:Bk.CONNECTING})),this._workerConnection.on(BS.ON_MESSAGE,function(){var t=c(s().mark((function t(n){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.data instanceof ArrayBuffer?(r=gL(new Uint8Array(n.data)),$w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&lS.debug("[".concat(e._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),e._uploadNum++,void 0===r.code||0===r.code||(e._uploadFailedNum++,lS.error("[".concat(e._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),e._uploadTimer||(e._uploadTimer=window.setTimeout((function(){bS.reportApiInvoke(e._connectInfo.sid||null,{name:__.IMAGE_MODERATION_UPLOAD,options:[e._uploadFailedNum,e._uploadNum,r.code],tag:E_.TRACER}).onError(new ek(Oy.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),e._uploadTimer=null}),$w("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))):lS.error("[".concat(e._moderationId,"] Unexpected message type from worker"));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this._workerConnection.on(BS.WILL_RECONNECT,(function(e,t,n){"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(BS.REQUEST_NEW_URLS,(function(t,n){e.requestAP(e._connectInfo,e._cancelTokenSource.token,e._retryConfig).then(t).catch(n)}))}},{key:"requestToInspectImage",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=F_(this,Gk.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid},!t){e.next=11;break}if(t.isPlaying){e.next=4;break}return e.abrupt("return",void($w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&lS.debug("Only the track being played can be inspected")));case 4:return this._sequence++,e.next=7,this.generateRequestData(t,n);case 7:r=e.sent,this._workerConnection.sendMessage(r,!0,!0),e.next=12;break;case 11:$w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&lS.debug("Only the track being published can be inspected");case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"generateRequestData",value:function(){var e=c(s().mark((function e(t,r){var i,a,o,c,u,l,d,f,p,h,v,m,g,y;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.appId,a=r.cname,o=r.cid,c=r.vid,u=r.sid,l=r.uid,d=Date.now(),e.next=4,t.getCurrentFrameImage("image/jpeg",this.quality);case 4:return f=e.sent,e.next=7,FC(f,i,a);case 7:if(p=e.sent,h=this._sequence+"-"+o+"-"+l+"-"+d+"-"+rE(12,""),v={appId:i,cid:o,cname:a,deviceId:"",elapse:n.intToLong(Number(d-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:p,networkType:6,osType:7,requestId:h,sdkVersion:"4.19.1",sequence:this._sequence,sid:u,timestamp:HL(d),uid:l,vid:c,service:this._moderationMode,ticket:this._ticket},!((m=mL(v)).byteLength<this._workerMessageLengthLimit)){e.next=14;break}return $w("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&(g=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KL(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},v),delete g.jpg,lS.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(g))),e.abrupt("return",m);case 14:return y=this.quality*this._qualityRatio,this.quality=y,e.next=18,this.generateRequestData(t,{appId:i,cname:a,cid:o,vid:c,sid:u,uid:l});case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mw.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Bk.CLOSED,this.emit(Gk.STATE_CHANGE,Zk.CLOSED)}}],[{key:"intToLong",value:function(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}}]),n}(O_);function YL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YL(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var XL,QL=function(e){p(n,e);var t=h(n);function n(e,r,i){var a;return l(this,n),a=t.call(this,e,r),kf(f(a),"direction",void 0),kf(f(a),"store",void 0),kf(f(a),"peerConnection",void 0),kf(f(a),"transportEventReceiver",void 0),kf(f(a),"statsFilter",void 0),kf(f(a),"localCandidateCount",0),kf(f(a),"allCandidatesReceived",!1),kf(f(a),"mutex",new fE("P2PConnection-mutex")),kf(f(a),"dataChannel",void 0),kf(f(a),"onLocalCandidate",void 0),a.store=r,a.peerConnection=new RTCPeerConnection(n.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),a.direction=null!=i?i:VS.SEND_ONLY,a.dataChannel=a.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),a.statsFilter=nP(a.peerConnection,$w("STATS_UPDATE_INTERVAL"),void 0,Gy()?1200:void 0),a.bindPCEvents(),a.bindStatsEvents(),a.store.p2pId=a.store.p2pId+1,a}return d(n,[{key:"currentLocalDescription",get:function(){return this.peerConnection.currentLocalDescription}},{key:"currentRemoteDescription",get:function(){return this.peerConnection.currentRemoteDescription}},{key:"peerConnectionState",get:function(){return this.peerConnection.connectionState}},{key:"iceConnectionState",get:function(){return this.peerConnection.iceConnectionState}},{key:"dtlsTransportState",get:function(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}},{key:"establish",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=12;break}return e.next=4,this.peerConnection.setRemoteDescription({type:"offer",sdp:t});case 4:return e.next=6,this.peerConnection.createAnswer();case 6:return n=e.sent,e.next=9,this.peerConnection.setLocalDescription(n);case 9:if(n.sdp){e.next=11;break}throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");case 11:return e.abrupt("return",n.sdp);case 12:return e.next=14,this.peerConnection.createOffer();case 14:if((r=e.sent).sdp){e.next=17;break}throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");case 17:return e.next=19,this.peerConnection.setLocalDescription(r);case 19:return e.abrupt("return",r.sdp);case 22:throw e.prev=22,e.t0=e.catch(0),new o_(Oy.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.t0.toString());case 25:case"end":return e.stop()}}),e,this,[[0,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.setRemoteDescription({type:"answer",sdp:t});case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.t0.toString()));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRemoteCandidate",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.addIceCandidate(t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new o_(Oy.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.t0.toString()));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"send",value:function(){var e=c(s().mark((function e(t){var n,r,i,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=[],t.forEach((function(e){var t=a.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});n.push(t)})),e.t0=Gy()&&!0===$w("SIMULCAST"),!e.t0){e.next=7;break}return e.next=7,this.applySimulcastForFirefox(n,t);case 7:return e.next=9,this.applySimulcastEncodings(n,t);case 9:return e.next=11,this.applySendEncodings(n,t);case 11:return e.next=13,this.peerConnection.createOffer();case 13:return r=e.sent,e.next=16,this.peerConnection.setLocalDescription(r);case 16:if(r.sdp){e.next=18;break}throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");case 18:return i=n.map((function(e){var t=a.getLocalSSRC(e.mid,r.sdp);if(!t)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:e.mid,localSSRC:[{ssrcId:t}]}})),e.abrupt("return",{sdp:r.sdp,trackMessage:i});case 22:throw e.prev=22,e.t1=e.catch(0),e.t1 instanceof o_?e.t1:new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.t1.toString()));case 25:case"end":return e.stop()}}),e,this,[[0,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopSending",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.mutex.lock("From P2PConnection.stopSending");case 6:e.t0=e.sent;case 7:if(r=e.t0,e.prev=8,i=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),i.length===t.length){e.next=12;break}throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));case 12:return i.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e),o.peerConnection.removeTrack(e.sender)})),e.next=15,this.peerConnection.createOffer();case 15:return a=e.sent,e.next=18,this.peerConnection.setLocalDescription(a);case 18:if(a.sdp){e.next=20;break}throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");case 20:return e.abrupt("return",a.sdp);case 23:throw e.prev=23,e.t1=e.catch(8),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.t1.toString()));case 26:return e.prev=26,r&&r(),e.finish(26);case 29:case"end":return e.stop()}}),e,this,[[8,23,26,29]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"receive",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 3:return e.next=5,this.peerConnection.createAnswer();case 5:if((i=e.sent).sdp){e.next=8;break}throw new Error("Cannot get answer sdp when trying to receive track.");case 8:return e.next=10,this.peerConnection.setLocalDescription(i);case 10:if(lS.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")),void 0!==(a=this.getRemoteMid(r,n))){e.next=14;break}throw new Error("Cannot get transceiver mid when trying to receive track.");case 14:if(o=this.peerConnection.getTransceivers().find((function(e){return e.mid===a})),o&&null!==o.mid){e.next=17;break}throw new Error("Cannot get transceiver after setLocalDescription.");case 17:return e.abrupt("return",{track:o.receiver.track,mid:o.mid,sdp:i.sdp});case 20:throw e.prev=20,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.t0.toString()));case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"setDescription",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"remote"!==t){e.next=13;break}return e.next=4,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 4:return e.next=6,this.peerConnection.createAnswer();case 6:if((r=e.sent).sdp){e.next=9;break}throw new Error("Cannot get answer sdp when trying to receive track.");case 9:return e.next=11,this.peerConnection.setLocalDescription(r);case 11:return lS.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(t)),e.abrupt("return",r.sdp);case 13:return e.next=15,this.peerConnection.setRemoteDescription({type:"answer",sdp:n});case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(e.t0.toString()));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"stopReceiving",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.peerConnection.getTransceivers().filter((function(e){return-1!==t.indexOf(e.mid)})),r.length===t.length){e.next=4;break}throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");case 4:return r.map((function(e){var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)})),e.next=7,this.peerConnection.setRemoteDescription({type:"offer",sdp:n});case 7:return e.next=9,this.peerConnection.createAnswer();case 9:return i=e.sent,e.next=12,this.peerConnection.setLocalDescription(i);case 12:if(i.sdp){e.next=14;break}throw new Error("Cannot get answer sdp when trying to receive track.");case 14:return e.abrupt("return",i.sdp);case 17:throw e.prev=17,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"restartICE",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peerConnection.createOffer({iceRestart:!0});case 3:if((t=e.sent).sdp){e.next=6;break}throw new Error("Cannot restartICE because restart offer SDP does not exist.");case 6:return this.store.descriptionStart(),e.next=9,this.peerConnection.setLocalDescription(t);case 9:return e.abrupt("return",t.sdp);case 12:throw e.prev=12,e.t0=e.catch(0),new o_(Oy.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.t0.toString()));case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}},{key:"getStats",value:function(){return this.statsFilter.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){return this.statsFilter.getVideoIsReady(e)}},{key:"updateEncoderConfig",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateSendParameters",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().filter((function(e){return e.mid===t})),e.t0=1===r.length,!e.t0){e.next=12;break}if(!this.isVP8Simulcast(n)){e.next=10;break}if(e.t1=Gy(),e.t1){e.next=8;break}return e.next=8,this.applySimulcastEncodings(r,[n]);case 8:e.next=12;break;case 10:return e.next=12,this.applySendEncodings(r,[n]);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStatsRemoteVideoIsReady",value:function(e,t){this.statsFilter.setVideoIsReady2(e,t)}},{key:"replaceTrack",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.peerConnection.getTransceivers().find((function(e){return e.mid===n})),e.t0=r,!e.t0){e.next=5;break}return e.next=5,r.sender.replaceTrack(t._mediaStreamTrack);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getSelectedCandidatePair",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.peerConnection.getReceivers()).length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair())){e.next=4;break}return n=t[0].transport.iceTransport,r=n.getSelectedCandidatePair(),i=r.local,a=r.remote,e.abrupt("return",{local:JL(JL({},VD),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:JL(JL({},VD),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})});case 4:return e.abrupt("return",this.statsFilter.getSelectedCandidatePair());case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"bindPCEvents",value:function(){var e=this;this.peerConnection.oniceconnectionstatechange=function(){var t;null===(t=e.onICEConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=function(){var t;null===(t=e.onConnectionStateChange)||void 0===t||t.call(e,e.peerConnection.connectionState)},this.peerConnection.onicecandidate=function(t){var n;t.candidate&&(null===(n=e.onLocalCandidate)||void 0===n||n.call(e,t.candidate)),t.candidate?e.localCandidateCount+=1:(e.peerConnection.onicecandidate=null,e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] local candidate count"),e.localCandidateCount))},setTimeout((function(){e.allCandidatesReceived||(e.allCandidatesReceived=!0,lS.debug("[".concat(e.store.clientId,"] [pc-").concat(e.store.p2pId,"] onicecandidate timeout, local candidate count"),e.localCandidateCount))}),$w("CANDIDATE_TIMEOUT"))}},{key:"unbindPCEvents",value:function(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}},{key:"tryBindTransportEvents",value:function(e){var t=this,n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=function(){var e;null!=n&&n.state&&(null===(e=t.onDTLSTransportStateChange)||void 0===e||e.call(t,n.state))},n.onerror=function(e){var n;null===(n=t.onDTLSTransportError)||void 0===n||n.call(t,"error"in e?e.error:e)};var r=n.iceTransport;r&&(r.onstatechange=function(){var e,r=null==n?void 0:n.iceTransport.state;r&&(null===(e=t.onICETransportStateChange)||void 0===e||e.call(t,r))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=function(){if(r.getSelectedCandidatePair()){var e=r.getSelectedCandidatePair(),n=e.local,i=e.remote;lS.info("[".concat(t.store.clientId,"] [pc-").concat(t.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}},{key:"tryUnbindTransportEvents",value:function(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}},{key:"updateRtpSenderEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.peerConnection.getSenders().find((function(e){return e.track===t._mediaStreamTrack}))),n){e.next=3;break}return e.abrupt("return",lS.warn("[".concat(t.getTrackId(),"] no rtpSender found}")));case 3:if(!this.isVP8Simulcast(t)){e.next=5;break}return e.abrupt("return",lS.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings"));case 5:if(OI().supportSetRtpSenderParameters){e.next=7;break}return e.abrupt("return",lS.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters"));case 7:i={},a={},e.t0=t._optimizationMode,e.next="motion"===e.t0?11:"detail"===e.t0?13:15;break;case 11:return i.degradationPreference="maintain-framerate",e.abrupt("break",16);case 13:return i.degradationPreference="maintain-resolution",e.abrupt("break",16);case 15:i.degradationPreference="balanced";case 16:return t._encoderConfig&&(c=t._encoderConfig,u=c.bitrateMax,l=c.frameRate,d=c.scaleResolutionDownBy,u&&(a.maxBitrate=1e3*u),$i(o=t._hints).call(o,zT.LOW_STREAM)&&(l&&(a.maxFramerate=DN(l)),d&&d>=1&&(a.scaleResolutionDownBy=d))),$w("DSCP_TYPE")&&t_()&&(p=$w("DSCP_TYPE"),$i(f=["very-low","low","medium","high"]).call(f,p)&&(a.networkPriority=p)),h=n.getParameters(),v=null===(r=h.encodings)||void 0===r?void 0:r[0],Gy()&&!v&&(i.encodings=[a]),v&&Object.assign(v,a),Object.assign(h,i),lS.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),e.next=25,n.setParameters(h);case 25:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySendEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,OI().supportSetRtpSenderParameters){e.next=3;break}return e.abrupt("return");case 3:if(t.length===n.length){e.next=5;break}return e.abrupt("return");case 5:r=0;case 6:if(!(r<t.length)){e.next=15;break}if(i=t[r],a=n[r],e.t0=a instanceof GC&&!this.isVP8Simulcast(a),!e.t0){e.next=12;break}return e.next=12,this.updateRtpSenderEncodings(a,i.sender);case 12:r++,e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(0),lS.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."));case 20:case"end":return e.stop()}}),e,this,[[0,17]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"mungSendOfferSDP",value:function(e,t,n){var r=this,i=vD.parse(e);return t.forEach((function(e,t){var a=n[t],o=i.mediaDescriptions.find((function(e){return e.attributes.mid===a}));o&&(SD(o,e),RD(o,e,r.store.codec))})),vD.print(i)}},{key:"bindStatsEvents",value:function(){var e=this;this.statsFilter.onFirstAudioReceived=function(t){var n;null===(n=e.onFirstAudioReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoReceived=function(t){var n;null===(n=e.onFirstVideoReceived)||void 0===n||n.call(e,t)},this.statsFilter.onFirstAudioDecoded=function(t){var n;null===(n=e.onFirstAudioDecoded)||void 0===n||n.call(e,t)},this.statsFilter.onFirstVideoDecoded=function(t,n,r){var i;null===(i=e.onFirstVideoDecoded)||void 0===i||i.call(e,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=function(t,n){var r;null===(r=e.onSelectedLocalCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=function(t,n){var r;null===(r=e.onSelectedRemoteCandidateChanged)||void 0===r||r.call(e,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=function(t){var n;null===(n=e.onFirstVideoDecodedTimeout)||void 0===n||n.call(e,t)}}},{key:"unbindStatsEvents",value:function(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}},{key:"applySimulcastForFirefox",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u,l,d,f,p,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(l=t[r],!((d=n[r])instanceof GC&&!$i(i=d._hints).call(i,zT.LOW_STREAM)&&null!==(a=d._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(o=d._encoderConfig)||void 0===o?void 0:o.bitrateMax)>200&&null!==(c=d._scalabilityMode)&&void 0!==c&&c.numSpatialLayers&&(null===(u=d._scalabilityMode)||void 0===u?void 0:u.numSpatialLayers)>1&&"vp8"===this.store.codec)){e.next=10;break}return f={},p={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4},f.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}],h=l.sender.getParameters(),e.next=10,l.sender.setParameters(Object.assign(h,f));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"applySimulcastEncodings",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Gy()||t.length!==n.length){e.next=13;break}r=0;case 2:if(!(r<t.length)){e.next=13;break}if(!((i=n[r])instanceof GC&&this.isVP8Simulcast(i))){e.next=10;break}return a=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4},o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}],u=a.sender.getParameters(),e.next=10,a.sender.setParameters(Object.assign(u,o));case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"isVP8Simulcast",value:function(e){var t,n,r,i,a;return!!(e instanceof GC&&$w("SIMULCAST")&&"vp8"===this.store.codec&&!$i(t=e._hints).call(t,zT.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}},{key:"logSDPExchange",value:function(e,t,n,r){var i=this;if($w("SDP_LOGGING"))return lS.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?function(e){i.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}},{key:"getLocalSSRC",value:function(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentLocalDescription)||void 0===r?void 0:r.sdp){var i,a=null===(i=vD.parse(t).mediaDescriptions.find((function(t){return t.attributes.mid===e})))||void 0===i?void 0:i.attributes.ssrcs;return null==a?void 0:a[0].ssrcId}}},{key:"getRemoteMid",value:function(e,t){var n,r,i;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp)return null===(i=vD.parse(t).mediaDescriptions.find((function(t){return t.attributes.ssrcs.some((function(t){return t.ssrcId===e}))})))||void 0===i?void 0:i.attributes.mid}},{key:"getRemoteSSRC",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=null!==(r=n)&&void 0!==r?r:null===(i=this.currentRemoteDescription)||void 0===i?void 0:i.sdp)){e.next=3;break}return o=null===(a=vD.parse(n).mediaDescriptions.find((function(e){return e.attributes.mid===t})))||void 0===a?void 0:a.attributes.ssrcs,e.abrupt("return",null==o?void 0:o[0].ssrcId);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()}],[{key:"resolvePCConfiguration",value:function(e){var t,r,i={iceServers:[]};return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(P_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&(t=i.iceServers).push.apply(t,m(n.turnServerConfigToIceServers(e.turnServer.servers))),$w("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&(r=i.iceServers).push.apply(r,m(n.turnServerConfigToIceServers(e.turnServer.serversFromGateway))),$w("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((function(e){e.forceturn&&(i.iceTransportPolicy="relay")})))),$w("ENABLE_ENCODED_TRANSFORM")&&OI().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}},{key:"turnServerConfigToIceServers",value:function(e){var t=[];return e.forEach((function(e){e.tcpport&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(NN(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"stun:".concat(e.turnServerURL,":").concat(e.tcpport)}))})),t}}]),n}(zk);function $L(e,t,n){var r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=c(s().mark((function e(){var n,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mutex,e.next=3,n.lock("From P2PConnection.".concat(t));case 3:for(i=e.sent,e.prev=4,a=u.length,o=new Array(a),c=0;c<a;c++)o[c]=u[c];return e.next=8,r.apply(this,o);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,i(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),n}function eM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eM(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([$L,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],QL.prototype,"establish",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],QL.prototype,"connect",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[RTCIceCandidate]),$S("design:returntype",by)],QL.prototype,"addRemoteCandidate",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],QL.prototype,"send",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[String,String,Number]),$S("design:returntype",by)],QL.prototype,"receive",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[String,String]),$S("design:returntype",by)],QL.prototype,"setDescription",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[Array,String]),$S("design:returntype",by)],QL.prototype,"stopReceiving",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],QL.prototype,"restartICE",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],QL.prototype,"close",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],QL.prototype,"updateEncoderConfig",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[String,yI]),$S("design:returntype",by)],QL.prototype,"updateSendParameters",null),QS([$L,$S("design:type",Function),$S("design:paramtypes",[yI,String]),$S("design:returntype",by)],QL.prototype,"replaceTrack",null),function(e){e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY"}(XL||(XL={}));var nM=function(e){p(n,e);var t=h(n);function n(e,r){var i;return l(this,n),i=t.call(this),kf(f(i),"store",void 0),kf(f(i),"statsUploader",void 0),kf(f(i),"sendConnection",void 0),kf(f(i),"recvConnection",void 0),kf(f(i),"localTrackMap",new Map),kf(f(i),"remoteUserMap",new Map),kf(f(i),"localDataChannels",[]),kf(f(i),"pendingLocalTracks",[]),kf(f(i),"pendingRemoteTracks",[]),kf(f(i),"statsCollector",void 0),kf(f(i),"dtlsFailedCount",0),kf(f(i),"sendMutex",new fE("P2PChannel2-send-mutex")),kf(f(i),"recvMutex",new fE("P2PChannel2-recv-mutex")),kf(f(i),"_state",Nk.Disconnected),kf(f(i),"_restartStates",["disconnected","failed"]),kf(f(i),"_restartTimer",void 0),kf(f(i),"handleMuteLocalTrack",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,l,d,p,h,v,m,g,y;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");case 2:if(a=e.sent,e.prev=3,i.sendConnection&&i.state===Nk.Connected){e.next=6;break}return e.abrupt("return",void r(new o_(Oy.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.")));case 6:if(0!==(o=i.filterTobeMutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:if(c=o.find((function(e){return"videoLowTrack"===e[0]})),c&&c[1].track._originMediaStreamTrack.stop(),l=!1,l="video"===t.trackMediaType?!(null===(d=i.localTrackMap.get(Ok.LocalAudioTrack))||void 0===d||!d.track._muted):void 0===(null===(p=i.localTrackMap.get(Ok.LocalVideoTrack))||void 0===p?void 0:p.id),h=o.filter((function(e){var t=u(e,2),n=t[0],r=t[1];return(n!==Ok.LocalAudioTrack||l)&&void 0!==r.id})).map((function(e){return u(e,2)[1]})),e.t0=h.length>0,!e.t0){e.next=20;break}return e.next=18,i.sendConnection.stopSending(h.map((function(e){return e.id})));case 18:v=e.sent,h.forEach((function(e){e.id=void 0,e.ssrcs=void 0}));case 20:return m=i.createMuteMessage(o),g="video"===t.trackMediaType?Wk.MUTE_LOCAL_VIDEO:Wk.MUTE_LOCAL_AUDIO,e.next=24,U_(f(i),xk.RequestP2PMuteLocal,{action:g,sdp:v,message:m,isMuteAll:l});case 24:if(y=e.sent,e.t1=y,!e.t1){e.next=29;break}return e.next=29,i.sendConnection.setDescription("local",y);case 29:if(e.t2=v||"audio"===t.trackMediaType,!e.t2){e.next=33;break}return e.next=33,j_(f(i),xk.RequestMuteLocal,m);case 33:n(),e.next=39;break;case 36:e.prev=36,e.t3=e.catch(3),r(e.t3);case 39:return e.prev=39,a(),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[3,36,39,42]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleUnmuteLocalTrack",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");case 2:if(a=e.sent,e.prev=3,i.sendConnection&&i.state===Nk.Connected){e.next=6;break}return e.abrupt("return",void r(new o_(Oy.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established.")));case 6:if(0!==(o=i.filterTobeUnmutedTracks(t)).length){e.next=9;break}return e.abrupt("return",void n());case 9:return c=i.createUnmuteMessage(o),u="video"===t.trackMediaType?Wk.UNMUTE_LOCAL_VIDEO:Wk.UNMUTE_LOCAL_AUDIO,e.next=12,j_(f(i),xk.RequestP2PMuteLocal,{action:u,message:c});case 12:n(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r(e.t0);case 18:return e.prev=18,a(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleUpdateVideoEncoder",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(Ok.LocalVideoTrack),i.sendConnection&&o&&o.track===t&&i.state===Nk.Connected){e.next=7;break}return e.abrupt("return",void n());case 7:if(c=o.id,u=o.track,e.t0=c,!e.t0){e.next=15;break}return e.next=12,i.sendConnection.updateSendParameters(c,u);case 12:return e.next=14,i.sendConnection.updateEncoderConfig(c,u);case 14:i.emit(xk.UpdateVideoEncoder,u);case 15:n(),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(3),r(e.t1);case 21:return e.prev=21,a(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[3,18,21,24]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleSetOptimizationMode",function(){var e=c(s().mark((function e(t,n,r){var a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");case 2:if(a=e.sent,e.prev=3,o=i.localTrackMap.get(Ok.LocalVideoTrack),i.sendConnection&&o&&o.track===t&&i.state===Nk.Connected){e.next=7;break}return e.abrupt("return");case 7:if(c=o.id,u=o.track,e.t0=c,!e.t0){e.next=12;break}return e.next=12,i.sendConnection.updateSendParameters(c,u);case 12:n(),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(3),r(e.t1);case 18:return e.prev=18,a(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()),kf(f(i),"handleReplaceTrack",function(){var e=c(s().mark((function e(t,n,r,a){var o,c,l,d,f,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("[".concat(i.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),e.t0="boolean"==typeof a&&a,e.t0){e.next=6;break}return e.next=5,i.sendMutex.lock("From P2PChannel2.handleReplaceTrack");case 5:o=e.sent;case 6:if(e.prev=6,l=Array.from(i.localTrackMap.entries()).find((function(e){var n=u(e,2)[1].track;return t===n})),i.sendConnection&&l&&void 0!==l[1].id&&i.state===Nk.Connected){e.next=10;break}return e.abrupt("return",void n());case 10:return e.next=12,null===(c=i.sendConnection)||void 0===c?void 0:c.replaceTrack(t,l[1].id);case 12:if(l[0]!==Ok.LocalVideoTrack||!OI().supportDualStreamEncoding){e.next=21;break}if(!(d=i.localTrackMap.get(Ok.LocalVideoLowTrack))){e.next=21;break}return f=t._mediaStreamTrack.clone(),d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,e.next=21,new by((function(e,t){i.handleReplaceTrack(d.track,e,t,!0)}));case 21:n(),e.next=27;break;case 24:e.prev=24,e.t1=e.catch(6),r(e.t1);case 27:return e.prev=27,null===(p=o)||void 0===p||p(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[6,24,27,30]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),kf(f(i),"handleGetLocalVideoStats",(function(e){e(i.statsCollector.getLocalVideoTrackStats())})),kf(f(i),"handleGetLocalAudioStats",(function(e){e(i.statsCollector.getLocalAudioTrackStats())})),kf(f(i),"handleGetRemoteVideoStats",(function(e){return i.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]})),kf(f(i),"handleGetRemoteAudioStats",(function(e){return i.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]})),i.store=e,i.statsCollector=r,i.statsCollector.addP2PChannel(f(i)),i.statsUploader=new DP,i.bindStatsUploaderEvents(),i}return d(n,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;this._state=e,this.emit(xk.StateChange,t,this._state)}},{key:"startP2PConnection",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.");case 1:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support connect.");case 1:case"end":return e.stop()}}),e)})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"startP2P",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=Nk.New,this.sendConnection&&(lS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(lS.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new QL(t,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new QL(t,this.store,VS.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),!n){e.next=8;break}return this.store.peerConnectionStart(),e.next=4,this.recvConnection.establish(n);case 4:return e.next=6,this.sendConnection.establish(n);case 6:return r=e.sent,e.abrupt("return",(this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=Nk.Connected,r));case 8:return e.next=10,this.recvConnection.establish(n);case 10:return e.abrupt("return",this.sendConnection.establish(n));case 11:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"p2pConnect",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.recvConnection){e.next=2;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");case 2:return this.store.peerConnectionStart(),e.next=5,this.recvConnection.connect(t);case 5:return e.next=7,this.sendConnection.connect(t);case 7:this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Nk.Connected;case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRemoteCandidate",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.recvConnection){e.next=2;break}throw new o_(Oy.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");case 2:return e.next=4,this.recvConnection.addRemoteCandidate(t);case 4:return e.next=6,this.sendConnection.addRemoteCandidate(t);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.state===Nk.Connected){e.next=4;break}return this.throwIfTrackTypeNotMatch(t),i=t.filter((function(e){return-1===c.pendingLocalTracks.indexOf(e)})),e.abrupt("return",void(this.pendingLocalTracks=this.pendingLocalTracks.concat(i)));case 4:if(this.store.pubId=this.store.pubId+1,TN.markPublishStart(this.store.clientId,this.store.pubId),0!==(a=this.filterTobePublishedTracks(t,n,r)).length){e.next=10;break}return e.next=9,this.tryToUnmuteAudio(t);case 9:return e.abrupt("return",void e.sent);case 10:return a.forEach((function(e){var t=e.track,n=e.type,r=Date.now();c.store.publish(t.getTrackId(),n===Ok.LocalAudioTrack?"audio":"video",r)})),this.bindLocalTrackEvents(a),o=this.createGatewayPublishMessage(a),e.abrupt("return",(this.assignLocalTracks(a),a.forEach((function(e){var t=e.track,n=e.type,r=Date.now();c.store.publish(t.getTrackId(),n===Ok.LocalAudioTrack?"audio":"video",void 0,r)})),o));case 13:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"dopublish",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return");case 2:if(!(n=this.localTrackMap.get(t))){e.next=23;break}return e.next=6,this.sendConnection.send([n.track]);case 6:return r=e.sent,i=r.sdp,a=r.trackMessage,o=a[0],c=o.mid,u=o.localSSRC,n.id=c,n.ssrcs=u,this.statsCollector.addLocalStats(t),this.statsUploader.startUploadUplinkStats(),e.next=15,U_(this,xk.RequestP2PPublish,{kind:t===Ok.LocalAudioTrack?Ck.AUDIO:Ck.VIDEO,sdp:i,ssrcId:u[0].ssrcId});case 15:return l=e.sent,e.next=18,this.sendConnection.setDescription("local",l);case 18:return d=this.createUnmuteMessage([[t,n]]),e.next=21,j_(this,xk.RequestUnmuteLocal,d);case 21:e.next=24;break;case 23:case 24:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setDescription",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("local"!==t){e.next=7;break}return e.next=3,this.sendMutex.lock("From P2PChannel.restartICE");case 3:r=e.sent,i=this.sendConnection,e.next=11;break;case 7:return e.next=9,this.recvMutex.lock("From P2PChannel.restartICE");case 9:r=e.sent,i=this.recvConnection;case 11:if(e.prev=11,i&&this.state===Nk.Connected){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,i.setDescription(t,n);case 16:return e.abrupt("return",e.sent);case 17:return e.prev=17,r(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[11,,17,20]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"publishLowStream",value:function(e){return lD(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support publishLowStream.");case 1:case"end":return e.stop()}}),e)})))()}},{key:"republish",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.pendingLocalTracks.length>0,!e.t0){e.next=7;break}return lS.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),e.next=5,U_(this,xk.RequestRePublish,this.pendingLocalTracks);case 5:this.emit(xk.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[];case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,l,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return",void(0===t.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((function(e){return!$i(t).call(t,e)}))));case 2:if(0!==(n=this.filterTobeUnpublishedTracks(t)).length){e.next=5;break}return e.abrupt("return");case 5:if(this.unbindLocalTrackEvents(n.map((function(e){var t=u(e,2);return{type:t[0],track:t[1].track}}))),r=n.filter((function(e){return void 0!==u(e,2)[1].id})),this.sendConnection&&this.state===Nk.Connected){e.next=9;break}return e.abrupt("return",void t.forEach((function(e){var t=d.pendingLocalTracks.indexOf(e);-1!==t&&d.pendingLocalTracks.splice(t,1)})));case 9:if(i=n.find((function(e){return"videoLowTrack"===e[0]})),i&&i[1].track.close(),o=this.createGatewayUnpublishMessage(n),e.t0=r.length>0,!e.t0){e.next=17;break}return e.next=16,this.sendConnection.stopSending(r.map((function(e){return u(e,2)[1].id})));case 16:a=e.sent;case 17:return this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map((function(e){var t=u(e,2);return{type:t[0],track:t[1].track}}))),n.forEach((function(e){var t=u(e,1)[0];d.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),l=this.createMuteMessage(n),e.next=24,by.all(l.map(function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j_(d,xk.RequestMuteLocal,[t]);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:return e.abrupt("return",{sdp:a,unpubMsg:o});case 25:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublishLowStream",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.");case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"doUnpublish",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,l,d,f=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendConnection&&this.state===Nk.Connected){e.next=2;break}return e.abrupt("return");case 2:if(n=[],t!==Ck.AUDIO&&(void 0!==(null==(r=this.localTrackMap.get(Ok.LocalVideoTrack))?void 0:r.id)&&n.push([Ok.LocalVideoTrack,r]),void 0!==(null==(i=this.localTrackMap.get(Ok.LocalVideoLowTrack))?void 0:i.id)&&n.push([Ok.LocalVideoLowTrack,i]),this.statsCollector.removeLocalStats(Ok.LocalVideoTrack),this.statsCollector.removeLocalStats(Ok.LocalVideoLowTrack)),t!==Ck.VIDEO&&(void 0!==(null==(a=this.localTrackMap.get(Ok.LocalAudioTrack))?void 0:a.id)&&n.push([Ok.LocalAudioTrack,a]),this.statsCollector.removeLocalStats(Ok.LocalAudioTrack)),!(n.length>0)){e.next=20;break}return e.next=8,this.sendConnection.stopSending(n.map((function(e){return u(e,2)[1].id})));case 8:return o=e.sent,n.forEach((function(e){var t=u(e,2)[1];t.id=void 0,t.ssrcs=void 0})),e.next=12,U_(this,xk.RequestP2PUnPublish,{sdp:o,kind:t});case 12:return l=e.sent,e.next=15,this.sendConnection.setDescription("local",l);case 15:return d=this.createMuteMessage(n),e.next=18,by.all(d.map(function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j_(f,xk.RequestMuteLocal,[t]);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:e.next=21;break;case 20:case 21:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection&&this.state===Nk.Connected){e.next=2;break}throw new o_(Oy.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");case 2:if(null===(a=this.remoteUserMap.get(t))||void 0===a||!a.has(n)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.recvConnection.receive(n,r,i);case 6:return o=e.sent,c=o.track,u=o.mid,l=o.sdp,n===Ck.AUDIO?(t._audioSSRC=i,t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new XC(c,t.uid,t._uintid,this.store),lS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new JC(c,t.uid,t._uintid,this.store),lS.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack)),(d=this.remoteUserMap.get(t))?d.set(n,u):this.remoteUserMap.set(t,new Map([[n,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),e.next=17,j_(this,xk.RequestP2PUnmuteRemote,n);case 17:return f=this.pendingRemoteTracks.findIndex((function(e){var r=e.user,i=e.kind;return r.uid===t.uid&&n===i})),e.abrupt("return",(-1!==f&&(this.pendingRemoteTracks.splice(f,1),this.emit(xk.MediaReconnectEnd,t.uid)),l));case 19:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=c(s().mark((function e(t,n,r,i){var a,o,c,l=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.pendingRemoteTracks.filter((function(e){var n=e.user,i=e.kind;return void 0!==r?n.uid===t.uid&&r===i:n.uid===t.uid})),a.forEach((function(e){var t=l.pendingRemoteTracks.indexOf(e);l.pendingRemoteTracks.splice(t,1)})),this.recvConnection&&this.state===Nk.Connected||i||a.forEach((function(e){var n,r=e.kind;if(r===Ck.AUDIO)null===(n=t._audioTrack)||void 0===n||n._destroy(),t._audioTrack=void 0;else if(r===Ck.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}})),this.recvConnection&&this.state===Nk.Connected){e.next=3;break}return e.abrupt("return");case 3:if(0!==(o=this.filterTobeUnSubscribedTracks(t,r)).length){e.next=6;break}return e.abrupt("return",void(r!==Ck.VIDEO&&j_(this,xk.RequestP2PMuteRemote,Ck.AUDIO)));case 6:return e.next=8,this.recvConnection.stopReceiving(o.map((function(e){return u(e,2)[1].id})),n);case 8:return c=e.sent,e.abrupt("return",(this.withdrawRemoteTracks(o),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),o.forEach((function(e){var t,n,r=u(e,2),a=r[0],o=r[1].kind;if(o===Ck.VIDEO&&a._videoSSRC&&(null===(t=l.recvConnection)||void 0===t||t.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),o===Ck.VIDEO)l.unbindRemoteTrackEvents(a._videoTrack),i||(null===(n=a._videoTrack)||void 0===n||n._destroy(),a._videoTrack=void 0);else if(o===Ck.AUDIO){var s;l.unbindRemoteTrackEvents(a._audioTrack),i||(null===(s=a._audioTrack)||void 0===s||s._destroy(),a._audioTrack=void 0)}})),o.filter((function(e){return u(e,2)[1].kind!==Ck.AUDIO})).forEach((function(e){var t=u(e,2)[1].kind;j_(l,xk.RequestP2PMuteRemote,t)})),r!==Ck.VIDEO&&j_(this,xk.RequestP2PMuteRemote,Ck.AUDIO),c));case 10:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"getAllDataChannels",value:function(){return this.localDataChannels}},{key:"massSubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support massSubscribe.");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massSubscribeNoLock",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribeNoLock",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.");case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"muteRemote",value:function(){var e=c(s().mark((function e(t,n){var r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,".")));case 5:if(r.get(n)){e.next=7;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(n,".")));case 7:void 0!==(i=n===Ck.VIDEO?t._videoSSRC:t._audioSSRC)&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1);case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemote",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.unmuteRemoteNoLock(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unmuteRemoteNoLock",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return");case 2:if(r=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",void lS.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,".")));case 5:r.get(n)||lS.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(n,"."));case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getAllTracks",value:function(e){var t=this.localTrackMap.get(Ok.LocalAudioTrack);if((null==t?void 0:t.track)instanceof wC){var n=t.track;return Array.from(this.localTrackMap.entries()).filter((function(e){return u(e,1)[0]!==Ok.LocalAudioTrack})).filter((function(t){var n=u(t,1)[0];return!(e&&n===Ok.LocalVideoLowTrack)})).map((function(e){return u(e,2)[1].track})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((function(t){var n=u(t,1)[0];return!(e&&n===Ok.LocalVideoLowTrack)})).map((function(e){return u(e,2)[1].track}))}},{key:"reportPublishEvent",value:function(e,t,n,r,i){if(e){var a=this.localTrackMap.get(Ok.LocalAudioTrack),o=r?this.localTrackMap.get(Ok.LocalVideoLowTrack):this.localTrackMap.get(Ok.LocalVideoTrack);bS.publish(this.store.sessionId,{eventElapse:TN.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(zT.SCREEN_TRACK)),audio:!!a,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);var c=n.find((function(e){return e instanceof _C})),u=r?null===(s=this.localTrackMap.get(Ok.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((function(e){return e instanceof GC}));bS.publish(this.store.sessionId,{eventElapse:TN.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==c?void 0:c.getTrackLabel(),videoName:null==u?void 0:u.getTrackLabel(),screenshare:-1!==(null==u?void 0:u._hints.indexOf(zT.SCREEN_TRACK)),audio:!!c,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}},{key:"reportSubscribeEvent",value:function(e,t,n,r){var i=r===Ck.VIDEO?n._videoSSRC:n._audioSSRC;i&&bS.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Ck.VIDEO,audio:r===Ck.AUDIO,peerid:n.uid,subscribeRequestid:r===Ck.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:TN.measureFromSubscribeStart(this.store.clientId,i)})}},{key:"reset",value:function(){lS.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new fE("P2PChannel2-send-mutex"),this.sendMutex=new fE("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();var e=this.localTrackMap.get(Ok.LocalAudioTrack);if((null==e?void 0:e.track)instanceof wC){if(e.track.trackList.length>0){var t=e.track;e.track.trackList.forEach((function(e){t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Nk.Disconnected}},{key:"getStats",value:function(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}},{key:"getRemoteVideoIsReady",value:function(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}},{key:"getLocalAudioVolume",value:function(){var e=this.localTrackMap.get(Ok.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}},{key:"getLocalVideoSize",value:function(){var e=this.localTrackMap.get(Ok.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}},{key:"getEncoderConfig",value:function(e){var t=this.localTrackMap.get(e);return t&&t.track instanceof GC||t&&t.track instanceof _C?t.track._encoderConfig:void 0}},{key:"getLocalMedia",value:function(e){return this.localTrackMap.get(e)}},{key:"hasLocalMedia",value:function(){return this.localTrackMap.size>0}},{key:"hasRemoteMedia",value:function(e,t){if(!e)return this.remoteUserMap.size>0;var n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}},{key:"hasRemoteMediaWithLock",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",this.remoteUserMap.size>0);case 2:return r=this.remoteUserMap.get(t),e.abrupt("return",!!r&&(!n||r.has(n)));case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteMedia",value:function(e){var t,n=Array.from(xf(t=this.remoteUserMap).call(t)).find((function(t){return t.uid===e}));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}},{key:"getAudioLevels",value:function(){var e=Array.from(this.remoteUserMap.entries()).map((function(e){var t=u(e,1)[0];return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(Ok.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_p(e).call(e,(function(e,t){return e.level-t.level})),e}},{key:"disconnectForReconnect",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sendConnection&&this.recvConnection&&(lS.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Nk.Reconnecting,$w("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var t,n=u(e,1)[0];n._videoTrack&&n._videoTrack._player&&(null===(t=n._videoTrack._player.getVideoElement())||void 0===t||t.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((function(e){var n,r=u(e,2),i=r[0],a=r[1].track;switch(i){case Ok.LocalVideoTrack:$i(n=a._hints).call(n,zT.LOW_STREAM)?a.close():t.pendingLocalTracks.push(a);break;case Ok.LocalAudioTrack:a instanceof wC?t.pendingLocalTracks=t.pendingLocalTracks.concat(a.trackList):t.pendingLocalTracks.push(a);case Ok.LocalVideoLowTrack:}})),this.emit(xk.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((function(e){var n=u(e,2),r=n[0],i=n[1];Array.from(xf(i).call(i)).forEach((function(e){t.setPendingRemoteMedia(r,e)})),t.emit(xk.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),lS.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hasPendingRemoteMedia",value:function(e,t){var n,r=o(this.pendingRemoteTracks);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.user,s=i.kind;if((e instanceof eD?e.uid:e)===a.uid&&t===s)return!0}}catch(c){r.e(c)}finally{r.f()}return!1}},{key:"setPendingRemoteMedia",value:function(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}},{key:"restartICE",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.direction!==VS.SEND_ONLY){e.next=6;break}return e.next=3,this.sendMutex.lock("From P2PChannel.restartICE");case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,this.recvMutex.lock("From P2PChannel.restartICE");case 8:e.t0=e.sent;case 9:return n=e.t0,e.prev=10,e.next=13,t.restartICE();case 13:return r=e.sent,e.next=16,U_(this,xk.RequestP2PRestartICE,r);case 16:i=e.sent,t.setDescription("local",i);case 18:return e.prev=18,n(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[10,,18,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getUplinkNetworkQuality",value:function(){if(!this.sendConnection)return 0;var e=this.sendConnection.getStats(),t=this.localTrackMap.get(Ok.LocalVideoTrack),n=this.localTrackMap.get(Ok.LocalAudioTrack),r=e.videoSend.find((function(e){var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((function(e){var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;var a=F_(this,xk.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,f=null==t?void 0:t.track;if(f&&f._encoderConfig&&-1===f._hints.indexOf(zT.SCREEN_TRACK)){var p=f._encoderConfig.bitrateMax,h=e.bitrate.actualEncoded;if(p&&h){var v=(1e3*p-h)/(1e3*p);return kS[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][d]}}return d}},{key:"getDownlinkNetworkQuality",value:function(){var e=this;if(!this.recvConnection)return 0;var t=this.recvConnection.getStats(),n=0;return Array.from(this.remoteUserMap.entries()).forEach((function(r){var i=u(r,1)[0],a=i._audioSSRC,o=i._videoSSRC,s=t.audioRecv.find((function(e){return e.ssrc===a})),c=t.videoRecv.find((function(e){return e.ssrc===o}));if(s||c){var l=F_(e,xk.NeedSignalRTT),d=t.rtt,f=(d&&l?(d+l)/2:d||l)||0,p=s?s.jitterMs:void 0,h=t.recvPacketLossRate,v=.7*h*100/50+.3*f/1500;p&&(v=.6*h*100/50+.2*f/1500+.2*p/400),n+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}else n+=1})),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}},{key:"muteLocalTrack",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new by((function(e,r){n.handleMuteLocalTrack(t,e,r)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"filterTobePublishedTracks",value:function(e,t,n){var r=[],i=OI(),a=this.getAllTracks();e=W_(e=e.filter((function(e){return-1===a.indexOf(e)})));var s,c=!1,u=!1,l=o(e);try{for(l.s();!(s=l.n()).done;){var d=s.value;if(d instanceof GC&&(this.localTrackMap.has(Ok.LocalVideoTrack)||c?new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:Ok.LocalVideoTrack}),c=!0),t)){var f=this.getLowVideoTrack(d,n);r.push({track:f,type:Ok.LocalVideoLowTrack})}if(d instanceof _C){var p=this.localTrackMap.get(Ok.LocalAudioTrack);if(p){if(!(p.track instanceof wC))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(u){var h=r.find((function(e){return e.type===Ok.LocalAudioTrack}));if(!(h.track instanceof wC))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d)}else{if(!i.webAudioMediaStreamDest||d instanceof wC||d._bypassWebAudio)r.push({track:d,type:Ok.LocalAudioTrack});else{var v=new wC;v.addAudioTrack(d),r.push({track:v,type:Ok.LocalAudioTrack})}u=!0}}}}catch(m){l.e(m)}finally{l.f()}return r}},{key:"filterTobeUnpublishedTracks",value:function(e){var t=[],n=this.getAllTracks();e=W_(e=e.filter((function(e){return-1!==n.indexOf(e)})));var r,i=o(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a instanceof _C){var s=this.localTrackMap.get(Ok.LocalAudioTrack);if(!s)continue;s.track instanceof wC?(s.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===s.track.trackList.length&&(t.push([Ok.LocalAudioTrack,s]),s.track.close())):t.push([Ok.LocalAudioTrack,s])}if(a instanceof GC){var c=this.localTrackMap.get(Ok.LocalVideoTrack);if(!c)continue;t.push([Ok.LocalVideoTrack,c]);var u=this.localTrackMap.get(Ok.LocalVideoLowTrack);u&&t.push([Ok.LocalVideoLowTrack,u])}}}catch(l){i.e(l)}finally{i.f()}return t}},{key:"bindLocalTrackEvents",value:function(e){var t=this;e.forEach((function(e){var n=e.track;switch(e.type){case Ok.LocalVideoTrack:n.addListener(KT.GET_STATS,t.handleGetLocalVideoStats),n.addListener(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.addListener(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.addListener(KT.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.addListener(KT.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.addListener(KT.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.addListener(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.addListener(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case Ok.LocalAudioTrack:t.bindLocalAudioTrackEvents(n);case Ok.LocalVideoLowTrack:}}))}},{key:"bindLocalAudioTrackEvents",value:function(e,t){var n=this;e instanceof wC?e.trackList.forEach((function(e){e.addListener(KT.NEED_DISABLE_TRACK,n.handleMuteLocalTrack),e.addListener(KT.NEED_ENABLE_TRACK,n.handleUnmuteLocalTrack),e.addListener(KT.GET_STATS,n.handleGetLocalAudioStats),e.addListener(KT.NEED_MUTE_TRACK,n.handleMuteLocalTrack),e.addListener(KT.NEED_UNMUTE_TRACK,n.handleUnmuteLocalTrack)})):(e.addListener(KT.GET_STATS,this.handleGetLocalAudioStats),e.addListener(KT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(KT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(KT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(KT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(KT.NEED_REPLACE_TRACK,this.handleReplaceTrack))}},{key:"unbindLocalTrackEvents",value:function(e){var t=this;e||(e=Array.from(this.localTrackMap.entries()).map((function(e){var t=u(e,2),n=t[0];return{track:t[1].track,type:n}}))),e.forEach((function(e){var n=e.track;switch(e.type){case Ok.LocalVideoTrack:n.off(KT.GET_STATS,t.handleGetLocalVideoStats),n.off(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),n.off(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),n.off(KT.NEED_UPDATE_VIDEO_ENCODER,t.handleUpdateVideoEncoder),n.off(KT.SET_OPTIMIZATION_MODE,t.handleSetOptimizationMode),n.off(KT.NEED_REPLACE_TRACK,t.handleReplaceTrack),n.off(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),n.off(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack);break;case Ok.LocalAudioTrack:t.unbindLocalAudioTrackEvents(n);case Ok.LocalVideoLowTrack:}}))}},{key:"unbindLocalAudioTrackEvents",value:function(e){var t=this;e instanceof wC?e.trackList.forEach((function(e){e.off(KT.NEED_DISABLE_TRACK,t.handleMuteLocalTrack),e.off(KT.NEED_ENABLE_TRACK,t.handleUnmuteLocalTrack),e.off(KT.GET_STATS,t.handleGetLocalAudioStats),e.off(KT.NEED_MUTE_TRACK,t.handleMuteLocalTrack),e.off(KT.NEED_UNMUTE_TRACK,t.handleUnmuteLocalTrack)})):(e.off(KT.GET_STATS,this.handleGetLocalAudioStats),e.off(KT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(KT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(KT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(KT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(KT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}},{key:"bindRemoteTrackEvents",value:function(e,t){var n=this;t instanceof JC&&t.addListener(KT.GET_STATS,(function(t){t(n.handleGetRemoteVideoStats(e))})),t instanceof XC&&t.addListener(KT.GET_STATS,(function(t){t(n.handleGetRemoteAudioStats(e))}))}},{key:"unbindRemoteTrackEvents",value:function(e){e&&e.removeAllListeners(KT.GET_STATS)}},{key:"unbindAllRemoteTrackEvents",value:function(){var e=this;Array.from(this.remoteUserMap.entries()).forEach((function(t){var n=u(t,2),r=n[0],i=n[1];i.has(Ck.AUDIO)&&e.unbindRemoteTrackEvents(r._audioTrack),i.has(Ck.VIDEO)&&e.unbindRemoteTrackEvents(r._videoTrack)}))}},{key:"createGatewayPublishMessage",value:function(e){var t=this;return e.map((function(e){var n,r,i,a=e.track,o=e.type;switch(o){case Ok.LocalAudioTrack:r=hk.Audio,i={dtx:a instanceof EC&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ok.LocalVideoTrack:r=$i(n=a._hints).call(n,zT.SCREEN_TRACK)?hk.Screen:hk.High,i=tM(tM({},PN(a)),{},{codec:t.store.codec});break;case Ok.LocalVideoLowTrack:r=hk.Low,i=tM(tM({},PN(a)),{},{codec:t.store.codec})}return{kind:o===Ok.LocalAudioTrack?Ck.AUDIO:Ck.VIDEO,stream_type:r,attributes:i,isMuted:a.muted||!a.enabled}}))}},{key:"createGatewayUnpublishMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"assignLocalTracks",value:function(e){var t=this;e.forEach((function(e){var n=e.track,r=e.type;t.localTrackMap.set(r,{track:n})}))}},{key:"withdrawLocalTracks",value:function(e){var t=this;e.forEach((function(e){var n=u(e,1)[0];t.localTrackMap.delete(n)}))}},{key:"bindConnectionEvents",value:function(e){var t=this;e.onConnectionStateChange=function(){var n=c(s().mark((function n(r){var i,a;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),t.emit(xk.PeerConnectionStateChange,r),"connected"!==r||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),!$i(i=t._restartStates).call(i,r)&&e.direction!==VS.SEND_ONLY){n.next=7;break}if(!t._restartTimer){n.next=3;break}return n.abrupt("return");case 3:a=function(){"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(lS.debug("[".concat(t.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===F_(t,xk.QueryClientConnectionState)&&t.restartICE(e))},t._restartTimer=window.setTimeout((function(){a(),t._restartTimer=void 0}),800),n.next=8;break;case 7:case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.onICEConnectionStateChange=function(e){"connected"!==e||t.store.keyMetrics.iceConnectionEnd||t.store.iceConnectionEnd(),lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),bS.reportApiInvoke(t.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:E_.TRACER}).onSuccess(),t.emit(xk.IceConnectionStateChange,e)},e.onICETransportStateChange=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=function(e){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=function(e){var n,r,i=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));i&&(t.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(eI.FIRST_FRAME_DECODED),bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_AUDIO_DECODE,pS.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId}))},e.onFirstAudioReceived=function(e){var n,r=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._audioSSRC===e}));r&&bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_AUDIO_RECEIVED,pS.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onFirstVideoDecoded=function(e,n,r){t.reportVideoFirstFrameDecoded(e,n,r)},e.onFirstVideoReceived=function(e){var n,r=Array.from(xf(n=t.remoteUserMap).call(n)).find((function(t){return t._videoSSRC===e}));r&&bS.firstRemoteFrame(t.store.sessionId,fS.FIRST_VIDEO_RECEIVED,pS.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:TN.measureFromSubscribeStart(t.store.clientId,e),subscribeRequestid:e,p2pid:t.store.p2pId})},e.onSelectedLocalCandidateChanged=function(e,n){var r="relay"===e.candidateType,i="relay"===n.candidateType;"unknown"!==n.candidateType&&r===i||t.emit(xk.ConnectionTypeChange,r),lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(BN(n))," -> ").concat(JSON.stringify(BN(e)),")"))},e.onSelectedRemoteCandidateChanged=function(e,n){lS.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(BN(n))," -> ").concat(JSON.stringify(BN(e)),")"))},e.onFirstVideoDecodedTimeout=function(e){t.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=function(e){t.emit(xk.LocalCandidate,e)}}},{key:"unbindConnectionEvents",value:function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}},{key:"filterTobeMutedTracks",value:function(e){var t=[];if(-1===this.getAllTracks().indexOf(e))return t;var n=this.localTrackMap.get(Ok.LocalAudioTrack);if(e instanceof _C&&(null==n?void 0:n.track)instanceof wC)return n.track.isActive||t.push([Ok.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=u(t,2)[1].track;return e===n}));if(r&&(t.push(r),r[0]===Ok.LocalVideoTrack)){var i=this.localTrackMap.get(Ok.LocalVideoLowTrack);i&&t.push([Ok.LocalVideoLowTrack,i])}return t}},{key:"filterTobeUnmutedTracks",value:function(e){var t=[],n=this.localTrackMap.get(Ok.LocalAudioTrack);if(e instanceof _C&&(null==n?void 0:n.track)instanceof wC)return n.track.isActive&&t.push([Ok.LocalAudioTrack,n]),t;var r=Array.from(this.localTrackMap.entries()).find((function(t){var n=u(t,2)[1].track;return e===n}));if(r)if(r[0]===Ok.LocalVideoTrack){t.push(r);var i=this.localTrackMap.get(Ok.LocalVideoLowTrack);i&&t.push([Ok.LocalVideoLowTrack,i])}else t.push(r);return t}},{key:"createMuteMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"createUnmuteMessage",value:function(e){return e.map((function(e){var t,n,r=u(e,2),i=r[0],a=r[1],o=a.track,s=a.ssrcs,c=a.id;switch(i){case Ok.LocalAudioTrack:n=hk.Audio;break;case Ok.LocalVideoTrack:n=$i(t=o._hints).call(t,zT.SCREEN_TRACK)?hk.Screen:hk.High;break;case Ok.LocalVideoLowTrack:n=hk.Low}return{stream_type:n,ssrcs:s,mid:c}}))}},{key:"filterTobeUnSubscribedTracks",value:function(e,t){var n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){var i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((function(t){var r=u(t,2),i=r[0],a=r[1];n.push([e,{kind:i,id:a}])}));return n}},{key:"createUnsubscribeMessage",value:function(e){var t=[];return e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1],a=i.kind;switch(i.id,a){case Ck.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Ck.VIDEO,ssrcId:r._videoSSRC}));case Ck.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Ck.AUDIO,ssrcId:r._audioSSRC}))}})),t}},{key:"withdrawRemoteTracks",value:function(e){var t=this;e.forEach((function(e){var n=u(e,2),r=n[0],i=n[1].kind,a=t.remoteUserMap.get(r);a&&(a.delete(i),0===Array.from(a.entries()).length&&t.remoteUserMap.delete(r))}))}},{key:"updateBitrateLimit",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.localTrackMap.get(Ok.LocalVideoTrack),r=this.localTrackMap.get(Ok.LocalVideoLowTrack),e.t0=n,!e.t0){e.next=5;break}return e.next=5,n.track.setBitrateLimit(t.uplink);case 5:if(e.t1=r&&t.low_stream_uplink,!e.t1){e.next=9;break}return e.next=9,r.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isP2PDisconnected",value:function(){if(this.sendConnection&&this.recvConnection){var e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}},{key:"tryToUnmuteAudio",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=13;break}if(!(t[n]instanceof _C)){e.next=10;break}if(0!==(r=this.filterTobeUnmutedTracks(t[n])).length){e.next=6;break}return e.abrupt("continue",10);case 6:return i=this.createUnmuteMessage(r),e.next=9,j_(this,xk.RequestUnmuteLocal,i);case 9:return e.abrupt("return",void e.sent);case 10:n++,e.next=1;break;case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"bindStatsUploaderEvents",value:function(){var e=this;this.statsUploader.requestStats=function(t){return e.getStats(t)},this.statsUploader.requestLocalMedia=function(){return Array.from(e.localTrackMap.entries()).filter((function(e){return!!u(e,2)[1].ssrcs}))},this.statsUploader.requestRemoteMedia=function(){return Array.from(e.remoteUserMap.entries())},this.statsUploader.requestVideoIsReady=function(t){var n;return!(null===(n=e.recvConnection)||void 0===n||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=function(t,n){return e.emit(xk.RequestUploadStats,t,n)},this.statsUploader.requestAllTracks=function(){return e.getAllTracks()}}},{key:"unbindStatsUploaderEvents",value:function(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}},{key:"requestReconnect",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dtlsFailedCount+=1,e.next=3,nE(vE(this.dtlsFailedCount,hE));case 3:this.emit(xk.RequestReconnect);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reconnectP2P",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"canPublishLowStream",value:function(){return this.localTrackMap.has(Ok.LocalVideoTrack)||this.pendingLocalTracks.some((function(e){return e instanceof GC}))}},{key:"throwIfTrackTypeNotMatch",value:function(e){if(e.filter((function(e){return e instanceof GC})).length>1)throw new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((function(e){return e instanceof _C})).length>1&&(e.some((function(e){return e instanceof _C&&e._bypassWebAudio}))||!OI().webAudioMediaStreamDest))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r instanceof GC&&this.pendingLocalTracks.some((function(e){return e instanceof GC})))throw new o_(Oy.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof _C&&this.pendingLocalTracks.some((function(e){return e instanceof _C}))&&(!OI().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((function(e){return e instanceof _C&&e._bypassWebAudio}))))throw new o_(Oy.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}catch(i){n.e(i)}finally{n.f()}}},{key:"getLowVideoTrack",value:function(e,t){var n,r=!$w("DISABLE_DUAL_STREAM_USE_ENCODING")&&OI().supportDualStreamEncoding,i=tM(tM({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():vP(e,i);var a=rE(8,"track-low-"),o=new GC(n,tM(tM({},r&&{scaleResolutionDownBy:VN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(QT.TRANSCEIVER_UPDATED,(function(t){e._updateRtpTransceiver(t,YT.LOW_STREAM)})),o._hints.push(zT.LOW_STREAM),e.addListener(KT.NEED_CLOSE,(function(){o.close()})),o}},{key:"globalLock",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.recvMutex.lock("From P2PChannel2.globalLock"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"reportVideoFirstFrameDecoded",value:function(e,t,n,r){var i,a=Array.from(xf(i=this.remoteUserMap).call(i)).find((function(t){return t._videoSSRC===e}));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());var o=this.store.keyMetrics,s=o.subscribe.find((function(e){return e.userId===a.uid&&"video"===e.type}));bS.firstRemoteVideoDecode(this.store.sessionId,fS.FIRST_VIDEO_DECODE,pS.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:TN.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}},{key:"remoteMediaSsrcChanged",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recvConnection){e.next=2;break}return e.abrupt("return",!1);case 2:if(i=this.remoteUserMap.get(t)){e.next=5;break}return e.abrupt("return",!1);case 5:if(a=i.get(n)){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.recvConnection.getRemoteSSRC(a);case 10:return o=e.sent,e.abrupt("return",void 0!==o&&o!==r);case 12:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"resetConnection",value:function(e){lS.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===Nk.Connected?(lS.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}},{key:"publishDataChannel",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublishDataChannel",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unsubscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"hasPendingRemoteDataChannel",value:function(e,t){throw new o_(Oy.NOT_SUPPORTED)}},{key:"setPendingRemoteDataChannel",value:function(e,t){throw new o_(Oy.NOT_SUPPORTED)}},{key:"preConnect",value:function(){var e=c(s().mark((function e(t,n,r,i,a,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t,n,r,i,a,o){return e.apply(this,arguments)}return t}()},{key:"getEstablishParams",value:function(){throw new o_(Oy.NOT_SUPPORTED)}},{key:"reSubscribe",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateVideoStreamParameter",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o_(Oy.NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unbindRtpTransceiver",value:function(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((function(e){var t=u(e,2),n=t[0],r=t[1].track;n===Ok.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,YT.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}}]),n}(O_);function rM(e){return function(t,n,r){var i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=c(s().mark((function t(){var r,a,o,c,u,l,d,f=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=f.length,a=new Array(r),o=0;o<r;o++)a[o]=f[o];t.t0=e,t.next=t.t0===XL.SEND_ONLY?4:t.t0===XL.RECEIVE_ONLY?14:24;break;case 4:return t.next=6,this.sendMutex.lock("From P2PChannel2.".concat(n));case 6:return c=t.sent,t.prev=7,t.next=10,i.apply(this,a);case 10:case 20:case 33:return t.abrupt("return",t.sent);case 11:return t.prev=11,c(),t.finish(11);case 14:return t.next=16,this.recvMutex.lock("From P2PChannel2.".concat(n));case 16:return u=t.sent,t.prev=17,t.next=20,i.apply(this,a);case 21:return t.prev=21,u(),t.finish(21);case 24:return t.next=26,this.sendMutex.lock("From P2PChannel2.".concat(n));case 26:return l=t.sent,t.next=29,this.recvMutex.lock("From P2PChannel2.".concat(n));case 29:return d=t.sent,t.prev=30,t.next=33,i.apply(this,a);case 34:return t.prev=34,l(),d(),t.finish(34);case 37:case"end":return t.stop()}}),t,this,[[7,,11,14],[17,,21,24],[30,,34,37]])}))),r}}function iM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iM(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}QS([rM(),$S("design:type",Function),$S("design:paramtypes",[Object,String]),$S("design:returntype",by)],nM.prototype,"startP2P",null),QS([rM(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],nM.prototype,"p2pConnect",null),QS([rM(XL.SEND_ONLY),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],nM.prototype,"dopublish",null),QS([rM(XL.SEND_ONLY),$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],nM.prototype,"unpublish",null),QS([rM(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],nM.prototype,"unpublishLowStream",null),QS([rM(XL.SEND_ONLY),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],nM.prototype,"doUnpublish",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String,String,Number]),$S("design:returntype",by)],nM.prototype,"subscribe",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String,String,Boolean]),$S("design:returntype",by)],nM.prototype,"unsubscribe",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],nM.prototype,"muteRemote",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],nM.prototype,"unmuteRemote",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String]),$S("design:returntype",by)],nM.prototype,"hasRemoteMediaWithLock",null),QS([rM(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],nM.prototype,"disconnectForReconnect",null),QS([rM(XL.RECEIVE_ONLY),$S("design:type",Function),$S("design:paramtypes",[eD,String,Number]),$S("design:returntype",by)],nM.prototype,"remoteMediaSsrcChanged",null);var oM=Date.now(),sM=20,cM=new Map,uM=new Map;function lM(e){return dM.apply(this,arguments)}function dM(){return dM=c(s().mark((function e(t){var n,r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=cM.get(t),r=Array.isArray(n)&&n[n.length-1],i=uM.get(t),r){e.next=3;break}return e.abrupt("return",void(i.isSyncing=!1));case 3:a={uid:r.uid,payload:X_(r.payload)},0===i.firstRecvTs&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs),o=r.sendTs-i.firstSendTs,(c=o-(Date.now()-i.firstRecvTs))>0&&(i.firstRecvTs=Date.now()-o),(u=r.mediaDelay+c)<=0?(n.pop(),fM(r.context,a),u=0):u=Math.min(u,sM),setTimeout((function(){return n.length&&lM(t)}),u);case 9:case"end":return e.stop()}}),e)}))),dM.apply(this,arguments)}function fM(e,t){e.safeEmit(S_.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function pM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return fM(n,{uid:e.uid,payload:X_(e.payload)});var r="".concat(n.id,"-").concat(e.uid),i=cM.get(r)||[],a=i.findIndex((function(t){return e.sendTs>=t.sendTs})),o=aM(aM({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===a?i.push(o):i.splice(a,0,o),cM.set(r,i);var s,c=!1;uM.has(r)?c=!(null===(s=uM.get(r))||void 0===s||!s.isSyncing):uM.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||lM(r)}function hM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hM(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}fE.setLogger(lS);var mM=function(e){p(n,e);var t=h(n);function n(e){var i,a;if(l(this,n),i=t.call(this),kf(f(i),"store",void 0),kf(f(i),"_uid",void 0),kf(f(i),"_channelName",void 0),kf(f(i),"_uintUid",void 0),kf(f(i),"_users",[]),kf(f(i),"_config",void 0),kf(f(i),"_clientId",void 0),kf(f(i),"_appId",void 0),kf(f(i),"_sessionId",null),kf(f(i),"_key",void 0),kf(f(i),"_joinInfo",void 0),kf(f(i),"_gateway",void 0),kf(f(i),"_statsCollector",void 0),kf(f(i),"_configDistribute",void 0),kf(f(i),"_leaveMutex",new fE("client-leave")),kf(f(i),"_publishMutex",new fE("client-publish")),kf(f(i),"_renewTokenMutex",new fE("client-renewtoken")),kf(f(i),"_subscribeMutex",new fE("client-subscribe")),kf(f(i),"_encryptionMode","none"),kf(f(i),"_encryptionSecret",null),kf(f(i),"_encryptionSalt",null),kf(f(i),"_proxyServer",void 0),kf(f(i),"_turnServer",{servers:[],mode:"auto"}),kf(f(i),"_cloudProxyServerMode","disabled"),kf(f(i),"_isDualStreamEnabled",!1),kf(f(i),"_defaultStreamFallbackType",void 0),kf(f(i),"_lowStreamParameter",void 0),kf(f(i),"_streamFallbackTypeCacheMap",new Map),kf(f(i),"_remoteStreamTypeCacheMap",new Map),kf(f(i),"_axiosCancelSource",Mw.CancelToken.source()),kf(f(i),"_audioVolumeIndicationInterval",void 0),kf(f(i),"_networkQualityInterval",void 0),kf(f(i),"_userOfflineTimeout",void 0),kf(f(i),"_streamRemovedTimeout",void 0),kf(f(i),"_injectStreamingClient",void 0),kf(f(i),"_liveTranscodeStreamingClient",void 0),kf(f(i),"_liveRawStreamingClient",void 0),kf(f(i),"_channelMediaRelayClient",void 0),kf(f(i),"_networkQualitySensitivity","normal"),kf(f(i),"_p2pChannel",void 0),kf(f(i),"_useLocalAccessPoint",!1),kf(f(i),"_setLocalAPVersion",void 0),kf(f(i),"_joinAndNotLeaveYet",!1),kf(f(i),"_numberOfJoinCount",0),kf(f(i),"_remoteDefaultVideoStreamType",void 0),kf(f(i),"_inspect",void 0),kf(f(i),"_moderation",void 0),kf(f(i),"_license",void 0),kf(f(i),"_pendingPublishedUsers",[]),kf(f(i),"ntpAlignErrorCount",0),kf(f(i),"remoteInboundOffset",0),kf(f(i),"_handleLocalTrackEnable",(function(e,t,n){i.publish(e,!1).then(t).catch(n)})),kf(f(i),"_handleLocalTrackDisable",(function(e,t,n){i.unpublish(e).then(t).catch(n)})),kf(f(i),"_handleUserOnline",(function(e){if($w("BLOCK_LOCAL_CLIENT")&&IS(e.uid,i.channelName))lS.debug("[".concat(e.uid,"] will be ignored in local"));else{i.isStringUID&&"string"!=typeof e.uid&&lS.error("[".concat(i._clientId,"] StringUID is Mixed with UintUID"));var t=i._users.find((function(t){return t.uid===e.uid}));if(t)t._trust_in_room_=!0;else{var n=new eD(e.uid,e.uint_id||e.uid);i._users.push(n),lS.debug("[".concat(i._clientId,"] user online"),e.uid),i.safeEmit(S_.USER_JOINED,n)}}})),kf(f(i),"_handleUserOffline",(function(e){if(!$w("BLOCK_LOCAL_CLIENT")||!IS(e.uid,i.channelName)){var t=i._users.find((function(t){return t.uid===e.uid}));t&&(i._handleRemoveStream(e),i._handleRemoveDataChannels(e),q_(i._users,t),i._remoteStreamTypeCacheMap.delete(t.uid),i._streamFallbackTypeCacheMap.delete(t.uid),lS.debug("[".concat(i._clientId,"] user offline"),e.uid,"reason:",e.reason),i.safeEmit(S_.USER_LEAVED,t,e.reason))}})),kf(f(i),"_handleAddAudioOrVideoStream",(function(e,t,n,r,a,o,s){if(!$w("BLOCK_LOCAL_CLIENT")||!IS(t,i.channelName)){var c=i._users.find((function(e){return e.uid===t}));if(c){lS.debug("[".concat(i._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),i.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now());var u="audio"===e?c.hasAudio:c.hasVideo;c._uintid||(c._uintid=a||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==r&&(c._cname=r),o&&(c._audioOrtc=o)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==r&&(c._cname=r),void 0!==s&&(c._rtxSsrcId=s),o&&(c._videoOrtc=o)),("audio"===e?c.hasAudio:c.hasVideo)&&!u&&(lS.info("[".concat(i._clientId,"] remote user ").concat(c.uid," published ").concat(e)),i.safeEmit(S_.USER_PUBLISHED,c,e)),"video"===e?bS.onGatewayStream(i._sessionId,fS.ON_ADD_VIDEO_STREAM,pS.ON_ADD_VIDEO_STREAM,{peer:a||t,ssrc:c._videoSSRC}):bS.onGatewayStream(i._sessionId,fS.ON_ADD_AUDIO_STREAM,pS.ON_ADD_AUDIO_STREAM,{peer:a||t,ssrc:c._audioSSRC}),i._p2pChannel.remoteMediaSsrcChanged(c,e,n).then((function(t){if(t&&(lS.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),i._p2pChannel instanceof jP))return i._p2pChannel.unsubscribe(c,e,!0).then((function(){return i._subscribe(c,e,!0).catch((function(e){lS.error("[".concat(i._clientId,"] resubscribe error"),e.toString())}))}))})),i._p2pChannel.hasPendingRemoteMedia(c,e)&&(lS.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),i._subscribe(c,e,!0).catch((function(e){lS.error("[".concat(i._clientId,"] resubscribe error"),e.toString())})))}else lS.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)"))}})),kf(f(i),"_handleRemoveStream",(function(e,t,n){if(!$w("BLOCK_LOCAL_CLIENT")||!IS(e.uid,i.channelName)){var r=i._users.find((function(t){return t.uid===e.uid}));if(r){lS.debug("[".concat(i._clientId,"] stream removed with uid ").concat(e.uid));var a=function(){};if(r.hasAudio&&r.hasVideo?a=function(){lS.info("[".concat(i._clientId,"] remote user ").concat(r.uid," unpublished audio track")),i.safeEmit(S_.USER_UNPUBLISHED,r,"audio"),lS.info("[".concat(i._clientId,"] remote user ").concat(r.uid," unpublished video track")),i.safeEmit(S_.USER_UNPUBLISHED,r,"video")}:r.hasVideo?a=function(){lS.info("[".concat(i._clientId,"] remote user ").concat(r.uid," unpublished video track")),i.safeEmit(S_.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(a=function(){lS.info("[".concat(i._clientId,"] remote user ").concat(r.uid," unpublished audio track")),i.safeEmit(S_.USER_UNPUBLISHED,r,"audio")}),r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,i._p2pChannel instanceof jP)i._p2pChannel.unsubscribe(r).then((function(e){if(e)return i._gateway.unsubscribe(e,r.uid)}));else if(t&&n)if(e.sdp){var o=e.sdp;i._p2pChannel.unsubscribe(r,o).then((function(e){e&&t(e)})).catch(n)}else t&&t();r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0,bS.onGatewayStream(i._sessionId,fS.ON_REMOVE_STREAM,pS.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),a()}else lS.warning("[".concat(i._clientId,"] can not find target user!(on_remove_stream)"))}})),kf(f(i),"_handleSetStreamLocalEnable",(function(e,t,n){if(!$w("BLOCK_LOCAL_CLIENT")||!IS(t,i.channelName)){var r=i._users.find((function(e){return e.uid===t}));if(r){lS.debug("[".concat(i._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));var a="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;var o=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===o)return;var s=r._audio_enabled_?"enable-local-audio":"disable-local-audio";lS.debug("[".concat(i._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(s)),i.safeEmit(S_.USER_INFO_UPDATED,t,s)}else{r._trust_video_enabled_state_=!0;var c=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===c)return;var u=r._video_enabled_?"enable-local-video":"disable-local-video";lS.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(u)),i.safeEmit(S_.USER_INFO_UPDATED,t,u)}var l="audio"===e?r.hasAudio:r.hasVideo;return a!==l?!a&&l?(lS.info("[".concat(i._clientId,"] remote user ").concat(t," published ").concat(e)),void i.safeEmit(S_.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,i._p2pChannel.muteRemote(r,e),lS.info("[".concat(i._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void i.safeEmit(S_.USER_UNPUBLISHED,r,e)):void 0}lS.error("[".concat(i._clientId,"] can not find target user!(disable_local)"))}})),kf(f(i),"_handleMuteStream",(function(e,t,n,r,a,o){if(!$w("BLOCK_LOCAL_CLIENT")||!IS(e,i.channelName)){lS.debug("[".concat(i._clientId,"] receive mute message"),e,t,n);var s=i._users.find((function(t){return t.uid===e}));if(s){var c="audio"===t?s.hasAudio:s.hasVideo;if("audio"===t){s._trust_audio_mute_state_=!0;var u=s._audio_muted_;if(s._audio_muted_=n,s._audio_muted_===u)return;var l=s._audio_muted_?"mute-audio":"unmute-audio";lS.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(l)),i.safeEmit(S_.USER_INFO_UPDATED,e,l)}else{s._trust_video_mute_state_=!0;var d=s._video_muted_;if(s._video_muted_=n,s._video_muted_===d)return;var f=s._video_muted_?"mute-video":"unmute-video";lS.debug("[".concat(i._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(f)),i.safeEmit(S_.USER_INFO_UPDATED,e,f)}var p="audio"===t?s.hasAudio:s.hasVideo;if(c!==p){if(!c&&p)return i.store.useP2P||("audio"===t?s._audioSSRC:s._videoSSRC)?(lS.info("[".concat(i._clientId,"] remote user ").concat(e," published ").concat(t)),void i.safeEmit(S_.USER_PUBLISHED,s,t)):void lS.warning("[".concat(i._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&s._videoTrack&&s._videoTrack._destroy(),"audio"===t&&s._audioTrack,a&&o&&i._p2pChannel instanceof nM&&(r?i._p2pChannel.unsubscribe(s,r,t).then((function(e){a(e)})).catch(o):a()),i._p2pChannel.muteRemote(s,t),lS.info("[".concat(i._clientId,"] remote user ").concat(e," unpublished ").concat(t)),i.safeEmit(S_.USER_UNPUBLISHED,s,t)}}else lS.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e))}})),kf(f(i),"_handleP2PLost",function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lS.debug("[".concat(i._clientId,"] receive p2p lost"),t),parseInt(t.p2pid,10)!==i.store.p2pId){e.next=6;break}return e.next=4,i._p2pChannel.requestReconnect();case 4:e.next=7;break;case 6:lS.warning("[".concat(i._clientId,"] P2PLost stream not found"),t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),kf(f(i),"_handleTokenWillExpire",(function(){lS.debug("[".concat(i._clientId,"] received message onTokenPrivilegeWillExpire")),i.safeEmit(S_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),kf(f(i),"_handleBeforeUnload",(function(e){"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(i.leave(),lS.info("[".concat(i._clientId,"] auto leave onbeforeunload or pagehide")))})),kf(f(i),"_handleUpdateNetworkQuality",(function(){if("normal"!==i._networkQualitySensitivity)if(!navigator||void 0===navigator.onLine||navigator.onLine){var e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=i._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=i._p2pChannel.getDownlinkNetworkQuality(),i.safeEmit(S_.NETWORK_QUALITY,e)}else i.safeEmit(S_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6})})),kf(f(i),"_handleP2PAddAudioOrVideoStream",(function(e,t){var n=i._users.find((function(e){return e.uid===t}));if(n){lS.debug("[".concat(i._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),i.store.subscribe(n.uid,e,void 0,void 0,void 0,Date.now());var r="audio"===e?n.hasAudio:n.hasVideo;"audio"===e?n._trust_audio_stream_added_state_=!0:n._trust_video_stream_added_state_=!0,"audio"===e?n._audio_added_=!0:n._video_added_=!0,("audio"===e?n.hasAudio:n.hasVideo)&&!r&&(lS.info("[".concat(i._clientId,"] remote user ").concat(n.uid," published ").concat(e)),i.safeEmit(S_.USER_PUBLISHED,n,e)),i._p2pChannel.hasPendingRemoteMedia(n,e)&&(lS.debug("[".concat(i._clientId,"] resubscribe ").concat(e," for user ").concat(n.uid," after reconnect.")),i._subscribe(n,e,!0).catch((function(e){lS.error("[".concat(i._clientId,"] resubscribe error"),e.toString())})))}else lS.error("[".concat(i._clientId,"] can not find target user!(on_add_stream)"))})),i._config=e,i._clientId=rE(5,"client-"),i.store=new Kw(e.codec,e.audioCodec,e.mode,i._clientId),i.store.clientCreated(),e.proxyServer&&i.setProxyServer(e.proxyServer,!0),e.turnServer&&i.setTurnServer(e.turnServer,!0),lS.info("[".concat(i._clientId,"] Initializing AgoraRTC client v").concat(zw," build: ").concat(Jw,", mode: ").concat(i.mode,", codec: ").concat(i.codec)),e.clientRoleOptions)try{M_(e.clientRoleOptions),a=Object.assign({},e.clientRoleOptions)}catch(e){lS.warning("[".concat(i._clientId,"] ").concat(e.toString()))}return i._statsCollector=new RN(i.store),i._statsCollector.onStatsException=function(e,t,n){lS.debug("[".concat(i._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),i.safeEmit(S_.EXCEPTION,{code:e,msg:t,uid:n})},i._statsCollector.onUploadPublishDuration=function(e,t,n,r){var a=i._users.find((function(t){return t.uid===e}));a&&bS.peerPublishStatus(i._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:a._uintid})},i.store.useDataChannel=OI().supportDataChannel&&$w("SIGNAL_CHANNEL"),i.store.useP2P=$w("P2P"),i._gateway=new $N(i.store,{clientId:i._clientId,mode:i.mode,codec:i.codec,websocketRetryConfig:e.websocketRetryConfig||hE,httpRetryConfig:e.httpRetryConfig||hE,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:i._statsCollector,role:e.role,clientRoleOptions:a}),i._configDistribute=new Zx,i.store.useP2P?(i._p2pChannel=new nM(i.store,i._statsCollector),i._handleP2PEvents()):i._p2pChannel=new jP(i.store,i._statsCollector),i._handleP2PChannelEvents(),i._handleGatewayEvents(),i._handleGatewaySignalEvents(),r(i)}return d(n,[{key:"connectionState",get:function(){return this._gateway.state}},{key:"remoteUsers",get:function(){return this._users}},{key:"localTracks",get:function(){return this._p2pChannel.getAllTracks(!0)}},{key:"uid",get:function(){return this._uid}},{key:"channelName",get:function(){return this._channelName}},{key:"localDataChannels",get:function(){return this._p2pChannel.getAllDataChannels()}},{key:"mode",get:function(){return this._config.mode}},{key:"role",get:function(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}},{key:"codec",get:function(){return this._config.codec}},{key:"audioCodec",get:function(){return this._config.audioCodec||"opus"}},{key:"isStringUID",get:function(){return!!this._joinInfo&&!!this._joinInfo.stringUid}},{key:"__className__",get:function(){return"Client"}},{key:"joinMeta",value:function(){var e=c(s().mark((function e(t,n,r,i,a){var o,u,l,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!(d.length>5&&void 0!==d[5])||d[5],u=d.length>6&&void 0!==d[6]&&d[6],Qw("JOIN_GATEWAY_USE_443PORT_ONLY",o),Qw("JOIN_GATEWAY_USE_DUAL_DOMAIN",u),l=this._gateway.signal.websocket,e.abrupt("return",(l instanceof fT&&(l.use443PortOnly=o,l.tryDoubleDomain=u),function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d,f=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Iy.get(t)||Iy.set(t,[]),Cy.get(t)||Cy.set(t,n),Ry.get(t)||Ry.set(t,0),i=Iy.get(t),a=Cy.get(t),i&&a){e.next=4;break}throw new Error("concurrent: deferQueue or maxConcurrency is null");case 4:if(Ry.get(t)!==a){e.next=9;break}return o=Sy(),i.push(o),e.next=9,o.promise;case 9:for(Ry.set(t,Ry.get(t)+1),c=f.length,u=new Array(c>3?c-3:0),l=3;l<c;l++)u[l-3]=f[l];return e.next=13,r.apply(void 0,u);case 13:return d=e.sent,e.abrupt("return",(Ry.set(t,Ry.get(t)-1),Ry.get(t)===a-1&&i.length>0&&(i[0].resolve(),i.shift()),0===Ry.get(t)&&(Iy.set(t,[]),Cy.set(t,0),Ry.set(t,0)),d));case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()("client.join",$w("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,n,r,i,a)));case 4:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i,a){return e.apply(this,arguments)}return t}()},{key:"join",value:function(){var e=c(s().mark((function e(t,n,r,i,a){var o,c,u,l,d,f,p,h,v,m,g,y,_,E,b,w,S,k,T,I=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=++this._numberOfJoinCount,this.store.joinStart(),i&&(this.store.uid=i),c=Zw(),u=qw()?window.isSecureContext:"Browser Not Support",(qw()||c)&&window.isSecureContext||(l="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",lS.warning(l)),d=iE(),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),lS.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),f=bS.reportApiInvoke(d,{name:__.JOIN,options:[t,n,r,i],states:{isHttps:c,isSecureContext:u},tag:E_.TRACER}),bS.setAppId(t),e.prev=8,r||null===r){e.next=11;break}throw new ek(Oy.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));case 11:r&&d_(r,"token",1,2047),d_(t,"appid",1,2047),tk(n),i&&nk(i),a&&d_(a,"optionalInfo",1,2047),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),f.onError(e.t0),e.t0;case 17:if(lS.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(o)),!this._leaveMutex.isLocked){e.next=24;break}return lS.debug("[".concat(this._clientId,"] join: waiting leave operation")),e.next=21,this._leaveMutex.lock();case 21:e.t1=e.sent,(0,e.t1)(),lS.debug("[".concat(this._clientId,"] join: continue"));case 24:if(this._joinAndNotLeaveYet=!0,"DISCONNECTED"===this.connectionState){e.next=27;break}throw p=new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),f.onError(p),p;case 27:if(this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING",h=vM({clientId:this._clientId,appId:t,sid:this._sessionId,cname:n,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(h.stringUid=i,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"===this._encryptionMode||!this._encryptionSecret){e.next=37;break}return h.aesmode=this._encryptionMode,e.next=33,R_(this._encryptionSecret);case 33:if(h.aespassword=e.sent,this._joinAndNotLeaveYet){e.next=36;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 36:this._encryptionSalt&&(h.aessalt=this._encryptionSalt);case 37:if(this._startSession(this._sessionId,{channel:n,appId:t}),v=this._sessionId,setTimeout((function(){"CONNECTING"===I.connectionState&&v===I._sessionId&&bS.joinChannelTimeout(I._sessionId,5)}),5e3),e.prev=40,y=h.cloudProxyServer,$i(m=["proxy3","proxy4","proxy5"]).call(m,y)&&(_=$w("PROXY_SERVER_TYPE3"),Array.isArray(_)?h.proxyServer=_[0]:h.proxyServer=_),bS.setProxyServer(h.proxyServer),lS.setProxyServer(h.proxyServer),this.store.requestAPStart(),!h.stringUid||h.uid){e.next=54;break}return e.next=46,Ax(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||hE,this.store);case 46:return E=e.sent,lS.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(E)),h.uid=E,e.next=51,Cx(h,this._axiosCancelSource.token,this._config.httpRetryConfig||hE,!0,this.store);case 51:g=e.sent,e.next=57;break;case 54:return e.next=56,Cx(h,this._axiosCancelSource.token,this._config.httpRetryConfig||hE,!0,this.store);case 56:g=e.sent;case 57:if(this._joinAndNotLeaveYet){e.next=59;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 59:return this.store.requestAPEnd(),setTimeout((function(){I._configDistribute.startGetConfigDistribute(h,I._axiosCancelSource.token),I._configDistribute.on(Tk.UPDATE_BITRATE_LIMIT,(function(e){I._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=r||t,b=g.gatewayInfo,this._joinInfo=vM(vM({},h),{},{cid:b.cid,uid:h.uid?h.uid:b.uid,vid:b.vid,apResponse:b.res,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),e.next=64,this._joinGateway();case 64:if(w=e.sent,this._joinAndNotLeaveYet){e.next=67;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));case 67:return f.onSuccess(w),this._appId=t,this._channelName=h.cname,this._uid=w,this.store.uid=w,setTimeout((function(){I._networkQualityInterval&&window.clearInterval(I._networkQualityInterval),I._networkQualityInterval=window.setInterval(I._handleUpdateNetworkQuality,2e3),window.addEventListener(By()?"beforeunload":"pagehide",I._handleBeforeUnload)}),0),S=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid),e.abrupt("return",(lS.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(S)),setTimeout((function(){lS.startUpload()}),5e3),this.store.joinEnd(),T=this,$i(TS).call(TS,T)||TS.push(T),w));case 72:throw e.prev=72,e.t2=e.catch(40),(k=Array.isArray(e.t2)?e.t2[0]:e.t2)&&k.code===Oy.OPERATION_ABORTED?lS.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k):lS.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k),k.code!==Oy.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(k),k;case 76:case"end":return e.stop()}}),e,this,[[8,14],[40,72]])})));function t(t,n,r,i,a){return e.apply(this,arguments)}return t}()},{key:"_joinGateway",value:function(){var e=this;if(!this._joinInfo||!this._key)throw new ek(Oy.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!$w("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((function(e){return e})).catch((function(t){if(t.code===Oy.INIT_WEBSOCKET_TIMEOUT)return e._gateway.leave(!0,w_.FALLBACK),t;if(t.code===Oy.INIT_DATACHANNEL_TIMEOUT)return e._gateway.leave(!0,w_.FALLBACK),t;throw t})).then((function(t){if(t instanceof ek){if(t.code===Oy.INIT_WEBSOCKET_TIMEOUT){if(lS.info("[".concat(e._clientId,"] join timeout, fallback to proxy")),!e._joinInfo||!e._key)throw new ek(Oy.INVALID_OPERATION);e._joinInfo.cloudProxyServer="fallback",e._cloudProxyServerMode="fallback",e.store.cloudProxyServerMode="fallback";var n=$w("PROXY_SERVER_TYPE3");if(Array.isArray(n))if(e._joinInfo.apUrl){var r=/^https?:\/\/(.+?)(\/.*)?$/.exec(e._joinInfo.apUrl)[1].split("."),i=r.slice(r.length-2).join(".");n.forEach((function(t){e._joinInfo&&$i(t).call(t,i)&&(e._joinInfo.proxyServer=t)})),e._joinInfo.proxyServer||(e._joinInfo.proxyServer=n[0])}else e._joinInfo.proxyServer=n[0];else e._joinInfo.proxyServer=n;var a=$w("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&lS.setProxyServer(e._joinInfo.proxyServer),"443"!==$w("STATS_COLLECTOR_PORT").toString()&&bS.setProxyServer(e._joinInfo.proxyServer),bS.reportApiInvoke(e._sessionId,{name:__.JOIN_FALLBACK_TO_PROXY,options:[e._joinInfo.proxyServer],tag:E_.TRACER}).onSuccess(),e.safeEmit(S_.JOIN_FALLBACK_TO_PROXY,e._joinInfo.proxyServer),$w("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&e._joinInfo.turnServer.servers.forEach((function(e){"forceturn"in e&&(e.forceturn=!0)})),e._gateway.join(e._joinInfo,e._key)}if(lS.info("[".concat(e._clientId,"] join by datachannel timeout, fallback to websocket")),!e._joinInfo||!e._key)throw new ek(Oy.INVALID_OPERATION);return bS.reportApiInvoke(e._sessionId,{name:__.DATACHANNEL_FAILBACK,options:[e.store.clientId],tag:E_.TRACER}).onSuccess(),e._joinGateway()}return t})).then((function(e){return e}))}},{key:"leave",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return lS.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(By()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){var t=TS.indexOf(e);-1!==t&&TS.splice(t,1)}(this),e.next=3,this._leaveMutex.lock();case 3:if(t=e.sent,"DISCONNECTED"!==this.connectionState){e.next=6;break}return e.abrupt("return",(lS.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t()));case 6:return e.next=8,this._gateway.leave("CONNECTED"!==this.connectionState);case 8:lS.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t();case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,c,u,l=this,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(d.length>1&&void 0!==d[1])||d[1],Array.isArray(t)){e.next=5;break}if(t instanceof yI){e.next=4;break}return e.abrupt("return",this._publishDataChannel(t));case 4:t=[t];case 5:if(0!==t.length){e.next=7;break}throw new ek(Oy.INVALID_PARAMS,"param list is empty");case 7:if(r=t,"audience"!==this._gateway.role){e.next=10;break}throw new ek(Oy.INVALID_OPERATION,"audience can not publish stream");case 10:i=o(r),e.prev=11,i.s();case 13:if((a=i.n()).done){e.next=21;break}if((c=a.value)instanceof yI){e.next=17;break}throw new ek(Oy.INVALID_PARAMS,"parameter is not local track");case 17:if(c._enabled||!n){e.next=19;break}throw new ek(Oy.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()));case 19:e.next=13;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(11),i.e(e.t0);case 26:return e.prev=26,i.f(),e.finish(26);case 29:return lS.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=32,this._publishMutex.lock();case 32:return u=e.sent,e.next=35,this._configDistribute.awaitConfigDistributeComplete();case 35:return n&&r.forEach((function(e){var t=l._configDistribute.getBitrateLimit();e instanceof GC&&t&&e.setBitrateLimit(t.uplink)})),e.prev=36,e.next=39,this._publishHighStream(r);case 39:lS.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map((function(e){return"".concat(e.getTrackId()," ")})))),e.next=45;break;case 42:throw e.prev=42,e.t1=e.catch(36),lS.error("[".concat(this._clientId,"] publish error"),e.t1.toString()),e.t1;case 45:return e.prev=45,u(),e.finish(45);case 48:case"end":return e.stop()}}),e,this,[[11,23,26,29],[36,42,45,48]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_publishDataChannel",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u_(t.id,"id",0,65535,!0),s_(t.ordered,"ordered"),d_(t.metadata,"metadata",0,512),lS.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id)),e.next=3,this._publishMutex.lock();case 3:if(n=e.sent,e.prev=4,-1===this._p2pChannel.getAllDataChannels().findIndex((function(e){return e.id===t.id}))){e.next=7;break}throw new ek(Oy.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));case 7:if(this._joinInfo&&void 0!==this._uid){e.next=9;break}throw new ek(Oy.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");case 9:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=11;break}throw new ek(Oy.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));case 11:if("auto"!==this._turnServer.mode||!$w("FORCE_TURN")||$w("TURN_ENABLE_TCP")||$w("TURN_ENABLE_UDP")){e.next=13;break}throw new ek(Oy.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");case 13:return r=new wN(t),e.next=16,this._p2pChannel.publishDataChannel([r]);case 16:return e.prev=16,i={streamId:t.id,ordered:t.ordered,maxRetransmits:$w("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:r._originDataChannelId},e.next=20,this._gateway.publishDataChannel(this._uid,i,!0);case 20:e.next=26;break;case 22:if(e.prev=22,e.t0=e.catch(16),e.t0.code===Oy.DISCONNECT_P2P){e.next=26;break}throw e.t0;case 26:return e.next=28,r._waitTillOpen();case 28:return lS.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),e.abrupt("return",r);case 32:throw e.prev=32,e.t1=e.catch(4),lS.error("[".concat(this._clientId,"] publish datachannels error"),e.t1.toString()),e.t1;case 35:return e.prev=35,n(),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,32,35,38],[16,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unpublish",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");case 2:if(n=[],!t){e.next=13;break}if(!Array.isArray(t)){e.next=8;break}n=t,e.next=11;break;case 8:if(t instanceof yI){e.next=10;break}return e.abrupt("return",this._unpublishDataChannel([t]));case 10:n=[t];case 11:e.next=18;break;case 13:if(e.t0=this.store.useP2P,e.t0){e.next=17;break}return e.next=17,this._unpublishDataChannel();case 17:n=this._p2pChannel.getAllTracks(!0);case 18:return lS.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map((function(e){return"".concat(e.getTrackId()," ")}))," ")),e.next=21,this._publishMutex.lock();case 21:if(r=e.sent,e.prev=22,!(this._p2pChannel instanceof nM)){e.next=37;break}return e.next=26,this._p2pChannel.unpublish(n);case 26:if(!(i=e.sent)){e.next=35;break}return e.next=30,this._gateway.sendExtensionMessage(qk.UNPUBLISH,i);case 30:if(a=e.sent,e.t1=a,!e.t1){e.next=35;break}return e.next=35,this._p2pChannel.setDescription("local",a);case 35:e.next=45;break;case 37:return e.next=39,this._p2pChannel.unpublish(n);case 39:if(o=e.sent,e.t2=o,!e.t2){e.next=44;break}return e.next=44,this._gateway.unpublish(o,this._uid);case 44:lS.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map((function(e){return"".concat(e.getTrackId())}))));case 45:e.next=50;break;case 47:throw e.prev=47,e.t3=e.catch(22),lS.error("[".concat(this._clientId,"] unpublish error"),e.t3.toString()),e.t3;case 50:return e.prev=50,r&&r(),e.finish(50);case 53:case"end":return e.stop()}}),e,this,[[22,47,50,53]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_unpublishDataChannel",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&0!==t.length||(t=this._p2pChannel.getAllDataChannels()),lS.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map((function(e){return"".concat(e.id," ")}))," ")),e.next=3,this._publishMutex.lock();case 3:return n=e.sent,e.prev=4,e.next=7,this._p2pChannel.unpublishDataChannel(t);case 7:if(r=e.sent,e.t0=r,!e.t0){e.next=12;break}return e.next=12,this._gateway.unpublishDataChannel(r);case 12:lS.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map((function(e){return"".concat(e.id)})))),e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(4),lS.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.t1.toString()),e.t1;case 18:return e.prev=18,n&&n(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","datachannel"===n?this._subscribeDataChannel(t,r):this._subscribe(t,n));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"_subscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u_(n,"channelId",0,65535,!0),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe datachannel, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));case 4:if(this._users.find((function(e){return e===t}))){e.next=6;break}throw lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel");case 6:if(t.hasAudio||t.hasVideo||0!==t._dataChannels.length){e.next=8;break}throw lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ek(Oy.INVALID_REMOTE_USER,"user is not published");case 8:if(i=null===(r=t._dataChannels)||void 0===r?void 0:r.find((function(e){return e.id===n})),i){e.next=11;break}throw lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED);case 11:return e.next=13,this._subscribeMutex.lock();case 13:return a=e.sent,lS.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel")),e.prev=15,e.next=18,this._p2pChannel.subscribeDataChannel(t,[i]);case 18:if(!(o=e.sent)||!$i(o).call(o,i.id)){e.next=37;break}if(e.prev=20,i._originDataChannelId){e.next=23;break}throw lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED);case 23:return u={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(c=i.metadata)&&void 0!==c?c:""},e.next=26,this._gateway.subscribeDataChannel(t.uid,u,!0);case 26:e.next=37;break;case 28:if(e.prev=28,e.t0=e.catch(20),(null==e.t0?void 0:e.t0.code)===Oy.WS_ABORT){e.next=34;break}return e.next=33,this._p2pChannel.unsubscribeDataChannel(t,[i]);case 33:throw e.t0;case 34:return e.next=36,this._p2pChannel.unsubscribeDataChannel(t,[i]);case 36:this._p2pChannel.setPendingRemoteDataChannel(t,i.id);case 37:return e.next=39,i._waitTillOpen();case 39:return lS.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),e.abrupt("return",i);case 41:return e.prev=41,a(),e.finish(41);case 44:case"end":return e.stop()}}),e,this,[[15,,41,44],[20,28]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_p2pSubscribe",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c_(n,"mediaType",["audio","video"]),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:if(this._users.find((function(e){return e===t}))){e.next=7;break}throw i=new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel"),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),i;case 7:if(t.hasAudio||t.hasVideo){e.next=10;break}throw a=new ek(Oy.INVALID_REMOTE_USER,"user is not published"),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a;case 10:if(r||("audio"!==n||t.hasAudio)&&("video"!==n||t.hasVideo)){e.next=13;break}throw o=new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(n,", remote track is not published")),o;case 13:return e.next=15,this._subscribeMutex.lock();case 15:return c=e.sent,lS.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(n)),u="audio"===n?Ok.LocalAudioTrack:this._joinInfo.defaultVideoStream===JT.LOW_STREAM?Ok.LocalVideoLowTrack:Ok.LocalVideoTrack,e.prev=18,e.next=21,this._p2pChannel.hasRemoteMediaWithLock(t,n);case 21:if(!e.sent){e.next=26;break}return e.next=24,this._p2pChannel.unmuteRemote(t,n);case 24:e.next=31;break;case 26:if(this.store.subscribe(t.uid,n,Date.now()),e.t0=this._p2pChannel instanceof nM,!e.t0){e.next=31;break}return e.next=31,this._gateway.sendExtensionMessage(qk.SUBSCRIBE,{trackType:u});case 31:if(lS.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((function(e){lS.warning("[".concat(d._clientId,"] auto set fallback failed"),e)})),l="audio"===n?t._audioTrack:t._videoTrack){e.next=36;break}throw new ek(Oy.UNEXPECTED_ERROR,"can not find remote track in user object");case 36:return e.abrupt("return",l);case 39:throw e.prev=39,e.t1=e.catch(18),lS.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e.t1),e.t1;case 42:return e.prev=42,c(),e.finish(42);case 45:case"end":return e.stop()}}),e,this,[[18,39,42,45]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"_subscribe",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o,c,u,l,d,f,p,h,v=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._p2pChannel instanceof nM)){e.next=2;break}return e.abrupt("return",this._p2pSubscribe(t,n));case 2:if(c_(n,"mediaType",["audio","video"]),this._joinInfo){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream, not joined");case 4:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=6;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 6:if(this._users.find((function(e){return e===t}))){e.next=9;break}throw i=new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel"),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),i;case 9:if(t.hasAudio||t.hasVideo){e.next=12;break}throw a=new ek(Oy.INVALID_REMOTE_USER,"user is not published"),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a;case 12:if(r||("audio"!==n||t.hasAudio&&void 0!==t._audioSSRC)&&("video"!==n||t.hasVideo&&void 0!==t._videoSSRC)){e.next=15;break}throw o=new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED),lS.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(n,", remote track is not published")),o;case 15:return c="audio"===n?t._audioSSRC:t._videoSSRC,u="audio"===n?t._audioOrtc:t._videoOrtc,l="video"===n?t._rtxSsrcId:void 0,d={stream_type:"audio"===n?Ck.AUDIO:Ck.VIDEO,ssrcId:c},e.next=18,this._subscribeMutex.lock();case 18:return f=e.sent,lS.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(n)),e.prev=20,e.next=23,this._p2pChannel.hasRemoteMediaWithLock(t,n);case 23:if(!e.sent){e.next=28;break}return e.next=26,this._p2pChannel.unmuteRemote(t,n);case 26:e.next=55;break;case 28:return e.prev=28,void 0!==(p="audio"===n?t._audioSSRC:t._videoSSRC)&&p!==c&&(c=p,u="audio"===n?t._audioOrtc:t._videoOrtc,l="video"===n?t._rtxSsrcId:void 0,d={stream_type:"audio"===n?Ck.AUDIO:Ck.VIDEO,ssrcId:c}),TN.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,n,Date.now()),e.next=35,this._p2pChannel.subscribe(t,n,c,l,u);case 35:return e.prev=35,e.next=38,this._gateway.subscribe(t.uid,d,!0);case 38:e.next=49;break;case 40:if(e.prev=40,e.t0=e.catch(35),(null==e.t0?void 0:e.t0.code)===Oy.WS_ABORT){e.next=46;break}return e.next=45,this._p2pChannel.unsubscribe(t,n);case 45:throw e.t0;case 46:return e.next=48,this._p2pChannel.unsubscribe(t,n,!0);case 48:this._p2pChannel.setPendingRemoteMedia(t,n);case 49:this.store.subscribe(t.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,n),e.next=55;break;case 52:throw e.prev=52,e.t1=e.catch(28),this._p2pChannel.reportSubscribeEvent(!1,null==e.t1?void 0:e.t1.code,t,n),e.t1;case 55:if(lS.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((function(e){lS.warning("[".concat(v._clientId,"] auto set fallback failed"),e)})),h="audio"===n?t._audioTrack:t._videoTrack){e.next=59;break}throw new ek(Oy.UNEXPECTED_ERROR,"can not find remote track in user object");case 59:return e.abrupt("return",h);case 62:throw e.prev=62,e.t2=e.catch(20),lS.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e.t2),e.t2;case 65:return e.prev=65,f(),e.finish(65);case 68:case"end":return e.stop()}}),e,this,[[20,62,65,68],[28,52],[35,40]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"massSubscribe",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,c,l,d,f,p,h,v,g,y,_,E,b,w,S,k,T,I,C,R,A,O=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f_(t,"subscribeList"),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream, not joined");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));case 4:return n=Date.now(),r=new Map,e.next=8,this._subscribeMutex.lock();case 8:return i=e.sent,lS.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),a=(t=m(t)).map((function(e){return{user:e.user,mediaType:e.mediaType}})),e.next=13,this._p2pChannel.globalLock();case 13:c=e.sent,e.prev=14,d=s().mark((function e(){var n,i,o,c,u,l,d,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t[f],i=n.user,c_(o=n.mediaType,"mediaType",["audio","video"]),i){e.next=4;break}throw c=new ek(Oy.INVALID_PARAMS,"user property does not exist in subscribeList item"),lS.error("[".concat(O._clientId,"] user property does not exist in subscribeList item")),c;case 4:if(O._users.find((function(e){return e===i}))){e.next=8;break}return u=new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel"),lS.error("[".concat(O._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),a[f].error=u,t.splice(f,1),e.abrupt("return",0);case 8:if(("audio"!==o||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==o||i.hasVideo&&void 0!==i._videoSSRC)){e.next=12;break}return l=new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED),lS.error("[".concat(O._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote user is not published")),a[f].error=l,t.splice(f,1),e.abrupt("return",0);case 12:if(d=gk.Video|gk.LwoVideo,!(p=r.get(i))){e.next=20;break}if(!("video"===o?p&d:p&gk.Audio)){e.next=17;break}return t.splice(f,1),lS.warning("[".concat(O._clientId,"] repeat massSubscribe user:").concat(i.uid,", mediaType:").concat(o," twice")),e.abrupt("return",0);case 17:r.set(i,p|("video"===o?d:gk.Audio)),e.next=21;break;case 20:r.set(i,"video"===o?d:gk.Audio);case 21:case"end":return e.stop()}}),e)})),f=t.length-1;case 17:if(!(f>=0)){e.next=25;break}return e.delegateYield(d(),"t0",19);case 19:if(0!==e.t0){e.next=22;break}return e.abrupt("continue",22);case 22:f--,e.next=17;break;case 25:p=t.length-1;case 26:if(!(p>=0)){e.next=36;break}if(h=t[p],v=h.user,g=h.mediaType,y=gk.Video|gk.LwoVideo,!this._p2pChannel.hasRemoteMedia(v,g)){e.next=33;break}return e.next=31,this._p2pChannel.unmuteRemoteNoLock(v,g);case 31:_=r.get(v),r.set(v,"video"===g?_^y:_^gk.Audio),t.splice(p,1);case 33:p--,e.next=26;break;case 36:if(this.store.massSubscribe(t.map((function(e){return{userId:e.user.uid,type:e.mediaType}})),n),E=AE(l=Array.from(r.entries())).call(l,(function(e,t){var n=u(t,2),r=n[0],i=n[1];if(0===i)return e;var a={stream_id:r.uid,stream_type:i};return i&gk.Audio&&(a.audio_ssrc=r._audioSSRC),i&gk.Video&&(a.video_ssrc=r._videoSSRC),e.push(a),e}),[]),e.prev=38,e.t1=t.length>0,!e.t1){e.next=43;break}return e.next=43,this._p2pChannel.massSubscribeNoLock(t.map((function(e){var t=e.user,n=e.mediaType;return{user:t,mediaType:n,ssrcId:n===Ck.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===Ck.VIDEO?t._rtxSsrcId:void 0}})));case 43:if(b=new Map,!(E.length>0)){e.next=49;break}return e.next=47,this._gateway.subscribeAll(E,!0);case 47:((null==(w=e.sent)?void 0:w.users)||[]).forEach((function(e){var t=e.stream_id,n=e.video_error_code,r=e.audio_error_code,i=e.error_code;(n||r||i)&&b.set(t,{video_error_code:n,audio_error_code:r,error_code:i})}));case 49:if(!(Array.from(b.entries()).length>0)){e.next=53;break}return S=Array.from(b.entries()).map((function(e){var t,n=u(e,2),r=n[0],i=n[1];return i.error_code||i.video_error_code&&i.audio_error_code?t=void 0:i.video_error_code?t=Ck.VIDEO:i.audio_error_code&&(t=Ck.AUDIO),{user:O.remoteUsers.find((function(e){return e.uid===r})),mediaType:t}})),e.next=53,this._p2pChannel.massUnsubscribeNoLock(S);case 53:k=o(a);try{for(k.s();!(T=k.n()).done;)I=T.value,(C=b.get(I.user.uid))&&(R=C.error_code||"audio"===I.mediaType&&C.audio_error_code||"video"===I.mediaType&&C.video_error_code)&&(A=$k(R),lS.error("user:".concat(I.user.uid," mediaType:").concat(I.mediaType," has massSubscribe error ").concat(A.desc)),I.error=new ek(Oy.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(A.desc))),I.error||("video"===I.mediaType?I.track=I.user.videoTrack:I.track=I.user.audioTrack)}catch(N){k.e(N)}finally{k.f()}return e.abrupt("return",(this.store.massSubscribe(a.filter((function(e){return!e.error})).map((function(e){return{userId:e.user.uid,type:e.mediaType}})),void 0,Date.now()),a.forEach((function(e){var t;bS.subscribe(O.store.sessionId,{succ:!!e.error,ec:(null===(t=e.error)||void 0===t?void 0:t.code)||null,video:e.mediaType===Ck.VIDEO,audio:e.mediaType===Ck.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===Ck.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:O.store.p2pId,eventElapse:Math.floor(performance.now()-n)},!0)})),lS.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),a));case 58:return e.prev=58,e.t2=e.catch(38),e.next=62,this._p2pChannel.massUnsubscribeNoLock(t);case 62:throw e.t2;case 63:return e.prev=63,c(),i(),e.finish(63);case 66:case"end":return e.stop()}}),e,this,[[14,,63,66],[38,58]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unsubscribe",value:function(){var e=c(s().mark((function e(t,n,r){var i,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n&&!this.store.useP2P){e.next=5;break}if("datachannel"!==n){e.next=3;break}return e.abrupt("return",this._unsubscribeDataChannel(t,r));case 3:e.next=7;break;case 5:return e.next=7,this._unsubscribeDataChannel(t,r);case 7:if(n&&c_(n,"mediaType",["audio","video"]),this._joinInfo){e.next=9;break}throw new ek(Oy.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");case 9:if(this._users.find((function(e){return e===t}))){e.next=12;break}throw i=new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel"),lS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),i;case 12:return lS.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(n)),e.next=15,this._subscribeMutex.lock();case 15:if(a=e.sent,e.prev=16,!(this._p2pChannel instanceof nM)){e.next=22;break}return e.next=20,this._gateway.sendExtensionMessage(qk.UNSUBSCRIBE,{mediaType:n});case 20:e.next=30;break;case 22:return e.next=24,this._p2pChannel.unsubscribe(t,n);case 24:if(o=e.sent,e.t0=o,!e.t0){e.next=29;break}return e.next=29,this._gateway.unsubscribe(o,t.uid);case 29:lS.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(n));case 30:e.next=37;break;case 32:if(e.prev=32,e.t1=e.catch(16),e.t1.code!==Oy.DISCONNECT_P2P){e.next=36;break}return e.abrupt("return",void lS.warning("disconnecting p2p, abort unsubscribe request."));case 36:throw lS.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.t1.toString()),e.t1;case 37:return e.prev=37,a(),e.finish(37);case 40:case"end":return e.stop()}}),e,this,[[16,32,37,40]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"_unsubscribeDataChannel",value:function(){var e=c(s().mark((function e(t,n){var r,i,a,o,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&u_(n,"id",0,65535,!0),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");case 2:if(this._users.find((function(e){return e===t}))){e.next=5;break}throw r=new ek(Oy.INVALID_REMOTE_USER,"user is not in the channel"),lS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r;case 5:if("number"==typeof n?(a=t._dataChannels.find((function(e){return e.id===n})))&&(i=[a]):i=t._dataChannels,void 0!==i){e.next=9;break}throw o=new ek(Oy.REMOTE_USER_IS_NOT_PUBLISHED),lS.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(n,", remote datachannel is not published")),o;case 9:return lS.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map((function(e){return e.id})))),e.prev=10,e.next=13,this._p2pChannel.unsubscribeDataChannel(t,i);case 13:if(c=e.sent,e.t0=c,!e.t0){e.next=18;break}return e.next=18,this._gateway.unsubscribeDataChannel(c,t.uid);case 18:lS.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c)),e.next=26;break;case 21:if(e.prev=21,e.t1=e.catch(10),e.t1.code!==Oy.DISCONNECT_P2P){e.next=25;break}return e.abrupt("return",void lS.warning("disconnecting p2p, abort unsubscribe request."));case 25:throw lS.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.t1.toString()),e.t1;case 26:case"end":return e.stop()}}),e,this,[[10,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"massUnsubscribe",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f_(t,"unsubscribeList"),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");case 2:lS.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),t=m(t),n=new Map,r=s().mark((function e(){var r,a,c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t[i],a=r.user,c=r.mediaType,a){e.next=4;break}throw u=new ek(Oy.INVALID_PARAMS,"user property does not exist in unsubscribeList item"),lS.error("[".concat(o._clientId,"] user property does not exist in unsubscribeList item")),u;case 4:if(c_(c,"mediaType",["video","audio",void 0]),o._users.find((function(e){return e===a}))){e.next=8;break}return lS.warning("[".concat(o._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(i,1),e.abrupt("return",0);case 8:if(l=gk.Video|gk.LwoVideo,!n.has(a)){e.next=25;break}d=n.get(a),e.t0=c,e.next="video"===e.t0?14:"audio"===e.t0?16:18;break;case 14:return f=d&l,e.abrupt("break",19);case 16:return f=d&gk.Audio,e.abrupt("break",19);case 18:f=d&(gk.Audio|l);case 19:if(!f){e.next=22;break}return lS.warning("[".concat(o._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(i,1),e.abrupt("return",0);case 22:c?"audio"===c?n.set(a,d|gk.Audio):"video"===c&&n.set(a,d|l):n.set(a,d|gk.Audio|l),e.next=26;break;case 25:c?"audio"===c?n.set(a,gk.Audio):"video"===c&&n.set(a,l):n.set(a,gk.Audio|l);case 26:case"end":return e.stop()}}),e)})),i=t.length-1;case 6:if(!(i>=0)){e.next=14;break}return e.delegateYield(r(),"t0",8);case 8:if(0!==e.t0){e.next=11;break}return e.abrupt("continue",11);case 11:i--,e.next=6;break;case 14:return e.prev=14,e.next=17,this._p2pChannel.massUnsubscribe(t);case 17:if(a=e.sent,e.t1=a,!e.t1){e.next=22;break}return e.next=22,this._gateway.massUnsubscribe(a);case 22:lS.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((function(e){var t=e.user,n=e.mediaType;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e.next=30;break;case 25:if(e.prev=25,e.t2=e.catch(14),e.t2.code!==Oy.DISCONNECT_P2P){e.next=29;break}return e.abrupt("return",void lS.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request.")));case 29:throw lS.error("[".concat(this._clientId,"] massUnsubscribe error"),e.t2.toString()),e.t2;case 30:case"end":return e.stop()}}),e,this,[[14,25]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setLowStreamParameter",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(function(e){if(!e)throw new o_(Oy.INVALID_PARAMS);p_(e.width)||l_(e.width,"streamParameter.width"),p_(e.height)||l_(e.height,"streamParameter.height"),p_(e.framerate)||l_(e.framerate,"streamParameter.framerate"),p_(e.bitrate)||u_(e.bitrate,"streamParameter.bitrate")}(t),(!t.width&&t.height||t.width&&!t.height)&&lS.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),lS.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t)),(n=this._configDistribute.getLowStreamConfigDistribute())&&n.bitrate&&t.bitrate&&n.bitrate<t.bitrate&&(t.bitrate=n.bitrate),this._lowStreamParameter=t,!this._isDualStreamEnabled){e.next=4;break}return e.abrupt("return",this._p2pChannel.updateVideoStreamParameter(t,Ok.LocalVideoLowTrack));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"enableDualStream",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(OI().supportDualStream){e.next=2;break}throw bS.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ek(Oy.NOT_SUPPORTED,"Your browser is not support dual stream");case 2:if(!this._isDualStreamEnabled){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"Dual stream is already enabled");case 4:if(!this._p2pChannel.canPublishLowStream()){e.next=13;break}return e.prev=5,e.next=8,this._publishLowStream();case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(5),bS.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e.t0;case 13:this._isDualStreamEnabled=!0,bS.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),lS.info("[".concat(this._clientId,"] enable dual stream"));case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"disableDualStream",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isDualStreamEnabled){e.next=18;break}if(this._joinInfo){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 3:if(!this._p2pChannel.getLocalMedia(Ok.LocalVideoLowTrack)){e.next=17;break}return e.prev=4,e.next=7,this._p2pChannel.unpublishLowStream();case 7:if(t=e.sent,e.t0=t,!e.t0){e.next=12;break}return e.next=12,this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid);case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(4),bS.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e.t1;case 17:this._isDualStreamEnabled=!1,bS.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),lS.info("[".concat(this._clientId,"] disable dual stream"));case 18:case"end":return e.stop()}}),e,this,[[4,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setClientRole",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(function(e){c_(e,"role",["audience","host"])}(t),n&&M_(n),"rtc"!==this.mode){e.next=2;break}throw lS.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new ek(Oy.INVALID_OPERATION,"rtc mode can not use setClientRole");case 2:if(!n||!n.level||"host"!==t){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"host mode can not set audience latency level");case 4:if("audience"!==t||!this._p2pChannel.hasLocalMedia()){e.next=6;break}throw new ek(Oy.INVALID_OPERATION,"can not set client role to audience when publishing stream");case 6:return e.next=8,this._gateway.setClientRole(t,n);case 8:this._config.role=t,lS.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(n&&n.level));case 10:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getRemoteInboundOffset",value:function(){var e,t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;var n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}},{key:"getNtpWallTimeInMs",value:function(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}},{key:"setProxyServer",value:function(e,t){if(d_(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new ek(Oy.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,bS.setProxyServer(this._proxyServer),lS.setProxyServer(this._proxyServer),lS.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}},{key:"setTurnServer",value:function(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new ek(Oy.INVALID_OPERATION,"You have already set the proxy")}if(P_(e))return this._turnServer={servers:e,mode:"original-manual"},void lS.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((function(e){return e.urls})).join(","),"."));e.forEach((function(e){return L_(e)})),this._turnServer={servers:e,mode:"manual"},lS.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}},{key:"setLicense",value:function(e){if("DISCONNECTED"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"you should set license before join channel");if(d_(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ek(Oy.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,lS.info("[".concat(this._clientId,"] set license success"),e)}},{key:"startProxyServer",value:function(e){if("DISCONNECTED"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new ek(Oy.INVALID_OPERATION,"You have already set the proxy");var t,n=[3,4,5];switch(void 0===e&&(e=3),e){case 1:case 2:throw new ek(Oy.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new ek(Oy.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,lS.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}},{key:"stopProxyServer",value:function(){if("DISCONNECTED"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"Stop proxy server after leave channel");bS.setProxyServer(),lS.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",lS.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}},{key:"setLocalAccessPointsV2",value:function(e){if(!e.accessPoints)throw new ek(Oy.INVALID_PARAMS,"accessPoints is required.");f_(e.accessPoints.serverList,"accessPoints.serverList"),d_(e.accessPoints.domain,"accessPoints.domain");var t=function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){u_(e,t,0,65535,!0)})),n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new ek(Oy.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$w("CLOSE_AFB_FOR_LOCAL_AP")&&(Qw("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Qw("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));var r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map((function(e){return r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e})),o=a.map((function(e){return"".concat(e,":").concat(n)}));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Qw("WEBCS_DOMAIN",o),Qw("WEBCS_DOMAIN_BACKUP_LIST",o),Qw("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(f_(e.report.hostname,"report.hostname"),Qw("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Qw("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Qw("EVENT_REPORT_DOMAIN",a[0]),Qw("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));var s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),Qw("STATS_COLLECTOR_PORT",s),e.report?Qw("ENABLE_EVENT_REPORT",!0):Qw("ENABLE_EVENT_REPORT",!1);var c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(f_(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=a[0];var u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),Qw("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));var l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(f_(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=a;var d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),Qw("CDS_AP",l.map((function(e){return"".concat(e,":").concat(d)}))),e.cds?Qw("ENABLE_CONFIG_DISTRIBUTE",!0):Qw("ENABLE_CONFIG_DISTRIBUTE",!1),lS.info("set local access point v2 success")}},{key:"setLocalAccessPoints",value:function(e,t){if(f_(e,"serverList"),d_(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new ek(Oy.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");var n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((function(e){return n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e})),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Qw("WEBCS_DOMAIN",e),Qw("WEBCS_DOMAIN_BACKUP_LIST",e),Qw("GATEWAY_DOMAINS",[t]),Qw("EVENT_REPORT_DOMAIN",e[0]),Qw("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Qw("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),lS.info("[".concat(this._clientId,"] set local access point success"))}},{key:"setRemoteDefaultVideoStreamType",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c_(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,!this._joinInfo){e.next=12;break}return e.prev=1,e.next=4,this._gateway.setDefaultRemoteVideoStreamType(t);case 4:this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),lS.error("[".concat(this._clientId,"] set default remote video stream type error"),e.t0.toString()),e.t0;case 10:e.next=13;break;case 12:lS.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t));case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setRemoteVideoStreamType",value:function(){var e=c(s().mark((function e(t,n){var r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c_(n,"streamType",[0,1]),e.prev=1,e.next=4,this._gateway.setRemoteVideoStreamType(t,n);case 4:setTimeout((function(){var e=r._users.find((function(e){return e.uid===t}));e&&e.videoTrack&&e.videoTrack.updateMediaStreamTrackResolution()}),2e3),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),lS.error("[".concat(this._clientId,"] set remote video stream type error"),e.t0.toString()),e.t0;case 10:lS.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(t,n);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setStreamFallbackOption",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c_(n,"fallbackType",[0,1,2]),e.prev=1,e.next=4,this._gateway.setStreamFallbackOption(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.error("[".concat(this._clientId,"] set stream fallback option"),e.t0.toString()),e.t0;case 9:lS.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(t,n);case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setEncryptionConfig",value:function(e,t,n){!function(e){c_(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),d_(t,"secret");var r=["aes-128-gcm2","aes-256-gcm2"];if($i(r).call(r,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new ek(Oy.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ek(Oy.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||lS.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Q_(n))}},{key:"renewToken",value:function(){var e=c(s().mark((function e(t){var n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d_(t,"token",1,2047),this._key&&this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"renewToken should not be called before user join");case 2:return n=this._key,this._key=t,this._joinInfo&&(this._joinInfo.token=t),e.next=6,this._renewTokenMutex.lock();case 6:if(r=e.sent,e.prev=7,!$w("USE_NEW_TOKEN")){e.next=18;break}return lS.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs")),e.next=12,Fx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||hE);case 12:return i=e.sent,lS.debug("[".concat(this._clientId,"] get ticket from unilbs success")),e.next=16,this._gateway.renewToken({token:t,ticket:i});case 16:e.next=21;break;case 18:return lS.debug("[".concat(this._clientId,"] start renew token without ticket")),e.next=21,this._gateway.renewToken({token:t});case 21:lS.debug("[".concat(this._clientId,"] renewToken success")),e.next=27;break;case 24:throw e.prev=24,e.t0=e.catch(7),this._key=n,this._joinInfo.token=n,lS.error("[".concat(this._clientId,"] renewToken failed"),e.t0.toString()),e.t0;case 27:return e.prev=27,r(),e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[7,24,27,30]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"enableAudioVolumeIndicator",value:function(){var e=this;this._audioVolumeIndicationInterval?lS.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((function(){var t=e._p2pChannel.getAudioLevels();e.safeEmit(S_.VOLUME_INDICATOR,t)}),$w("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}},{key:"getRTCStats",value:function(){var e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}},{key:"startLiveStreaming",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=5;break}if("h264"===this.codec){e.next=3;break}throw new ek(Oy.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");case 3:if(this._p2pChannel.hasLocalMedia()){e.next=5;break}throw new ek(Oy.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");case 5:if(!(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))){e.next=7;break}throw new ek(Oy.LIVE_STREAMING_TASK_CONFLICT);case 7:return r=n?GS.TRANSCODE:GS.RAW,e.abrupt("return",this._createLiveStreamingClient(r).startLiveStreamingTask(t,r));case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setLiveTranscoding",value:function(e){return this._createLiveStreamingClient(GS.TRANSCODE).setTranscodingConfig(e)}},{key:"stopLiveStreaming",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((function(e){return e&&e.hasUrl(t)}))).length){e.next=3;break}throw new ek(Oy.INVALID_PARAMS,"can not find live streaming url to stop");case 3:return e.next=5,by.all(n.map((function(e){return e&&e.stopLiveStreamingTask(t)})));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addInjectStreamUrl",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");case 2:return(r=this._createLiveStreamingClient(GS.INJECT)).setInjectStreamConfig(n,0),e.next=6,r.startLiveStreamingTask(t,GS.INJECT);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"removeInjectStreamUrl",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._createLiveStreamingClient(GS.INJECT),r=Array.from(XS(t=n.streamingTasks).call(t)).find((function(e){return e.mode===GS.INJECT})),this._joinInfo&&r){e.next=3;break}throw new ek(Oy.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");case 3:return e.next=5,n.stopLiveStreamingTask(r.url);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startChannelMediaRelay",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xx(t),n=this._createChannelMediaRelayClient(),e.next=4,n.startChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateChannelMediaRelay",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xx(t),n=this._createChannelMediaRelayClient(),e.next=4,n.updateChannelMediaRelay(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopChannelMediaRelay",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._createChannelMediaRelayClient(),e.next=3,t.stopChannelMediaRelay();case 3:this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendStreamMessage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new ek(Oy.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){var n=new TextEncoder;e.payload=n.encode(e.payload)}if(new Blob([e.payload]).size>1024)throw new ek(Oy.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(MS.DATA_STREAM,{payload:Q_(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-oM},!t)}},{key:"sendMetadata",value:function(e){if(!this._joinInfo)throw new ek(Oy.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ek(Oy.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(MS.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Q_(e)})}},{key:"sendCustomReportMessage",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)||(t=[t]),t.forEach(dS),this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"can not send custom report, not joined");case 2:return e.next=4,bS.sendCustomReportMessage(this._joinInfo.sid,t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getLocalAudioStats",value:function(){return this._statsCollector.getLocalAudioTrackStats()}},{key:"getRemoteAudioStats",value:function(){return this._statsCollector.getRemoteAudioTrackStats()}},{key:"getLocalVideoStats",value:function(){return this._statsCollector.getLocalVideoTrackStats()}},{key:"getRemoteVideoStats",value:function(){return this._statsCollector.getRemoteVideoTrackStats()}},{key:"getRemoteNetworkQuality",value:function(){return this._statsCollector.getRemoteNetworkQualityStats()}},{key:"pickSVCLayer",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c_(n.spatialLayer,"spatialLayer",[0,1,2,3]),c_(n.temporalLayer,"temporalLayer",[0,1,2,3]),e.prev=1,e.next=4,this._gateway.pickSVCLayer(t,n);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),lS.error("[".concat(this._clientId,"] pick SVC layer failed"),e.t0.toString()),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setRTM2Flag",value:function(e){if(c_(e,"flag",[0,1]),!this._joinInfo)throw new ek(Oy.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new ek(Oy.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(e)}},{key:"_reset",value:function(){if(lS.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Mw.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach((function(e){e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((function(e){return e._close()})),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new fE("client-publish"),this._subscribeMutex=new fE("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(b){}if(this._moderation)try{this.setImageModeration(!1)}catch(b){}}},{key:"_startSession",value:function(e,t){var n=e||iE();e?lS.debug("[".concat(this._clientId,"] new Session ").concat(n)):lS.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?bS.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?bS.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&bS.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}},{key:"_publishHighStream",value:function(){var e=c(s().mark((function e(t){var n,r,i,a,c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:if("auto"!==this._turnServer.mode||!$w("FORCE_TURN")||$w("TURN_ENABLE_TCP")||$w("TURN_ENABLE_UDP")){e.next=6;break}throw new ek(Oy.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");case 6:if(lS.debug("[".concat(this._clientId,"] publish high stream")),e.prev=7,!(this._p2pChannel instanceof nM)){e.next=23;break}return e.next=11,this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);case 11:if(!(n=e.sent)){e.next=21;break}return e.prev=13,e.next=16,this._gateway.sendExtensionMessage(qk.PUBLISH,n);case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(13),this._p2pChannel.unpublish(t),e.t0;case 21:e.next=63;break;case 23:return e.next=25,this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);case 25:return r=e.sent,e.next=28,r.next();case 28:if(!(i=e.sent.value)){e.next=42;break}return e.prev=30,e.next=33,this._gateway.publish(this._uid,i,!0);case 33:c=e.sent,e.next=40;break;case 36:if(e.prev=36,e.t1=e.catch(30),e.t1.code===Oy.DISCONNECT_P2P){e.next=40;break}throw r.throw(e.t1),e.t1;case 40:return e.next=42,r.next((null===(a=c)||void 0===a?void 0:a.ortc)||[]);case 42:this._p2pChannel.reportPublishEvent(!0,null),u=o(t),e.prev=44,u.s();case 46:if((l=u.n()).done){e.next=55;break}if((d=l.value)instanceof GC&&d._encoderConfig&&this._gateway.setVideoProfile(d._encoderConfig),e.t2=!d.muted&&d.enabled,e.t2){e.next=53;break}return e.next=53,this._p2pChannel.muteLocalTrack(d);case 53:e.next=46;break;case 55:e.next=60;break;case 57:e.prev=57,e.t3=e.catch(44),u.e(e.t3);case 60:return e.prev=60,u.f(),e.finish(60);case 63:e.next=70;break;case 65:if(e.prev=65,e.t4=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t4?void 0:e.t4.code,t),(null==e.t4?void 0:e.t4.code)!==Oy.WS_ABORT){e.next=69;break}return e.abrupt("return");case 69:throw e.t4;case 70:case"end":return e.stop()}}),e,this,[[7,65],[13,18],[30,36],[44,57,60,63]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_publishLowStream",value:function(){var e=c(s().mark((function e(){var t,n,r,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joinInfo&&void 0!==this._uid){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");case 2:if("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));case 4:return lS.debug("[".concat(this._clientId,"] publish low stream")),(t=this._configDistribute.getLowStreamConfigDistribute())&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate)),e.prev=7,e.next=10,this._p2pChannel.publishLowStream(this._lowStreamParameter);case 10:return n=e.sent,e.next=13,n.next();case 13:if(!(r=e.sent.value)){e.next=26;break}return e.prev=15,e.next=18,this._gateway.publish(this._uid,r,!0);case 18:a=e.sent,e.next=25;break;case 21:if(e.prev=21,e.t0=e.catch(15),e.t0.code===Oy.DISCONNECT_P2P){e.next=25;break}throw n.throw(e.t0),e.t0;case 25:n.next((null===(i=a)||void 0===i?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0);case 26:e.next=33;break;case 28:if(e.prev=28,e.t1=e.catch(7),this._p2pChannel.reportPublishEvent(!1,null==e.t1?void 0:e.t1.code,void 0,!0),(null==e.t1?void 0:e.t1.code)!==Oy.WS_ABORT){e.next=32;break}return e.abrupt("return");case 32:throw e.t1;case 33:case"end":return e.stop()}}),e,this,[[7,28],[15,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_createLiveStreamingClient",value:function(e){var t=this;if(!this._joinInfo||!this._appId)return new ek(Oy.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();var n=function(){return new Yx(t._joinInfo,t._config.websocketRetryConfig||hE,t._config.httpRetryConfig||hE)},r=function(e){e.onLiveStreamError=function(e,n){bS.reportApiInvoke(t._sessionId,{name:__.ON_LIVE_STREAM_ERROR,options:[e,n],tag:E_.TRACER}).onSuccess(),t.safeEmit(S_.LIVE_STREAMING_ERROR,e,n)},e.onLiveStreamWarning=function(e,n){bS.reportApiInvoke(t._sessionId,{name:__.ON_LIVE_STREAM_WARNING,options:[e,n],tag:E_.TRACER}).onSuccess(),t.safeEmit(S_.LIVE_STREAMING_WARNING,e,n)},e.on(sk.REQUEST_WORKER_MANAGER_LIST,(function(e,n,r){if(!t._joinInfo)return r(new ek(Oy.INVALID_OPERATION,"can not find join info to get worker manager"));Lx(e,t._joinInfo,t._axiosCancelSource.token,hE).then(n).catch(r)}))};switch(e){case GS.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=n(),r(this._liveRawStreamingClient)),this._liveRawStreamingClient;case GS.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=n(),r(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case GS.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=n(),this._injectStreamingClient.on(sk.REQUEST_WORKER_MANAGER_LIST,(function(e,n,r){if(!t._joinInfo)return r(new ek(Oy.INVALID_OPERATION,"can not find join info to get worker manager"));Lx(e,t._joinInfo,t._axiosCancelSource.token,hE).then(n).catch(r)})),this._injectStreamingClient.onInjectStatusChange=function(e,n,r){t.safeEmit(S_.INJECT_STREAM_STATUS,e,n,r)}),this._injectStreamingClient}}},{key:"_createChannelMediaRelayClient",value:function(){var e=this;if(!this._joinInfo)return new ek(Oy.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){var t=this.getLocalVideoStats(),n={width:t.sendResolutionWidth,height:t.sendResolutionHeight};this._channelMediaRelayClient=new $x(this._joinInfo,this._clientId,this._config.websocketRetryConfig||hE,this._config.httpRetryConfig||hE,n),this._channelMediaRelayClient.on("state",(function(t){t===fk.RELAY_STATE_FAILURE&&e._channelMediaRelayClient&&e._channelMediaRelayClient.dispose(),e.safeEmit(S_.CHANNEL_MEDIA_RELAY_STATE,t)})),this._channelMediaRelayClient.on("event",(function(t){e.safeEmit(S_.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._statsCollector.onStatsChanged=function(t,n){var r;"resolution"===t&&(null===(r=e._channelMediaRelayClient)||void 0===r||r.setVideoProfile(n))}}return this._channelMediaRelayClient}},{key:"_handleUpdateDataChannel",value:function(e,t){var n=this,r=e.added,i=e.deleted,a=[];Array.isArray(r)&&r.length>0&&r.forEach((function(e){var r=e.uid,i=e.stream_id,o=e.ordered,s=e.max_retrans_times,c=e.metadata,u=n._users.find((function(e){return e._uintid===r}));if(u){if(lS.debug("[".concat(n._clientId,"] data_channel added with uid ").concat(r)),$i(a).call(a,u)||a.push(u),u._uintid||(u._uintid=r),-1===u._dataChannels.findIndex((function(t){return t.id===e.stream_id}))){var l={id:i,ordered:!!o,maxRetransmits:s,metadata:c},d=new bN(l);u._dataChannels.push(d),lS.info("[".concat(n._clientId,"] remote user ").concat(u.uid," published datachannel")),t||n.safeEmit(S_.USER_PUBLISHED,u,"datachannel",l)}n._p2pChannel.hasPendingRemoteDataChannel(u,e.stream_id)&&(lS.debug("[".concat(n._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),n._subscribeDataChannel(u,e.stream_id).catch((function(e){lS.error("[".concat(n._clientId,"] resubscribe datachannel error"),e.toString())})))}else lS.error("[".concat(n._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(S_.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach((function(e){var t=e.uid,r=(e.stream_id,n._users.find((function(e){return e._uintid===t})));if(r){var i=r._dataChannels.find((function(t){return t.id===e.stream_id}));i&&(lS.debug("[".concat(n._clientId,"] data_stream delete with uid ").concat(t)),n._p2pChannel.unsubscribeDataChannel(r,[i]).then((function(e){if(e)return r._dataChannels=r._dataChannels.filter((function(e){return e!==i})),n._gateway.unsubscribeDataChannel(e,r.uid)})),lS.info("[".concat(n._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),n.safeEmit(S_.USER_UNPUBLISHED,r,"datachannel",i._config))}else lS.error("[".concat(n._clientId,"] can not find target user!(on_delete_data_channel)"))}))}},{key:"_handleRemoveDataChannels",value:function(e){var t=this,n=this._users.find((function(t){return t.uid===e.uid}));if(n){if(void 0!==n._dataChannels&&n._dataChannels.length>0){lS.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));var r=function(){lS.info("[".concat(t._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach((function(e){t.safeEmit(S_.USER_UNPUBLISHED,n,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then((function(e){if(e)return t._gateway.unsubscribeDataChannel(e,n.uid)})),r()}}else lS.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}},{key:"_handleGatewayEvents",value:function(){var e=this;this._gateway.on(vk.DISCONNECT_P2P,c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.disconnectForReconnect();case 2:case"end":return t.stop()}}),t)})))),this._gateway.on(vk.CONNECTION_STATE_CHANGE,(function(t,n,r){var i;if(r!==w_.FALLBACK){var a=function(){e.safeEmit(S_.CONNECTION_STATE_CHANGE,t,n,r)};if(bS.reportApiInvoke(e._sessionId||(null===(i=e._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:__.CONNECTION_STATE_CHANGE,options:[t,n,r],tag:E_.TRACER}).onSuccess(JSON.stringify({cur:t,prev:n,reason:r})),lS.info("[".concat(e._clientId,"] connection state change: ").concat(n," -> ").concat(t)),"DISCONNECTED"===t)return e._reset(),void a();if("RECONNECTING"===t)e._users.forEach((function(e){e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._audioSSRC=void 0,e._videoSSRC=void 0,e._videoOrtc=void 0,e._audioOrtc=void 0,e._cname=void 0,e._rtxSsrcId=void 0})),e._userOfflineTimeout&&window.clearTimeout(e._userOfflineTimeout),e._streamRemovedTimeout&&window.clearTimeout(e._streamRemovedTimeout),e._userOfflineTimeout=void 0,e._streamRemovedTimeout=void 0;else if("CONNECTED"===t){var o;e._streamFallbackTypeCacheMap.forEach((function(t,n){e._gateway.setStreamFallbackOption(n,t).catch((function(t){lS.warning("[".concat(e._clientId,"] auto set stream fallback option failed"),t)}))})),e._remoteStreamTypeCacheMap.forEach((function(t,n){e._gateway.setRemoteVideoStreamType(n,t).catch((function(t){lS.warning("[".concat(e._clientId,"] auto set remote stream type failed"),t)}))})),void 0!==e._remoteDefaultVideoStreamType&&void 0===(null===(o=e._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&e.setRemoteDefaultVideoStreamType(e._remoteDefaultVideoStreamType).then((function(){lS.debug("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((function(t){lS.error("[".concat(e._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(t))})),e.store.useP2P||(e._p2pChannel.republish(),e._userOfflineTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._userOfflineTimeout=void 0,e._users.filter((function(e){return!e._trust_in_room_})).forEach((function(t){lS.debug("[".concat(e._clientId,"] user offline timeout, emit user offline ").concat(t.uid)),e._handleUserOffline({uid:t.uid})})))}),3e3),e._streamRemovedTimeout=window.setTimeout((function(){"CONNECTED"===e.connectionState&&(e._streamRemovedTimeout=void 0,e._users.forEach((function(t){t._trust_audio_mute_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch audio unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,Ck.AUDIO,!1)),t._trust_video_mute_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch video unmute event ").concat(t.uid)),e._handleMuteStream(t.uid,Ck.VIDEO,!1)),t._trust_audio_enabled_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch enable local audio ").concat(t.uid)),e._handleSetStreamLocalEnable("audio",t.uid,!0)),t._trust_video_enabled_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch enable local video ").concat(t.uid)),e._handleSetStreamLocalEnable("video",t.uid,!0)),t._trust_video_stream_added_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch reset video stream added ").concat(t.uid)),e._handleResetAddStream(t,"video")),t._trust_audio_stream_added_state_||(lS.debug("[".concat(e._clientId,"] auto dispatch reset audio stream added ").concat(t.uid)),e._handleResetAddStream(t,"audio")),t._video_added_||t._audio_added_||(lS.debug("[".concat(e._clientId,"] auto dispatch stream remove ").concat(t.uid)),e._handleRemoveStream({uid:t.uid,uint_id:t._uintid}))})))}),1e3))}a()}})),this._gateway.on(vk.REQUEST_NEW_GATEWAY_LIST,(function(t,n){if(!e._joinInfo)return n(new ek(Oy.UNEXPECTED_ERROR,"can not recover, no join info"));Tx(e._joinInfo,e._axiosCancelSource.token,e._config.httpRetryConfig||hE,e.store).then((function(n){e._joinInfo&&(e._joinInfo.apResponse=n.gatewayInfo.res,e._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,e._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);var r=[];n.gatewayInfo.gatewayAddrs.forEach((function(t){var n=t.address.split(":"),i=u(n,2),a=i[0],o=i[1];e._joinInfo&&e._joinInfo.proxyServer?r.push({proxy:e._joinInfo.proxyServer,host:a,port:o}):r.push({host:a,port:o})})),t(r)})).catch(n)})),this._gateway.on(vk.NETWORK_QUALITY,(function(t){"normal"===e._networkQualitySensitivity&&e.safeEmit(S_.NETWORK_QUALITY,t)})),this._gateway.on(vk.STREAM_TYPE_CHANGE,(function(t,n){e.safeEmit(S_.STREAM_TYPE_CHANGED,t,n),bS.reportApiInvoke(e._sessionId,{name:__.STREAM_TYPE_CHANGE,options:[t,n],tag:E_.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:n}))})),this._gateway.on(vk.IS_P2P_DISCONNECTED,(function(t){e._p2pChannel.isP2PDisconnected()?t(!0):e._p2pChannel.hasLocalMedia()||e._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(vk.NEED_RENEW_SESSION,(function(){e._startSession()})),this._gateway.on(vk.REQUEST_P2P_CONNECTION_PARAMS,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._p2pChannel.startP2PConnection(n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.on(vk.JOIN_RESPONSE,(function(t,n){if(!e.store.useP2P){var r=bD(t.ortc,n),i=r.dtlsParameters,a=r.iceParameters,o=r.candidates,s=r.rtpCapabilities,c=r.setup,u=r.cname;e._p2pChannel.connect(a,i,o,s,c,u)}})),this._gateway.on(vk.REQUEST_DC_CONNECTION_PARAMS,(function(t){t(e._p2pChannel.getEstablishParams())})),this._gateway.on(vk.RESET_SIGNAL,(function(t){e._p2pChannel.resetConnection(t),e._handleGatewaySignalEvents()})),this._gateway.on(vk.DATACHANNEL_FAILBACK,(function(){e._joinGateway()})),this._gateway.on(vk.DATACHANNEL_PRECONNECT,function(){var t=c(s().mark((function t(n,r,i,a){var o,c,u,l,d,f,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.startP2PConnection({turnServer:null===(o=e._joinInfo)||void 0===o?void 0:o.turnServer},!0);case 2:return p=function(e,t){var n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],lS.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),lS.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(n,r),t.abrupt("return",e._p2pChannel.preConnect({iceUfrag:"".concat(null===(c=e._joinInfo)||void 0===c?void 0:c.apResponse.cid,"_").concat(null===(u=e._joinInfo)||void 0===u?void 0:u.apResponse.cert),icePwd:"".concat(null===(l=e._joinInfo)||void 0===l?void 0:l.apResponse.cid,"_").concat(null===(d=e._joinInfo)||void 0===d?void 0:d.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(f=$w("FINGERPRINT"))&&void 0!==f?f:n.fingerprint}]},p,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(a));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}())}},{key:"_handleGatewaySignalEvents",value:function(){var e=this;this._gateway.signal.on(jS.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(jS.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(jS.ON_ADD_AUDIO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)})),this._gateway.signal.on(jS.ON_ADD_VIDEO_STREAM,(function(t){return e._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)})),this._gateway.signal.on(jS.ON_REMOTE_DATASTREAM_UPDATE,(function(t){e._handleUpdateDataChannel(t)})),this._gateway.signal.on(jS.ON_REMOTE_FULL_DATASTREAM_INFO,(function(t){e._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)})),this._gateway.signal.on(jS.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(jS.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(jS.MUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,Ck.AUDIO,!0)})),this._gateway.signal.on(jS.UNMUTE_AUDIO,(function(t){return e._handleMuteStream(t.uid,Ck.AUDIO,!1)})),this._gateway.signal.on(jS.MUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,Ck.VIDEO,!0)})),this._gateway.signal.on(jS.UNMUTE_VIDEO,(function(t){return e._handleMuteStream(t.uid,Ck.VIDEO,!1)})),this._gateway.signal.on(jS.RECEIVE_METADATA,(function(t){var n=X_(t.metadata);e.safeEmit(S_.RECEIVE_METADATA,t.uid,n)})),this._gateway.signal.on(jS.ON_DATA_STREAM,function(){var t=c(s().mark((function t(n){var r,i,a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:r=0,(n.ordered||n.syncWithAudio)&&(i=e._p2pChannel.getStats(),a=e.remoteUsers.find((function(e){return e.uid===n.uid})),o=null==i?void 0:i.audioRecv.find((function(e){return e.ssrc===(null==a?void 0:a._audioSSRC)})),r=null==o?void 0:o.jitterBufferMs),null==r&&(r=0),pM(n,r,{id:e._clientId,onStreamMessage:"function"==typeof e.onStreamMessage?e.onStreamMessage.bind(e):void 0,safeEmit:e.safeEmit.bind(e)});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this._gateway.signal.on(jS.ON_CRYPT_ERROR,(function(){J_((function(){lS.warning("[".concat(e._clientId,"] on crypt error")),e.safeEmit(S_.CRYPT_ERROR)}),e._sessionId)})),this._gateway.signal.on(jS.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(jS.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(function(){lS.warning("[".concat(e._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),e._gateway.leave(!0,w_.TOKEN_EXPIRE),e.safeEmit(S_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),e._reset()})),this._gateway.signal.on(jS.ON_STREAM_FALLBACK_UPDATE,(function(t){lS.debug("[".concat(e._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),e.safeEmit(S_.STREAM_FALLBACK,t.stream_id,1===t.stream_type?"fallback":"recover")})),this._gateway.signal.on(jS.ON_PUBLISH_STREAM,(function(t){e.uid===e._uid&&(e._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),lS.info("[".concat(e._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on(jS.ENABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on(jS.DISABLE_LOCAL_VIDEO,(function(t){e._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(LS.REQUEST_TIMEOUT,(function(t,n){if(e._joinInfo)switch(t){case MS.PUBLISH:if(!n)return;var r=n.ortc;if(r){var i,a,o=r.some((function(e){return e.stream_type===hk.Audio})),s=r.some((function(e){return e.stream_type!==hk.Audio})),c=r.some((function(e){var t=e.stream_type;return t===hk.Screen||t===hk.ScreenLow}));"offer"===n.state&&bS.publish(e._joinInfo.sid,{eventElapse:TN.measureFromPublishStart(e.store.clientId,e.store.pubId),succ:!1,ec:Oy.TIMEOUT,audio:o,video:s,p2pid:n.p2p_id,publishRequestid:e.store.pubId,screenshare:c,audioName:o?null===(i=r.find((function(e){return e.stream_type===hk.Audio})))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0,videoName:s?null===(a=r.find((function(e){return e.stream_type!==hk.Audio})))||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId.toString():void 0})}break;case MS.SUBSCRIBE:n&&bS.subscribe(e._joinInfo.sid,{succ:!1,ec:Oy.TIMEOUT,audio:n.stream_type===Ck.AUDIO,video:n.stream_type===Ck.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:e.store.p2pId,eventElapse:TN.measureFromSubscribeStart(e.store.clientId,n.ssrcId)})}})),this._gateway.signal.on(jS.ON_P2P_OK,(function(t){e.uid,e._uid})),this._gateway.signal.on(jS.ON_PUBLISHED_USER_LIST,(function(t){if(null!=t&&t.users){$w("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((function(t){return!IS(t.string_id||t.stream_id,e.channelName)})));var n,r=[],i=[],a=o(t.users);try{var s=function(){var t=n.value,a=e._users.find((function(e){return e._uintid===t.stream_id}));a?a._trust_in_room_=!0:(a=new eD(t.string_id||t.stream_id,t.stream_id),e._users.push(a),0===e.getListeners(S_.PUBLISHED_USER_LIST).length&&(lS.debug("[".concat(e._clientId,"] user online"),t.stream_id),e.safeEmit(S_.USER_JOINED,a)));var o=gk.Audio&t.stream_type,s=(gk.Video|gk.LwoVideo)&t.stream_type,c=0!=(65280&t.stream_type),u=o&&a.hasAudio,l=s&&a.hasVideo;s&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=t.video_ssrc,a._rtxSsrcId=t.video_rtx),o&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=t.audio_ssrc),o&&!u&&0===e.getListeners(S_.PUBLISHED_USER_LIST).length&&(lS.info("[".concat(e._clientId,"] remote user ").concat(a.uid," published audio")),e.safeEmit(S_.USER_PUBLISHED,a,"audio")),s&&!l&&0===e.getListeners(S_.PUBLISHED_USER_LIST).length&&(lS.info("[".concat(e._clientId,"] remote user ").concat(a.uid," published video")),e.safeEmit(S_.USER_PUBLISHED,a,"video")),(o&&!u||s&&!l||c)&&r.push(a),s&&e._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),o&&e._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})};for(a.s();!(n=a.n()).done;)s()}catch(c){a.e(c)}finally{a.f()}i.length>0&&(lS.debug("[".concat(e._clientId,"] RE massSubscribe after reconnect ").concat(i.map((function(e){return"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)})).join("; ")," ")),e.massSubscribe(i).catch((function(t){lS.error("[".concat(e._clientId,"] mass resubscribe error"),t.toString())}))),e.getListeners(S_.PUBLISHED_USER_LIST).length>0?$w("ENABLE_DATASTREAM_2")?e._pendingPublishedUsers=r:(lS.info("[".concat(e._clientId,"] client emit user-list event, users: ").concat(r.map((function(e){return e.uid})).join(", "))),e.safeEmit(S_.PUBLISHED_USER_LIST,r)):lS.info("[".concat(e._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map((function(e){return e.uid})).join(", ")))}}))}},{key:"_handleP2PEvents",value:function(){var e=this;this._gateway.signal.on(jS.ON_USER_OFFLINE,(function(){e._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(qk.PUBLISH,function(){var t=c(s().mark((function t(n,r){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.forEach((function(t){return t.kind===Ck.VIDEO?(e._handleP2PAddAudioOrVideoStream("video",r),t.isMuted?e._handleMuteStream(r,Ck.VIDEO,!0):e._handleMuteStream(r,Ck.VIDEO,!1)):(e._handleP2PAddAudioOrVideoStream("audio",r),t.isMuted?e._handleMuteStream(r,Ck.AUDIO,!0):e._handleMuteStream(r,Ck.AUDIO,!1))}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),this._gateway.signal.on(LS.P2P_START,function(){var t=c(s().mark((function t(n,r){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=6;break}return t.t0=r,t.next=4,e._p2pChannel.startP2P({turnServer:null===(i=e._joinInfo)||void 0===i?void 0:i.turnServer},n);case 4:t.t1=t.sent,(0,t.t0)(t.t1);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),this._gateway.signal.on(LS.P2P_CONNECTION,function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e._p2pChannel instanceof nM,!t.t0){t.next=4;break}return t.next=4,e._p2pChannel.p2pConnect(n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this._gateway.signal.on(LS.P2P_REMOTE_CANDIDATE_UPDATE,(function(t){e._p2pChannel instanceof nM&&e._p2pChannel.addRemoteCandidate(JSON.parse(t))})),this._gateway.signal.on(qk.SUBSCRIBE,function(){var t=c(s().mark((function t(n,r,i){var a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=11;break}return a=JSON.parse(n),o=a.trackType,t.prev=2,t.next=5,e._p2pChannel.dopublish(o);case 5:r(),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),i(t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.UNSUBSCRIBE,function(){var t=c(s().mark((function t(n,r,i){var a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=11;break}return a=JSON.parse(n),o=a.mediaType,t.prev=2,t.next=5,e._p2pChannel.doUnpublish(o);case 5:r(),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),i(t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.EXCHANGE_SDP,function(){var t=c(s().mark((function t(n,r,i){var a,o,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=13;break}return a=JSON.parse(n),o=a.type,c=a.sdp,t.prev=2,t.t0=r,t.next=6,e._p2pChannel.setDescription(o,c);case 6:t.t1=t.sent,(0,t.t0)(t.t1),t.next=13;break;case 10:t.prev=10,t.t2=t.catch(2),i(t.t2);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.UNPUBLISH,function(){var t=c(s().mark((function t(n,r,i){var a,o,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=17;break}if(a=n.unpubMsg,o=n.uid,1!==a.length){t.next=16;break}if(c=a[0].stream_type===hk.Audio?Ck.AUDIO:Ck.VIDEO,e._handleMuteStream(o,c,!0),u=n.sdp,!(e._p2pChannel instanceof nM&&u)){t.next=13;break}if(l=e._users.find((function(e){return e.uid===o})),l){t.next=10;break}return t.abrupt("return",(lS.warning("[".concat(e._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void r()));case 10:e._p2pChannel.unsubscribe(l,u,c).then((function(e){e&&r(e)})).catch(i),t.next=14;break;case 13:r();case 14:t.next=17;break;case 16:e._handleRemoveStream(n,r,i);case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.CONTROL,function(){var t=c(s().mark((function t(n,r,i){var a,o,c,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=n.action,o=n.sdp,c=n.isMuteAll,u=n.uid,t.t0=a,t.next=t.t0===Wk.MUTE_LOCAL_VIDEO?4:t.t0===Wk.MUTE_LOCAL_AUDIO?6:t.t0===Wk.UNMUTE_LOCAL_VIDEO?8:t.t0===Wk.UNMUTE_LOCAL_AUDIO?10:11;break;case 4:return e._handleMuteStream(u,Ck.VIDEO,!0,o,r,i),t.abrupt("break",11);case 6:return r(),e._handleMuteStream(u,Ck.AUDIO,!0),t.abrupt("break",11);case 8:return r(),e._handleP2PAddAudioOrVideoStream("video",u),e._handleMuteStream(u,Ck.VIDEO,!1),t.abrupt("break",11);case 10:r(),e._handleP2PAddAudioOrVideoStream("audio",u),e._handleMuteStream(u,Ck.AUDIO,!1);case 11:c&&e._handleRemoveStream(n,r,i);case 12:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.DO_SUBSCRIBE,function(){var t=c(s().mark((function t(n,r,i){var a,o,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=15;break}if(a=n.kind,o=n.sdp,c=n.ssrcId,u=n.uid,l=e._users.find((function(e){return e.uid===u})),l){t.next=4;break}return t.abrupt("return",(lS.error("[".concat(e._clientId,"] can not find target user!(on_add_stream)")),void r()));case 4:return t.prev=4,t.t0=r,t.next=8,e._p2pChannel.subscribe(l,a,o,c);case 8:t.t1=t.sent,(0,t.t0)(t.t1),t.next=15;break;case 12:t.prev=12,t.t2=t.catch(4),i(t.t2);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.DO_UNSUBSCRIBE,function(){var t=c(s().mark((function t(n,r,i){var a,o,c,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=15;break}if(a=n.uid,o=n.kind,c=n.sdp,u=e._users.find((function(e){return e.uid===a})),u){t.next=4;break}return t.abrupt("return",(lS.error("[".concat(e._clientId,"] can not find target user!(on_add_stream)")),void r()));case 4:return t.prev=4,t.t0=r,t.next=8,e._p2pChannel.unsubscribe(u,c,o);case 8:t.t1=t.sent,(0,t.t0)(t.t1),t.next=15;break;case 12:t.prev=12,t.t2=t.catch(4),i(t.t2);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(qk.RESTART_ICE,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=12;break}return t.prev=1,t.t0=r,t.next=5,e._p2pChannel.setDescription("remote",n);case 5:t.t1=t.sent,(0,t.t0)(t.t1),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(1),i(t.t2);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestP2PRestartICE,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._gateway.sendExtensionMessage(qk.RESTART_ICE,n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.LocalCandidate,(function(t){e._gateway.sendExtensionMessage(qk.CANDIDATE,JSON.stringify(t))})),this._p2pChannel.on(xk.RequestP2PMuteLocal,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._gateway.sendExtensionMessage(qk.CONTROL,n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestP2PPublish,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._gateway.sendExtensionMessage(qk.DO_SUBSCRIBE,n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestP2PUnPublish,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e._gateway.sendExtensionMessage(qk.DO_UNSUBSCRIBE,n);case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),i(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestP2PUnmuteRemote,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.unmuteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Oy.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestP2PMuteRemote,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.muteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Oy.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.StateChange,(function(t,n){n===Nk.Connected&&e._p2pChannel.republish()}))}},{key:"_handleP2PChannelEvents",value:function(){var e=this;this._p2pChannel.on(xk.RequestMuteLocal,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.muteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Oy.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestUnmuteLocal,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo){t.next=12;break}return t.prev=1,t.next=4,e._gateway.unmuteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid);case 4:r(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),t.t0.code===Oy.DISCONNECT_P2P?r():i(t.t0);case 10:t.next=13;break;case 12:r();case 13:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestRePublish,(function(t,n,r){e.publish(t,!1).then(n).catch(r)})),this._p2pChannel.on(xk.RequestRePublishDataChannel,(function(t,n,r){by.all(t.map(function(){var t=c(s().mark((function t(n){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.publishDataChannel([n]);case 2:return r={streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId},t.prev=3,t.next=6,e._gateway.publishDataChannel(e._uid,r,!0);case 6:t.next=12;break;case 8:if(t.prev=8,t.t0=t.catch(3),t.t0.code===Oy.DISCONNECT_P2P){t.next=12;break}throw t.t0;case 12:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e){return t.apply(this,arguments)}}())).then(n).catch(r)})),this._p2pChannel.on(xk.RequestReSubscribe,function(){var t=c(s().mark((function t(n,r,i){var a,c,u,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=o(n),t.prev=2,a.s();case 4:if((c=a.n()).done){t.next=15;break}if(u=c.value,l=u.user,u.kind!==Ck.VIDEO){t.next=11;break}return t.next=9,e.subscribe(l,"video");case 9:t.next=13;break;case 11:return t.next=13,e.subscribe(l,"audio");case 13:t.next=4;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(2),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:r(),t.next=29;break;case 26:t.prev=26,t.t1=t.catch(0),i(t.t1);case 29:case"end":return t.stop()}}),t,null,[[0,26],[2,17,20,23]])})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestUploadStats,(function(t,n){e._gateway.uploadStats(t,n)})),this._p2pChannel.on(xk.MediaReconnectStart,(function(t){e.safeEmit(S_.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(xk.MediaReconnectEnd,(function(t){e.safeEmit(S_.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(xk.NeedSignalRTT,(function(t){t(e._gateway.getSignalRTT())})),this._p2pChannel.on(xk.RequestRestartICE,function(){var t=c(s().mark((function t(n){var r,i,a,o,c,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._p2pChannel instanceof nM)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e._p2pChannel.restartICE(n);case 4:return r=t.sent,t.next=7,r.next();case 7:if(!(i=t.sent).done){t.next=10;break}return t.abrupt("return");case 10:return a=i.value,t.prev=11,t.next=14,e._gateway.restartICE({iceParameters:a});case 14:o=t.sent,t.next=20;break;case 17:return t.prev=17,t.t0=t.catch(11),t.abrupt("return",void r.throw(t.t0));case 20:return c=function(e){var t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(o),u=c.iceParameters,t.next=23,r.next({remoteIceParameters:u});case 23:case"end":return t.stop()}}),t,null,[[11,17]])})));return function(e){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.RequestReconnect,c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._gateway.reconnect();case 1:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(xk.RequestReconnectPC,c(s().mark((function t(){var n,r,i,a,o,c,u,l,d,f,p,h,v,m,g;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._p2pChannel.startP2PConnection({turnServer:null===(n=e._joinInfo)||void 0===n?void 0:n.turnServer});case 2:return r=t.sent,i=r.iceParameters,a=r.dtlsParameters,o=r.rtpCapabilities,t.next=8,e._gateway.reconnectPC({iceParameters:i,dtlsParameters:a,rtpCapabilities:o});case 8:return c=t.sent,u=c.gatewayEstablishParams,l=c.gatewayAddress,d=bD(u,l),f=d.dtlsParameters,p=d.iceParameters,h=d.candidates,v=d.rtpCapabilities,m=d.setup,g=d.cname,t.next=20,e._p2pChannel.connect(p,f,h,v,m,g);case 20:return t.next=22,e._p2pChannel.republish();case 22:return t.next=24,e._p2pChannel.reSubscribe();case 24:case"end":return t.stop()}}),t)})))),this._p2pChannel.on(xk.RequestUnpublishForReconnectPC,function(){var t=c(s().mark((function t(n,r,i){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._joinInfo||void 0===e._uid){t.next=6;break}return t.next=3,e._gateway.unpublish(n,e._uid);case 3:r(),t.next=7;break;case 6:i();case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(xk.P2PLost,(function(){e.safeEmit(S_.P2P_LOST,e.store.uid)})),this._p2pChannel.on(xk.UpdateVideoEncoder,(function(t){t._encoderConfig&&e._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(xk.ConnectionTypeChange,(function(t){e.safeEmit(S_.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(xk.RequestLowStreamParameter,(function(t){t(e._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(xk.QueryClientConnectionState,(function(t){t(e.connectionState)}))}},{key:"getKeyMetrics",value:function(){return this.store.keyMetrics}},{key:"enableContentInspect",value:function(){var e=c(s().mark((function e(t){var n,r,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("CONNECTED"===this.connectionState&&this._joinInfo){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));case 2:if(!this._inspect){e.next=4;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));case 4:if(t){e.next=6;break}throw new ek(Oy.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));case 6:if(t.inspectType&&Array.isArray(t.inspectType)){e.next=8;break}throw new ek(Oy.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));case 8:if((n=m(new Set(t.inspectType))).forEach((function(e){var t;if(!$i(t=["supervise","moderation"]).call(t,e))throw new ek(Oy.INVALID_PARAMS,"[".concat(i._clientId,"] ").concat(e," is not a valid inspect type."))})),t.inspectType=n,!(t&&t.extraInfo&&t.extraInfo.length>1024)){e.next=12;break}throw new ek(Oy.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));case 12:return e.prev=12,r=new vL(t),this._inspect=r,this.handleVideoInspectEvents(this._inspect),e.next=18,r.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},hE);case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(12),Array.isArray(e.t0)?e.t0[0]:e.t0;case 23:case"end":return e.stop()}}),e,this,[[12,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"disableContentInspect",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._inspect){e.next=2;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));case 2:e.prev=2,this._inspect.close(),this._inspect=void 0,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),Array.isArray(e.t0)?e.t0[0]:e.t0;case 9:case"end":return e.stop()}}),e,this,[[2,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setImageModeration",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s_(t,"enabled"),!t){e.next=20;break}if(n){e.next=3;break}throw new ek(Oy.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));case 3:if(u_(n.interval,"interval",1e3,1/0),"CONNECTED"===this.connectionState&&this._joinInfo){e.next=5;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));case 5:if(e.prev=5,!this._moderation){e.next=8;break}return e.abrupt("return",void this._moderation.updateConfig(n));case 8:return r=new zL(n),this._moderation=r,this.handleImageModerationEvents(this._moderation),e.next=13,r.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},hE);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(5),Array.isArray(e.t0)?e.t0[0]:e.t0;case 18:e.next=29;break;case 20:if(this._moderation){e.next=22;break}throw new ek(Oy.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));case 22:e.prev=22,this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0,e.next=29;break;case 26:throw e.prev=26,e.t1=e.catch(22),Array.isArray(e.t1)?e.t1[0]:e.t1;case 29:case"end":return e.stop()}}),e,this,[[5,15],[22,26]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"handleImageModerationEvents",value:function(e){var t=this;e.on(Gk.CONNECTION_STATE_CHANGE,(function(n,r){if(t.safeEmit(S_.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,r),n===Bk.CONNECTED){if("CONNECTED"!==t.connectionState)throw t.setImageModeration(!1),new ek(Oy.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Gk.CLIENT_LOCAL_VIDEO_TRACK,(function(e){e(t.localTracks.filter((function(e){return"video"===e.trackMediaType}))[0])}))}},{key:"handleVideoInspectEvents",value:function(e){var t=this;e.on(Mk.CONNECTION_STATE_CHANGE,(function(n,r){if(t.safeEmit(S_.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,r),r===Pk.CONNECTED){if("CONNECTED"!==t.connectionState)return void t.safeEmit(S_.CONTENT_INSPECT_ERROR,new ek(Oy.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(Mk.INSPECT_RESULT,(function(e,n){var r;if((null==n?void 0:n.code)===Oy.INVALID_OPERATION&&"DISCONNECTED"===t.connectionState)return lS.debug("Stop inspect content because that has left channel"),null==t||null===(r=t._inspect)||void 0===r||r.close(),void(t._inspect=void 0);t.safeEmit(S_.CONTENT_INSPECT_RESULT,e,n)})),e.on(Mk.CLIENT_LOCAL_VIDEO_TRACK,(function(e){e(t.localTracks.filter((function(e){return"video"===e.trackMediaType}))[0])}))}},{key:"getJoinChannelServiceRecords",value:function(){return lS.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}},{key:"setPublishAudioFilterEnabled",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s_(t,"enabled"),Qw("ENABLE_PUBLISH_AUDIO_FILTER",t),e.t0=this._joinInfo,!e.t0){e.next=6;break}return e.next=6,this._gateway.setPublishAudioFilterEnabled(t);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_handleResetAddStream",value:function(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}]),n}(O_);QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"leave",null),QS([ES({argsMap:function(e,t){if(!Array.isArray(t)){if(!(t instanceof yI))return[t];t=[t]}return t.map((function(e){return e?Object(e).toString():"null"}))}}),$S("design:type",Function),$S("design:paramtypes",[Object,Boolean]),$S("design:returntype",by)],mM.prototype,"publish",null),QS([ES({argsMap:function(e,t){return t||(t=[]),t instanceof wN?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map((function(e){return e.getTrackId()})))}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],mM.prototype,"unpublish",null),QS([ES({argsMap:function(e,t,n,r){return[t.uid,n,r]}}),$S("design:type",Function),$S("design:paramtypes",[eD,String,Number]),$S("design:returntype",by)],mM.prototype,"subscribe",null),QS([ES({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return[null==t?void 0:t.uid,n]}))}}),$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],mM.prototype,"massSubscribe",null),QS([ES({argsMap:function(e,t,n,r){return[t.uid,n,r]}}),$S("design:type",Function),$S("design:paramtypes",[eD,String,Number]),$S("design:returntype",by)],mM.prototype,"unsubscribe",null),QS([ES({argsMap:function(e,t){return t.map((function(e){var t=e.user,n=e.mediaType;return{uid:null==t?void 0:t.uid,mediaType:n}}))}}),$S("design:type",Function),$S("design:paramtypes",[Array]),$S("design:returntype",by)],mM.prototype,"massUnsubscribe",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],mM.prototype,"setLowStreamParameter",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"enableDualStream",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"disableDualStream",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String,Object]),$S("design:returntype",by)],mM.prototype,"setClientRole",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String,Boolean]),$S("design:returntype",void 0)],mM.prototype,"setProxyServer",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object,Boolean]),$S("design:returntype",void 0)],mM.prototype,"setTurnServer",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",void 0)],mM.prototype,"setLicense",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",void 0)],mM.prototype,"startProxyServer",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],mM.prototype,"stopProxyServer",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",void 0)],mM.prototype,"setLocalAccessPointsV2",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Array,String]),$S("design:returntype",void 0)],mM.prototype,"setLocalAccessPoints",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",by)],mM.prototype,"setRemoteDefaultVideoStreamType",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object,Number]),$S("design:returntype",by)],mM.prototype,"setRemoteVideoStreamType",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object,Number]),$S("design:returntype",by)],mM.prototype,"setStreamFallbackOption",null),QS([ES({argsMap:function(e,t){return[t]}}),$S("design:type",Function),$S("design:paramtypes",[String,String,Uint8Array]),$S("design:returntype",void 0)],mM.prototype,"setEncryptionConfig",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],mM.prototype,"renewToken",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",void 0)],mM.prototype,"enableAudioVolumeIndicator",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String,Boolean]),$S("design:returntype",by)],mM.prototype,"startLiveStreaming",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],mM.prototype,"setLiveTranscoding",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String]),$S("design:returntype",by)],mM.prototype,"stopLiveStreaming",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[String,Object]),$S("design:returntype",by)],mM.prototype,"addInjectStreamUrl",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"removeInjectStreamUrl",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Jx]),$S("design:returntype",by)],mM.prototype,"startChannelMediaRelay",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Jx]),$S("design:returntype",by)],mM.prototype,"updateChannelMediaRelay",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"stopChannelMediaRelay",null),QS([ES({argsMap:function(e,t){return Array.isArray(t)||(t=[t]),[JSON.stringify(t)]}}),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],mM.prototype,"sendCustomReportMessage",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object,Object]),$S("design:returntype",by)],mM.prototype,"pickSVCLayer",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Number]),$S("design:returntype",by)],mM.prototype,"setRTM2Flag",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Object]),$S("design:returntype",by)],mM.prototype,"enableContentInspect",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",by)],mM.prototype,"disableContentInspect",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Boolean,Object]),$S("design:returntype",by)],mM.prototype,"setImageModeration",null),QS([ES({reportResult:!0}),$S("design:type",Function),$S("design:paramtypes",[]),$S("design:returntype",Array)],mM.prototype,"getJoinChannelServiceRecords",null),QS([ES(),$S("design:type",Function),$S("design:paramtypes",[Boolean]),$S("design:returntype",by)],mM.prototype,"setPublishAudioFilterEnabled",null);var gM=Py().name,yM=function(){function e(t,n){l(this,e),kf(this,"id",0),kf(this,"element",void 0),kf(this,"peerPair",void 0),kf(this,"context",void 0),kf(this,"audioPlayerElement",void 0),kf(this,"audioTrack",void 0),e.count+=1,this.id=e.count,this.element=t,this.context=n}return d(e,[{key:"initPeers",value:function(){var e=this;this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=function(t){var n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),e.audioPlayerElement=n}}},{key:"switchSdp",value:function(){var e=c(s().mark((function e(){var t,n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.peerPair){e.next=2;break}return e.abrupt("return");case 2:return t=function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("offer"!==n){e.next=6;break}return e.next=3,t.createOffer();case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.createAnswer();case 8:e.t0=e.sent;case 9:return r=e.t0,e.next=12,t.setLocalDescription(r);case 12:return e.abrupt("return","complete"===t.iceGatheringState?t.localDescription:new by((function(e){t.onicegatheringstatechange=function(){"complete"===t.iceGatheringState&&e(t.localDescription)}})));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n=function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setRemoteDescription(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,t(this.peerPair[0],"offer");case 6:return r=e.sent,e.next=9,n(this.peerPair[1],r);case 9:return e.next=11,t(this.peerPair[1],"answer");case 11:return i=e.sent,e.next=14,n(this.peerPair[0],i);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(3),new ek(Oy.LOCAL_AEC_ERROR,e.t0.toString()).print();case 19:case"end":return e.stop()}}),e,this,[[3,16]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTracksFromMediaElement",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioTrack){e.next=2;break}return e.abrupt("return",this.audioTrack);case 2:e.prev=2,t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new ek(Oy.LOCAL_AEC_ERROR,e.t0.toString()).print();case 10:if(n){e.next=12;break}throw new ek(Oy.LOCAL_AEC_ERROR,"no dest node when local aec").print();case 12:return r=n.stream.getAudioTracks()[0],e.abrupt("return",(this.audioTrack=r,r));case 14:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getElement",value:function(){return this.element}},{key:"startEchoCancellation",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.context.resume(),this.peerPair&&this.close(),this.initPeers(),t=this.element,e.next=4,this.getTracksFromMediaElement(t);case 4:return n=e.sent,this.peerPair&&this.peerPair[0].addTrack(n),e.next=8,this.switchSdp();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){lS.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((function(e){e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}]),e}();kf(yM,"count",0);var _M=window.AudioContext||window.webkitAudioContext,EM=function(){function e(){l(this,e),kf(this,"units",[]),kf(this,"context",void 0)}return d(e,[{key:"processExternalMediaAEC",value:function(e){if(!this._doesEnvironmentNeedAEC())return lS.debug("the system does not need to process local aec"),-1;this.context||(this.context=new _M);var t=this.units.find((function(t){return t&&t.getElement()===e}));return t||(t=new yM(e,this.context),this.units.push(t)),t.startEchoCancellation(),lS.debug("start processing local audio echo cancellation, id is",t.id),t.id}},{key:"_doesEnvironmentNeedAEC",value:function(){return Py().name!==Ty.SAFARI}}]),e}();QS([ES({report:bS}),$S("design:type",Function),$S("design:paramtypes",[HTMLAudioElement]),$S("design:returntype",Number)],EM.prototype,"processExternalMediaAEC",null);var bM=new EM;function wM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wM(Object(n),!0).forEach((function(t){kf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kM=window||document;function TM(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(kM){var n=IM._cspEventHandlerPointer;if(n&&t)console.error(n,t);else{var r=function(e){if(e&&e.blockedURI&&(IM.onSecurityPolicyViolation||IM.getListeners(Fk.SECURITY_POLICY_VIOLATION).length>0)){var t=e.blockedURI;$w("CSP_DETECTED_HOSTNAME_LIST").some((function(e){return $i(t).call(t,e)}))&&(IM.onSecurityPolicyViolation&&"function"==typeof IM.onSecurityPolicyViolation&&IM.onSecurityPolicyViolation(e),IM.getListeners(Fk.SECURITY_POLICY_VIOLATION).length>0&&IM.safeEmit(Fk.SECURITY_POLICY_VIOLATION,e))}};n&&kM.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||IM.getListeners(Fk.SECURITY_POLICY_VIOLATION).length>0)&&kM.addEventListener("securitypolicyviolation",r),IM._cspEventHandlerPointer=r}}}Qw("PROCESS_ID","process-".concat(rE(8,""),"-").concat(rE(4,""),"-").concat(rE(4,""),"-").concat(rE(4,""),"-").concat(rE(12,""))),function(){var e=Py();AI.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),AI.getStreamFromExtension=e.name===Ty.CHROME&&Number(e.version)>34,AI.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),AI.supportMinBitrate=e.name===Ty.CHROME||e.name===Ty.EDGE,AI.supportSetRtpSenderParameters=function(){var e=Py();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!t_()||!(!By()&&!Uy())||e.name===Ty.FIREFOX&&Number(e.version)>=64)}(),e.name===Ty.SAFARI&&(Number(e.version)>=14?AI.supportDualStream=!0:AI.supportDualStream=!1),AI.webAudioMediaStreamDest=function(){var e=Py();return!(e.name===Ty.SAFARI&&Number(e.version)<12)}(),AI.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,AI.supportWebGL="undefined"!=typeof WebGLRenderingContext,AI.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,t_()||(AI.webAudioWithAEC=!0),AI.supportShareAudio=function(){var e=Py();return(e.os===ky.WIN_10||e.os===ky.WIN_81||e.os===ky.WIN_7||e.os===ky.LINUX||e.os===ky.MAC_OS)&&e.name===Ty.CHROME&&Number(e.version)>=74}(),AI.supportDataChannel=!!(qy(76)||function(e){var t=Py();return!(t.name!==Ty.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){var t=Py();return!(t.name!==Ty.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14)),AI.supportPCSetConfiguration=function(){var e=window.RTCPeerConnection;return!Gy()&&!!e&&e.prototype.setConfiguration instanceof Function}(),AI.supportWebRTCEncodedTransform=function(){var e=Py();return"Chrome"===e.name&&Number(e.version)>=86}(),AI.supportWebRTCInsertableStream=function(){var e=Py();return(e.name===Ty.CHROME||e.name===Ty.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),H_((function(){AI.supportDualStreamEncoding=function(){var e=Py();return!!$w("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&$w("CHROME_DUAL_STREAM_USE_ENCODING"))}(),lS.info("browser compatibility",JSON.stringify(AI),JSON.stringify(e))}))}(),function(){var e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void lS.error("Error loading sdk config",e.message)}if(e)try{var t=JSON.parse(window.atob(e)),n=Date.now();lS.debug("Loading global parameters from cache",t),Object.keys(t).forEach((function(e){if(Object.prototype.hasOwnProperty.call(Xw,e)){var r=t[e],i=r.value,a=r.expires;if(a&&a<=n)return;eS[e]=i,Xw[e]=i}}))}catch(w){lS.error("Error loading mutableParamsCache: ".concat(e),w.message)}}(),Array.isArray(eS.AREAS)&&eS.AREAS.length>0&&ux(eS.AREAS,!0);var IM=function(e){var t=new O_,n=e,r={getListeners:t.getListeners.bind(t),on:function(e,n){return function(e,t){e===Fk.SECURITY_POLICY_VIOLATION&&TM(t,!0)}(e,n),t.on.bind(t)(e,n)},addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return SM(SM({},n),r)}({__TRACK_LIST__:rI,VERSION:zw,BUILD:Jw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:function(e,t,n){lS.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Qw(e,t,n)},getParameter:$w,getSupportedCodec:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={audio:[],video:[]},e.prev=1,(n=new RTCPeerConnection).addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),e.next=6,n.createOffer();case 6:if(r=e.sent.sdp){e.next=9;break}return e.abrupt("return",t);case 9:n.close(),n=null,t=function(e){var t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(r),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),new ek(Oy.CREATE_OFFER_FAILED,e.t0.toString&&e.t0.toString()).print();case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}(),checkSystemRequirements:function(){var e=bS.reportApiInvoke(null,{name:__.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:E_.TRACER}),t=!1;try{var n=window.RTCPeerConnection,r=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;t=!!(n&&r&&i)}catch(e){return lS.error("check system requirement failed: ",e),!1}var a=!1,o=Py();o.name===Ty.CHROME&&Number(o.version)>=58&&(!Fy()||jy())&&(a=!0),o.name===Ty.FIREFOX&&Number(o.version)>=56&&(a=!0),o.name===Ty.OPERA&&Number(o.version)>=45&&(a=!0),o.name===Ty.SAFARI&&Number(o.version)>=11&&(a=!0),($y()||Py().name===Ty.QQ)&&(a=!0),lS.debug("checkSystemRequirements, api:",t,"browser",a);var s=t&&a;return e.onSuccess(s),s},getDevices:function(e){return JI.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return JI.getRecordingDevices(e)},getCameras:function(e){return JI.getCamerasDevices(e)},getElectronScreenSources:jI,getPlaybackDevices:function(e){return JI.getSpeakers(e)},createClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},t=bS.reportApiInvoke(null,{name:__.CREATE_CLIENT,options:[e],tag:E_.TRACER});try{!function(e){c_(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),c_(e.mode,"config.mode",["rtc","live"]),void 0!==e.audioCodec&&c_(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&d_(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&L_(e.turnServer),void 0!==e.httpRetryConfig&&D_(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&D_(e.websocketRetryConfig)}(e)}catch(e){throw t.onError(e),e}return void 0===e.audioCodec&&(e.audioCodec="opus"),t.onSuccess(),new mM(vM(vM({forceWaitGatewayResponse:!0},e),{},{role:"rtc"===e.mode?"host":e.role||"audience"}))},createCameraVideoTrack:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_CAM_VIDEO_TRACK,options:[WC({},t)]}),r=SC(t),i=rE(8,"track-cam-"),a=null,lS.info("start create camera video track with config",JSON.stringify(t),"trackId",i),e.prev=4,e.next=7,qI({video:r},i);case 7:if(e.t0=e.sent.getVideoTracks()[0],e.t0){e.next=10;break}e.t0=null;case 10:a=e.t0,e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(4),n.onError(e.t1),e.t1;case 16:if(a){e.next=19;break}return o=new o_(Oy.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(n.onError(o),o.throw(lS)));case 19:return t.optimizationMode&&HC(i,a,t,GT(t.encoderConfig)),c=new ZC(a,t,r,t.scalabiltyMode?qT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i),e.abrupt("return",(n.onSuccess(c.getTrackId()),lS.info("create camera video success, trackId:",i),c));case 22:case"end":return e.stop()}}),e,null,[[4,13]])})));function t(){return e.apply(this,arguments)}return t}(),createCustomVideoTrack:function(e){var t=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new GC(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?qT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,rE(8,"track-cus-"),[zT.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),lS.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o,c,u,l,d,f,p,h,v,m=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:{},n=m.length>1&&void 0!==m[1]?m[1]:"disable",r=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_SCREEN_VIDEO_TRACK,options:[WC({},t),n]}),t.encoderConfig?"string"==typeof t.encoderConfig||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2",i=function(e){var t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Vy()&&(t.extensionId=e.extensionId);var n=e.displaySurface,r=e.selfBrowserSurface,i=e.surfaceSwitching,a=e.systemAudio;(qy(107)||Wy(107)||Hy(93))&&(n&&(c_(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(c_(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(c_(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(qy(105)||Wy(105)||Hy(91))&&a&&(c_(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);var o=e.encoderConfig?ZT(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(t),a=rE(8,"track-scr-v-"),o=null,c=null,(u=OI()).supportShareAudio||"enable"!==n){e.next=9;break}return l=new o_(Oy.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),e.abrupt("return",(r.onError(l),l.throw(lS)));case 9:return lS.info("start create screen video track with config",t,"withAudio",n,"trackId",a),e.prev=10,e.next=13,qI({screen:i,screenAudio:"auto"===n?u.supportShareAudio:"enable"===n},a);case 13:d=e.sent,o=d.getVideoTracks()[0]||null,c=d.getAudioTracks()[0]||null,e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(10),r.onError(e.t0),e.t0;case 20:if(o){e.next=23;break}return f=new o_(Oy.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(r.onError(f),f.throw(lS)));case 23:if(c||"enable"!==n){e.next=27;break}return o&&o.stop(),p=new o_(Oy.SHARE_AUDIO_NOT_ALLOWED),e.abrupt("return",(r.onError(p),p.throw(lS)));case 27:if(t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(HC(a,o,t,t.encoderConfig&&ZT(t.encoderConfig)||void 0),t.encoderConfig&&"string"!=typeof t.encoderConfig&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax)),h=new GC(o,t.encoderConfig?ZT(t.encoderConfig):{},t.scalabiltyMode?qT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[zT.SCREEN_TRACK]),c){e.next=31;break}return e.abrupt("return",(r.onSuccess(h.getTrackId()),lS.info("create screen video track success","video:",h.getTrackId()),h));case 31:return v=new _C(c,void 0,rE(8,"track-scr-a-"),!1,!0),e.abrupt("return",(r.onSuccess([h.getTrackId(),v.getTrackId()]),lS.info("create screen video track success","video:",h.getTrackId(),"audio:",v.getTrackId()),[h,v]));case 33:case"end":return e.stop()}}),e,null,[[10,17]])})));function t(){return e.apply(this,arguments)}return t}(),createMicrophoneAndCameraTracks:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o,c,u,l,d,f,p,h,v=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:{},n=v.length>1&&void 0!==v[1]?v[1]:{},r=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_MIC_AND_CAM_TRACKS,options:[t,n]}),i=SC(n),a=kC(t),o=rE(8,"track-mic-"),c=rE(8,"track-cam-"),u=null,l=null,lS.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(n))),e.prev=4,e.next=7,qI({audio:a,video:i},"".concat(o,"-").concat(c));case 7:d=e.sent,u=d.getAudioTracks()[0],l=d.getVideoTracks()[0],e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(4),r.onError(e.t0),e.t0;case 14:if(u&&l){e.next=17;break}return f=new o_(Oy.UNEXPECTED_ERROR,"can not find tracks in media stream"),e.abrupt("return",(r.onError(f),f.throw(lS)));case 17:return n.optimizationMode&&HC(c,l,n,GT(n.encoderConfig)),p=new EC(u,t,a,o),h=new ZC(l,n,i,n.scalabiltyMode?qT(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c),e.abrupt("return",(r.onSuccess([p.getTrackId(),h.getTrackId()]),lS.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[p,h]));case 20:case"end":return e.stop()}}),e,null,[[4,11]])})));function t(){return e.apply(this,arguments)}return t}(),createMicrophoneAudioTrack:function(){var e=c(s().mark((function e(){var t,n,r,i,a,o,c,u=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_MIC_AUDIO_TRACK,options:[t]}),r=kC(t),i=rE(8,"track-mic-"),a=null,lS.info("start create microphone audio track with config",JSON.stringify(t),"trackId",i),e.prev=4,e.next=7,qI({audio:r},i);case 7:if(e.t0=e.sent.getAudioTracks()[0],e.t0){e.next=10;break}e.t0=null;case 10:a=e.t0,e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(4),n.onError(e.t1),e.t1;case 16:if(a){e.next=19;break}return o=new o_(Oy.UNEXPECTED_ERROR,"can not find track in media stream"),e.abrupt("return",(n.onError(o),o.throw(lS)));case 19:return c=new EC(a,t,r,i),e.abrupt("return",(n.onSuccess(c.getTrackId()),lS.info("create microphone audio track success, trackId:",i),c));case 21:case"end":return e.stop()}}),e,null,[[4,13]])})));function t(){return e.apply(this,arguments)}return t}(),createCustomAudioTrack:function(e){var t=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new _C(e.mediaStreamTrack,e.encoderConfig?HT(e.encoderConfig):{},rE(8,"track-cus-"),!1,!0);return lS.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c,u,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.cacheOnlineFile,i=t.encoderConfig,a=t.source,o={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?null!==(n=File.name)&&void 0!==n?n:"File":a,cacheOnlineFile:r,encoderConfig:i},c=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CREATE_BUFFER_AUDIO_TRACK,options:[o]}),!$w("DISABLE_WEBAUDIO")){e.next=5;break}throw new o_(Oy.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");case 5:if(u=rE(8,"track-buf-"),lS.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",u),l=a,a instanceof AudioBuffer){e.next=18;break}return e.prev=9,e.next=12,CC(a,r);case 12:a=e.sent,e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(9),e.abrupt("return",(c.onError(e.t0),e.t0.throw(lS)));case 18:return d=new TC(a),f=new bC(l,d,i?HT(i):{},u),e.abrupt("return",(lS.info("create buffer source audio track success, trackId:",u),c.onSuccess(f.getTrackId()),f));case 20:case"end":return e.stop()}}),e,null,[[9,15]])})));function t(t){return e.apply(this,arguments)}return t}(),setAppType:function(e){if(lS.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw lS.debug("Invalid appType"),new ek(Oy.INVALID_PARAMS,"invalid app type",e);Qw("APP_TYPE",Math.floor(e))},setLogLevel:function(e){lS.setLogLevel(e)},enableLogUpload:function(){$w("USE_NEW_LOG")?Qw("UPLOAD_LOG",!0):lS.enableLogUpload()},disableLogUpload:function(){$w("USE_NEW_LOG")?Qw("UPLOAD_LOG",!1):lS.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Jx},checkAudioTrackIsActive:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c,u,l,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:5e3,r=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]}),t instanceof _C||t instanceof XC){e.next=5;break}return i=new ek(Oy.INVALID_TRACK,"the parameter is not a audio track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return n&&n<1e3&&(n=1e3),a=t instanceof _C?t.getTrackLabel():"remote_track",o=t.getVolumeLevel(),c=o,u=o,l=Date.now(),e.abrupt("return",new by((function(e){var i=setInterval((function(){var o=t.getVolumeLevel(),s=(c=o>c?o:c)-(u=o<u?o:u)>1e-4,d=Date.now()-l;if(s||d>n){clearInterval(i);var f=s,p={duration:d,deviceLabel:a,maxVolumeLevel:c,result:f};lS.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(p))),r.onSuccess(p),e(f)}}),200)})));case 10:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),checkVideoTrackIsActive:function(){var e=c(s().mark((function e(t){var n,r,i,a,o,c,u,l,d,f,p,h,v=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:5e3,r=bS.reportApiInvoke(null,{tag:E_.TRACER,name:__.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]}),t instanceof GC||t instanceof JC){e.next=5;break}return i=new ek(Oy.INVALID_TRACK,"the parameter is not a video track"),e.abrupt("return",(r.onError(i),i.throw()));case 5:return n&&n<1e3&&(n=1e3),a=t instanceof GC?t.getTrackLabel():"remote_track",o=t.getMediaStreamTrack(!0),(c=document.createElement("video")).style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(By()||Uy())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([o]),c.play(),(u=document.createElement("canvas")).width=160,u.height=120,l=0,d=0,e.prev=11,f=Date.now(),e.next=15,function(e,t,n,r){var i,a=0,o=null;return new by((function(s,c){function u(){a>r&&i&&(i(),s(a));var t=n.getContext("2d");if(!t){var u=new ek(Oy.UNEXPECTED_ERROR,"can not get canvas 2d context.");return lS.error(u.toString()),void c(u)}t.drawImage(e,0,0,160,120);var l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(o){for(var f=0;f<d;f+=3)if(l.data[f]!==o[f])return a+=1,void(o=l.data);o=l.data}else o=l.data}setTimeout((function(){i&&(i(),s(a))}),t),i=RI((function(){u()}),30)}))}(c,n,u,4);case 15:l=e.sent,d=Date.now()-f,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(11),r.onError(e.t0),e.t0;case 22:return gM===Ty.SAFARI&&(c.pause(),c.remove()),c.srcObject=null,h={duration:d,changedPicNum:l,deviceLabel:a,result:p=l>4},e.abrupt("return",(lS.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(h))),r.onSuccess(h),p));case 25:case"end":return e.stop()}}),e,null,[[11,19]])})));function t(t){return e.apply(this,arguments)}return t}(),setArea:ux,audioElementPlayCenter:iC,processExternalMediaAEC:function(e){bM.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach((function(e){var t=e;t.__registered__=!0,t.logger.hookLog=lS.extLog,t.reporter.hookApiInvoke=bS.extApiInvoke,t.parameters&&Object.keys(t.parameters).forEach((function(e){t.parameters[e]=$w(e)}))}))},ChannelMediaRelayError:pk,ChannelMediaRelayEvent:dk,ChannelMediaRelayState:fk,RemoteStreamFallbackType:XT,RemoteStreamType:JT,ConnectionDisconnectedReason:w_,AudienceLatencyLevelType:b_,AREAS:_k});return Object.defineProperties(IM,{onAudioAutoplayFailed:{get:function(){return QI.onAudioAutoplayFailed},set:function(e){QI.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:function(){return QI.onAutoplayFailed},set:function(e){QI.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:function(){return IM._onSecurityPolicyViolation},set:function(e){IM._onSecurityPolicyViolation=e,TM(e)}},__CLIENT_LIST__:{get:function(){return $w("SHOW_GLOBAL_CLIENT_LIST")?TS:[]}}}),JI.on(cI.CAMERA_DEVICE_CHANGED,(function(e){lS.info("camera device changed",JSON.stringify(e)),IM.onCameraChanged&&IM.onCameraChanged(e),IM.safeEmit(Fk.CAMERA_CHANGED,e)})),JI.on(cI.RECORDING_DEVICE_CHANGED,(function(e){lS.info("microphone device changed",JSON.stringify(e)),IM.onMicrophoneChanged&&IM.onMicrophoneChanged(e),IM.safeEmit(Fk.MICROPHONE_CHANGED,e)})),JI.on(cI.PLAYOUT_DEVICE_CHANGED,(function(e){lS.debug("playout device changed",JSON.stringify(e)),IM.onPlaybackDeviceChanged&&IM.onPlaybackDeviceChanged(e),IM.safeEmit(Fk.PLAYBACK_DEVICE_CHANGED,e)})),iC.onAutoplayFailed=function(){lS.info("detect audio element autoplay failed"),QI.onAudioAutoplayFailed&&QI.onAudioAutoplayFailed()},wI.on("autoplay-failed",(function(){lS.info("detect webaudio autoplay failed"),QI.onAudioAutoplayFailed&&QI.onAudioAutoplayFailed(),IM.safeEmit(Fk.AUTOPLAY_FAILED)})),B_.on(I_.NETWORK_STATE_CHANGE,(function(e,t){lS.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=IM),IM}()},1197:function(module,__unused_webpack_exports,__webpack_require__){"use strict";var t;module=__webpack_require__.nmd(module),t=function(){function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sl(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function a(e){sl(s,r,i,a,o,"next",e)}function o(e){sl(s,r,i,a,o,"throw",e)}var s=e.apply(t,n);a(void 0)}))}}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ha(e,t,n){return t&&tl(e.prototype,t),n&&tl(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function la(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&df(e,t)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function df(e,t){return(df=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ul(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Sh(e,t,n){return(Sh=ul()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&df(e,n.prototype),e}).apply(null,arguments)}function ef(e){var t="function"==typeof Map?new Map:void 0;return(ef=function(e){function n(){return Sh(e,arguments,wd(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),df(n,e)})(e)}function ff(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var a=i[r];0<=t.indexOf(a)||(n[a]=e[a])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),a=0;a<r.length;a++)i=r[a],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var t=ul();return function(){var r=wd(e);if(t){var i=wd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function Th(e,t,n){return(Th="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wd(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function ra(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0;var s=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw s}}n=i}if(!(e=n||vl(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function G(e){var t=Array.isArray(e)?Uh(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||vl(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function vl(e,t){if(e){if("string"==typeof e)return Uh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uh(e,t)}}function Uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fa(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function $a(e){var t={exports:{}};return e(t,t.exports),t.exports}function wl(e,t){var n,r=3>arguments.length?e:arguments[2];return va(e)===r?e[t]:(n=Fb.f(e,t))?Q(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ha(n=Vb(e))?wl(n,t,r):void 0}function rs(e){var t=e.charCodeAt(0)<<24,n=0|ss(~t),r=0,i=0|e.length,a="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?a+=xd(t):1114111>=t?a+=xd(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)a+="\ufffd";return a}function xl(){}function ts(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return xd(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return xd(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?xd(192|t>>>6,128|63&t):xd(224|t>>>12,128|t>>>6&63,128|63&t)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,t,n,r){ng(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var a=i[t]}return void 0===a?(i[t]=n,++e._eventsCount):("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),0<(n=void 0===e._maxListeners?ea.defaultMaxListeners:e._maxListeners)&&a.length>n&&!a.warned&&(a.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=a.length,console&&console.warn&&console.warn(n))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=us.bind(e)).listener=n,e.wrapFn=t}function Bl(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Cl(t,t.length);return n}function Dl(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Cl(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function vs(e,t,n){"function"==typeof e.on&&El(e,"error",t,n)}function El(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(t,(function i(a){r.once&&e.removeEventListener(t,i),n(a)}))}}function ws(e){return e?G(e):xs((function(){return[]}),(function(e,t){return e.push(t),e}))}function Fl(e,t){var n,r,i,a;return w.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=Gl(e)([Hl,Hl,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){o.next=17;break}if(i=t[r],!((a=n(Vh,i))instanceof og)){o.next=11;break}if((a=Wh(a.deref()))===Vh){o.next=10;break}return o.next=10,a;case 10:return o.abrupt("return");case 11:if(a===Vh){o.next=14;break}return o.next=14,a;case 14:r++,o.next=2;break;case 17:case"end":return o.stop()}}),ys)}function pg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Fl(pg(e),t):function(t){var n=t[2];return zs(t,(function(t,r){return n(t,e(r))}))}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return"Object"===Ac(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var t;return(t="Boolean"===Ac(e)||"Null"===Ac(e)||"Undefined"===Ac(e))||(t="Number"===Ac(e)&&!isNaN(e)),t||"String"===Ac(e)||"Symbol"===Ac(e)}function zd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function gf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qg;++t<n;)this.add(e[t])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,t,n,r,i,a){var o,s=1&t,c=2&t,u=4&t;if(n&&(o=i?n(e,r,i,a):n(e)),void 0!==o)return o;if(!lb(e))return e;if(r=Va(e)){if(o=As(e),!s)return Xh(e,o)}else{var l=hf(e),d="[object Function]"==l||"[object GeneratorFunction]"==l;if(jf(e))return Jl(e,s);if("[object Object]"==l||"[object Arguments]"==l||d&&!i){if(o=c||d?{}:Kl(e),!s)return c?Bs(e,Cs(o,e)):Ds(e,Es(o,e))}else{if(!wa[l])return i?e:{};o=Fs(e,l,s)}}if(a||(a=new ge),i=a.get(e))return i;a.set(e,o),Gs(e)?e.forEach((function(r){o.add(fe(r,t,n,r,e,a))})):Hs(e)&&e.forEach((function(r,i){o.set(i,fe(r,t,n,i,e,a))})),c=u?c?Ll:Yh:c?kf:Ad;var f=r?void 0:c(e);return Is(f||e,(function(r,i){f&&(r=e[i=r]),Ml(o,i,fe(r,t,n,i,e,a))})),o}function Zh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;return a.has(i)?a.get(i):(r=e.apply(this,r),n.cache=a.set(i,r)||a,r)};return n.cache=new(Zh.Cache||qg),n}function Nl(e){if("string"==typeof e)return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var t=e+"";return"0"==t&&1/e==-Js?"-0":t}function $h(e,t,n,r,i){var a=-1,o=e.length;for(n||(n=Ks),i||(i=[]);++a<o;){var s=e[a];0<t&&n(s)?1<t?$h(s,t-1,n,r,i):ai(i,s):r||(i[i.length]=s)}return i}function je(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!gc(e)&&!gc(t))t=e!=e&&t!=t;else e:{var a=Va(e),o=Va(t),s=a?"[object Array]":hf(e),c=o?"[object Array]":hf(t),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(o="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&jf(e)){if(!jf(t)){t=!1;break e}a=!0,u=!1}if(c&&!u)i||(i=new ge),t=a||bi(e)?Pl(e,t,n,r,je,i):Ls(e,t,s,n,r,je,i);else{if(!(1&n)&&(a=u&&Ql.call(e,"__wrapped__"),s=o&&Ql.call(t,"__wrapped__"),a||s)){e=a?e.value():e,t=s?t.value():t,i||(i=new ge),t=je(e,t,n,r,i);break e}if(c)t:if(i||(i=new ge),a=1&n,s=Yh(e),o=s.length,c=Yh(t).length,o==c||a){for(c=o;c--;){var l=s[c];if(!(a?l in t:Ms.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var d=a;++c<o;){var f=e[l=s[c]],p=t[l];if(r)var h=a?r(p,f,l,t,e,i):r(f,p,l,e,t,i);if(void 0===h?f!==p&&!je(f,p,n,r,i):!h){u=!1;break}d||(d="constructor"==l)}u&&!d&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function xa(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function mb(e){return!0===(e&&e.__isLong__)}function Bd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Rl[e]))return n;n=ya(e,0>(0|e)?-1:0,!0),t&&(Rl[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Sl[e]))return n;n=ya(e,0>e?-1:0,!1),t&&(Sl[e]=n)}return n}function Gb(e,t){if(isNaN(e))return t?Cd:Hb;if(t){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,t).neg():ya(e%ke|0,e/ke|0,t)}function ya(e,t,n){return new xa(e,t,n)}function ci(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Hb;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return ci(e.substring(1),t,n).neg();r=Gb(sg(n,8));for(var i=Hb,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),s=parseInt(e.substring(a,a+o),n);8>o?(o=Gb(sg(n,o)),i=i.mul(o).add(Gb(s))):i=(i=i.mul(r)).add(Gb(s))}return i.unsigned=t,i}function Wb(e,t){return"number"==typeof e?Gb(e,t):"string"==typeof e?ci(e,t):ya(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function O(e,t){function n(){this.constructor=e}_di(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function le(e){return"function"==typeof e}function me(e){setTimeout((function(){throw e}),0)}function ei(e){return null!==e&&"object"===X(e)}function Xl(e){return e.reduce((function(e,t){return e.concat(t instanceof lf?t.errors:t)}),[])}function fi(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof ia?t:null}return!0}function Yc(e){return e}function gi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yl(e)}function Yl(e){return 0===e.length?Yc:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y((function(t){return e.schedule((function(){return t.complete()}))}))}function Zc(e){return e&&"function"==typeof e.schedule}function hi(e,t){return new Y((function(n){var r=new Oa,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function nf(e,t){return t?hi(e,t):new Y(am(e))}function bb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Zc(t=e[e.length-1])?(e.pop(),hi(e,t)):nf(e)}function Z(e,t){return new Y(t?function(n){return t.schedule(Ps,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Rs(e,t))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Ss(e,t))}}function cm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return cm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,a=this,o={context:a,subject:i,callbackFunc:e,scheduler:n};return new Y((function(r){if(n)return n.schedule(Ts,0,{args:t,subscriber:r,params:o});if(!i){i=new of;try{e.apply(a,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){fi(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function Ts(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var a=i.context,o=i.scheduler,s=i.subject;if(!s){s=i.subject=new of,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(o.schedule(Us,0,{value:1>=e.length?e[0]:e,subject:s}))};try{e.apply(a,n.concat([i]))}catch(e){s.error(e)}}this.add(s.subscribe(r))}function Us(e){var t=e.subject;t.next(e.value),t.complete()}function dm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return dm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Y((function(r){var a=i.context,o=i.subject;if(n)return n.schedule(Vs,0,{params:i,subscriber:r,context:a});if(!o){o=i.subject=new of;try{e.apply(a,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?o.error(t):(o.next(1>=e.length?e[0]:e),o.complete())}]))}catch(e){fi(o)?o.error(e):console.warn(e)}}return o.subscribe(r)}))}}function Vs(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,a=n.args,o=n.scheduler,s=n.subject;if(!s){s=n.subject=new of,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(o.schedule(em,0,{err:n,subject:s})):t.add(o.schedule(Ws,0,{value:1>=e.length?e[0]:e,subject:s}))};try{i.apply(e,a.concat([n]))}catch(e){this.add(o.schedule(em,0,{err:e,subject:s}))}}this.add(s.subscribe(r))}function Ws(e){var t=e.subject;t.next(e.value),t.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function ji(e,t,n,r,i){if(void 0===i&&(i=new Xs(e,n,r)),!i.closed)return t instanceof Y?t.subscribe(i):pf(t)(i)}function Ys(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){var i=e[ne]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function Zs(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function $s(e,t){if(!e)throw Error("Iterable cannot be null");return new Y((function(n){var r,i=new Oa;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[$c](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function gm(e,t){if(null!=e){if(e&&"function"==typeof e[ne])return Ys(e,t);if(fm(e))return Zs(e,t);if(hm(e))return hi(e,t);if(e&&"function"==typeof e[$c]||"string"==typeof e)return $s(e,t)}throw new TypeError((null!==e&&X(e)||e)+" is not observable")}function Kb(e,t){return t?gm(e,t):e instanceof Y?e:new Y(pf(e))}function ic(e,t){if(!t.closed){if(e instanceof Y)return e.subscribe(t);try{var n=pf(e)(t)}catch(e){t.error(e)}return n}}function cb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(cb((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new at(e,n))})}function tg(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Kb(n):mf()).subscribe(t)}))}function jm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Jb(n))return ug(n,null);if(ei(n)&&Object.getPrototypeOf(n)===Object.prototype)return ug((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return ug(e=1===e.length&&Jb(e[0])?e[0]:e,null).pipe(ba((function(e){return r.apply(void 0,e)})))}return ug(e,null)}function ug(e,t){return new Y((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),a=0,o=0,s=function(s){var c=Kb(e[s]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,o++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++a!==r&&u||(o===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c)}))}function gb(e,t,n,r){return le(n)&&(r=n,n=void 0),r?gb(e,t,n).pipe(ba((function(e){return Jb(e)?r.apply(void 0,e):r(e)}))):new Y((function(r){km(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function km(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var a=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),a=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),a=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var o=0,s=e.length;o<s;o++)km(e[o],t,n,r,i)}r.add(a)}function lm(e,t,n){return n?lm(e,t).pipe(ba((function(e){return Jb(e)?n.apply(void 0,e):n(e)}))):new Y((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(le(t))return function(){return t(r,i)}}))}function bt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,t){return void 0===e&&(e=0),void 0===t&&(t=bd),(!ki(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=bd),new Y((function(n){return n.add(t.schedule(ct,e,{subscriber:n,counter:0,period:e})),n}))}function ct(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Xb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return Zc(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Y?e[0]:tg(t)(nf(e,n))}function li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return vb;var n=e[0],r=e.slice(1);return 1===e.length&&Jb(n)?li.apply(void 0,n):new Y((function(e){var t=function(){return e.add(li.apply(void 0,r).subscribe(e))};return Kb(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function dt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var a=t[n];r.next([a,e[a]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function et(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function wb(e,t){return function(n){return n.lift(new ft(e,t))}}function Ca(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Bc(e,t,n){void 0===e&&(e=0);var r=-1;return ki(t)?r=1>Number(t)?1:Number(t):Zc(t)&&(n=t),Zc(n)||(n=bd),new Y((function(t){var i=ki(e)?e:+e-n.now();return n.schedule(it,i,{index:0,period:r,subscriber:t})}))}function it(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),nf(e,void 0).lift(new jt(t))}function Ga(e){return function(t){var n=new kt(e);return t=t.lift(n),n.caught=t}}function ni(e,t){return cb(e,t,1)}function nm(e){return void 0===e&&(e=null),function(t){return t.lift(new lt(e))}}function cd(e,t){void 0===t&&(t=bd);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new mt(n,t))}}function om(e,t){return function(n){return n.lift(new nt(e,t))}}function Dd(e){return void 0===e&&(e=ot),function(t){return t.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(t){return 0===e?mf():t.lift(new qt(e))}}function pm(e,t){return t?function(n){return n.pipe(pm((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new rt(e))}}function wg(e){return function(t){return t.lift(new st(e))}}function aa(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?wb((function(t,n){return e(t,n,r)})):Yc,Ka(1),n?nm(t):Dd((function(){return new vg})))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(t){return 0===e?mf():t.lift(new vt(e))}}function qf(e){return function(t){return t.lift(new wt(e))}}function xg(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new xt(e,t,n))}}function rm(e,t){return 2<=arguments.length?function(n){return gi(xg(e,t),qm(1),nm(t))(n)}:function(t){return gi(xg((function(t,n,r){return e(t,n,r+1)})),qm(1))(t)}}function yt(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new zt(r,t));var i=Object.create(n,At);return i.source=n,i.subjectFactory=r,i}}function oe(e){return function(t){return t.lift(new Bt(e,t))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,t,n){var r=e&&"object"===X(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(Dt(r))}}function Dt(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,a=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,o=e.refCount,s=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new qe(i,a,s)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&o&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Cc(e,t){return"function"==typeof t?function(n){return n.pipe(Cc((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Et(e))}}function ob(e){return function(t){return t.lift(new Ft(e))}}function Gt(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Ht(e,t))}}function ca(e,t,n){return function(r){return r.lift(new It(e,t,n))}}function Jt(e,t,n){return void 0===t&&(t=bd),void 0===n&&(n=Kt),function(r){return r.lift(new Lt(e,t,n.leading,n.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,t,n){return void 0===n&&(n=bd),function(r){var i=e instanceof Date&&!isNaN(+e),a=i?+e-n.now():Math.abs(e);return r.lift(new Ot(a,i,t,n))}}function hb(e,t){return void 0===t&&(t=bd),Nt(e,Z(new pb),t)}function Pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new Qt(e,n))}}function tm(e,t,n,r,i){e!==t&&um(t,(function(a,o){if(i||(i=new ge),lb(a)){a=i;var s=oi(e,o),c=oi(t,o),u=a.get(c);if(u)pi(e,o,u);else{var l=void 0===(u=r?r(s,c,o+"",e,t,a):void 0);if(l){var d=Va(c),f=!d&&jf(c),p=!d&&!f&&bi(c);u=c,d||f||p?Va(s)?u=s:gc(s)&&Ed(s)?u=Xh(s):f?(l=!1,u=Jl(c,!0)):p?(l=!1,u=vm(c,!0)):u=[]:wm(c)||rf(c)?(u=s,rf(s)?u=re(s,kf(s)):lb(s)&&!qi(s)||(u=Kl(c))):l=!1}l&&(a.set(c,u),tm(u,c,n,r,a),a.delete(c)),pi(e,o,u)}}else void 0===(s=r?r(oi(e,o),a,o+"",e,t,i):void 0)&&(s=a),pi(e,o,s)}),kf)}function Rt(e){var t=1,n=ri;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(xg((function(t,i){var a=n.now(),o=a-e;if((t=t.filter((function(e){return e.until>o}))).length>=r){var s=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:s.until<a?c-a:c-s.until,until:c,value:i})}else t.push({delay:0,until:a,value:i});return t}),[]),ba((function(e){return e[e.length-1]})),ni((function(e){var t=bb(e.value);return e.delay?t.pipe(cd(e.delay,n)):t})))}}function St(e,t){var n=(t=void 0===t?{protocols:xm,makeWebSocket:ym}:t).protocols,r=void 0===n?xm:n,i=void 0===(t=t.makeWebSocket)?ym:t;return new Y((function(t){var n,a=new Pa,o=i(e,r),s=!1,c=!1,u=function(e){if(n)throw s=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){o.send(e)})),a};return o.onopen=function(){c?(s=!0,o.close()):t.next(u)},o.onmessage=function(e){a.next(e.data)},o.onerror=function(e){s=!0,t.error(Error(e.message))},o.onclose=function(e){s||(s=!0,c?(t.complete(),a.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),s||(s=!0,o.close())}}))}function yg(){this._listeners={}}function zm(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){a[0]=e,t[n]=o[0],t[n+1]=o[1],t[n+2]=o[2],t[n+3]=o[3]}function n(e,t,n){a[0]=e,t[n]=o[3],t[n+1]=o[2],t[n+2]=o[1],t[n+3]=o[0]}function r(e,t){return o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],o[3]=e[t+3],a[0]}function i(e,t){return o[3]=e[t],o[2]=e[t+1],o[1]=e[t+2],o[0]=e[t+3],a[0]}var a=new Float32Array([-0]),o=new Uint8Array(a.buffer),s=128===o[3];e.writeFloatLE=s?t:n,e.writeFloatBE=s?n:t,e.readFloatLE=s?r:i,e.readFloatBE=s?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var a=Math.floor(Math.log(t)/Math.LN2);e((i<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Am),e.writeFloatBE=t.bind(null,Bm),e.readFloatLE=n.bind(null,Cm),e.readFloatBE=n.bind(null,Dm)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){a[0]=e,t[n]=o[0],t[n+1]=o[1],t[n+2]=o[2],t[n+3]=o[3],t[n+4]=o[4],t[n+5]=o[5],t[n+6]=o[6],t[n+7]=o[7]}function n(e,t,n){a[0]=e,t[n]=o[7],t[n+1]=o[6],t[n+2]=o[5],t[n+3]=o[4],t[n+4]=o[3],t[n+5]=o[2],t[n+6]=o[1],t[n+7]=o[0]}function r(e,t){return o[0]=e[t],o[1]=e[t+1],o[2]=e[t+2],o[3]=e[t+3],o[4]=e[t+4],o[5]=e[t+5],o[6]=e[t+6],o[7]=e[t+7],a[0]}function i(e,t){return o[7]=e[t],o[6]=e[t+1],o[5]=e[t+2],o[4]=e[t+3],o[3]=e[t+4],o[2]=e[t+5],o[1]=e[t+6],o[0]=e[t+7],a[0]}var a=new Float64Array([-0]),o=new Uint8Array(a.buffer),s=128===o[7];e.writeDoubleLE=s?t:n,e.writeDoubleBE=s?n:t,e.readDoubleLE=s?r:i,e.readDoubleBE=s?i:r}():function(){function t(e,t,n,r,i,a){var o=0>r?1:0;if(o&&(r=-r),0===r)e(0,i,a+t),e(0<1/r?0:2147483648,i,a+n);else if(isNaN(r))e(0,i,a+t),e(2146959360,i,a+n);else if(17976931348623157e292<r)e(0,i,a+t),e((o<<31|2146435072)>>>0,i,a+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,a+t),e((o<<31|r/4294967296)>>>0,i,a+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),e(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,a+t),e((o<<31|s+1023<<20|1048576*r&1048575)>>>0,i,a+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047===(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Am,0,4),e.writeDoubleBE=t.bind(null,Bm,4,0),e.readDoubleLE=n.bind(null,Cm,0,4),e.readDoubleBE=n.bind(null,Dm,4,0)}(),e}function Am(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Bm(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function Cm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Dm(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Wa(e,t){this.lo=e>>>0,this.hi=t>>>0}function sf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,t,n){t[n]=255&e}function ui(e,t){this.len=e,this.next=void 0,this.val=t}function vi(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function wi(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,t,n){40>e.length?V.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function Yb(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function za(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Gm(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Hm(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(t))throw new I("attributes must be an object",Ja);if(Object.keys(t).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);if(0===Object.keys(t).length)throw new I("The attributes is an empty object",Ja);var a=0,o=0;for(t=Object.entries(t);o<t.length;o++){var s=ra(t[o],2),c=s[1];s=new Blob([s[0]]).size;var u=new Blob([c]).size;if(0===s||32<s)throw new I("Invalid attribute key",Ja);if(u>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);if("string"!=typeof c||0===c.length)throw new I("Invalid attribute value",Ja);a+=s,a+=u}if(a>e)throw new ib("The attributes size overflow",se);if(void 0!==n){if(Object.keys(n).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);for(a=r=0,n=Object.entries(n);a<n.length;a++){if(o=(t=ra(n[a],2))[1],0===(t=new Blob([t[0]]).size))throw new I("Invalid attribute key",Ja);if(o>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);r+=t,r+=o}if(r>e)throw new ib("The attributes size overflow",se)}}function Ag(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),t=Ag(1,4294967295);return new U(e,t,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function Jm(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,t){t="".concat(e).concat(t||"");var n=Lm.get(t)||1;return Lm.set(t,n+1),"".concat(e).concat(n)}function Mm(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Cg(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pm(e){return e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e)}function Dg(e){var t=255&e,n=e>>8&255,r=e>>16&255;return"".concat(e>>24&255,".").concat(r,".").concat(n,".").concat(t)}function te(e,t,n){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark((function e(t,n,r){var i,a,o,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,S,k,T,I,C,R,A,O;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,a=n.headers,o=void 0===a?{}:a,s=n.timeout,c=void 0===s?1e4:s,u=n.signal,l=n.withCredentials,d=void 0!==l&&l,f=(r||{}).useBinaryResponse,p=void 0!==f&&f,(h=new XMLHttpRequest).open("POST",t,!0),h.responseType=p?"arraybuffer":"text",h.withCredentials=d,h.timeout=c,v=i instanceof FormData,m=i instanceof Uint8Array,!(1<(g=Object.keys(o).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===g.length&&(m?o["Content-Type"]="application/octet-stream":v||(o["Content-Type"]="application/json"));case 15:if("setRequestHeader"in h){e.next=46;break}return h.abort(),e.next=19,fetch(t,{body:v||m?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:o,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(y=e.sent,!(200<=(_=y.status)&&300>_||304===_)){e.next=31;break}if(!p){e.next=27;break}return e.next=25,y.arrayBuffer();case 25:return E=e.sent,e.abrupt("return",{status:_,responseData:E});case 27:return e.next=29,y.text();case 29:return b=e.sent,e.abrupt("return",{status:_,responseText:b});case 31:return S=new da(["Post XHR failure, status %d",_]),e.prev=32,e.next=35,y.text();case 35:throw k=e.sent,S.statusCode=_,S.message=k||"Request failed, status ".concat(_),S;case 41:throw e.prev=41,e.t0=e.catch(32),S.statusCode=_,S.message="Request failed, status ".concat(_),S;case 46:if(0!==Object.keys(o).length)for(T=0,I=Object.entries(o);T<I.length;T++)C=ra(I[T],2),R=C[0],A=C[1],h.setRequestHeader(R,A);return void 0!==u&&(O=function e(){h.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",O)),v||m?h.send(i):h.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){h.onload=function(){var n=h.status;if(200<=n&&300>n||304===n)e(p?{status:n,responseData:h.response}:{status:n,responseText:h.responseText});else{var r=new da(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=h.response||"Request failed, status ".concat(h.status),t(r)}},h.ontimeout=function(e){t(new db(["XHR request timed out after %d ms",c],{originalError:e}))},h.onerror=function(){var e=new da(["Post XHR failure, status %d",h.status]);e.statusCode=h.status,e.message=h.response||"Request failed, status ".concat(h.status),t(e)},h.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.abrupt("return",new Promise((function(e,t){n.onload=function(){e({width:n.width,height:n.height})},n.onerror=t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e,t){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,f;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.thumbnailHeight,i=void 0===r?0:r,a=t.thumbnailWidth,o=void 0===a?0:a,s=t.width,c=void 0===s?0:s,u=t.height,l=void 0===u?0:u,d=t.thumbnail,f=[],"number"==typeof i&&"number"==typeof o&&"number"==typeof c&&"number"==typeof l){e.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c&&0>=l&&f.push(Rm(Sm(n)).then((function(e){c=e.width,l=e.height}))),0>=o&&0>=i&&void 0!==d&&f.push(Ji(d).then(function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rm(Sm(t));case 2:n=e.sent,o=n.width,i=n.height;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=9,Promise.all(f).catch((function(){}));case 9:return e.abrupt("return",{width:c,height:l,thumbnailWidth:o,thumbnailHeight:i});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tm(e,t){if(!yd(e))throw new I("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new I("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new I("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new I("Text messages cannot have rawMessage property",t)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,S;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,a=t.session,o=t.errorCodes,s=t.diff,c=t.logger,u=t.options,void 0!==a){e.next=3;break}throw new K("The client is not logged in. Cannot do the operation",o.NOT_LOGGED_IN);case 3:if(l=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=11;break}if(d=n.text.split("_"),f=ra(d,3),p=f[0],h=f[1],void 0!==f[2]&&za(h)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===p){e.next=10;break}throw new I("Message is not valid",ve);case 10:l=!0;case 11:if(v=Date.now(),m=a.messageSentTimes.length-1,!((g=a.messageSentTimes[m])&&g+3e3<v)){e.next=18;break}a.messageSentTimes=[v],e.next=29;break;case 18:y=m;case 19:if(!(0<=y)){e.next=28;break}if(!(a.messageSentTimes[y]+3e3<v)){e.next=23;break}return a.messageSentTimes=a.messageSentTimes.slice(y+1,m+1),e.abrupt("break",28);case 23:if(!(180<=m-y+1)){e.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",o.TOO_OFTEN);case 25:y--,e.next=19;break;case 28:a.messageSentTimes.push(v);case 29:e.t0=n.messageType,e.next="TEXT"===e.t0?32:"RAW"===e.t0?37:"FILE"===e.t0||"IMAGE"===e.t0?39:40;break;case 32:if(!l){e.next=36;break}return _=n.text.split("_"),E=ra(_,3),b=E[1],S=E[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",a.sendInvitationMessage({peerId:r,type:"CallCancel",extra:S,channelId:b,callId:"0"}));case 36:return e.abrupt("return",a.sendTextMessage(n.text,r,i,u,1e4-s));case 37:return void 0===n.description&&(n.description=""),e.abrupt("return",a.sendRawMessage(n.rawMessage,n.description,r,i,u,1e4-s));case 39:return e.abrupt("return",a.sendMediaMessage(n.messageType,n,r,i,u,1e4-s));case 40:throw new I("Invalid message type",ve);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function oa(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Um(e,t,n,"*".repeat(n-t))}function Vm(e,t,n){function r(i){if(void 0===e)return e;if(Il(i))return i;if(Array.isArray(i))return i.map(r);var a={},o=0;for(i=Hg(i);o<i.length;o++){var s=ra(i[o],2),c=s[0];if("string"==typeof(s=s[1])&&n.includes(c)){a[c]="string"==typeof s?oa(s):"[Sensitive Info]";break}t.includes(c)?a[c]="[Hidden Info]":a[c]=null==s?s:n.includes(c)?"[Sensitive Info]":r(s)}return a}return Array.isArray(e)?e.map(r):r(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==X(t=e[t])&&null!==t&&Wm(t)})),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return(new TextEncoder).encode(e).length}function Xm(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function we(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function Ji(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){var e=r.result||new ArrayBuffer(0);t(e)},r.onerror=n,r.readAsArrayBuffer(e)}))}function Zt(e,t){e=e=[e],"string"==typeof(t=t||{})&&(t={type:t});try{var n=new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<e.length;r+=1)n.append(e[r]);n=n.getBlob(t.type)}return n}function Um(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function Ym(e){var t=[];return function e(n){if(null===n||"object"!==X(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if($t.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function Jg(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function bu(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===F.GLOBAL&&n===F.CHINA)return xe([F.OVERSEA]);if(t.includes(F.GLOBAL)){if(e=xf(Kg).filter((function(e){return e!==F.GLOBAL&&e!==F.OVERSEA})),n in yf){t=yf[n];var r=[].concat(G(null!=t?t:[]),[n]);return xe(e.filter((function(e){return!r.includes(e)})))}if(Zm(n)){var i=cu(n);return xe(e.filter((function(e){return e!==n&&e!==i})))}}if(Zm(n)||n in yf)return xe(t);throw new I("Invalid excludedArea area config")}function Ma(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(G(i.map(ye))));try{var o=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(w.mark((function n(){var r,a;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==o?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,ye(r)):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,ye(r)):e.resultTracker("%s result is %s",t,r.name||(null===(a=r.constructor)||void 0===a?void 0:a.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),o},n}function Nb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var o=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(w.mark((function n(){var r,a;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==o?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,r):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(a=r.constructor)||void 0===a?void 0:a.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),o},n}function du(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=Li[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=$m[e])(t),t=e.encode(t).finish(),new eu({uri:n,data:t})}function an(e,t){return"".concat(e.split(".").join("-"),".edge.").concat(t?"sd-rtn.com":"agora.io")}function eb(e,t,n){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark((function e(t,n,r){var i,a;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return i=fu[t].encode(n).finish(),a=function(){var e=J(w.mark((function e(n){var o,s,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(s=1<u.length&&void 0!==u[1]?u[1]:0))){e.next=3;break}return e.abrupt("return");case 3:return c=we(c=r?"https://".concat(null!==(o=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==o?o:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=6443&d=events/proto-raw"):"https://".concat(n,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),c=we(c,"id",gu[t].toString()),e.next=8,te(c,{body:i,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return a(n,s+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=4,e.next=7,a((null==M?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),e.next=13,a(M&&bn(1<(null==M?void 0:M.EVENT_REPORT_DOMAIN.length)?null==M?void 0:M.EVENT_REPORT_DOMAIN.slice(1):null==M?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function fb(e){return void 0===e?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map((function(e){return parseInt(e,16)})))).replace(/={1,2}$/,"")}function Lg(e,t){return U.fromValue(e).eq(t)}function Mg(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,a=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=Ni(i),iu(i,Lg).length===i.length&&void 0!==ju(i,(function(e){return Lg(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===a,t=void 0!==t&&n.toString(2).length<=a,!(e||r||t)))throw Error("invalid field value")}function cn(e){return function(){var t=e();if(!t)throw new K("Client is not logged in. Cannot do the operation");return t}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng("object"==typeof globalThis&&globalThis)||Ng("object"==typeof window&&window)||Ng("object"==typeof self&&self)||Ng("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch(e){return!0}},ka=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Zb(e)?lu.call(e,""):Object(e)}:Object,jb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return"object"==typeof e?null!==e:"function"==typeof e},lc=function(e,t){if(!ha(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!ha(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,t){return mu.call(Qa(e),t)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R((function(){return 7!=Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a})),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,t){if(e=qb(e),t=lc(t,!0),fn)try{return gn(e,t)}catch(e){}if(Q(e,t))return dd(!zf.call(e,t),e[t])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,t,n){if(va(e),t=lc(t,!0),va(n),fn)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Na=ka?function(e,t,n){return Ra.f(e,t,dd(1,n))}:function(e,t,n){return e[t]=n,e},Oi=function(e,t){try{Na(y,e,t)}catch(n){y[e]=t}return t},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;"function"!=typeof ed.inspectSource&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou="function"==typeof jn&&/native code/.test(Pi(jn)),fd=$a((function(e){(e.exports=function(e,t){return ed[e]||(ed[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})})),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,t){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return t.facade=e,tu.call(Gd,e,t),t},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,t){if(Q(e,Ce))throw new TypeError("Object already initialized");return t.facade=e,Na(e,Ce,t),t},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=Qg(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ta=$a((function(e){var t=Za.get,n=Za.enforce,r=String(String).split("String");(e.exports=function(e,t,i,a){var o=!!a&&!!a.unsafe,s=!!a&&!!a.enumerable;if(a=!!a&&!!a.noTargetGet,"function"==typeof i){"string"!=typeof t||Q(i,"name")||Na(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===y?s?e[t]=i:Oi(t,i):(o?!a&&e[t]&&(s=!0):delete e[t],s?e[t]=i:Na(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Pi(this)}))})),mn=function(e){return"function"==typeof e?e:void 0},mc=function(e,t){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][t]||y[e]&&y[e][t]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,t){return 0>(e=$b(e))?xu(e+t,0):yu(e,t)},nn=function(e){return function(t,n,r){t=qb(t);var i=ta(t.length);if(r=xb(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,t){e=qb(e);var n,r=0,i=[];for(n in e)!Q(Be,n)&&Q(e,n)&&i.push(n);for(;t.length>r;)Q(e,n=t[r++])&&(~Si(i,n)||i.push(n));return i},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var t=Hd.f(va(e)),n=Bf.f;return n?t.concat(n(e)):t},rn=function(e,t){for(var n=qn(t),r=Ra.f,i=Fb.f,a=0;a<n.length;a++){var o=n[a];Q(e,o)||r(e,o,i(t,o))}},Au=/#|\.prototype\./,nc=function(e,t){return(e=Bu[Cu(e)])==Du||e!=Eu&&("function"==typeof t?R(t):!!t)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,t){var n,r,i,a=e.target,o=e.global,s=e.stat;if(r=o?y:s?y[a]||Oi(a,{}):(y[a]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=Fu(r,i))&&n.value:r[i];if(!(n=nc(o?i:a+(s?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;rn(c,u)}(e.sham||u&&u.sham)&&Na(c,"sham",!0);try{Ta(r,i,c,e)}catch(e){}}},yb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Id=function(e,t,n){if(yb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},gd=Array.isArray||function(e){return"Array"==Zb(e)},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R((function(){return!String(Symbol())||!Symbol.sham&&id&&41>id})),vn=oc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||"string"==typeof Cf[e])||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,t){if(gd(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!gd(n.prototype)?ha(n)&&null===(n=n[Hu])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},wn=[].push,jd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(c,u,l,d){var f=Qa(c),p=Af(f);u=Id(u,l,3),l=ta(p.length);var h,v=0;for(d=d||Sg,c=t?d(c,l):n||o?d(c,0):void 0;l>v;v++)if((s||v in p)&&(h=u(d=p[v],v,f),e))if(t)c[v]=h;else if(h)switch(e){case 3:return!0;case 5:return d;case 6:return v;case 2:wn.call(c,d)}else switch(e){case 4:return!1;case 7:wn.call(c,d)}return a?-1:r||i?i:c}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6);jd(7);var Ku=qa("species"),Ef=function(e){return 51<=id||!R((function(){var t=[];return(t.constructor={})[Ku]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R((function(){Dc(1)}));N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,t){var n=[][e];return!!n&&R((function(){n.call(null,t||function(){throw 1},1)}))},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),void 0===e?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var t=e.return;if(void 0!==t)return va(t.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return void 0!==e&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,t,n){(t=lc(t))in e?Ra.f(e,t,dd(0,n)):e[t]=n},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi="[object z]"===String(Bn),Uu=qa("toStringTag"),Vu="Arguments"==Zb(function(){return arguments}()),Ff=Wi?Zb:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Uu];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Vu?Zb(e):"Object"==(t=Zb(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Wu=qa("iterator"),Xi=function(e){if(null!=e)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,(function(){throw 2}))}catch(c){}var Tg=function(e,t){if(!t&&!Dn)return!1;var n=!1;try{(t={})[Cn]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Yu=!Tg((function(e){Array.from(e)}));N({target:"Array",stat:!0,forced:Yu},{from:function(e){var t,n=Qa(e),r="function"==typeof this?this:Array,i=arguments.length,a=1<i?arguments[1]:void 0,o=void 0!==a,s=Xi(n),c=0;if(o&&(a=Id(a,2<i?arguments[2]:void 0,2)),null==s||r==Array&&Vi(s)){var u=ta(n.length);for(r=new r(u);u>c;c++)s=o?a(n[c],c):n[c],Ge(r,c,s)}else for(i=(n=s.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(o){s=n;var l=a;t=[t.value,c];try{u=l(va(t)[0],t[1])}catch(e){throw Ui(s),e}}else u=t.value;Ge(r,c,s=u)}return r.length=c,r}});var Fn=function(e){return function(t,n){t=String(jb(t)),n=$b(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var a=t.charCodeAt(n);return 55296>a||56319<a||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):a:e?t.slice(n,n+2):r-56320+(a-55296<<10)+65536}};Fn(!1);var Gn=Fn(!0),Hn=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(null==Kd||R((function(){var e={};return Kd[Yi].call(e)!==e})))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,t){va(e);for(var n,r=Dc(t),i=r.length,a=0;i>a;)Ra.f(e,n=r[a++],t[n]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,_Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(_Wg=e,e=Rg.length;e--;)delete _Wg.prototype[Rg[e]];return _Wg()};Be[Mn]=!0;var ac=Object.create||function(e,t){if(null!==e){$i.prototype=va(e);var n=new $i;$i.prototype=null,n[Mn]=e}else n=_Wg();return void 0===t?n:av(n,t)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,t,n){e&&!Q(e=n?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:t})},cv=function(){return this},dv=function(e,t,n){return t+=" Iterator",e.prototype=ac(Ug,{next:dd(1,n)}),Ec(e,t,!1),Fe[t]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(va(t),!ha(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,t,n,r,i,a,o){dv(n,t,r),r=function(e){if(e===i&&f)return f;if(!Vg&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var s,c=t+" Iterator",u=!1,l=e.prototype,d=l[Gf]||l["@@iterator"]||i&&l[i],f=!Vg&&d||r(i),p="Array"==t&&l.entries||d;if(p&&(e=Vb(p.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):"function"!=typeof e[Gf]&&Na(e,Gf,ev)),Ec(e,c,!0))),"values"==i&&d&&"values"!==d.name&&(u=!0,f=function(){return d.call(this)}),l[Gf]!==f&&Na(l,Gf,f),Fe[t]=f,i){var h={values:r("values"),keys:a?f:r("keys"),entries:r("entries")};if(o)for(s in h)!Vg&&!u&&s in l||Ta(l,s,h[s]);else N({target:t,proto:!0,forced:Vg||u},h)}return h},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",(function(e){fv(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=gv(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Gn(t,n),e.index+=t.length,{value:t,done:!1})}));var cj=qa("unscopables"),dj=Array.prototype;null==dj[cj]&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find((function(){On=!1})),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var t=String(jb(this)),n="";if(0>(e=$b(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,t,n){for(var r in t)Ta(e,r,t[r],n);return e},Qn=qa("species"),If=function(e){e=mc(e);var t=Ra.f;ka&&e&&!e[Qn]&&t(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Jf=function(e,t){this.stopped=e,this.result=t},Xg=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),a=!(!n||!n.IS_ITERATOR),o=!(!n||!n.INTERRUPTED),s=Id(t,n&&n.that,1+i+o),c=function(e){return u&&Ui(u),new Jf(!0,e)};if(t=function(e){return i?(va(e),o?s(e[0],e[1],c):s(e[0],e[1])):o?s(e,c):s(e)},a)var u=e;else{if("function"!=typeof(a=Xi(e)))throw TypeError("Target is not iterable");if(Vi(a)){for(a=0,n=ta(e.length);n>a;a++)if((r=t(e[a]))&&r instanceof Jf)return r;return new Jf(!1)}u=a.call(e)}for(e=u.next;!(a=e.call(u)).done;){try{r=t(a.value)}catch(e){throw Ui(u),e}if("object"==typeof r&&r&&r instanceof Jf)return r}return new Jf(!1)},iv=qa("species"),kd=function(e,t){var n;return void 0===(e=va(e).constructor)||null==(n=va(e)[iv])?t:yb(n)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc="process"==Zb(y.process),Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var t=Kf[e];delete Kf[e],t()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Kf[++gj]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&"function"==typeof postMessage&&!y.importScripts&&Yg&&"file:"!==Yg.protocol&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var t=Md.fn;Md=Md.next;try{t()}catch(e){throw Md?$g():Mf=void 0,e}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=yb(t),this.reject=yb(n)},lj={f:function(e){return new nv(e)}},mj=function(e,t){return va(e),ha(t)&&t.constructor===e?t:((0,(e=lj.f(e)).resolve)(t),e.promise)},ov=function(e,t){var n=y.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},nj=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},pv="object"==typeof window,qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,_zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io="function"==typeof PromiseRejectionEvent,jo=!1,Nf=nc("Promise",(function(){var e=Pi(_zb)!==String(_zb);if(!e&&66===id)return!0;if(51<=id&&/native code/.test(_zb))return!1;var t=new _zb((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[qv]=n,!(jo=t.then((function(){}))instanceof n)||!e&&pv&&!io})),vv=Nf||!Tg((function(e){_zb.all(e).catch((function(){}))})),ko=function(e){var t;return!(!ha(e)||"function"!=typeof(t=e.then))&&t},qj=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fo((function(){for(var r=e.value,i=1==e.state,a=0;n.length>a;){var o,s=n[a++],c=i?s.ok:s.fail,u=s.resolve,l=s.reject,d=s.domain;try{if(c){if(i||(2===e.rejection&&wv(e),e.rejection=1),!0===c)var f=r;else if(d&&d.enter(),f=c(r),d){d.exit();var p=!0}f===s.promise?l(ho("Promise-chain cycle")):(o=ko(f))?o.call(f,u,l):u(f)}else l(r)}catch(e){d&&!p&&d.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&xv(e)}))}},lo=function(e,t,n){var r;if(uv){var i=oj.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),y.dispatchEvent(i)}else i={promise:t,reason:n};!io&&(r=y["on"+e])?r(i):"unhandledrejection"===e&&ov("Unhandled promise rejection",n)},xv=function(e){jj.call(y,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=nj((function(){Hc?pj.emit("unhandledRejection",n,t):lo("unhandledrejection",t,n)}));if(e.rejection=Hc||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},wv=function(e){jj.call(y,(function(){var t=e.facade;Hc?pj.emit("rejectionHandled",t):lo("rejectionhandled",t,e.value)}))},Ie=function(e,t,n){return function(r){e(t,r,n)}},Je=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,qj(e,!0))},rj=function e(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw ho("Promise can't be resolved itself");var i=ko(n);i?fo((function(){var r={done:!1};try{i.call(n,Ie(e,r,t),Ie(Je,r,t))}catch(n){Je(r,n,t)}})):(t.value=n,t.state=1,qj(t,!1))}catch(n){Je({done:!1},n,t)}}};if(Nf){_zb=function(e){Gc(this,_zb,"Promise"),yb(e),sj.call(this);var t=go(this);try{e(Ie(rj,t),Ie(Je,t))}catch(e){Je(t,e)}},bh=_zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,t){var n=sv(this),r=He(kd(this,_zb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hc?pj.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&qj(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,t=go(e);this.promise=e,this.resolve=Ie(rj,t),this.reject=Ie(Je,t)};if(lj.f=He=function(e){return e===_zb||e===zv?new yv(e):tv(e)},"function"==typeof Fc&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",(function(e,t){var n=this;return new _zb((function(e,t){Av.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch(c){}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:_zb}),Ec(_zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var t=He(this);return t.reject.call(void 0,e),t.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var t=this,n=He(t),r=n.resolve,i=n.reject,a=nj((function(){var n=yb(t.resolve),a=[],o=0,s=1;Xg(e,(function(e){var c=o++,u=!1;a.push(void 0),s++,n.call(t,e).then((function(e){u||(u=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=He(t),r=n.reject,i=nj((function(){var i=yb(t.resolve);Xg(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},pc=R((function(){var e=RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Cv=R((function(){var e=RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),po=pc||Cv,vj=void 0!==/()??/.exec("")[1],c,a;(uj||vj||po)&&(oo=function(e){var t,n=po&&this.sticky,r=tj.call(this),i=this.source,a=0,o=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),o=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",o=" "+o,a++);var s=new RegExp("^(?:"+i+")",r)}if(vj&&(s=new RegExp("^"+i+"$(?!\\s)",r)),uj)var c=this.lastIndex;var u=ch.call(n?s:this,o);return n?u?(u.input=u.input.slice(a),u[0]=u[0].slice(a),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:uj&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),vj&&u&&1<u.length&&Dv.call(u[0],s,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)})),u});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),qo="$0"==="a".replace(/./,"$0"),ro=qa("replace"),so=!!/./[ro]&&""===/./[ro]("a","$0"),Gv=!R((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),dh=function(e,t,n,r){var i=qa(e),a=!R((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!R((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[Ev]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!a||!o||"replace"===e&&(!Fv||!qo||so)||"split"===e&&!Gv){var s=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var o=t.exec;return o===Of||o===wj.exec?a&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,n[0]),Ta(wj,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&Na(wj[i],"sham",!0)},xj=function(e,t,n){return t+(n?Gn(e,t).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,t,n,r,i,a){var o=n+e.length,s=r.length,c=Kv;return void 0!==i&&(i=Qa(i),c=Jv),Iv.call(a,c,(function(a,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(o);case"<":a=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return a;if(u>s)return 0===(u=Hv(u/10))?a:u<=s?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):a;a=r[u-1]}return void 0===a?"":a}))},Ke=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==Zb(e))throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,t)},Mv=Math.max,Nv=Math.min,Ov=function(e){return void 0===e?e:String(e)};dh("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,a=r.REPLACE_KEEPS_$0,o=i?"$":"$0";return[function(n,r){var i=jb(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&a||"string"==typeof r&&-1===r.indexOf(o)){var s=n(t,e,this,r);if(s.done)return s.value}var c=va(e);e=String(this),(s="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var d=[];;){var f=Ke(c,e);if(null===f)break;if(d.push(f),!u)break;""===String(f[0])&&(c.lastIndex=xj(e,ta(c.lastIndex),l))}for(l="",u=c=0;u<d.length;u++){f=d[u];for(var p=String(f[0]),h=Mv(Nv($b(f.index),e.length),0),v=[],m=1;m<f.length;m++)v.push(Ov(f[m]));f=f.groups,s?(v=[p].concat(v,h,e),void 0!==f&&v.push(f),f=String(r.apply(void 0,v))):f=Lv(p,e,h,v,f,r),h>=c&&(l+=e.slice(c,h)+f,c=h+p.length)}return l+e.slice(c)}]}));var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,t){var n=qb(this),r=ta(n.length);if(e=xb(e,r),t=xb(void 0===t?r:t,r),gd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!gd(i.prototype)?ha(i)&&null===(i=i[Qv])&&(i=void 0):i=void 0,i===Array||void 0===i)return Rv.call(n,e,t)}for(i=new(void 0===i?Array:i)(Sv(t-e,0)),r=0;e<t;e++,r++)e in n&&Ge(i,r,n[e]);return i.length=r,i}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",(function(e,t){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:t})}),(function(){var e=Uv(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Le=function(e){if(void 0===e)return 0;e=$b(e);var t=ta(e);if(e!==t)throw RangeError("Wrong length or index");return t},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var t=Qa(this),n=ta(t.length),r=arguments.length,i=xb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:xb(r,n);n>i;)t[i++]=e;return t},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,_Ab2=bc,_cc=y.DataView,eh=_cc&&_cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,t,n){var r,i=Array(n),a=(1<<(n=8*n-t-1))-1,o=a>>1,s=23===t?Ic(2,-24)-Ic(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=Vv(e))!=e||1/0===e){e=e!=e?1:0;var l=a}else l=Wv(Xv(e)/Yv),1>e*(r=Ic(2,-l))&&(l--,r*=2),2<=(e=1<=l+o?e+s/r:e+s*Ic(2,1-o))*r&&(l++,r/=2),l+o>=a?(e=0,l=a):1<=l+o?(e=(e*r-1)*Ic(2,t),l+=o):(e=e*Ic(2,o-1)*Ic(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},xo=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,a=i>>1;r-=7,--n;var o=e[n--],s=127&o;for(o>>=7;0<r;s=256*s+e[n],n--,r-=8);var c=s&(1<<-r)-1;for(s>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===s)s=1-a;else{if(s===i)return c?NaN:o?-1/0:1/0;c+=Ic(2,t),s-=a}return(o?-1:1)*c*Ic(2,s-t)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,t){$v(e.prototype,t,{get:function(){return Me(this)[t]}})},md=function(e,t,n,r){n=Le(n);var i=Me(e);if(n+t>i.byteLength)throw fh("Wrong index");return e=Me(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},nd=function(e,t,n,r,i,a){n=Le(n);var o=Me(e);if(n+t>o.byteLength)throw fh("Wrong index");for(e=Me(o.buffer).bytes,n+=o.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[a?i:t-i-1]};if(to){if(!R((function(){bc(1)}))||!R((function(){new bc(-1)}))||R((function(){return new bc,new bc(1.5),new bc(NaN),"ArrayBuffer"!=bc.name}))){_Ab2=function(e){return Gc(this,_Ab2),new bc(Le(e))};for(var cw=_Ab2.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in _Ab2||Na(_Ab2,zj,bc[zj]);cw.constructor=_Ab2}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new _cc(new _Ab2(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,t){Eo.call(this,e,t<<24>>24)},setUint8:function(e,t){Eo.call(this,e,t<<24>>24)}},{unsafe:!0})}else _Ab2=function(e){Gc(this,_Ab2,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},_cc=function(e,t,n){Gc(this,_cc,"DataView"),Gc(e,_Ab2,"DataView");var r=Me(e).byteLength;if(0>(t=$b(t))||t>r)throw fh("Wrong offset");if(t+(n=void 0===n?r-t:ta(n))>r)throw fh("Wrong length");uo(this,{buffer:e,byteLength:n,byteOffset:t}),ka||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},ka&&(gh(_Ab2,"byteLength"),gh(_cc,"buffer"),gh(_cc,"byteLength"),gh(_cc,"byteOffset")),Hf(_cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){nd(this,1,e,yo,t)},setUint8:function(e,t){nd(this,1,e,yo,t)},setInt16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){nd(this,4,e,aw,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){nd(this,8,e,bw,t,2<arguments.length?arguments[2]:void 0)}});Ec(_Ab2,"ArrayBuffer"),Ec(_cc,"DataView");var Pf={ArrayBuffer:_Ab2,DataView:_cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R((function(){return!new Aj(2).slice(1,void 0).byteLength}));N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,t){if(void 0!==Go&&void 0===t)return Go.call(va(this),e);var n=va(this).byteLength;e=xb(e,n),t=xb(void 0===t?n:t,n),n=new(kd(this,Aj))(ta(t-e));for(var r=new Fo(this),i=new Fo(n),a=0;e<t;)i.setUint8(a++,r.getUint8(e++));return n}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&"Opera"!==Ff(y.opera),Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||"function"!=typeof qc||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var t in rc)if(Q(rc,Bb)){var n=y[t];if(n&&(e===n||Ko.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,t,n){if(ka){if(n)for(var r in rc){var i=y[r];if(i&&Q(i.prototype,e))try{delete i.prototype[e]}catch(e){}}dc[e]&&!n||Ta(dc,e,n?t:Jc&&Bj[e]||t)}},Oo=function(e,t,n){var r,i;if(ka){if(Ua){if(n)for(r in rc)if((i=y[r])&&Q(i,e))try{delete i[e]}catch(e){}if(qc[e]&&!n)return;try{return Ta(qc,e,n?t:Jc&&qc[e]||t)}catch(e){}}for(r in rc)!(i=y[r])||i[e]&&!n||Ta(i,e,t)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R((function(){Od(1)}))||!R((function(){new Od(-1)}))||!Tg((function(e){new Od,new Od(null),new Od(1.5),new Od(e)}),!0)||R((function(){return 1!==new Od(new gw(2),1,void 0).length})),kh=function(e,t){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},Ej=function(e){var t=Qa(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,a=Xi(t);if(null!=a&&!Vi(a)){var o=a.call(t),s=o.next;for(t=[];!(a=s.call(o)).done;)t.push(a.value)}for(i&&2<n&&(r=Id(r,arguments[2],2)),a=ta(t.length),o=new(Ne(this))(a),n=0;a>n;n++)o[n]=i?r(t[n],n):t[n];return o},lh=function(e,t,n){var r,i;return Ua&&"function"==typeof(r=t.constructor)&&r!==n&&ha(i=r.prototype)&&i!==n.prototype&&Ua(e,i),e},Sf=$a((function(e){var t=Hd.f,n=Za.get,r=Za.set,i=Ra.f,a=Fb.f,o=Math.round,s=y.RangeError,c=Pf.ArrayBuffer,u=Pf.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(Ne(e))(r);r>n;)e[n]=t[n++];return e},d=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},f=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=Ff(e))||"SharedArrayBuffer"==t},p=function(e,t){return jh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},h=function(e,t){return p(e,t=lc(t,!0))?dd(2,e[t]):a(e,t)},v=function(e,t,n){return!(p(e,t=lc(t,!0))&&ha(n)&&Q(n,"value"))||Q(n,"get")||Q(n,"set")||n.configurable||Q(n,"writable")&&!n.writable||Q(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};ka?(Qf||(Fb.f=h,Ra.f=v,d(Rf,"buffer"),d(Rf,"byteOffset"),d(Rf,"byteLength"),d(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:h,defineProperty:v}),e.exports=function(e,a,d){var p=e.match(/\d+$/)[0]/8,h=e+(d?"Clamped":"")+"Array",v="get"+e,m="set"+e,g=y[h],_=g;e=_&&_.prototype;var E={},b=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[v](t*p+e.byteOffset,!0)},set:function(e){var r=n(this);d&&(e=0>(e=o(e))?0:255<e?255:255&e),r.view[m](t*p+r.byteOffset,e,!0)},enumerable:!0})};Qf?Dj&&(_=a((function(e,t,n,r){return Gc(e,_,h),lh(ha(t)?f(t)?void 0!==r?new g(t,kh(n,p),r):void 0!==n?new g(t,kh(n,p)):new g(t):jh(t)?l(_,t):Ej.call(_,t):new g(Le(t)),e,_)})),Ua&&Ua(_,Po),Jd(t(g),(function(e){e in _||Na(_,e,g[e])})),_.prototype=e):(_=a((function(e,t,n,i){Gc(e,_,h);var a=0,o=0;if(ha(t)){if(!f(t))return jh(t)?l(_,t):Ej.call(_,t);var d=t;if(o=kh(n,p),t=t.byteLength,void 0===i){if(t%p)throw s("Wrong length");if(0>(i=t-o))throw s("Wrong length")}else if((i=ta(i)*p)+o>t)throw s("Wrong length");t=i/p}else t=Le(t),d=new c(i=t*p);for(r(e,{buffer:d,byteOffset:o,byteLength:i,length:t,view:new u(d)});a<t;)b(e,a++)})),Ua&&Ua(_,Po),e=_.prototype=ac(Rf)),e.constructor!==_&&Na(e,"constructor",_),No&&Na(e,No,h),E[h]=_,N({global:!0,forced:_!=g,sham:!Qf},E),"BYTES_PER_ELEMENT"in _||Na(_,"BYTES_PER_ELEMENT",p),"BYTES_PER_ELEMENT"in e||Na(e,"BYTES_PER_ELEMENT",p),If(h)}):e.exports=function(){}}));Sf("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var hw=Math.min,iw=[].copyWithin||function(e,t){var n=Qa(this),r=ta(n.length),i=xb(e,r),a=xb(t,r),o=2<arguments.length?arguments[2]:void 0;for(r=hw((void 0===o?r:xb(o,r))-a,r-i),o=1,a<i&&i<a+r&&(o=-1,a+=r-1,i+=r-1);0<r--;)a in n?n[i]=n[a]:delete n[i],i+=o,a+=o;return n};Aa("copyWithin",(function(e,t){return iw.call(Da(this),e,t,2<arguments.length?arguments[2]:void 0)})),Aa("every",(function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("fill",(function(e){return yj.apply(Da(this),arguments)})),Aa("filter",(function(e){var t=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),n=kd(this,this.constructor),r=0,i=t.length;for(n=new(Ne(n))(i);i>r;)n[r]=t[r++];return n})),Aa("find",(function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("findIndex",(function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("forEach",(function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("includes",(function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("indexOf",(function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&("values"==Fj.name||null==Fj.name),To=function(){return jw.call(Da(this))};Aa("entries",(function(){return lw.call(Da(this))})),Aa("keys",(function(){return kw.call(Da(this))})),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",(function(e){return mw.apply(Da(this),arguments)}));var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var t=qb(this),n=ta(t.length),r=n-1;for(1<arguments.length&&(r=nw(r,$b(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:Gj;Aa("lastIndexOf",(function(e){return pw.apply(Da(this),arguments)})),Aa("map",(function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(Ne(kd(e,e.constructor)))(t)}))}));var Vo=function(e){return function(t,n,r,i){yb(n),t=Qa(t);var a=Af(t),o=ta(t.length),s=e?o-1:0,c=e?-1:1;if(2>r)for(;;){if(s in a){i=a[s],s+=c;break}if(s+=c,e?0>s:o<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=s:o>s;s+=c)s in a&&(i=n(i,a[s],s,t));return i}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",(function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Aa("reduceRight",(function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var rw=Math.floor;Aa("reverse",(function(){for(var e,t=Da(this).length,n=rw(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var sw=R((function(){new Int8Array(1).set({})}));Aa("set",(function(e){Da(this);var t=kh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Qa(e),i=ta(r.length),a=0;if(i+t>n)throw RangeError("Wrong length");for(;a<i;)this[t+a]=r[a++]}),sw);var tw=[].slice,uw=R((function(){new Int8Array(1).slice()}));Aa("slice",(function(e,t){e=tw.call(Da(this),e,t);var n=kd(this,this.constructor);t=0;var r=e.length;for(n=new(Ne(n))(r);r>t;)n[t]=e[t++];return n}),uw),Aa("some",(function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var vw=[].sort;Aa("sort",(function(e){return vw.call(Da(this),e)})),Aa("subarray",(function(e,t){var n=Da(this),r=n.length;return e=xb(e,r),new(kd(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,ta((void 0===t?r:xb(t,r))-e))}));var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R((function(){Xo.call(new mh(1))})),yw=R((function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()}))||!R((function(){mh.prototype.toLocaleString.call([1,2])}));Aa("toLocaleString",(function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)}),yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R((function(){nh.call({})}))&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch(e){return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R((function(){return"/a/b"!=ap.call({source:"a",flags:"b"})})),Fw="toString"!=ap.name;(Ew||Fw)&&Ta(RegExp.prototype,"toString",(function(){var e=va(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):n)}),{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,t){var n,r,i=Qa(this),a=ta(i.length),o=xb(e,a),s=arguments.length;if(0===s?s=n=0:1===s?(s=0,n=a-o):(s-=2,n=Iw(Hw($b(t),0),a-o)),9007199254740991<a+s-n)throw TypeError("Maximum allowed length exceeded");var c=Sg(i,n);for(r=0;r<n;r++){var u=o+r;u in i&&Ge(c,r,i[u])}if(c.length=n,s<n){for(r=o;r<a-n;r++){var l=r+s;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=a;r>a-n+s;r--)delete i[r-1]}else if(s>n)for(r=a-n;r>o;r--)l=r+s-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<s;r++)i[r+o]=arguments[r+2];return i.length=a-n+s,c}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch(c){Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh])for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch(c){Kc[Oe]=ld[Oe]}}}var dp=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};dh("search",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=va(e);var i=String(this);return r=e.lastIndex,dp(r,0)||(e.lastIndex=0),i=Ke(e,i),dp(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),$a((function(e){!function(t,n){e.exports?e.exports=n(t):n(t)}("undefined"!=typeof self?self:Ya,(function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function a(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=a(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=a(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function o(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function s(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){var n=u(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var a="n e d p q dp dq qi".split(" ");for(n=u(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[a[r]]=t(i(n[r]));return e.kty="RSA",e}function u(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var a=0;r--;)a<<=8,a|=e[t.pos++];r=a}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in b))throw Error("Unsupported OBJECT ID "+e);n=b[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(u(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function l(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,a=e.length,o=0;o<a;o++)t.push(e[o]);else if(e instanceof ArrayBuffer)for(i=4,a=e.byteLength,e=new Uint8Array(e),o=0;o<a;o++)t.push(e[o]);else if(null===e)i=5,a=0;else if("string"==typeof e&&e in w)for(i=6,a=(e=r(atob(w[e]))).length,o=0;o<a;o++)t.push(e[o]);else if(e instanceof Array){for(o=0;o<e.length;o++)l(e[o],t);i=48,a=t.length-n}else{if(!("object"===X(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,a=(e=new Uint8Array(e.value)).byteLength,t.push(0),o=0;o<a;o++)t.push(e[o]);a++}if(128<=a){for(o=a,a=4,t.splice(n,0,o>>24&255,o>>16&255,o>>8&255,255&o);1<a&&!(o>>24);)o<<=8,a--;4>a&&t.splice(n,4-a),a|=128}return t.splice(n-2,2,i,a),t}function d(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function f(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var h=e.crypto||e.msCrypto;if(h){var v=h.subtle||h.webkitSubtle;if(v){var m=e.Crypto||h.constructor||Object,g=e.SubtleCrypto||v.constructor||Object;e.CryptoKey||e.Key;var y=-1<e.navigator.userAgent.indexOf("Edge/"),_=!!e.msCrypto&&!y,E=!h.subtle&&!!h.webkitSubtle;if(_||E){var b={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},w={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=v[e];v[e]=function(i,u,l){var m=[].slice.call(arguments);switch(e){case"generateKey":var g=a(i),y=u,b=l;break;case"importKey":g=a(l),y=m[3],b=m[4],"jwk"===i&&((u=s(u)).alg||(u.alg=o(g)),u.key_ops||(u.key_ops="oct"!==u.kty?"d"in u?b.filter(p):b.filter(f):b.slice()),m[1]=function(e){return e=s(e),_&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}(u));break;case"unwrapKey":g=m[4],y=m[5],b=m[6],m[2]=l._key}if("generateKey"===e&&"HMAC"===g.name&&g.hash)return g.length=g.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[g.hash.name],v.importKey("raw",h.getRandomValues(new Uint8Array(g.length+7>>3)),g,y,b);if(E&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===g.name&&(!g.modulusLength||2048<=g.modulusLength))return(i=a(i)).name="RSAES-PKCS1-v1_5",delete i.hash,v.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([v.exportKey("jwk",e.publicKey),v.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=o(g),e[0].key_ops=b.filter(f),e[1].key_ops=b.filter(p),Promise.all([v.importKey("jwk",e[0],g,!0,e[0].key_ops),v.importKey("jwk",e[1],g,y,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((E||_&&"SHA-1"===(g.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===g.name&&"oct"===u.kty)return v.importKey("raw",r(n(u.k)),l,m[3],m[4]);if(E&&"importKey"===e&&("spki"===i||"pkcs8"===i))return v.importKey("jwk",c(u),l,m[3],m[4]);if(_&&"unwrapKey"===e)return v.decrypt(m[3],l,u).then((function(e){return v.importKey(i,e,m[4],m[5],m[6])}));try{var w=t.apply(v,m)}catch(e){return Promise.reject(e)}return _&&(w=new Promise((function(e,t){w.onabort=w.onerror=function(e){t(e)},w.oncomplete=function(t){e(t.target.result)}}))),w=w.then((function(e){return"HMAC"!==g.name||g.length||(g.length=8*e.algorithm.length),0==g.name.search("RSA")&&(g.modulusLength||(g.modulusLength=(e.publicKey||e).algorithm.modulusLength),g.publicExponent||(g.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new d(e.publicKey,g,y,b.filter(f)),privateKey:new d(e.privateKey,g,y,b.filter(p))}:new d(e,g,y,b)}))}})),["exportKey","wrapKey"].forEach((function(e){var a=v[e];v[e]=function(c,u,d){var h=[].slice.call(arguments);switch(e){case"exportKey":h[1]=u._key;break;case"wrapKey":h[1]=u._key,h[2]=d._key}if((E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(h[0]="raw"),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(h[0]="jwk"),_&&"wrapKey"===e)return v.exportKey(c,u).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(s(e)))))),v.encrypt(h[3],d,e)}));try{var m=a.apply(v,h)}catch(e){return Promise.reject(e)}return _&&(m=new Promise((function(e,t){m.onabort=m.onerror=function(e){t(e)},m.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(m=m.then((function(e){return(E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:o(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=s(e)).alg||(e.alg=o(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(f):"private"===u.type?u.usages.filter(p):u.usages.slice()),e)}))),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(m=m.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=s(e)).kty)throw new TypeError("Unsupported key type");for(var a="n e d p q dp dq qi".split(" "),o=[],c=0;c<a.length&&a[c]in e;c++){var u=o[c]=r(n(e[a[c]]));128&u[0]&&(o[c]=new Uint8Array(u.length+1),o[c].set(u,1))}return 2<o.length&&(i=!0,o.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(l(o)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(l(t)).buffer}))),m}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=v[e];v[e]=function(n,r,i,o){if(_&&(!i.byteLength||o&&!o.byteLength))throw Error("Empty input is not allowed");var s=[].slice.call(arguments),c=a(n);if(!_||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(s[0]={name:n}),_&&r.algorithm.hash&&(s[0].hash=s[0].hash||r.algorithm.hash),_&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;s[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}_&&"AES-GCM"===c.name&&void 0===s[0].tagLength&&(s[0].tagLength=128),s[1]=r._key;try{var l=t.apply(v,s)}catch(e){return Promise.reject(e)}return _&&(l=new Promise((function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),l}})),_){var S=v.digest;v.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=S.call(v,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(h,{getRandomValues:{value:function(e){return h.getRandomValues(e)}},subtle:{value:v}}),e.CryptoKey=d}E&&(h.subtle=v,e.Crypto=m,e.SubtleCrypto=g,e.CryptoKey=d)}}}}))}));var Jw=qa("match"),Lj=function(e){var t;return ha(e)&&(void 0!==(t=e[Jw])?!!t:"RegExp"==Zb(e))},Kw=[].push,Lw=Math.min;dh("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(jb(this));if(0===(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Lj(e))return t.call(r,e,n);var i,a,o,s=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Of.call(e,r))&&!((a=e.lastIndex)>c&&(s.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&Kw.apply(s,i.slice(1)),o=i[0].length,c=a,s.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(o||!e.test(""))&&s.push(""):s.push(r.slice(c)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=jb(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,n):r.call(String(i),t,n)},function(e,i){var a=n(r,e,this,i,r!==t);if(a.done)return a.value;var o=va(e);e=String(this);var s=kd(o,RegExp);if(a=o.unicode,o=new s(pc?"^(?:"+o.source+")":o,(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(pc?"g":"y")),0===(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===Ke(o,e)?[e]:[];var c=0,u=0;for(s=[];u<e.length;){o.lastIndex=pc?0:u;var l,d=Ke(o,pc?e.slice(u):e);if(null===d||(l=Lw(ta(o.lastIndex+(pc?u:0)),e.length))===c)u=xj(e,u,a);else{if(s.push(e.slice(c,u)),s.length===i)return s;for(c=1;c<=d.length-1;c++)if(s.push(d[c]),s.length===i)return s;u=c=l}}return s.push(e.slice(c)),s}]}),pc),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R((function(){Vb(1)}));N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var t=yb(this),n=ep.call(arguments,1),r=function r(){var i=n.concat(ep.call(arguments));if(this instanceof r){var a=i.length;if(!(a in Mj)){for(var o=[],s=0;s<a;s++)o[s]="a["+s+"]";Mj[a]=Function("C,a","return new C("+o.join(",")+")")}i=Mj[a](t,i)}else i=t.apply(e,i);return i};return ha(t.prototype)&&(r.prototype=t.prototype),r},Nj=mc("Reflect","construct"),fp=R((function(){function e(){}return!(Nj((function(){}),[],e)instanceof e)})),gp=!R((function(){Nj((function(){}))})),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,t){yb(e),va(t);var n=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(Nw.apply(e,n))}n=n.prototype,n=ac(ha(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return ha(r)?r:n}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R((function(){ip(1)}));N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,t){return ip(qb(e),t)}});var jp=Hd.f,Pw={}.toString,kp="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&"[object Window]"==Pw.call(e))try{var t=jp(e)}catch(e){t=kp.slice()}else t=jp(qb(e));return t},lp={f:qa},Qw=Ra.f,ph=function(e){var t=y.Symbol||(y.Symbol={});Q(t,e)||Qw(t,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,_sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R((function(){return 7!=ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=op(Ob,t);r&&delete Ob[t],od(e,t,n),r&&e!==Ob&&od(Ob,t,r)}:od,Uj=function(e,t){var n=Lc[e]=ac(_sb.prototype);return Rw(n,{type:"Symbol",tag:e,description:t}),ka||(n.description=t),n},Vj=vn?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof _sb},qh=function e(t,n,r){return t===Ob&&e(Uf,n,r),va(t),n=lc(n,!0),va(r),Q(Lc,n)?(r.enumerable?(Q(t,rb)&&t[rb][n]&&(t[rb][n]=!1),r=ac(r,{enumerable:dd(0,!1)})):(Q(t,rb)||od(t,rb,dd(1,{})),t[rb][n]=!0),Tj(t,n,r)):od(t,n,r)},qp=function(e,t){va(e);var n=qb(t);return t=Dc(n).concat(Wj(n)),Jd(t,(function(t){ka&&!Xj.call(n,t)||qh(e,t,n[t])})),e},Xj=function(e){e=lc(e,!0);var t=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(t||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||t)},rp=function(e,t){if(e=qb(e),t=lc(t,!0),e!==Ob||!Q(Lc,t)||Q(Uf,t)){var n=op(e,t);return!n||!Q(Lc,t)||Q(e,rb)&&e[rb][t]||(n.enumerable=!0),n}},sp=function(e){e=pp(qb(e));var t=[];return Jd(e,(function(e){Q(Lc,e)||Q(Be,e)||t.push(e)})),t},Wj=function(e){var t=e===Ob;e=pp(t?Uf:qb(e));var n=[];return Jd(e,(function(e){!Q(Lc,e)||t&&!Q(Ob,e)||n.push(Lc[e])})),n};if(oc||(_sb=function(){if(this instanceof _sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ae(e);return ka&&Sj&&Tj(Ob,t,{configurable:!0,set:function e(n){this===Ob&&e.call(Uf,n),Q(this,rb)&&Q(this[rb],t)&&(this[rb][t]=!1),Tj(this,t,dd(1,n))}}),Uj(t,e)},Ta(_sb.prototype,"toString",(function(){return np(this).tag})),Ta(_sb,"withoutSetter",(function(e){return Uj(Ae(e),e)})),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(_sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:_sb}),Jd(Dc(Tw),(function(e){ph(e)})),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var t=_sb(e);return Pj[e]=t,Qj[t]=e,t},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,t){return void 0===t?ac(e):qp(ac(e),t)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R((function(){Bf.f(1)}))},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R((function(){var e=_sb();return"[null]"!=Tf([e])||"{}"!=Tf({a:e})||"{}"!=Tf(Object(e))}));N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,t,n){for(var r,i=[e],a=1;arguments.length>a;)i.push(arguments[a++]);if(r=t,(ha(t)||void 0!==e)&&!Vj(e))return gd(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Vj(t))return t}),i[1]=t,Tf.apply(null,i)}})}_sb.prototype[mp]||Na(_sb.prototype,mp,_sb.prototype.valueOf),Ec(_sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&"function"==typeof Mc&&(!("description"in Mc.prototype)||void 0!==Mc().description)){var tp={},Vf=function e(){var t=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),n=this instanceof e?new Mc(t):void 0===t?Mc():Mc(t);return""===t&&(tp[n]=!0),n};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw="Symbol(test)"==String(Mc("test")),Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,t=Ww.call(e);return Q(tp,e)?"":""===(e=Xw?t.slice(7,-1):t.replace(Yw,"$1"))?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var n,r=function(){n=i[a];try{n.callback.call(t,e)}catch(e){Promise.resolve().then((function(){throw e}))}n.options&&n.options.once&&t.removeEventListener(e.type,n.callback)},i=this.listeners[e.type].slice(),a=0,o=i.length;a<o;a++)r();return!e.defaultPrevented}}}]),t}(),u=function(t){function a(){e(this,a);var t=u.call(this);return t.listeners||c.call(o(t)),Object.defineProperty(o(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(o(t),"onabort",{value:null,writable:!0,configurable:!0}),t}r(a,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==X(n)&&"function"!=typeof n?o(this):n}}(a);return n(a,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),s(i(a.prototype),"dispatchEvent",this).call(this,e)}}]),a}(c),l=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=l,e.AbortSignal=u)}("undefined"!=typeof self?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Zj?new ak(e):e).length;n<r;n=n+32768|0)t+=xd.apply(0,e[Zj?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,n=new ak(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=yl),function(e){var t,n,r,i,a,o,s,c,u,l,d;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(n||(n={})),e.ConnectionState=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(r||(r={})),e.LocalInvitationState=r,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.RemoteInvitationState=i,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(a||(a={})),e.LocalInvitationFailureReason=a,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(o||(o={})),e.RemoteInvitationFailureReason=o,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(s||(s={})),e.PeerOnlineState=s,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=c,function(e){e.TEXT="TEXT",e.RAW="RAW",e.IMAGE="IMAGE",e.FILE="FILE"}(u||(u={})),e.MessageType=u,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(l||(l={})),e.LegacyAreaCode=l,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(d||(d={})),e.AreaCode=d}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ex]=!1,"/./"[e](t)}catch(e){}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch(c){rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,a){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),a=new f(a||[]),t._invoke=function(e,t,n){var i=w;return function(a,o){if(i===k)throw Error("Generator is already running");if(i===T){if("throw"===a)throw o;return h()}for(n.method=a,n.arg=o;;){if((a=n.delegate)&&(a=u(a,n))){if(a===I)continue;return a}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===w)throw i=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=k,"normal"===(a=r(e,t,n)).type){if(i=n.done?T:S,a.arg===I)continue;return{value:a.arg,done:n.done}}"throw"===a.type&&(i=T,n.method="throw",n.arg=a.arg)}}}(e,n,a),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function a(){}function o(){}function s(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,a,o,s){if("throw"!==(i=r(e[i],e,a)).type){var c=i.arg;return(i=c.value)&&"object"===X(i)&&g.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(i).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(i.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function u(e,t){var n=e.iterator[t.method];if(n===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,u(e,t),"throw"===t.method))return I;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return I}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,I):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,I):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,I)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function p(e){if(e){var t=e[_];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(g.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=v,t.done=!0,t}).next=t}}return{next:h}}function h(){return{value:v,done:!0}}var v,m=Object.prototype,g=m.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},_=y.iterator||"@@iterator",E=y.asyncIterator||"@@asyncIterator",b=y.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var w="suspendedStart",S="suspendedYield",k="executing",T="completed",I={};t(y={},_,(function(){return this}));var C=Object.getPrototypeOf;(C=C&&C(C(p([]))))&&C!==m&&g.call(C,_)&&(y=C);var R=o.prototype=i.prototype=Object.create(y);return a.prototype=o,t(R,"constructor",o),t(o,"constructor",a),a.displayName=t(o,b,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===a||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,t(e,b,"GeneratorFunction")),e.prototype=Object.create(R),e},e.awrap=function(e){return{__await:e}},s(c.prototype),t(c.prototype,E,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,a,o){void 0===o&&(o=Promise);var s=new c(n(t,r,i,a),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},s(R),t(R,b,"Generator"),t(R,_,(function(){return this})),t(R,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=p,f.prototype={constructor:f,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var o=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,I):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),I},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),I}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=v),I}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":X(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),yp=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),fk=$a((function(e){var t=Ra.f,n=Ae("meta"),r=0,i=Object.isExtensible||function(){return!0},a=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!ha(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Q(e,n)){if(!i(e))return"F";if(!t)return"E";a(e)}return e[n].objectID},getWeakData:function(e,t){if(!Q(e,n)){if(!i(e))return!0;if(!t)return!1;a(e)}return e[n].weakData},onFreeze:function(e){return yp&&o.REQUIRED&&i(e)&&!Q(e,n)&&a(e),e}};Be[n]=!0})),zp=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=r?"set":"add",o=y[e],s=o&&o.prototype,c=o,u={},l=function(e){var t=s[e];Ta(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!ha(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(nc(e,"function"!=typeof o||!(i||s.forEach&&!R((function(){(new o).entries().next()})))))c=n.getConstructor(t,e,r,a),fk.REQUIRED=!0;else if(nc(e,!0)){var d=new c,f=d[a](i?{}:-0,1)!=d,p=R((function(){d.has(1)})),h=Tg((function(e){new o(e)})),v=!i&&R((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));h||((c=t((function(t,n){return Gc(t,c,e),t=lh(new o,t,c),null!=n&&Xg(n,t[a],{that:t,AS_ENTRIES:r}),t}))).prototype=s,s.constructor=c),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||f)&&l(a),i&&s.clear&&delete s.clear}return u[e]=c,N({global:!0,forced:c!=o},u),Ec(c,e),i||n.setStrong(c,e,r),c},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,t,n,r){var i=e((function(e,a){Gc(e,i,t),Bp(e,{type:t,index:ac(null),first:void 0,last:void 0,size:0}),ka||(e.size=0),null!=a&&Xg(a,e[r],{that:e,AS_ENTRIES:n})})),a=gk(t),o=function(e,t,n){var r,i=a(e),o=s(e,t);return o?o.value=n:(i.last=o={index:r=Ap(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=o),t&&(t.next=o),ka?i.size++:e.size++,"F"!==r&&(i.index[r]=o)),e},s=function(e,t){e=a(e);var n=Ap(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Hf(i.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ka?e.size=0:this.size=0},delete:function(e){var t=a(this);if(e=s(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),ka?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=a(this),r=Id(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Hf(i.prototype,n?{get:function(e){return(e=s(this,e))&&e.value},set:function(e,t){return o(this,0===e?0:e,t)}}:{add:function(e){return o(this,e=0===e?0:e,e)}}),ka&&gx(i.prototype,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=gk(t),a=gk(r);bj(e,t,(function(e,t){Bp(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),If(t)}};zp("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(t){return t=String(jb(t)),1&e&&(t=t.replace(hx,"")),2&e&&(t=t.replace(ix,"")),t}};hk(1),hk(2);var ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=8!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=ik(String(e)),sh(e,t>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx="Number"==Zb(ac(th)),Ep=function(e){var t,n=lc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=ik(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var a=n.charCodeAt(t);if(48>a||a>r)return NaN}return parseInt(n,e)}return+n};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function e(t){var n=1>arguments.length?0:t,r=this;return r instanceof e&&(nx?R((function(){th.valueOf.call(r)})):"Number"!=Zb(r))?lh(new pd(Ep(n)),r,e):Ep(n)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R((function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e})),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var t,n=Qa(this),r=Sg(n,0),i=0,a=-1;for(t=arguments.length;a<t;a++){var o=-1===a?n:arguments[a],s=o;if(ha(s)){var c=s[Gp];s=void 0!==c?!!c:gd(s)}else s=!1;if(s){if(9007199254740991<i+(c=ta(o.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,i++)s in o&&Ge(r,i,o[s])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");Ge(r,i++,o)}}return r.length=i,r}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R((function(){kk((function(){}))}));N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,t,n){return yb(e),va(n),kk?kk(e,t,n):qx.call(e,t,n)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R((function(){return!Object.getOwnPropertyNames(1)}));N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe="object"===("undefined"==typeof Reflect?"undefined":X(Reflect))?Reflect:null,Hp=Pe&&"function"==typeof Pe.apply?Pe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ux=Pe&&"function"==typeof Pe.ownKeys?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return void 0===this._maxListeners?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Hp(n,this,t);else for(r=Cl(n,i=n.length),n=0;n<i;++n)Hp(r[n],this,t);return!0},ea.prototype.addListener=function(e,t){return zl(this,e,t,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,t){return zl(this,e,t,!0)},ea.prototype.once=function(e,t){return ng(t),this.on(e,Al(this,e,t)),this},ea.prototype.prependOnceListener=function(e,t){return ng(t),this.prependListener(e,Al(this,e,t)),this},ea.prototype.removeListener=function(e,t){var n;ng(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var a=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var o=i[n].listener;a=n;break}if(0>a)return this;if(0===a)i.shift();else{for(;a+1<i.length;a++)i[a]=i[a+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Dl.call(e,t)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,a),r(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}El(e,t,a,{once:!0}),"error"!==t&&vs(e,i,{once:!0})}))};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R((function(){if(ka&&1!==Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Qe({},e)[n]||"abcdefghijklmnopqrst"!=Dc(Qe({},t)).join("")}))?function(e,t){for(var n=Qa(e),r=arguments.length,i=1,a=Bf.f,o=zf;r>i;)for(var s,c=Af(arguments[i++]),u=a?Dc(c).concat(a(c)):Dc(c),l=u.length,d=0;l>d;)s=u[d++],(!ka||o.call(c,s))&&(n[s]=c[s]);return n}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R((function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||"/a/i"!=sc(Wf,"i")})))){for(var Oc=function e(t,n){var r,i=this instanceof e,a=Lj(t),o=void 0===n;return!i&&a&&t.constructor===e&&o||(nk?a&&!o&&(t=t.source):t instanceof e&&(o&&(n=tj.call(t)),t=t.source),pc&&(r=!!n&&-1<n.indexOf("y"))&&(n=n.replace(/y/g,"")),t=lh(nk?new sc(t,n):sc(t,n),i?this:lk,e),pc&&r&&(zx(t).sticky=!0)),t},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(t){sc[e]=t}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ok=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},pk=[],Op=pk.sort,Cx=R((function(){pk.sort(void 0)})),Dx=R((function(){pk.sort(null)})),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return void 0===e?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,t){var n;return e===t||(null==e?e==t:"function"===X(e.equiv)?e.equiv(t):null==t?e==t:"function"===X(t.equiv)?t.equiv(e):"string"!==X(e)&&"string"!==X(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Pp||null!=(n=Object.getPrototypeOf(t))&&n!==Pp?"function"!==X(e)&&void 0!==e.length&&"function"!==X(t)&&void 0!==t.length?Gx(e,t):e instanceof Set&&t instanceof Set?Hx(e,t):e instanceof Map&&t instanceof Map?Ix(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Fx(e,t)))},Gx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},Hx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e.keys()).sort(),G(t.keys()).sort())},Ix=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e).sort(),G(t).sort())},Fx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Qp=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return W(this,r),i.call(this,e(n)+t(n))}la(r,n);var i=ma(r);return r}(ef(Error))},Jx=Qp((function(){return"illegal argument(s)"})),vh=function(e){throw new Jx(e)},qk=Qp((function(){return"index out of bounds"})),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),rk=Math.random,Lx=new(function(e){function t(){return W(this,t),n.apply(this,arguments)}la(t,e);var n=ma(t);return Ha(t,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return rk()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(rk()-.5)*e}}]),t}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R((function(){sk(1)}));N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},og=function(){function e(t){W(this,e),this.value=t}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,t){return[e,function(e){return e},t]},Qx=w.mark((function(e,t){var n,r,i,a,o,s;return w.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Gl(e)(ws()),r=n[1],i=n[2],a=0;case 4:if(!(a<t.length)){c.next=15;break}if(o=t[a],!((s=i([],o))instanceof og)){c.next=10;break}return c.delegateYield(Wh(r(s.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!s.length){c.next=12;break}return c.delegateYield(s,"t1",12);case 12:a++,c.next=4;break;case 15:return c.delegateYield(Wh(r([])),"t2",16);case 16:case"end":return c.stop()}}),Qx)})),ys=w.mark(Fl),zs=function(e,t){return[e[0],e[1],t]},Sp=!0;"findIndex"in[]&&Array(1).findIndex((function(){Sp=!1})),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(t){W(this,e),this._length=0,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=ok(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Xf(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof og);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||ok;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&vh("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new qk(t);var i=this.nthCellUnsafe(t)}else i=t;var a=new e;if(0<n)for(;i&&0<n--;)this.remove(i),a.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return a}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&vh("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Lx;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ok;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,a=0,o=0;o<t&&(a++,i=i.next);o++);for(o=t;0<a||0<o&&i;){if(0===a){var s=i;i=i.next,o--}else i&&0!==o?0>=e(n.value,i.value)?(s=n,n=n.next,a--):(s=i,i=i.next,o--):(s=n,n=n.next,a--);this.tail?this.tail.next=s:this.head=s,s.prev=this.tail,this.tail=s}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),tc=function(){function e(t,n){W(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new Rx,this._size=0,this.opts=n,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return pg((function(e){return e.k}),this.items)}},{key:"values",value:function(){return pg((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),Sx=function(e){function t(e,r){return W(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}la(t,e);var n=ma(t);return Ha(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Th(wd(t.prototype),"ensureSize",this).call(this)}}]),t}(tc),Tp="object"==X(Ya)&&Ya&&Ya.Object===Object&&Ya,Tx="object"==("undefined"==typeof self?"undefined":X(self))&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var t=Ux.call(e,Yf),n=e[Yf];try{e[Yf]=void 0;var r=!0}catch(e){}var i=Vx.call(e);r&&(t?e[Yf]=n:delete e[Yf]),e=i}else e=Wx.call(e);return e},lb=function(e){var t=X(e);return null!=e&&("object"==t||"function"==t)},qi=function(e){return!!lb(e)&&("[object Function]"==(e=Qd(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(null!=e){try{return Xx.call(e)}catch(e){}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,t){return e=null==e?void 0:e[t],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var t=this.__data__;return Zf?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:$x.call(t,e)?t[e]:void 0},zd.prototype.has=function(e){var t=this.__data__;return Zf?void 0!==t[e]:ay.call(t,e)},zd.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zf&&void 0===t?"__lodash_hash_undefined__":t,this};var $f=function(e,t){return e===t||e!=e&&t!=t},wh=function(e,t){for(var n=e.length;n--;)if($f(e[n][0],t))return n;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var t=this.__data__;return!(0>(e=wh(t,e)))&&(e==t.length-1?t.pop():by.call(t,e,1),--this.size,!0)},ce.prototype.get=function(e){var t=this.__data__;return 0>(e=wh(t,e))?void 0:t[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,t){var n=this.__data__,r=wh(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,t){e=e.__data__;var n=X(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,t){var n=xh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},cy=function(e){return e!=e},dy=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Xp(e,cy,0);n=-1<e}return n},ey=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},fy=function(e,t){return e.has(t)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,t,n){var r=-1,i=dy,a=e.length,o=!0,s=[],c=s;if(n)o=!1,i=ey;else if(200<=a){if(i=t?null:iy(e))return uk(i);o=!1,i=fy,c=new gf}else c=t?[]:s;e:for(;++r<a;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,o&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),s.push(u)}else i(c,l,n)||(c!==s&&c.push(l),s.push(u))}return s},Yp=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},he=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof rg){var r=n.__data__;if(!ag||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qg(r)}return n.set(e,t),this.size=n.size,this};var ge=ee,Is=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),bg=function(e,t,n){"__proto__"==t&&yh?yh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},jy=Object.prototype.hasOwnProperty,Ml=function(e,t,n){var r=e[t];jy.call(e,t)&&$f(r,n)&&(void 0!==n||t in e)||bg(e,t,n)},re=function(e,t,n,r){var i=!n;n||(n={});for(var a=-1,o=t.length;++a<o;){var s=t[a],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?bg(n,s,c):Ml(n,s,c)}return n},gc=function(e){return null!=e&&"object"==X(e)},Zp=function(e){return gc(e)&&"[object Arguments]"==Qd(e)},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?Cb.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||my})),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,t){var n=X(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ny.test(e))&&-1<e&&0==e%1&&e<t},xk=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(t){return e(t)}},Se=$a((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Tp.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,t){var n=Va(e),r=!n&&rf(e),i=!n&&!r&&jf(e),a=!n&&!r&&!i&&bi(e);if(n=n||r||i||a){r=e.length;for(var o=String,s=-1,c=Array(r);++s<r;)c[s]=o(s);r=c}else r=[];for(var u in o=r.length,e)!t&&!py.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||wk(u,o))||r.push(u);return r},qy=Object.prototype,yk=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||qy)},cq=function(e,t){return function(n){return e(t(n))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return null!=e&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var t,n=[];for(t in Object(e))sy.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=ry(e);return e},Es=function(e,t){return e&&re(t,Ad(t),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var t=yk(e),n=[];for(r in e)("constructor"!=r||!t&&ty.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},Cs=function(e,t){return e&&re(t,kf(t),e)},Jl=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?Cb.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),Xh=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},uy=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return null==e?[]:(e=Object(e),uy(eq(e),(function(t){return vy.call(e,t)})))}:dq,Ds=function(e,t){return re(e,zk(e),t)},ai=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ai(t,zk(e)),e=Ak(e);return t}:dq,Bs=function(e,t){return re(e,fq(e),t)},gq=function(e,t,n){return t=t(e),Va(e)?t:ai(t,n(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&"[object DataView]"!=Td(new Bk(new ArrayBuffer(1)))||ag&&"[object Map]"!=Td(new ag)||Ck&&"[object Promise]"!=Td(Ck.resolve())||Re&&"[object Set]"!=Td(new Re)||Dk&&"[object WeakMap]"!=Td(new Dk))&&(Td=function(e){var t=Qd(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return t});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&By.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Ah=Cb.Uint8Array,Ek=function(e){var t=new e.constructor(e.byteLength);return new Ah(t).set(new Ah(e)),t},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,t){return t=t?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},Fs=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(t){return lb(t)?jq?jq(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Kl=function(e){return"function"!=typeof e.constructor||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&"[object Map]"==hf(e)},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&"[object Set]"==hf(e)},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return"symbol"==X(e)||gc(e)&&"[object Symbol]"==Qd(e)},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,t){if(Va(e))return!1;var n=X(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ie(e))||Hy.test(e)||!Gy.test(e)||null!=t&&e in Object(t)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var t=(e=Zh(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Iy,(function(e,n,r,i){t.push(r?i.replace(Jy,"$1"):n||e)})),t})),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,t){return Va(e)?e:Fk(e,t)?[e]:Ky(null==e?"":Nl(e))},Ly=1/0,cg=function(e){if("string"==typeof e||ie(e))return e;var t=e+"";return"0"==t&&1/e==-Ly?"-0":t},Ch=function(e,t){for(var n=0,r=(t=Bh(t,e)).length;null!=e&&n<r;)e=e[cg(t[n++])];return n&&n==r?e:void 0},My=function(e,t){if(!(2>(t=Bh(t,e)).length)){var n=t,r=0,i=-1,a=-1,o=n.length;for(0>r&&(r=-r>o?0:o+r),0>(i=i>o?o:i)&&(i+=o),o=r>i?0:i-r>>>0,r>>>=0,i=Array(o);++a<o;)i[a]=n[a+r];e=Ch(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[cg(n?t[n-1]:void 0)]),n},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||"[object Object]"!=Qd(e))&&(null===(e=Ak(e))||"function"==typeof(e=Ny.call(e,"constructor")&&e.constructor)&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return null!=e&&e.length?$h(e,1):[]},Ry=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},pq=Math.max,qq=function(e,t,n){return t=pq(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=pq(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];for(i=-1,a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),Ry(e,this,a)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var t=0,n=0;return function(){var r=Ty(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(yh?function(e,t){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(t),writable:!0})}:Dh),Gk=(e=function(e,t){var n={};if(null==e)return n;var r=!1;t=he(t,(function(t){return t=Bh(t,e),r||(r=1<t.length),t})),re(e,Ll(e),n),r&&(n=fe(n,7,Py));for(var i=t.length;i--;)My(n,t[i]);return n},rq(qq(e,void 0,Qy),e+"")),Uy=function(e,t,n,r){for(var i=-1,a=null==e?0:e.length;++i<a;){var o=e[i];t(r,o,n(o),e)}return r},um=function(e,t,n){for(var r=-1,i=Object(e),a=(n=n(e)).length;a--;){var o=n[++r];if(!1===t(i[o],o,i))break}return e},sq=function(e,t){return e&&um(e,t,Ad)},Hk=function(e,t){return function(t,n){if(null==t)return t;if(!Ed(t))return e(t,n);for(var r=t.length,i=-1,a=Object(t);++i<r&&!1!==n(a[i],i,a););return t}}(sq),Vy=function(e,t,n,r){return Hk(e,(function(e,i,a){t(r,e,n(e),a)})),r},tq=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Pl=function(e,t,n,r,i,a){var o=1&n,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;c=a.get(e);var u=a.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new gf:void 0;for(a.set(e,t),a.set(t,e);++c<s;){var d=e[c],f=t[c];if(r)var p=o?r(f,d,c,t,e,a):r(d,f,c,e,t,a);if(void 0!==p){if(p)continue;u=!1;break}if(l){if(!tq(t,(function(e,t){if(!l.has(t)&&(d===e||i(d,e,n,r,a)))return l.push(t)}))){u=!1;break}}else if(d!==f&&!i(d,f,n,r,a)){u=!1;break}}return a.delete(e),a.delete(t),u},Wy=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,t,n,r,i,a,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!a(new Ah(e),new Ah(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Wy;case"[object Set]":if(s||(s=uk),e.size!=t.size&&!(1&r))break;return(n=o.get(e))?n==t:(r|=2,o.set(e,t),t=Pl(s(e),s(t),r,i,a,o),o.delete(e),t);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(t)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,t,n,r){var i=n.length,a=i,o=!r;if(null==e)return!a;for(e=Object(e);i--;){var s=n[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){var c=(s=n[i])[0],u=e[c],l=s[1];if(o&&s[2]){if(void 0===u&&!(c in e))return!1}else{if(s=new ge,r)var d=r(u,l,c,e,t,s);if(void 0===d?!je(l,u,3,r,s):!d)return!1}}return!0},Yy=function(e){for(var t=Ad(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!lb(i)]}return t},vq=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Zy=function(e){var t=Yy(e);return 1==t.length&&t[0][2]?vq(t[0][0],t[0][1]):function(n){return n===e||Xy(n,e,t)}},$y=function(e,t){return Fk(e)&&t==t&&!lb(t)?vq(cg(e),t):function(n){var r=null==n?void 0:Ch(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,a=(r=Bh(r=e,n)).length,o=!1;++i<a;){var s=cg(r[i]);if(!(o=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}r=o||++i!=a?o:!!(a=null==n?0:n.length)&&xk(a)&&wk(s,a)&&(Va(n)||rf(n))}s=r}else s=je(t,r,3);return s}},az=function(e){return function(t){return null==t?void 0:t[e]}},bz=function(e){return function(t){return Ch(t,e)}},Te=function(e){return"function"==typeof e?e:null==e?Dh:"object"==X(e)?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,t){return function(t,n){return(Va(t)?Uy:Vy)(t,e,Te(n),{})}}((function(e,t,n){bg(e,n,t)})),uc=function(e,t){var n={};return t=Te(t),sq(e,(function(e,r,i){bg(n,r,t(e,r,i))})),n},e;N({target:"String",proto:!0,forced:R((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var t=Gb(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=Gb(sg(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),a=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return a+r;for(;6>a.length;)a="0"+a;r=""+a+r}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,a=65535&e.high,o=e.low>>>16;return r=(o=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+o))>>>16,ya((65535&o)<<16|65535&e,(t=((r+=n+a)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var t=Qb.mul(this.low,this.high,e.low,e.high);return ya(t,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*s)>>>16;var d=(l+=n*e)>>>16;return ya((65535&u)<<16|65535&c,(d=(d+=(l=(65535&l)+r*s)>>>16)+((l=(65535&l)+i*o)>>>16)+(t*e+n*s+r*o+i*a)&65535)<<16|65535&l,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var t=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var n=this.shr(1).div(e).shl(1);if(n.eq(Hb))return e.isNegative()?Ue:Kk;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=Hb}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:sg(2,i-48);for(var a=Gb(n),o=a.mul(e);o.isNegative()||o.gt(r);)o=(a=Gb(n-=i,this.unsigned)).mul(e);a.isZero()&&(a=Ue),t=t.add(a),r=r.sub(o)}return t},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return 32>e?ya(this.low>>>e|t<<32-e,t>>>e,this.unsigned):ya(32===e?t:t>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},xa.fromBytes=function(e,t,n){return n?xa.fromBytesLE(e,t):xa.fromBytesBE(e,t)},xa.fromBytesLE=function(e,t){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},xa.fromBytesBE=function(e,t){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _di=function(e,t){return(_di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&"number"==typeof e.length},lf=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var a=0;a<t.length;++a)t[a].remove(this);if(le(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var o=e instanceof lf?Xl(e.errors):[e]}}if(Jb(i))for(a=-1,t=i.length;++a<t;)if(ei(n=i[a]))try{n.unsubscribe()}catch(e){o=o||[],e instanceof lf?o=o.concat(Xl(e.errors)):o.push(e)}if(o)throw new lf(o)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(X(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Fh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function t(n,r,i){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=Eh;break;case 1:if(!n){a.destination=Eh;break}if("object"===X(n)){n instanceof t?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new yq(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new yq(a,n,r,i)}return a}return O(t,e),t.prototype[Fh]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(Oa),yq=function(e){function t(t,n,r,i){var a=e.call(this)||this;if(a._parentSubscriber=t,t=a,le(n))var o=n;else n&&(o=n.next,r=n.error,i=n.complete,n!==Eh&&(le((t=Object.create(n)).unsubscribe)&&a.add(t.unsubscribe.bind(t)),t.unsubscribe=a.unsubscribe.bind(a)));return a._context=t,a._next=o,a._error=r,a._complete=i,a}return O(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):me(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;me(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Ib.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):me(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(ia),ne="function"==typeof Symbol&&Symbol.observable||"@@observable",Y=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof ia)break e;if(e[Fh]){e=e[Fh]();break e}}e=e||t||n?new ia(e,t,n):new ia(Eh)}if(r?e.add(r.call(e,this.source)):e.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),fi(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Zl(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Yl(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Zl(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return O(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(Oa),Aq=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return O(t,e),t}(ia),Pa=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return O(t,e),t.prototype[Fh]=function(){return new Aq(this)},t.prototype.lift=function(e){var t=new Bq(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new qd;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new qd;return this.hasError?(e.error(this.thrownError),Oa.EMPTY):this.isStopped?(e.complete(),Oa.EMPTY):(this.observers.push(e),new zq(this,e))},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new Bq(e,t)},t}(Y),Bq=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return O(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Oa.EMPTY},t}(Pa),Ns=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new cz(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),cz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(ia),Cq=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return O(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),e.closed&&(this._connection=null,e=Oa.EMPTY)),e},t.prototype.refCount=function(){return $l()(this)},t}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Aq);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(ia),function(e){function t(t,n,r,i,a){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=a,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}O(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new Pa,n.set(t,r),e=new Mk(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new Mk(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new ez(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return O(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(ia),Mk=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return O(t,e),t.prototype._subscribe=function(e){var t=new Oa,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new fz(n)),t.add(r.subscribe(e)),t},t}(Y),fz=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return O(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(Oa),gz=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return O(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Pa),dg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return O(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return O(t,e),t.prototype.schedule=function(e,t){return this},t}(Oa)),hz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(dg),Nk=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),eg=function(e){function t(n,r){void 0===r&&(r=Nk.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return O(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Nk),fg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(eg))(hz),vb=new Y((function(e){return e.complete()})),am=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},Ok;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(Ok||(Ok={}));var Ve=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Dq(e,this.scheduler,this.delay))},e}(),Dq=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return O(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new iz(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Ve.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Ve.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},t}(ia),iz=function(e,t){this.notification=e,this.destination=t},qe=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return O(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new jz(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var a=Oa.EMPTY;else this.observers.push(e),a=new zq(this,e);if(r&&e.add(e=new Dq(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||fg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(e-r[a].time<n);)a++;return i>t&&(a=Math.max(a,i-t)),0<a&&r.splice(0,a),r},t}(Pa),jz=function(e,t){this.time=e,this.value=t},of=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return O(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var t=kz++;return ii[t]=!0,lz.then((function(){return bm(t)&&e()})),t},clearImmediate:function(e){bm(e)}},mz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Eq.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Eq.clearImmediate(n),t.scheduled=void 0)},t}(dg),ri=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(dg),Fq=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(oz),pz=function(e){function t(t,n){void 0===t&&(t=Gq),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return O(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(eg),Gq=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return O(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new qz(e,this.project,this.thisArg))},e}(),qz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return O(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Rk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ia),Xs=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ia),rz=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,me),t}},$c="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(t){for(var n=e[$c]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},tz=function(e){return function(t){var n=e[ne]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},hm=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},pf=function(e){if(e&&"function"==typeof e[ne])return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&"function"==typeof e[$c])return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new uz(e,this.resultSelector))},e}(),uz=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return O(t,e),t.prototype._next=function(e){this.values.push(Hq),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(ji(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Hq?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),vc=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ia);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(ia);var wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ia);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(ia);var at=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new wz(e,this.project,this.concurrent))},e}(),wz=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")?function(e){e=ik(String(e));var t=Sk(e);return 0===t&&"-"==e.charAt(0)?-0:t}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new xz(e,this.predicate,this.thisArg))},e}(),xz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return O(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ia),gt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new yz(e))},e}(),yz=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return O(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=ji(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Rk),jt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new zz(e,this.resultSelector))},e}(),zz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return O(t,e),t.prototype._next=function(e){var t=this.iterators;Jb(e)?t.push(new Az(e)):"function"==typeof e[$c]?t.push(new Bz(e[$c]())):t.push(new Cz(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var a=!1,o=[];for(r=0;r<t;r++){var s=(i=e[r]).next();if(i.hasCompleted()&&(a=!0),s.done)return void n.complete();o.push(s.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),a&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Bz=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),Az=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return O(t,e),t.prototype[$c]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return ic(this.observable,new vc(this))},t}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return Zc(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Jb(e[0])&&(e=e[0]),nf(e,n).lift(new vz(t))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,t,n,r,i){if(1==arguments.length){var a=e.initialState;t=e.condition,n=e.iterate;var o=e.resultSelector||Yc;i=e.scheduler}else void 0===r||Zc(r)?(a=e,o=Yc,i=r):(a=e,o=r);return new Y((function(e){var r=a;if(i)return i.schedule(bt,0,{subscriber:e,iterate:n,condition:t,resultSelector:o,state:r});for(;;){if(t){var s=void 0;try{s=t(r)}catch(t){e.error(t);break}if(!s){e.complete();break}}s=void 0;try{s=o(r)}catch(t){e.error(t);break}if(e.next(s),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=vb),void 0===n&&(n=vb),ad((function(){return e()?t:n}))},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,t){return new Y(t?function(n){var r=Object.keys(e),i=new Oa;return i.add(t.schedule(dt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[wb(t,n)(new Y(pf(e))),wb(et(t,n))(new Y(pf(e)))]},race:Ca,range:function(e,t,n){return void 0===e&&(e=0),new Y((function(r){void 0===t&&(t=e,e=0);var i=0,a=e;if(n)return n.schedule(ht,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(a++),r.closed)break}}))},throwError:Z,timer:Bc,using:function(e,t){return new Y((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var a=(i?Kb(i):vb).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}}))},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ez(e,this.selector,this.caught))},e}(),Ez=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new vc(this),this.add(t),(n=ic(n,t))!==t&&this.add(n)}},t}(wc),lt=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Fz(e,this.defaultValue))},e}(),Fz=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return O(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(ia),mt=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Gz(e,this.delay,this.scheduler))},e}(),Gz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return O(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new Hz(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Ve.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},t}(ia),Hz=function(e,t){this.time=e,this.notification=t},nt=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Iz(e,this.keySelector,this.flushes))},e}(),Iz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(ic(r,new vc(t))),t}return O(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(wc),pt=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Jz(e,this.errorFactory))},e}(),Jz=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return O(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(ia),qt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Kz(e,this.total))},e}(),Kz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(ia),rt=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Lz(e,this.project))},e}(),Lz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.hasSubscription=!1,t.hasCompleted=!1,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(wc),st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Mz(e,this.callback))},e}(),Mz=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new Oa(n)),t}return O(t,e),t}(ia),ut=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Nz(e))},e}(),Nz=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype._next=function(e){},t}(ia),vt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Oz(e,this.total))},e}(),Oz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var a=t++%n;e.next(r[a])}e.complete()},t}(ia),wt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Pz(e,this.value))},e}(),Pz=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return O(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ia),xt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return O(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(ia),zt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),Bt=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Rz(e,this.notifier,this.source))},e}(),Rz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new Pa;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=ic(r,new vc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(wc),Et=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Sz(e,this.project))},e}(),Sz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new vc(this);var n=this.destination;n.add(t),this.innerSubscription=ic(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(wc),Ft=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new Tz(e);var n=ic(this.notifier,new vc(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),Tz=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return O(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(wc),Ht=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new Uz(e,this.predicate,this.inclusive))},e}(),Uz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.inclusive=r,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.destination;try{var n=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;t?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(ia),It=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=hc,t._tapError=hc,t._tapComplete=hc,t._tapError=r||hc,t._tapComplete=i||hc,le(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||hc,t._tapError=n.error||hc,t._tapComplete=n.complete||hc),t}return O(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ia),Kt={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.destination=t,a.durationSelector=n,a._leading=r,a._trailing=i,a._hasValue=!1,a}O(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=ic(e,new vc(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(wc);for(var Lt=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function t(t,n,r,i,a){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=a,t._hasTrailingValue=!1,t._trailingValue=null,t}return O(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(ia),Ot=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function t(t,n,r,i,a){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=a,t.scheduleTimeout(),t}return O(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(ic(t,new vc(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(wc),Qt=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Yz(e,this.observables,this.project))},e}(),Yz=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(ji(t,n[i],void 0,i));return t}return O(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),Jq=$a((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,t){return t=t||0,[ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]]].join("")},Ud=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,t){var n;return Hk(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},Mh=function(e,t,n){if(!lb(n))return!1;var r=X(t);return!!("number"==r?Ed(n)&&wk(t,n.length):"string"==r&&t in n)&&$f(n[t],e)},dl=function(e,t,n){var r=Va(e)?tq:DA;return n&&Mh(e,t,n)&&(t=void 0),r(e,Te(t))},EA=function(e,t){var n=-1,r=Ed(e)?Array(e.length):[];return Hk(e,(function(e,i,a){r[++n]=t(e,i,a)})),r},FA=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},GA=function(e,t,n){t=t.length?he(t,(function(e){return Va(e)?function(t){return Ch(t,1===e.length?e[0]:e)}:e})):[Dh];var r=-1;return t=he(t,zh(Te)),e=EA(e,(function(e,n,i){return{criteria:he(t,(function(t){return t(e)})),index:++r,value:e}})),FA(e,(function(e,t){e:{for(var r=-1,i=e.criteria,a=t.criteria,o=i.length,s=n.length;++r<o;){t:{var c=i[r],u=a[r];if(c!==u){var l=void 0!==c,d=null===c,f=c==c,p=ie(c),h=void 0!==u,v=null===u,m=u==u,g=ie(u);if(!v&&!g&&!p&&c>u||p&&h&&m&&!v&&!g||d&&h&&m||!l&&m||!f){c=1;break t}if(!d&&!p&&!g&&c<u||g&&l&&f&&!d&&!p||v&&l&&f||!h&&f||!m){c=-1;break t}}c=0}if(c){e=r>=s?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},jr=function(e,t){return rq(qq(e,t,Dh),e+"")},kr=jr((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&Mh(e,t[0],t[1])?t=[]:2<n&&Mh(t[0],t[1],t[2])&&(t=[t[0]]),GA(e,$h(t,1),[])})),lr=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(Dz),mr=$a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var a=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,o=void 0===a?n:a,s=void 0===(i=i.makeWebSocket)?r:i;return new lr.Observable((function(n){var r,i=new lr.Subject,a=s(e,o),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){a.send(e)})),i};return a.onopen=function(){u?(c=!0,a.close()):n.next(l)},a.onmessage=function(e){i.next(e.data)},a.onerror=function(e){c=!0,n.error(Error(e.message))},a.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,a.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(mr);var pi=function(e,t,n){(void 0===n||$f(e[t],n))&&(void 0!==n||t in e)||bg(e,t,n)},oi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},HA=function(e){return jr((function(t,n){var r=-1,i=n.length,a=1<i?n[i-1]:void 0,o=2<i?n[2]:void 0;for(a=3<e.length&&"function"==typeof a?(i--,a):void 0,o&&Mh(n[0],n[1],o)&&(a=3>i?void 0:a,i=1),t=Object(t);++r<i;)(o=n[r])&&e(t,o,r,a);return t}))}((function(e,t,n,r){tm(e,t,n,r)})),IA=Math.floor,JA=Math.random,nr=function(e,t){return e+IA(JA()*(t-e+1))},or=function(e){var t=e.length;return t?e[nr(0,t-1)]:void 0},KA=function(e,t){return he(t,(function(t){return e[t]}))},Ni=function(e){return null==e?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,t){return new WebSocket(e,t)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,a=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,o){n[r]=function(e){if(a)if(a=!1,e)o(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){a&&(a=!1,o(e))}}))},OA=$a((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,a=null,o=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:o[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:o[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:o[s++]=n[i|u>>6],o[s++]=n[63&u],c=0}8191<s&&((a||(a=[])).push(String.fromCharCode.apply(String,o)),s=0)}return c&&(o[s++]=n[i],o[s++]=61,1===c&&(o[s++]=61)),a?(s&&a.push(String.fromCharCode.apply(String,o.slice(0,s))),a.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.decode=function(e,t,n){for(var i,a=n,o=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&1<o)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(o){case 0:i=c,o=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,o=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,o=3;break;case 3:t[n++]=(3&i)<<6|c,o=0}}if(1===o)throw Error("invalid encoding");return n-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));yg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},yg.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},yg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var PA=zm(zm),QA=function QA(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,a=[],o=0;t<n;)128>(r=e[t++])?a[o++]=r:191<r&&224>r?a[o++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[o++]=55296+(r>>10),a[o++]=56320+(1023&r)):a[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<o&&((i||(i=[])).push(String.fromCharCode.apply(String,a)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,a.slice(0,o))),i.join("")):String.fromCharCode.apply(String,a.slice(0,o))},t.write=function(e,t,n){for(var r,i,a=n,o=0;o<e.length;++o)128>(r=e.charCodeAt(o))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&i),++o,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-a}})),SA=function(e,t,n){var r=n||8192,i=r>>>1,a=null,o=r;return function(n){return 1>n||n>i?e(n):(o+n>r&&(a=e(r),o=0),n=t.call(a,o,o+=n),7&o&&(o=1+(7|o)),n)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(0===e)return Xd;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new Wa(n,e)},Wa.from=function(e){if("number"==typeof e)return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var V=$a((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=NA,t.base64=OA,t.EventEmitter=yg,t.float=PA,t.inquire=QA,t.utf8=RA,t.pool=SA,t.LongBits=Wa,t.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===X(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==X(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,t,n){return this.tail=this.tail.next=new sf(e,t,n),this.len+=t,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ja.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(ti,1,0);if(V.isString(e)){var n=ja.alloc(t=pr.length(e));pr.decode(e,n,0),e=n}return this.uint32(t)._push(UA,t,e)},ja.prototype.string=function(e){var t=qr.length(e);return t?this.uint32(t)._push(qr.write,t,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ja.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&"set"===V.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(jc.writeBytesBuffer,t,e),this},jc.prototype.string=function(e){var t=V.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Ut,t,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return 0!==this.uint32()},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Yb(this)}while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var t=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[t](!1)},uint64:function(){return yi.call(this)[t](!0)},sint64:function(){return yi.call(this).zzDecode()[t](!1)},fixed64:function(){return Fm.call(this)[t](!0)},sfixed64:function(){return Fm.call(this)[t](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(t,n,r,i,a){if(!i)throw TypeError("request must be specified");var o=this;if(!a)return V.asPromise(e,o,t,n,r,i);if(o.rpcImpl)try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return o.emit("error",e,t),a(e);if(null!==n){if(!(n instanceof r))try{n=r[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)}o.end(!0)}))}catch(e){o.emit("error",e,t),setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a((function(e,t){t.Service=tf})),XA={},fc=$a((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=xi,r.BufferWriter=jc,r.Reader=zi,r.BufferReader=Fd,r.util=V,r.rpc=WA,r.roots=XA,r.configure=n,n()}));fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[115]="FileUploadIndexGetUri"]=115,t[e[116]="FileUploadIndexRetUri"]=116,t[e[117]="FileUploadIndexSetUri"]=117,t[e[118]="FileUploadIndexFinUri"]=118,t[e[119]="FileUploadIndexErrUri"]=119,t[e[125]="FileDownloadIndexGetUri"]=125,t[e[126]="FileDownloadIndexRetUri"]=126,t[e[127]="FileDownloadIndexErrUri"]=127,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),Oh=t.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(e,t){return t||(t=L.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),ZA=t.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),$A=t.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),aB=t.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),bB=t.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),cB=t.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=L.create()),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),dB=t.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();i>>>3===1?r.code=e.uint32():e.skipType(7&i)}return r},e}(),eB=t.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),fB=t.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();i>>>3===1?r.account=e.string():e.skipType(7&i)}return r},e}(),gB=t.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ur=t.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),vr=t.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),wr=t.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r,i,a=new t.Message;e.pos<n;)switch(r=e.uint32(),r>>>3){case 1:a.instance=e.uint64();break;case 2:a.dialogue=e.uint64();break;case 3:a.sequence=e.uint64();break;case 4:a.options=e.uint64();break;case 5:a.src=e.string();break;case 6:a.dst=e.string();break;case 7:a.payload=e.bytes();break;case 8:a.MiscMap===q.emptyObject&&(a.MiscMap={});var o=e.uint32()+e.pos;for(r="",i=[];e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:r=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&s)}}a.MiscMap[r]=i;break;case 9:a.ms=e.uint64();break;default:e.skipType(7&r)}return a},e}(),xr=t.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),hB=t.FileUploadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(24).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),iB=t.FileUploadIndexRet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(26).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),jB=t.FileUploadIndexSet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),kB=t.FileUploadIndexFin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),lB=t.FileUploadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),mB=t.FileDownloadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(26).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(40).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),nB=t.FileDownloadIndexRet=function(){function e(e){if(this.servers=[],this.backups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(24).uint32(e.zone),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}if(null!=e.backups&&e.backups.length){for(t.uint32(42).fork(),n=0;n<e.backups.length;++n)t.uint32(e.backups[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),oB=t.FileDownloadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),pB=t.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),qB=t.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),rB=t.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),sB=t.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),tB=t.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),uB=t.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),vB=t.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),wB=t.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),xB=t.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),yB=t.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),zB=t.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),AB=t.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),BB=t.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),CB=t.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),DB=t.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),EB=t.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),FB=t.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),GB=t.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),HB=t.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),IB=t.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),JB=t.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),KB=t.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),LB=t.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),MB=t.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),NB=t.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),OB=t.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),PB=t.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),QB=t.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),RB=t.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),SB=t.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),TB=t.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),UB=t.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(t,n,r){var i=(t=String(jb(t))).length;return r=void 0===r?" ":String(r),(n=ta(n))<=i||""==r?t:(n-=i,(i=Pn.call(r,WB(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(t){t=qb(t);for(var n,r=Dc(t),i=r.length,a=0,o=[];i>a;)n=r[a++],ka&&!ZB.call(t,n)||o.push(e?[n,t[n]]:t[n]);return o}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var t=String(jb(this));ck(e);var n=1<arguments.length?arguments[1]:void 0,r=ta(t.length);return n=void 0===n?r:cC(ta(n),r),r=String(e),Br?Br.call(t,r,n):t.slice(n-r.length,n)===r}}),dh("match",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=va(e),r=String(this),!e.global)return Ke(e,r);var i=e.unicode;e.lastIndex=0;for(var a,o=[],s=0;null!==(a=Ke(e,r));)a=String(a[0]),o[s]=a,""===a&&(e.lastIndex=xj(r,ta(e.lastIndex),i)),s++;return 0===s?null:o}]}));var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var t=String(jb(this));ck(e);var n=ta(fC(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Dr?Dr.call(t,r,n):t.slice(n,n+r.length)===r}});var Nm=function(e){var t=Array.prototype.slice.call(arguments,1);return t.length&&(e=e.replace(/(%?)(%([jds]))/g,(function(e,n,r,i){switch(r=t.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return n?(t.unshift(r),e):r}))),t.length&&(e+=" "+t.join(" ")),""+e.replace(/%{2,2}/g,"%")},hC=/\s/,iC=function(e){for(var t=e.length;t--&&hC.test(e.charAt(t)););return t},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if("number"==typeof e)return e;if(ie(e))return Fr;if(lb(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=lb(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e?e.slice(0,iC(e)+1).replace(jC,""):e;var t=lC.test(e);return t||mC.test(e)?nC(e.slice(2),t?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,p=t,l=e.apply(r,n)}function i(e){var n=e-f;return e-=p,void 0===f||n>=t||0>n||v&&e>=g}function a(){var e=Cb.Date.now();if(i(e))return o(e);var n=setTimeout,r=e-p;e=t-(e-f),r=v?pC(e,g-r):e,d=n(a,r)}function o(e){return d=void 0,m&&c?r(e):(c=u=void 0,l)}function s(){var e=Cb.Date.now(),n=i(e);if(c=arguments,u=this,f=e,n){if(void 0===d)return p=e=f,d=setTimeout(a,t),h?r(e):l;if(v)return clearTimeout(d),d=setTimeout(a,t),r(f)}return void 0===d&&(d=setTimeout(a,t)),l}var c,u,l,d,f,p=0,h=!1,v=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=gl(t)||0,lb(n)){h=!!n.leading;var g=(v="maxWait"in n)?oC(gl(n.maxWait)||0,t):g;m="trailing"in n?!!n.trailing:m}return s.cancel=function(){void 0!==d&&clearTimeout(d),p=0,c=f=u=d=void 0},s.flush=function(){return void 0===d?l:o(Cb.Date.now())},s},yc=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"originalError",void 0),m(n(e),"code",void 0),m(n(e),"serverCode",void 0),"number"==typeof i?e.code=i:"string"==typeof i?e.name=i:void 0!==i&&(i.originalError&&(e.originalError=i.originalError),void 0!==i.code&&(e.code=i.code),void 0!==i.serverCode&&(e.serverCode=i.serverCode)),e}la(t,e);var r=ma(t);return t}(ef(Error)),Ia=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"name","RtmInternalError"),m(n(e),"code",void 0),e.code=i,e}la(t,e);var r=ma(t);return t}(ef(Error)),Ph=function(){return function(e){function t(e){W(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}la(t,e);var n=ma(t);return t}(Ia)},Fa=Ph(),db=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),e}la(t,e);var r=ma(t);return t}(yc),I=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),e}la(t,e);var r=ma(t);return t}(yc),K=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),e}la(t,e);var r=ma(t);return t}(yc),hl=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),e}la(t,e);var r=ma(t);return t}(yc),ib=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),e}la(t,e);var r=ma(t);return t}(yc),rC=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),e}la(t,e);var r=ma(t);return t}(yc),da=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(e),"serverCode",void 0),m(n(e),"statusCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Ye=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(e),"serverCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Wc=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),e}la(t,e);var r=ma(t);return t}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var t="",n=(e=new Uint8Array(e)).byteLength,r=-1;++r<n;)t+=String.fromCharCode(e[r]);return t=btoa(t),"data:;base64,".concat(t)},tC=R((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var t=lc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,t,n){return JSON.stringify(Ym(e),t,n)};Gr.ensureProperties=Ym;var uC=function(e,t){t=t||{};var n=X(e);if("string"===n&&0<e.length)return au(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?Jg(e,t,864e5,"day"):36e5<=t?Jg(e,t,36e5,"hour"):6e4<=t?Jg(e,t,6e4,"minute"):1e3<=t?Jg(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var o=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(o++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[o]),n.splice(o,1),o--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,a=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===a?t.enabled(e):a},set:function(e){a=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(G(t.names.map(r)),G(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=uC,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Hr=$a((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(e){}n=void 0}t.storage=n,t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=vC(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(t){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark((function n(){var r,i,a;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Uk){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),a=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),a),n.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Ze.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function e(t,n,r,i,a,o,s,c){var u=0;for(s=!!s&&Id(s,c,3);u<i;){if(u in r){if(c=s?s(r[u],u,n):r[u],0<o&&gd(c))a=e(t,n,c,ta(c.length),a,o-1)-1;else{if(9007199254740991<=a)throw TypeError("Exceed the acceptable array length");t[a]=c}a++}u++}return a},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Qa(this),n=ta(t.length),r=Sg(t,0);return r.length=xC(r,t,t,n,0,void 0===e?1:$b(e)),r}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var t;return null===(t=Hg(yf).find((function(t){return(t=ra(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},AC=function(e){return e.sort((function(e,t){return Kr.indexOf(e)-Kr.indexOf(t)}))},xe=function(e){var t=new Set;if(0===(e=AC(e).slice(0,3).map((function(e){var n=Kg[e];if(void 0===n)throw new Ia("invalid area key");return e=n.CODE,n=ff(n,yC),t.add(e),n}))).length)throw new Ia("areas cannot be empty");return ua({CODES:t},e.reduce((function(e,t){for(var n=0,r=Hg(e);n<r.length;n++){var i=ra(r[n],2),a=i[0];i=i[1],e[a]=Array.from(new Set([].concat(G(t[a]),G(i))))}return e})))},M,Lr=function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return a={withCredentials:!0,body:t,timeout:2e4},o=0<i?(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",s=n?"https://".concat(null!==(r=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(o,"&p=443&d=upload/v1"):"https://".concat(o,"/upload/v1"),e.next=8,te(s,a).catch((function(e){return Lr(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if("string"==typeof e)return oa(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return oa(e)}));if(!Il(e)){for(var t={},n=0;n<Or.length;n++){var r=Or[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=ra(e[n],2);r=i[0],i=i[1],il.includes(r)?t[r]="[Hidden Info]":t[oa(r)]="string"==typeof i?oa(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Pr=function(e){return"object"===X(e)?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Vm(fe(e,5),il,Nr)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===X(e)?Gr(Array.isArray(e)?e.map(Pr):Pr(e)):e})),Nm.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(G(t))))},CC=1,Rr=function(e,t,n){var r=Hr(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,a=Array(1<i?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(t.enableLogUpload){i=Cg(n);var s=Qr(i,a);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<s.length?s.slice(0,256):s)})}switch(i=function(e){var t=s||Qr(Cg(n),a),i=Nc.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},jl,Sr=function(e){return function(t){var n=1===jl||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},kl=function(e,t,n){var r=Sr(jl);return Rr("RTM:".concat(t),n,(function(t){return e(r(t))}))},tb=function(){return function(e){function t(e,i){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var o=r.call(this);if(m(n(o),"logError",void 0),m(n(o),"invokeTracker",void 0),m(n(o),"resultTracker",void 0),m(n(o),"errorTracker",void 0),m(n(o),"eventTracker",void 0),m(n(o),"info",void 0),m(n(o),"warn",void 0),m(n(o),"log",void 0),m(n(o),"genLogger",void 0),m(n(o),"loggerId",void 0),m(n(o),"logger",void 0),m(n(o),"name",void 0),o.logger=e,o.name=i,o.loggerId=e.loggerId,o.info=e.info,o.warn=e.warn,o.logError=e.logError,o.genLogger=e.genLogger,o.log=e.genLogger("RTM:DEBUG","<".concat(i,"> ")),o.invokeTracker=e.genTracker("Invoke"),o.eventTracker=e.genTracker("Event"),o.resultTracker=e.genTracker("Result"),o.errorTracker=e.genTracker("Error"),a){var s=o.emit.bind(n(o));o.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var r=BC.includes(e);o.eventTracker.apply(o,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,e].concat(G(r?n.map(ye):n)));try{s.apply(void 0,t)}catch(t){o.logError("Caught in the callback function of the event %s",e,t)}}}return o}la(t,e);var r=ma(t);return t}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Sr(e),a=console.debug.bind(console),o=Rr(n,t,(function(e){return a(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o.apply(void 0,[r+e].concat(n))}}},GC=function(e,t){return function(n){return Tr(e,t)("RTM:TRACK","[".concat(n,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var a=e[r=nr(n,i)];e[r]=e[n],e[n]=a}return e.length=t,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function t(e,i,a,o,s,c){W(this,t);var u=r.call(this,s,Ai("Socket-",s.loggerId));if(m(n(u),"isActiveClose",!1),m(n(u),"loggedIn",!1),m(n(u),"useNewDomain",void 0),m(n(u),"receivedPacket",new Pa),m(n(u),"open$",void 0),m(n(u),"input$",new Pa),m(n(u),"userJoin$",new Pa),m(n(u),"attemptsSinceLastError",0),m(n(u),"message$",new Pa),m(n(u),"socket$",void 0),m(n(u),"toClose",new Pa),m(n(u),"toReconnect",new Pa),m(n(u),"sendLogger",void 0),m(n(u),"receiveLogger",void 0),m(n(u),"ip",void 0),m(n(u),"env",void 0),m(n(u),"ticket",void 0),m(n(u),"context",void 0),m(n(u),"getDomain",(function(){return an(u.ip,u.useNewDomain)})),m(n(u),"socketReconnector",(function(e){var t=function(e){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,e.message),Bc(3e3)};return e.pipe(Ga((function(e){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),Z(e)):u.isActiveClose?vb:(u.emit("reconnect"),u.useNewDomain=!u.useNewDomain,Z(e))})),oe((function(e){return e.pipe(Cc(t))})))})),u.ip=e,u.env=i,u.ticket=a,u.context=o,u.useNewDomain=null!=c?c:.5<=Math.random(),u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(e))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var l=af[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env);var d=Xb(u.input$,u.userJoin$.pipe(Rt(2)),u.message$).pipe(ba((function(e){return Oh.encode(e).finish()})));return e=Xb(St("",{protocols:[],makeWebSocket:function(){if(u.context.config.enableCloudProxy){if(0===u.context.cloudProxyServers.length)throw u.logError("No cloud proxy server to connect"),new da;var e="wss://".concat(an(bn(u.context.cloudProxyServers),!1),"/");e=we(e,"sid",u.context.sid),e=we(e,"remote_port",l.toString()),e=we(e,"remote_ip",u.ip),e=we(e,"token",u.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(u.getDomain(),":").concat(l));return e.binaryType="arraybuffer",e}}),u.toReconnect),u.socket$=Ca(e,Tk.pipe(hb(15e3),Ga((function(e){return Sa(e)&&u.warn("socket open timed out"),Z(e)})))).pipe(ba((function(e){if(e instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),e;return e(d).pipe(ba((function(e){return Oh.decode(new Uint8Array(e))})))})),u.socketReconnector),u.open$=u.socket$.pipe(ca((function(e){u.log("Websocket opened",u.name),e.subscribe((function(e){var t=e.data;e=Li[e.uri].slice(0,-3),t=$m[e].decode(t);var n=HA({},Gk(t,"toJSON"),(function(e,t){return t instanceof U?Km(t):t})),r=!1;if((t instanceof vr||t instanceof ur)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof wr||t instanceof xr){var i=t.instance,a=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||a.lessThan(1))&&(r=!0)}r?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,e,n):("Pong"!==e&&u.receiveLogger("Env_%d: %s %o",u.env,e,n),u.receivedPacket.next([e,t]))}),(function(){}))})),qf(void 0),ob(u.toClose),pe()),u}la(t,e);var r=ma(t);return Ha(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=uc(t,(function(e){return e instanceof U?Km(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=du(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){var t=this;return this.receivedPacket.pipe(ca((function(e){var n=ra(e,2);e=n[0],n=n[1],"UserResp"===e&&(t.attemptsSinceLastError=0,t.loggedIn=!0),"UserDrop"===e&&t.emit("socketUserDrop",n)})),wb((function(t){return ra(t,1)[0]===e})),ba((function(e){return ra(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var t=xf(Kg);e=Yt(e);for(var n=0;n<t.length;n++){var r=Kg[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function t(e,i){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var o=r.call(this,i,"AccessPoint");return m(n(o),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!QC.includes(r))return Z(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys(Vr).includes(i))return(e=new da(["Login is rejected by the server. The response code is %d",e],jg)).serverCode=n,Z(e);switch(i=Vr[i],n=PC[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Ye(n,$q)).serverCode=e,Z(t);case"INVALID_USER_ID":return(t=new Ye(n,Jh)).serverCode=e,Z(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Ye(n,Kh)).serverCode=e,Z(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Ye(n,ar)).serverCode=e,Z(t);case"CANNOT_MEET_AREA_DEMAND":return(t=OC(t)).forEach((function(e){return o.failedAreas.add(e)})),o.failedAreas.size===(void 0===M?2:M.CODES.size)?((t=new I(n,jg)).serverCode=e,Z(t)):Z(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new da(n,jg)).serverCode=e,Z(t);default:return Z(Im("ApResErrType",i))}})),m(n(o),"getApEdgeInfo$",void 0),m(n(o),"getApEdgeInfoEndFirst$",void 0),m(n(o),"apFinish$",new Pa),m(n(o),"retryCount",0),m(n(o),"failedAreas",new Set),m(n(o),"usedUrl",[]),m(n(o),"newDomainUsed",!1),m(n(o),"backupNewDomainUsed",!1),m(n(o),"genUrl",(function(){return void 0===M?mi.apply(void 0,G($e([KC,LC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))})),m(n(o),"genBackupUrl",(function(){return void 0===M?mi.apply(void 0,G($e([MC,NC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))})),m(n(o),"getApUrl$",(function(e){var n,r;return o.genUrl().pipe(wb((function(e){return(!o.newDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(o.newDomainUsed=!0),!dl(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return o.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):Z(e)})))})),m(n(o),"getBackupApUrl$",(function(e){var n,r;return o.genBackupUrl().pipe(wb((function(e){return(!o.backupNewDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(o.backupNewDomainUsed=!0),!dl(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return o.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):Z(e)})))})),m(n(o),"getProxyApUrl$",(function(e){var t,n;return bb.apply(void 0,G(((null==M?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(t=null==M?void 0:M.CODES.size)&&void 0!==t?t:0):null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:2))})),m(n(o),"context",void 0),m(n(o),"fetchCloudProxy",(function(e,t){var n=Ai("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return o.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var a;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=Ag(0,Number.MAX_SAFE_INTEGER),o.log("%s request opid: %d",n,a),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:o.context.sid,opid:a,appid:o.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:o.context.key,cname:o.context.uid,uid:0,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")})}}]},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,a,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,S,k;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,a=JSON.parse(i),o.log("The %s response is %o",n,a),(void 0===(s=a.response_body)||0===s.length||s.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&Z(new da("cloud proxy response_body not valid",jg)),0===(c=s.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(u=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",o.handleUniLbsError(u.buffer.code,e));case 12:return o.logError("cloud proxy error response"),t.abrupt("return",o.handleUniLbsError(c[0].buffer.code,e));case 14:for(l=[],d=0;d<s.length;d++)if(262144===(null==(h=s[d])||null===(f=h.buffer)||void 0===f?void 0:f.flag))null===(v=h.buffer)||void 0===v||null===(m=v.edges_services)||void 0===m||null===(g=m.forEach)||void 0===g||g.call(m,(function(e){Gm(e=e.ip)&&-1===o.context.cloudProxyServers.indexOf(e)&&(o.log("got cloud proxy server: %s",e),o.context.cloudProxyServers.push(e))}));else if(128===(null==h||null===(p=h.buffer)||void 0===p?void 0:p.flag)){for(b=function(e,t){var n=t[e];l.some((function(e){return e.ip===n.ip}))||l.push({ip:n.ip,ticket:h.buffer.cert})},S=0,k=h.buffer.edges_services;S<k.length;S++)b(S,k);o.context.rtmArea=null!==(y=null===(_=h.buffer)||void 0===_||null===(E=_.detail)||void 0===E?void 0:E[9])&&void 0!==y?y:""}return t.abrupt("return",bb.apply(void 0,G(l).concat([fg])));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Ga((function(e){return sa(e)?Z(e):vb})),tg(),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),m(n(o),"fetchAp",(function(e,t){var n=Ai("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return o.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var a;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=Ag(0,Number.MAX_SAFE_INTEGER),o.log("%s request opid: %d",n,a),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:a,key:t||o.context.key,cname:o.context.uid,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")}),uid:0,sid:o.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,a,s,c,u,l,d;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,a=JSON.parse(i),o.log("The %s response is %o",n,a),c=(s=a).code,u=s.addresses,l=s.detail,0===c){t.next=6;break}return t.abrupt("return",o.handleUniLbsError(c,e));case 6:if(0!==(d=u).length){t.next=11;break}return t.abrupt("return",Z(Error("No available edge address to connect")));case 11:return o.context.rtmArea=null==l?void 0:l[9],t.abrupt("return",bb.apply(void 0,G(d).concat([fg])));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),tg(),Ga((function(e){return sa(e)?Z(e):vb})),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),o.context=e,o.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Bc(0,e||a?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca((function(){o.retryCount+=1})),cb((function(){return o.context.config.enableCloudProxy?o.getProxyApUrl$(e||a):(4<=o.retryCount&&(o.retryCount=0),3>=o.retryCount?o.getApUrl$(e||a):o.getBackupApUrl$(e||a))})),cb((function(e){return o.context.config.enableCloudProxy?o.fetchCloudProxy(e):o.fetchAp(e)})),Ga((function(e){return e instanceof pb&&o.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(o.apFinish$))},o.getApEdgeInfo$=function(e){return Bc(0,e||a?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca((function(){o.retryCount+=1})),cb((function(){return o.context.config.enableCloudProxy?o.getProxyApUrl$(e||a):3>=o.retryCount?o.getApUrl$(e||a):o.getBackupApUrl$(e||a)})),cb((function(e){return(o.context.config.enableCloudProxy?o.fetchCloudProxy(e):o.fetchAp(e)).pipe()})),Ga((function(e){return e instanceof pb&&o.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(o.apFinish$))},o}la(t,e);var r=ma(t);return Ha(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function t(e,i,a){W(this,t);var o=r.call(this,i,"Connection");m(n(o),"apClient",void 0),m(n(o),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(o),"curOpenSockets",[void 0,void 0]),m(n(o),"ipIterator",0),m(n(o),"firstEnv",.5<=Math.random()?1:0),m(n(o),"firstSocketOpener",void 0),m(n(o),"secondSocketOpener",void 0),m(n(o),"firstOpenKeeperSubject",new Pa),m(n(o),"secondOpenKeeperSubject",new Pa),m(n(o),"edgeInfoReplayed",void 0),m(n(o),"firstEnvOpenSocket",void 0),m(n(o),"firstOpenKeeperSub",void 0),m(n(o),"secondOpenKeeperSub",void 0),m(n(o),"context",void 0),m(n(o),"logger",void 0),o.context=e,o.logger=i,o.apClient=new Wr(o.context,i),o.apClient.apFinish$.subscribe((function(){o.log("Ap client fetch finished")}));var s,c=[];return o.edgeInfoReplayed=o.apClient.getApEdgeInfo$(a).pipe(oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(a?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))})),wb((function(e){return!dl(c,e)})),Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ca((function(e){c.push(e),o.log("An edge info got %o",e)})),ca({error:function(e){o.emit("connectionInitFailure",e)}}),wg((function(){o.apClient.clearUp()})),sm()),o.firstEnvOpenSocket=o.edgeInfoReplayed.pipe(cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,o.firstEnv,e.ticket,o.context,i,s);return o.firstEnv=1===o.firstEnv?0:1,t.on("connectionFailure",(function(){return o.onSocketConnectionFailure(t)})),s=!t.useNewDomain,t.open$.pipe(qf(t))})),ca((function(e){o.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,af[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e),o.firstEnv=e.env,o.openSecondSocket(e.env,e.ip,e.useNewDomain)})),Ka(1),pe()),o.firstSocketOpener=o.firstEnvOpenSocket.pipe(cb((function(e){return e.open$.pipe(ca((function(){o.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,af[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e)})))}))),e=o.firstOpenKeeperSubject.pipe(Cc(Yc)),o.firstOpenKeeperSub=e.subscribe({error:o.logError}),o}la(t,e);var r=ma(t);return Ha(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(tt(),Ga((function(e){return e.message===mr.normalClosureMessage?vb:Z(e)})),hb(5e3),Ga((function(n){return n instanceof pb?(t.warn("Force closing the ENV_%d connection",e.env),vb):Z(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return kr(e,(function(e){return Jm(t,e.ip)})).slice(-1)[0]})),Ka(1),cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(ca((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),oe((function(e){return e.pipe(ca((function(e){if(e.code===Kh)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(sa(e))throw e})),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))})),ca((function(e){t.log("An edge info got %o",e)})),wg((function(){t.apClient.clearUp()}))).pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return(e=kr(e,(function(e){return Jm(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),Dd(),cb((function(n){if(void 0===n)return Z(Error("Invalid edge info"));var i=new ml(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(qf(i))})),ca((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),cb((function(n){return n.open$.pipe(ca((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),pe()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=Xc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),SC=zc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),TC=zc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),UC=zc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),VC=zc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),WC=zc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),XC=zc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),YC=zc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function t(e,i,a){return W(this,t),m(n(a=r.call(this,a,"Context")),"_token",void 0),m(n(a),"config",void 0),m(n(a),"_uid",void 0),m(n(a),"_sid",void 0),m(n(a),"_area","CN"),m(n(a),"appId",void 0),m(n(a),"enableCloudProxy",!1),m(n(a),"cloudProxyServers",[]),a.appId=e,a.config=i,a}la(t,e);var r=ma(t);return Ha(t,[{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",oa(e)),!za(e))throw new Ia;this._uid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ia;this._sid=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(tb()),$C=!!Fc&&R((function(){Fc.prototype.finally.call({then:function(){}},(function(){}))}));if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var t=kd(this,mc("Promise")),n="function"==typeof e;return this.then(n?function(n){return mj(t,e()).then((function(){return n}))}:e,n?function(n){return mj(t,e()).then((function(){throw n}))}:e)}}),"function"==typeof Fc){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,crypto.subtle.digest("SHA-256",t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},bD=function(e){if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(0!=e.length%2)throw new RangeError("Expected string to be an even number of characters");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.digest("SHA-1",t);case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=sha1.arrayBuffer(t);case 9:return e.abrupt("return",as(new Uint8Array(n)));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),cs=function(e,t,n,r){r[t]=!0,n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function t(e,i,a,o){W(this,t);var s=r.call(this,a,"ChunkDownloadManager");if(m(n(s),"abortController",new AbortController),m(n(s),"downloadedSize",0),m(n(s),"successCount",0),m(n(s),"timer",void 0),m(n(s),"chunks",[]),m(n(s),"retUnit",void 0),m(n(s),"singleThread",!1),m(n(s),"initialized",!1),m(n(s),"ee",void 0),m(n(s),"chunkCount",void 0),m(n(s),"aborted",!1),m(n(s),"serverToIndices",new Map),m(n(s),"backupToIndices",new Map),m(n(s),"indexToBackupServers",[]),m(n(s),"busyBackupServers",new Map),m(n(s),"downloadingChunks",new Set),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===o?new ea:o,a=e.size,e=e.unit,0===a)throw new Ia("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s.chunkCount=Math.ceil(a/(32768*e)),s}la(t,e);var r=ma(t);return Ha(t,[{key:"setInfoByResponse",value:function(e){var t=this,n=e.serverList,r=e.backupList;if(e=e.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.serverToIndices,i)}))})),r.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.backupToIndices,i)}))})),i.some((function(){return!1})))throw new da("Not enough servers to download",mg);this.indexToBackupServers=r.map((function(e){return new Set(e)})),this.retUnit=e}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(e){var t=this,n=this.downloadedSize+e;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),this.initialized&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var e=0,t=0,n=this.chunks;t<n.length;t++)e+=n[t].byteLength;if(e!==this.metaInfo.size)throw new Ia("invalid chunks total size");e=new Uint8Array(e),n=t=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];e.set(new Uint8Array(i),t),t+=i.byteLength}return t=Array.from(e.subarray(0,4)).map((function(e){return e.toString(16)})).join("").toUpperCase(),Zt(e.buffer,cD(t))}},{key:"getDownloadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var e=J(w.mark((function e(t){var n,r=this,i=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,Promise.all(Array.from(t.entries()).map((function(e){return e=ra(e,2),r.postDownloadRequest(e[0],Array.from(e[1]),n).catch((function(e){404===e.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==e.name&&(Sa(e)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",e.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",e),r.abortController.abort()))}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var e=J(w.mark((function e(t,n,r){var i,a,o,s,c,u,l,d,f,p=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=function(){return(f=J(w.mark((function e(a){var o,f,p,h,v,m,g,y,_;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==a||0!==t){e.next=5;break}throw new Ia("Invalid serverIp");case 5:o=void 0===a?l.getDownloadUrl(t):a;case 6:return l.downloadingChunks.add(i),e.next=9,u(o);case 9:return f=e.sent,p=f.responseData,l.downloadingChunks.delete(i),e.abrupt("return",p);case 15:if(e.prev=15,e.t0=e.catch(0),l.downloadingChunks.delete(i),n.unshift(i),l.metaInfo.useNewDomain=!1,"AbortError"!==e.t0.name){e.next=22;break}throw e.t0;case 22:if(!Sa(e.t0)){e.next=25;break}throw e.t0.index=i,e.t0;case 25:if(h=s,s+=1,!(2>h)){e.next=30;break}return e.t0 instanceof Ia||l.warn("%o, %d download failed, retrying",e.t0,i),e.abrupt("return",d());case 30:if(504!==e.t0.statusCode){e.next=34;break}throw(v=new db("download server timed out",{originalError:e.t0,serverCode:504})).index=i,v;case 34:if(!r||2!==h||0===c[0]){e.next=45;break}return e.t0 instanceof Ia||l.warn("%d download failed, using backup: %d, %o",i,c[0],e.t0),e.next=38,l.busyBackupServers.get(c[0]);case 38:return m=d(l.getDownloadUrl(c[0])),l.busyBackupServers.set(c[0],m),e.next=42,m;case 42:return g=e.sent,l.busyBackupServers.delete(c[0]),e.abrupt("return",g);case 45:if(!(r&&2<h&&void 0!==c[1]&&0!==c[1])){e.next=56;break}return l.warn("%d download failed, using backup 1: %d",i,c[1]),e.next=49,l.busyBackupServers.get(c[1]);case 49:return y=d(l.getDownloadUrl(c[1])),l.busyBackupServers.set(c[1],y),e.next=53,y;case 53:return _=e.sent,l.busyBackupServers.delete(c[1]),e.abrupt("return",_);case 56:throw e.t0.index=i,e.t0;case 58:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)},d=function(e){return f.apply(this,arguments)},!this.aborted){e.next=4;break}throw new Ia("download already aborted");case 4:if(void 0!==(i=n.shift())){e.next=8;break}return this.log("%s download finished",t),e.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){e.next=10;break}return e.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){e.next=13;break}return this.log("%s already downloading, return",i),e.abrupt("return");case 13:if(void 0===this.chunks[i]){e.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),e.next=18,this.postDownloadRequest(t,n,r);case 18:return e.abrupt("return");case 19:return a=new FormData,o={hash:hu(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},a.append("parameter",JSON.stringify(o)),s=0,c=Array.from(this.indexToBackupServers[i]),u=function(e){return te(e,{body:a,signal:p.abortController.signal,timeout:p.singleThread?12e4:3e4},{useBinaryResponse:!0})},l=this,e.next=28,d().then((function(e){return void 0!==p.chunks[i]?p.log("chunk %d download duplicated",i):(p.chunks[i]=e,p.log("chunk %d downloaded",i),p.successCount+=1,p.updateProgress(p.chunks[i].byteLength)),p.successCount===p.chunkCount&&(p.log("chunks all download"),p.ee.emit("finished")),p.singleThread?(p.downloadChunks(),Promise.resolve()):p.postDownloadRequest(t,n,r)}));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(tb()),es=function(e){function t(e,i,a,o){W(this,t);var s=r.call(this,a,"ChunkUploadManager");if(m(n(s),"chunkCount",0),m(n(s),"chunks",[]),m(n(s),"uploadedChunks",[]),m(n(s),"totalFailures",0),m(n(s),"timer",void 0),m(n(s),"initState","uninitialized"),m(n(s),"ee",void 0),m(n(s),"unit",0),m(n(s),"uploadedSize",0),m(n(s),"singleThread",!1),m(n(s),"abortController",new AbortController),m(n(s),"servers",[]),m(n(s),"aborted",!1),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===o?new ea:o,0===e.file.length)throw new I("file not found or is empty",wf);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s}la(t,e);var r=ma(t);return Ha(t,[{key:"initChunks",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){e.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=t,n=this.sliceFile(t,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(e,t){var n=(e=ra(t[e],2))[0],i=e[1];e=bs(i).then((function(e){s.chunks[n]={payload:i,sha1:e,uploadedTo:void 0,index:n,processed:!1}})),r.push(e)},a=0,o=Array.from(n.entries());a<o.length;a++)i(a,o);return e.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var e=this;if(!this.aborted){for(var t=this.chunks.filter((function(e){return!e.processed})),n=function(n){var r=t[n],i=e.servers.filter((function(e){return!e.isUploading})).sort((function(e,t){return e.successCount-t.successCount})).sort((function(e,t){return e.failureCount-t.failureCount}))[0];if(void 0===i||1<i.failureCount)return e.log("Upload server not available, waiting"),e.ee.emit("serverUsedUp"),Om(1e3).then((function(){e.totalFailures>2*e.chunkCount&&e.ee.emit("error"),e.totalFailures+=1,void 0!==i&&(i.failureCount=0),e.uploadToServers()})).catch((function(){})),"break";r.processed=!0,i.isUploading=!0,e.log("uploading chunk %d to server %s",r.index,Dg(i.ip));var a=e.getUploadUrl(i.ip);return J(w.mark((function t(){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.postChunk(r.payload,a,r.index);case 3:n=e.chunks.findIndex((function(e){return e===r})),r.uploadedTo=i.ip,e.chunks.splice(n,1),e.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,e.updateProgress(r.payload.byteLength),e.log("upload chunk %d successfully",r.index),t.next=31;break;case 13:if(t.prev=13,t.t0=t.catch(0),i.isUploading=!1,r.processed=!1,504!==t.t0.statusCode&&!Sa(t.t0)){t.next=27;break}if(e.singleThread){t.next=24;break}return e.warn("%d upload timed out after %d, retrying use single thread",r.index,e.singleThread?12e4:3e4),e.abortController.abort(),e.singleThread=!0,e.ee.emit("multiTimeOut"),t.abrupt("return");case 24:return e.ee.emit("timedOut"),e.abortController.abort(),t.abrupt("return");case 27:return e.metaInfo.useNewDomain=!1,i.failureCount+=1,t.next=31,Om(1e3);case 31:e.uploadedChunks.length===e.chunkCount?(e.log("chunks uploaded"),e.ee.emit("finished")):(e.singleThread||1===e.chunks.filter((function(e){return!e.processed})).length)&&e.uploadToServers();case 32:case"end":return t.stop()}}),t,null,[[0,13]])})))(),e.singleThread?"break":void 0},r=0;r<t.length&&"break"!==n(r);r++);0===t.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var e=!0,t=[],n=G(this.uploadedChunks).sort((function(e,t){return e.index-t.index})),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){e=!1;break}t.push(i)}if(!e)throw new Ia("some chunks not uploaded, cannot get upload server ips");return t}},{key:"addServers",value:function(e){var t=this;e.forEach((function(e){var n=t.servers.findIndex((function(t){return t.ip===e}));-1!==n?t.servers[n].failureCount=0:(t.log("server %s added",Dg(e)),t.servers.push({successCount:0,isUploading:!1,ip:e,failureCount:0}))}))}},{key:"updateProgress",value:function(e){var t=this,n=void 0!==e?this.uploadedSize+e:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==e&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),"initialized"===this.initState&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(e,t){var n=0,r=[],i=t.length;for(e*=32768;n<i;)r.push(t.slice(n,n+e)),n+=e;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var e=J(w.mark((function e(t,n,r){var i,a,o,s,c,u,l;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Ia("upload already aborted");case 2:if(void 0!==this.unit){e.next=4;break}throw new Ia("unit is undefined");case 4:return i=this.metaInfo,a=i.ticket,o=i.instance,s=i.loginOpt,c=i.hashStr,e.t0=r,e.t1=c,e.next=9,bs(t);case 9:return e.t2=e.sent,e.t3=this.unit,e.t4=a,e.t5=o,e.t6=s,u={index:e.t0,hash:e.t1,sha1:e.t2,unit:e.t3,ticket:e.t4,instance:e.t5,loginOpt:e.t6},(l=new FormData).append("parameter",JSON.stringify(u)),l.append("payload",new Blob([t])),e.next=20,te(n,{headers:{Accept:"application/json"},body:l,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===e.sent.status){e.next=24;break}throw new da("uploading chunk ".concat(r," failed"));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/upload")}}]),t}(tb()),fs=function(e){function t(e){W(this,t);var i=r.call(this,e,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",(function(e){if(e===S.ConnectionState.ABORTED||e===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),e=0;for(var t=Array.from(i.mediaTasks.entries());e<t.length;e++){var n=ra(t[e],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else e===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():e===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")})),i}la(t,e);var r=ma(t);return Ha(t,[{key:"setAuthInfo",value:function(e){this.authInfo=e}},{key:"waitMediaTask",value:function(e){var t=this;return new Promise((function(n,r){t.taskFinishers[e]={resolve:n,reject:r},t.isProcessing||t.processMediaTask()})).finally((function(){void 0!==t.ongoingTask&&void 0!==t.ongoingTask.manager.timer&&clearTimeout(t.ongoingTask.manager.timer),delete t.taskFinishers[e],0!==t.mediaTasks.size?t.processMediaTask():t.isProcessing=!1}))}},{key:"addUploadTask",value:function(e,n,r,i){var a=e.file;if(e=e.hash,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return i=new es({hashStr:as(e),file:a,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},i,this.logger),a=Ud(),this.mediaTasks.set(a,{type:"UPLOAD",manager:i,hash:e,setter:r,fetcher:n,taskId:a}),a}},{key:"addDownloadTask",value:function(e,n,r){var i=e.hashHexStr,a=e.size,o=e.unit;if(e=e.zone,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return r=new ds({hashHexStr:i,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:a,zone:e,unit:o},r,this.logger),i=Ud(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u,l,d=this,f=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<f.length&&void 0!==f[2]&&f[2],a=i=t.manager,r&&(i=new ds(a.metaInfo,a.transHandler,this.logger,a.ee)),o=t.fetcher,e.next=7,o();case 7:if(s=e.sent,c=s.serverList,u=s.backupList,l=s.unit,!r||l===a.retUnit){e.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:r&&(t.manager=i,i.downloadedSize=a.downloadedSize,i.successCount=a.successCount,i.timer=a.timer,i.chunks=a.chunks,i.initialized=a.initialized,i.singleThread=a.singleThread,i.updateProgress(0)),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("error",(function(e){i.ee.removeAllListeners(),n.reject(new da(["download file file, index %d",e.index],{code:mg,originalError:e}))})),i.ee.once("notExist",(function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new da("download file not found",AA))})),i.ee.once("timedOut",(function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("download timed out",zA))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Downloading canceled",ir))}),{once:!0}),i.ee.once("finished",(function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})})),i.setInfoByResponse({serverList:c,backupList:u,unit:l}),i.downloadChunks();case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,a){n.doDownloadTaskImpl(e,t,r).then(i).catch(a)}))}},{key:"doUploadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u,l,d=this,f=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<f.length&&void 0!==f[2]&&f[2],a=i=t.manager,r&&(i=new es(a.metaInfo,a.transHandler,this.logger,a.ee)),o=t.fetcher,s=new Pa,u=new Promise((function(e,u){var l=o(),d=l.ret,f=l.err,p=l.timeout;l.fin.pipe(ob(s)).subscribe({next:function(e){n.resolve({type:"UPLOAD",retUnit:e.unit,zone:e.zone})},complete:function(){e({hasExist:!0}),s.next(),s.complete()}}),d.pipe(ob(s),cb(function(){var e=J(w.mark((function e(o){var s,u;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o.servers,u=o.unit,r&&a.unit!==u?n.reject(new da("upload unit is different, reject to continue",lg)):r&&(t.manager=i,i.chunkCount=a.chunkCount,i.chunks=a.chunks,i.totalFailures=a.totalFailures,i.uploadedChunks=a.uploadedChunks,i.timer=a.timer,i.initState=a.initState,i.unit=a.unit,i.uploadedSize=a.uploadedSize,i.singleThread=a.singleThread,i.updateProgress(0)),i.addServers(s),"uninitialized"!==i.initState){e.next=7;break}return c=i.initChunks(u),e.next=7,c;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).subscribe({complete:function(){return e({hasExist:!1})},error:u}),l=function(t){"uninitialized"!==i.initState&&c?e(c.then((function(){return{hasExist:!1}}))):u(t)},f.pipe(ob(s)).subscribe({error:l}),p.pipe(ob(s)).subscribe({error:l})})),e.next=9,u;case 9:if(!e.sent.hasExist){e.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),e.abrupt("return");case 15:s.next(),s.complete(),this.log("chunks initialization promise resolved"),l=gb(i.ee,"serverUsedUp").pipe(Gt((function(){return i.chunkCount!==i.uploadedChunks.length})),Jt(5e3,void 0,{leading:!1}),pm((function(){return o().ret}))).subscribe((function(e){i.addServers(e.servers)})),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("timedOut",(function(){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("upload timed out",Lh))})),i.ee.once("error",(function(e){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(e||new da("upload error",lg))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Uploading canceled",hr))}),{once:!0}),i.ee.once("finished",J(w.mark((function e(){var r,a,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.unsubscribe(),e.next=3,t.setter(i.unit,i.getUploadServerIPs());case 3:r=e.sent,a=r.zone,o=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:o,zone:a});case 8:case"end":return e.stop()}}),e)})))),i.uploadToServers();case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doUploadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,a){n.doUploadTaskImpl(e,t,r).then(i).catch(a)}))}},{key:"processMediaTask",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.mediaTasks.size){e.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,t=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[t])){e.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(t))){e.next=10;break}throw new Ia("task invalid");case 10:if("UPLOAD"!==r.type){e.next=15;break}return e.next=13,this.doUploadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 13:e.next=18;break;case 15:if("DOWNLOAD"!==r.type){e.next=18;break}return e.next=18,this.doDownloadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelTask",value:function(e){var t="DOWNLOAD"===e.type?ir:hr;e.manager.ee.removeAllListeners(),e.manager.abortController.abort(),void 0!==this.taskFinishers[e.taskId]&&this.taskFinishers[e.taskId].reject(new hl("User logged out or kicked off, media task canceled",t))}}]),t}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",(function(){for(var e=0,t=arguments.length,n=new(Ne(this))(t);t>e;)n[e]=arguments[e++];return n}),Dj);var gs=1/0,dD=Math.max,ju=function(e,t,n){var r=Object(e);if(!Ed(e)){var i=Te(t);e=Ad(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=gl(n))===gs||n===-gs?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=dD(r+n,0)),Xp(e,Te(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},iu=function(e,t){return e&&e.length?vk(e,void 0,"function"==typeof t?t:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}Mg(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],a=i.len;void 0!==(i=i.val)&&(e+=U.fromValue(i).shiftLeft(t).toNumber(),t+=a)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],a=i.len;void 0!==(i=i.val)&&(e=U.fromValue(i).shiftLeft(t).add(e),t+=a)}return e}},{key:"assert",value:function(e,t){function n(e){if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return Mg(r,e),Lg(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],a=i.len,o=U.fromNumber(Math.pow(2,a)-1,!0).shiftLeft(t);Mg(i,o=e.and(o).shiftRightUnsigned(t)),i.val=o,t+=a}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=ra(t[n],2),i=r[0];if(Lg(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function t(e){W(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",203),r.set("Rejoin",e),r}la(t,e);var n=ma(t);return t}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function t(e){W(this,t);var r=n.call(this);if(r.define("MessageType",fD,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",gD,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||U.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=Hg(e);i<e.length;i++){var a=ra(e[i],2);r.set(a[0],a[1])}}return r}la(t,e);var n=ma(t);return Ha(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):xf(js).some((function(e){return t.assert("MessageType",e)}))}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(hs),hD=function(e){function t(e){return W(this,t),m(n(e=r.call(this,e,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),e}la(t,e);var r=ma(t);return Ha(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(tb()),v={};"object"==X(module)&&(module.exports=v),v.parse=function(e,t){var n,r=v.bin.readUshort,i=v.bin.readUint,a={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var o=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var s=0;s<o;s++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),d=r(e,n+2),f=r(e,n+4);n+=6;var p=i(e,n+=8);n+=4,n+=l+d+f,v._readLocal(e,p,a,c,u,t)}return a},v._readLocal=function(e,t,n,r,i,a){var o=v.bin.readUshort,s=v.bin.readUint;s(e,t),o(e,t+=4),o(e,t+=2);var c=o(e,t+=2);s(e,t+=2),s(e,t+=4),s=o(e,t=t+4+8);var u=o(e,t+=2);if(t+=2,o=v.bin.readUTF8(e,t,s),t=t+s+u,a)n[o]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[o]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),v.inflateRaw(e,t),n[o]=t}},v.inflateRaw=function(e,t){return v.F.inflate(e,t)},v.inflate=function(e,t){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},v.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=v.F.deflateRaw(e,r,n+2,t.level),e=v.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},v.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=v.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},v.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=v.bin.writeUint,a=v.bin.writeUshort,o={};for(n in e){var s=!v._noNeed(n)&&!t,c=e[n],u=v.crc.crc(c,0,c.length);o[n]={cpr:s,usize:c.length,crc:u,file:s?v.deflateRaw(c):c}}for(n in o)r+=o[n].file.length+30+46+2*v.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],o)u=o[n],c.push(t),t=v._writeHeader(e,t,n,u,0);for(n in r=0,s=t,o)u=o[n],c.push(t),t=v._writeHeader(e,t,n,u,1,c[r++]);return o=t-s,i(e,t,101010256),a(e,t=t+4+4,r),a(e,t+=2,r),i(e,t+=2,o),i(e,t+4,s),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},v._writeHeader=function(e,t,n,r,i,a){var o=v.bin.writeUint,s=v.bin.writeUshort,c=r.file;return o(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,r.cpr?8:0),o(e,t+=2,0),o(e,t+=4,r.crc),o(e,t+=4,c.length),o(e,t+=4,r.usize),s(e,t+=4,v.bin.sizeUTF8(n)),s(e,t+=2,0),t+=2,1==i&&(o(e,t=t+2+2+6,a),t+=4),t+=n=v.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},v.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=v.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^v.crc.update(4294967295,e,t,n)}},v.adler=function(e,t,n){var r=1,i=0,a=t;for(t+=n;a<t;){for(n=Math.min(a+5552,t);a<n;)i+=r+=e[a++];r%=65521,i%=65521}return i<<16|r},v.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",a=0;a<n;a++)i+="%"+v.bin.pad(e[t+a].toString(16));try{r=decodeURIComponent(i)}catch(r){return v.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,a=0;a<r;a++){var o=n.charCodeAt(a);if(0==(4294967168&o))e[t+i]=o,i++;else if(0==(4294965248&o))e[t+i]=192|o>>6,e[t+i+1]=128|o>>0&63,i+=2;else if(0==(4294901760&o))e[t+i]=224|o>>12,e[t+i+1]=128|o>>6&63,e[t+i+2]=128|o>>0&63,i+=3;else{if(0!=(4292870144&o))throw"e";e[t+i]=240|o>>18,e[t+i+1]=128|o>>12&63,e[t+i+2]=128|o>>6&63,e[t+i+3]=128|o>>0&63,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},v.F={},v.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],a=v.F.U,o=v.F._goodIndex;v.F._hash;var s=v.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var d=Math.min(65535,l-c);s(t,n,c+d==l?1:0),n=v.F._copyExact(e,c,d,t,n+8),c+=d}return n>>>3}s=a.lits,r=a.strt;var f=a.prev,p=0,h=0,m=0,g=0,y=0;for(2<l&&(r[y=v.F._hash(e,0)]=0),c=0;c<l;c++){if(d=y,c+1<l-2){y=v.F._hash(e,c+1);var _=c+1&32767;f[_]=r[y],r[y]=_}if(u<=c){if((14e3<p||26697<h)&&100<l-c&&(u<c&&(s[p]=c-u,p+=2,u=c),n=v.F._writeBlock(c==l-1||u==l?1:0,s,p,g,e,m,c-m,t,n),p=h=g=0,m=c),_=0,c<l-2&&(_=v.F._bestMatch(e,c,f,d,Math.min(i[2],l-c),i[3])),0!=_){d=_>>>16,_&=65535;var E=o(d,a.of0);a.lhst[257+E]++;var b=o(_,a.df0);a.dhst[b]++,g+=a.exb[E]+a.dxb[b],s[p]=d<<23|c-u,s[p+1]=_<<16|E<<8|b,p+=2,u=c+d}else a.lhst[e[c]]++;h++}}for(m==c&&0!=e.length||(u<c&&(s[p]=c-u,p+=2),n=v.F._writeBlock(1,s,p,g,e,m,c-m,t,n));0!=(7&n);)n++;return n>>>3},v.F._bestMatch=function(e,t,n,r,i,a){var o=32767&t,s=n[o],c=o-s+32768&32767;if(s==o||r!=v.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--a&&s!=o;){if((0==r||e[t+r]==e[t+r-c])&&(o=v.F._howLong(e,t,c))>r){if(u=c,(r=o)>=i)break;c+2<o&&(o=c+2);for(var d=0,f=0;f<o-2;f++){var p=t-c+f+32768&32767,h=p-n[p]+32768&32767;h>d&&(d=h,s=p)}}c+=(o=s)-(s=n[o])+32768&32767}return r<<16|u},v.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},v.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,t,n,r,i,a,o,s,c){var u=v.F.U,l=v.F._putsF,d=v.F._putsE;u.lhst[256]++;var f=v.F.getTrees(),p=f[0],h=f[1],m=f[2],g=f[3],y=f[4],_=f[5],E=f[6];f=f[7];var b=32+(0==(c+3&7)?0:8-(c+3&7))+(o<<3),w=r+v.F.contSize(u.fltree,u.lhst)+v.F.contSize(u.fdtree,u.dhst);r=r+v.F.contSize(u.ltree,u.lhst)+v.F.contSize(u.dtree,u.dhst),r+=14+3*_+v.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var S=0;286>S;S++)u.lhst[S]=0;for(S=0;30>S;S++)u.dhst[S]=0;for(S=0;19>S;S++)u.ihst[S]=0;if(b=b<w&&b<r?0:w<r?1:2,l(s,c,e),l(s,c+1,b),c+=3,0==b){for(;0!=(7&c);)c++;c=v.F._copyExact(i,a,o,s,c)}else{if(1==b)var k=u.fltree,T=u.fdtree;if(2==b){for(v.F.makeCodes(u.ltree,p),v.F.revCodes(u.ltree,p),v.F.makeCodes(u.dtree,h),v.F.revCodes(u.dtree,h),v.F.makeCodes(u.itree,m),v.F.revCodes(u.itree,m),k=u.ltree,T=u.dtree,d(s,c,g-257),d(s,c+=5,y-1),d(s,c+=5,_-4),c+=4,e=0;e<_;e++)d(s,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=v.F._codeTiny(E,u.itree,s,c+3*_),c=v.F._codeTiny(f,u.itree,s,c)}for(_=0;_<n;_+=2){for(E=(e=t[_])>>>23,e=a+(8388607&e);a<e;)c=v.F._writeLit(i[a++],k,s,c);0!=E&&(e=(p=t[_+1])>>16,o=p>>8&255,p&=255,d(s,c=v.F._writeLit(257+o,k,s,c),E-u.of0[o]),c+=u.exb[o],l(s,c=v.F._writeLit(p,T,s,c),e-u.df0[p]),c+=u.dxb[p],a+=E)}c=v.F._writeLit(256,k,s,c)}return c},v.F._copyExact=function(e,t,n,r,i){var a=i>>>3;return r[a]=n,r[a+1]=n>>>8,r[a+2]=255-r[a],r[a+3]=255-r[a+1],a+=4,r.set(new Uint8Array(e.buffer,t,n),a),i+(n+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,t=v.F._hufTree(e.lhst,e.ltree,15),n=v.F._hufTree(e.dhst,e.dtree,15),r=[],i=v.F._lenCodes(e.ltree,r),a=[],o=v.F._lenCodes(e.dtree,a),s=0;s<r.length;s+=2)e.ihst[r[s]]++;for(s=0;s<a.length;s+=2)e.ihst[a[s]]++;s=v.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,s,i,o,c,r,a]},v.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},v.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},v.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},v.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var a=e[i],o=e[i+1];r=v.F._writeLit(a,t,n,r);var s=16==a?2:17==a?3:7;15<a&&(v.F._putsE(n,r,o,s),r+=s)}return r},v.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],a=r+3<n?e[r+3]:-1,o=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==i&&a==i&&o==i){for(a=r+5;a+2<n&&e[a+2]==i;)a+=2;11>(i=Math.min(a+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==s&&a==i&&o==i){for(a=r+5;a+2<n&&e[a+2]==i;)a+=2;i=Math.min(a+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},v.F._hufTree=function(e,t,n){var r=[],i=e.length,a=t.length,o=0;for(o=0;o<a;o+=2)t[o]=0,t[o+1]=0;for(o=0;o<i;o++)0!=e[o]&&r.push({lit:o,f:e[o]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),o=r[0],a=r[1];var s=0,c=1,u=2;for(r[0]={lit:-1,f:o.f+a.f,l:o,r:a,d:0};c!=e-1;)o=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],a=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],r[c++]={lit:-1,f:o.f+a.f,l:o,r:a};for((r=v.F.setDepth(r[c-1],0))>n&&(v.F.restrictDepth(i,n,r),r=n),o=0;o<e;o++)t[1+(i[o].lit<<1)]=i[o].d;return r},v.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(v.F.setDepth(e.l,t+1),v.F.setDepth(e.r,t+1))},v.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,a=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var o=e[r].d;e[r].d=t,a+=i-(1<<n-o)}for(a>>>=n-t;0<a;)(o=e[r].d)<t?(e[r].d++,a-=1<<t-o-1):r++;for(;0<=r;r--)e[r].d==t&&0>a&&(e[r].d--,a++);0!=a&&console.log("debt left")},v.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},v.F._writeLit=function(e,t,n,r){return v.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},v.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=v.F,i=r._bitsF,a=r._bitsE,o=r._decodeTiny,s=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,d=null==t;d&&(t=new n(e.length>>>2<<3));for(var f,p,h,m,g=0,y=0,_=p=0,E=0;0==g;)if(g=i(e,E,1),f=i(e,E+1,2),E+=3,0==f)0!=(7&E)&&(E+=8-(7&E)),f=e[(E=4+(E>>>3))-4]|e[E-3]<<8,d&&(t=v.F._check(t,_+f)),t.set(new n(e.buffer,e.byteOffset+E,f),_),E=E+f<<3,_+=f;else{if(d&&(t=v.F._check(t,_+131072)),1==f&&(h=l.flmap,m=l.fdmap,y=511,p=31),2==f){for(p=a(e,E,5)+257,f=a(e,E+5,5)+1,h=a(e,E+10,4)+4,E+=14,m=0;38>m;m+=2)l.itree[m]=0,l.itree[m+1]=0;for(y=1,m=0;m<h;m++){var b=a(e,E+3*m,3);l.itree[1+(l.ordr[m]<<1)]=b,b>y&&(y=b)}E+=3*h,s(l.itree,y),c(l.itree,y,l.imap),h=l.lmap,m=l.dmap,E=o(l.imap,(1<<y)-1,p+f,e,E,l.ttree),y=(1<<(b=r._copyOut(l.ttree,0,p,l.ltree)))-1,p=(1<<(f=r._copyOut(l.ttree,p,f,l.dtree)))-1,s(l.ltree,b),c(l.ltree,b,h),s(l.dtree,f),c(l.dtree,f,m)}for(;;)if(E+=15&(f=h[u(e,E)&y]),0==(b=f>>>4)>>>8)t[_++]=b;else{if(256==b)break;f=_+b-254,264<b&&(f=_+((b=l.ldef[b-257])>>>3)+a(e,E,7&b),E+=7&b),E+=15&(b=m[u(e,E)&p]);var w=((b=l.ddef[b>>>4])>>>4)+i(e,E,15&b);for(E+=15&b,d&&(t=v.F._check(t,_+131072));_<f;)t[_]=t[_++-w],t[_]=t[_++-w],t[_]=t[_++-w],t[_]=t[_++-w];_=f}}return t.length==_?t:t.slice(0,_)},v.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},v.F._decodeTiny=function(e,t,n,r,i,a){for(var o=v.F._bitsE,s=v.F._get17,c=0;c<n;){var u=e[s(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)a[c]=l,c++;else{var d=u=0;for(16==l?(d=3+o(r,i,2),i+=2,u=a[c-1]):17==l?(d=3+o(r,i,3),i+=3):18==l&&(d=11+o(r,i,7),i+=7),l=c+d;c<l;)a[c]=u,c++}}return i},v.F._copyOut=function(e,t,n,r){for(var i=0,a=0,o=r.length>>>1;a<n;){var s=e[a+t];r[a<<1]=0,r[1+(a<<1)]=s,s>i&&(i=s),a++}for(;a<o;)r[a<<1]=0,r[1+(a<<1)]=0,a++;return i},v.F.makeCodes=function(e,t){var n,r,i=v.F.U,a=e.length,o=i.bl_count;for(n=0;n<=t;n++)o[n]=0;for(n=1;n<a;n+=2)o[e[n]]++;for(i=i.next_code,n=0,o[0]=0,r=1;r<=t;r++)n=n+o[r-1]<<1,i[r]=n;for(t=0;t<a;t+=2)0!=(o=e[t+1])&&(e[t]=i[o],i[o]++)},v.F.codes2map=function(e,t,n){for(var r=e.length,i=v.F.U.rev15,a=0;a<r;a+=2)if(0!=e[a+1]){var o=e[a+1],s=a>>1<<4|o,c=t-o;for(c=(o=e[a]<<c)+(1<<c);o!=c;)n[i[o]>>>15-t]=s,o++}},v.F.revCodes=function(e,t){for(var n=v.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},v.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},v.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},v.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},v.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},v.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},v.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},v.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=v.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),v.F.makeCodes(t.fltree,9),v.F.codes2map(t.fltree,9,t.flmap),v.F.revCodes(t.fltree,9),e(t.fdtree,32,5),v.F.makeCodes(t.fdtree,5),v.F.codes2map(t.fdtree,5,t.fdmap),v.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function t(e,i,a,o){W(this,t);var s=r.call(this,o,"Session");return m(n(s),"chatManager",void 0),m(n(s),"joinedChannels",new Set),m(n(s),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(s),"startTime",Date.now()),m(n(s),"seq",U.fromNumber(1,!0)),m(n(s),"userJoinOptions",new is(!1)),m(n(s),"seqSentStatuses",[!1,!1]),m(n(s),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(s),"loggedOut",!1),m(n(s),"messageSentTimes",[]),m(n(s),"curLoginSockets",[void 0,void 0]),m(n(s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(s),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(s),"dialPendingMsgSubjectMap",new Map),m(n(s),"context",void 0),m(n(s),"connection",void 0),m(n(s),"instanceId",void 0),m(n(s),"registerSocketsFailureListener",(function(){s.connection.once("socketsFailure",(function(){s.log("socketsFailure, creating a new connection"),ad((function(){return s.connection.removeAllListeners(),s.connection=new Yr(s.context,s.logger,!0),s.loginHandler(15e3,!0)})).pipe(oe((function(e){return e.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))})),ob(s.connection.apClient.apFinish$)).subscribe((function(){s.log("new connection connected")}))})),0===s.connection.listenerCount("tokenExpired")&&s.connection.on("tokenExpired",(function(){s.emit("tokenExpired")}))})),s.context=e,s.connection=i,s.instanceId=a,s.chatManager=new hD(o),s.log("The instanceId is %s",s.instanceId.toString()),s}la(t,e);var r=ma(t);return Ha(t,[{key:"fetchFileUploadIndexGet",value:function(e){var n=e.hash,r=e.size;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var i=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})})),{ret:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexRet").pipe(aa((function(e){return i.eq(e.seq)})))})))),fin:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return i.eq(e.seq)})))})))),err:Xb.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The media message upload failure, code %d",e.code],lg)})))})))),timeout:t.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(e){var n=e.hash,r=e.unit,i=e.servers;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var a=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexSet",{seq:a,servers:i,hash:n,unit:r})})),Ca.apply(void 0,[t.genTimeoutError(Lh)].concat(G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return a.eq(e.seq)})),ba((function(e){throw new da(["FileUploadIndexSet failure, code %d",e.code],lg)})))}))),G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return a.eq(e.seq)})))})))))}},{key:"requestFileDownloadIndexGet",value:function(e){var n=e.size,r=e.zone,i=e.unit,a=e.hash,o=this.getLoginSockets();if(0===o.length)throw new K("Client is not logged in");var s=this.incGetSeq();return o.forEach((function(e){e.sendPacket("FileDownloadIndexGet",{seq:s,size:n,zone:r,unit:i,hash:a})})),e=Ca.apply(void 0,G(o.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return s.eq(e.seq)})))})))).pipe(ba((function(e){var t=e.backups,n=e.servers;return e=ff(e,iD),ua({backupList:t.map((function(e){return[e]})),serverList:n.map((function(e){return[e]}))},e)})),cd(500)),o=jm(o.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return s.eq(e.seq)})))}))),Ca(e,o.pipe(ba((function(e){return e.reduce((function(e,t){var n=e.backupList,r=e.serverList;e=t.backups;var i=t.servers;return t=ff(t,jD),ua({backupList:e.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(n[t])?n[t]:[]))})),serverList:i.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(r[t])?r[t]:[]))}))},t)}),{})}))),t.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2e4,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new K("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var a=e.loginSocketSubs[r].login;void 0!==a&&a.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(ca((function(t){var a;e.curLoginSockets[r]=t;var o=Date.now();eb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:fb(e.startTime),lts:U.fromNumber(o),responseTime:i-o,sid:Xa(e.instanceId),userId:e.context.uid},null!==(a=e.context.config.enableCloudProxy)&&void 0!==a&&a),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(r).concat([gb(this.connection,"connectionInitFailure").pipe(ca((function(e){if(sa(e)||Sa(e))throw e;throw new da("Login failure",{code:Zq,originalError:e})})))])).pipe(Ka(1),hb(t),Ga((function(t){return t instanceof pb&&e.warn("Client login timeout"),t&&t.code===Kh&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Z(t)})),ca((function(){n||e.registerSocketsFailureListener()})),wg((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:function(){var e=J(w.mark((function e(){var t,n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map((function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)})),this.clearSockets(5e3),r=t.map((function(e){return e.env})),[0,1].filter((function(e){return!r.includes(e)})).forEach((function(e){i.connection.closeSocket(e,0)})),e.abrupt("return",Xb.apply(void 0,G(n)).toPromise());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return r=gb(this,"channelLeft").pipe(wb((function(e){return e===t})),Ka(1)),i=this.incGetSeq(),(a=this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e,t){0!==t&&o.incSeqIfNeeded(e.env);var r=0===t?i:o.seq;return e.sendPacket("GroupEnter",{account:n,seq:r}),e.fromReceived("GroupReply").pipe(aa((function(e){return r.eq(e.seq)})),ca((function(e){if(0!==(e=e.code))throw new da(["Channel join failure. The response code is %d",e],Rq)})))})),ob(r),pe())}))).forEach((function(e,n){var r=function(){return o.loginSocketSubs[n].channels.delete(t.channelId)};o.loginSocketSubs[n].channels.set(t.channelId,e.subscribe({error:r,complete:r}))})),e.next=8,Xb.apply(void 0,G(a)).pipe(Ka(1),hb(1e4),Ga((function(e){return e instanceof pb&&o.warn("Channel join timeout"),Z(e)}))).toPromise();case 8:this.joinedChannels.add(t);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e,t){this.emit("channelLeft",e),this.joinedChannels.delete(e),this.getLoginSockets().forEach((function(e){e.sendPacket("GroupLeave",{account:t})}))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in. Cannot get the channel members",cA);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(aa((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(oA)].concat(G(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var a=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:a})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return a.eq(e.seq)})),ba((function(e){throw new da(["The user attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return a.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var a=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:a})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return a.eq(e.seq)})),ba((function(e){throw new da(["The group attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return a.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var a=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:a})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return a.eq(e.seq)})),ba((function(e){throw new da(["The group attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return a.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var a=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:a})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return a.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return a.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),Ca.apply(void 0,G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new da(["The user attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes get failure, code %d",e.code],Sb)})))}))),G(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new Wc(["Channel attribute operation unknown error code: %d",e.code],Sb)})))}))),G(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),Ca.apply(void 0,[t.genTimeoutError(vA)].concat(G(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new K("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f,p,h=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,a=t.isAcceptAck,o=t.channelId,s=t.type,c={callId:r},void 0===a){e.next=6;break}if("CallAccept"===s){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=a?"ack":"request";case 6:return c.channel=o,("CallInvite"===s||"CallCancel"===s||"CallReject"===s||"CallAccept"===s&&!1===a)&&void 0!==i&&(c.extra=i),u=Bg(),this.log("The sent invitation body is %o",c),l=function(e){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:u,instance:h.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,MessageType:s}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:h.context.uid}},e.next=14,Kb(this.sendMessageToRetry(l,!0)).pipe(hb(1e4),Ga((function(e){return e instanceof pb&&h.warn("Send invitation timeout"),Z(e)}))).toPromise();case 14:return d=e.sent,f=d.code,p=d.retryTimes,e.abrupt("return",{hasPeerReceived:0===f,hasReSent:0!==p});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,a,o){var s,c,u,l,d,f,p,h,v,g,y,_,E,b,S,k,T,C,R,A,O,N,x,D,P,L,M,j,F,V=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.width,u=void 0===c?0:c,l=n.height,d=void 0===l?0:l,f=n.fileName,p=void 0===f?"":f,h=n.description,v=void 0===h?"":h,g=n.thumbnail,y=void 0===g?new Blob:g,_=n.thumbnailHeight,E=void 0===_?0:_,b=n.thumbnailWidth,S=void 0===b?0:b,k=n.size,T=void 0===k?0:k,C=n.mediaId,R=a.enableOfflineMessaging,A=a.enableHistoricalMessaging,za(r)){e.next=4;break}throw new I("The send message arguments are not valid",i?$k:hg);case 4:if(!(32768<new Blob([p,y,v]).size)){e.next=6;break}throw new I("The size of message overflowed ",i?ve:Hh);case 6:return O=this.chatManager.getChatInfo(r),N=O.dialogue,x=O.sequence,D=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(D,"-").concat(N,"#").concat(x,'"'),i?" peer":" channel",oa(r)),m(s={},"media_description",v),m(s,"media_width",u),m(s,"media_height",d),m(s,"media_thumbnailwidth",S),m(s,"media_thumbnailheight",E),m(s,"media_size",T),m(s,"media_id",C),m(s,"media_filename",p),P=uc(s,(function(e){return(new TextEncoder).encode(e.toString())})),e.t0=Uint8Array,e.next=14,Ji(y);case 14:return e.t1=e.sent,P.media_thumbnail=new e.t0(e.t1),L=i&&"IMAGE"===t?"PeerImageMessage":i&&"FILE"===t?"PeerFileMessage":i||"IMAGE"!==t?"ChannelFileMessage":"ChannelImageMessage",M=function(e){return{MiscMap:P,sequence:x,dialogue:N,instance:D,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:"Uncompressed",MessageType:L,ToCache:R,ToArchive:A}).toLong(),payload:new Uint8Array,src:V.context.uid}},e.next=20,Kb(this.sendMessageToRetry(M,!0)).pipe(hb(void 0===o?1e4:o),Ga((function(e){return e instanceof pb&&V.warn("Send message timeout"),Z(e)}))).toPromise();case 20:if(j=e.sent,2!==(F=j.code)){e.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return e.abrupt("return",{hasPeerReceived:0===F});case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,a,o){var s,c,u,l,d,f,p,h,v,m,g=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.enableOfflineMessaging,c=a.enableHistoricalMessaging,za(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=3;break}throw new I("The send message arguments are not valid",i?$k:hg);case 3:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",i?ve:Hh);case 5:return u=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,l=this.chatManager.getChatInfo(r),d=l.dialogue,f=l.sequence,p=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(p,"-").concat(d,"#").concat(f,'"'),u?" compressed":"",i?"peer":"channel",oa(r)),h=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:f,dialogue:d,instance:p,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:u?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:s,ToArchive:c}).toLong(),payload:u?ks(t):t,src:g.context.uid}},e.next=12,Kb(this.sendMessageToRetry(h,!0)).pipe(hb(void 0===o?1e4:o),Ga((function(e){return e instanceof pb&&g.warn("Send message timeout"),Z(e)}))).toPromise();case 12:return v=e.sent,m=v.code,e.abrupt("return",{hasPeerReceived:0===m});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,a){var o,s,c,u,l,d,f,p,h,v,m,g=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i.enableOfflineMessaging,s=i.enableHistoricalMessaging,za(n)){e.next=3;break}throw new I("The send message arguments are not valid",r?$k:hg);case 3:if(!(32768<new Blob([t]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",r?ve:Hh);case 5:return c=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,u=this.chatManager.getChatInfo(n),l=u.dialogue,d=u.sequence,f=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(f,"-").concat(l,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",oa(n)),p=(new TextEncoder).encode(t),h=function(e){return{MiscMap:{},sequence:d,dialogue:l,instance:f,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:o,ToArchive:s}).toLong(),payload:c?ks(p):p,src:g.context.uid}},e.next=13,Kb(this.sendMessageToRetry(h,!0)).pipe(hb(void 0===a?1e4:a),Ga((function(e){return e instanceof pb&&g.warn("Send message timeout"),Z(e)}))).toPromise();case 13:return v=e.sent,m=v.code,e.abrupt("return",{hasPeerReceived:0===m});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=ra(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,f=this,p=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<p.length&&void 0!==p[2]?p[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return a=t(r),i.forEach((function(e){e.sendPacket("Message",a)})),o=a.dialogue,s=a.sequence,c=a.instance,u=i.map((function(e){return e.fromReceived("Ack").pipe(wb((function(e){return o.eq(e.dialogue)&&s.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,Xb.apply(void 0,G(u)).pipe(hb(6e3),Ga((function(e){return Sa(e)&&f.warn("Message send timeout, retry times %d",r),Z(e)})),Ka(1)).toPromise();case 12:return l=e.sent,d=l.code,this.log("The message has been acked, %o",{code:d}),e.abrupt("return",{code:d,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof pb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Bc(0,2750).pipe(ca((function(){e.incSeqIfNeeded(t.env),t.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:e.seq})})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e){var t,n=!1,r=e.userJoin$.pipe(ca((function(){n=!0}))),i=e.input$.pipe(ca((function(e){"Ping"!==Li[e.uri].slice(0,-3)&&(n=!1)})));return Xb(Bc(15e3,1e4).pipe(Pt(e.receivedPacket),ca((function(r){r=ra(r,2),r=ra(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Xb(gb(t,"reconnect").pipe(ca(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(ca(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(ca(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(ca(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(ca(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(ca(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return im(ad((function(){r.userJoinOptions=new is(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(aa((function(e){return n.eq(e.seq)})),ca((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",t],jg);r.log("ENV_%d logged in",e.env)})),qf(e),hb(15e3))).pipe(wb((function(e){return void 0!==e})),Ga((function(e){return e instanceof pb&&r.warn("Login response timeout, rejoin: %s",t),Z(e)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(ca((function(e){0===e.listenerCount("socketUserDrop")&&e.on("socketUserDrop",(function(t){return n.onUserDrop(t,e)}))})),Cc((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),pe())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var a=e[t];a&&(i[r++]=a)}return i}},{key:"emitMessage",value:function(e,n){var r=e.options,i=e.payload,a=e.src,o=e.dst,s=e.instance,c=e.dialogue,u=e.sequence,l=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(c.toString(),u),s="".concat(s,"-").concat(c,"#").concat(u),this.msgDedupLru.has(s)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,s):(this.msgDedupLru.set(s,void 0),n=new ae(r),this.lastLoginSockets.forEach(function(){var n=J(w.mark((function n(r){var i;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Ka(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(o=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),o=JSON.parse(o),this.log("The received invitation body is %o",o),this.emit("invitationMessage",{body:o,type:n.getInvitationType(),peerId:a,serverReceivedTs:l.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a %s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",oa(a),oa(o),s),d?(a={text:i,peerId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",a)):this.emit("channelTextMessage",{channelId:o,memberId:a,text:i,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":pa(d),i=r?nl(i):i,this.info("Received a %s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",oa(a),oa(o),s),c?(a={desc:d,raw:i,peerId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",a)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:o,memberId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",oa(a),oa(o),s),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:a,channelId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserDrop",value:function(e,t){var n;e=e.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:t.address,serverCode:e,sid:Xa(this.instanceId),userId:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),10006===e||10001===e?this.warn("Login too often and kicked off, reconnect and login"):10009===e?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(e)&&(this.emit("userDrop",e),this.clearSockets())}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,a=n.sequence,o=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var s=r.toString(),c=t.dialPendingMsgSubjectMap.get(s);if(r="".concat(i,"-").concat(r,"#").concat(a),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(s);if(c=!u&&a.eq(1),i=void 0!==u&&a.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(a.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);a=new Pa,t.dialPendingMsgSubjectMap.set(s,a);var l=a.pipe(Qs(Pk),xg((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return G(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),sm(1));o=!(o=new ae(o)).isFromCache()&&!o.isBufferedMessage(),l.pipe(ob(Bc(o?750:1500)),aa((function(e){if(2>e.length)return!1;for(var t=void 0===u?U.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),wg((function(){t.dialPendingMsgSubjectMap.delete(s)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof vg&&l.pipe(Ka(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),a.next(n)}}}}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=ff(t,kD),e.emit("channelAttributesUpdated",ua({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}}],[{key:"sendMessageAck",value:function(e,t){var n=new ae(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(tb());m(ls,"genTimeoutError",(function(e,t){return bb(void 0).pipe(cd(void 0===t?1e4:t),ba((function(){throw new db(["Request timed out after %ds",void 0===t?1e4:t],e)})))}));var ms,ol,pl=0,ql=0;Ud.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||ms,a=void 0!==e.clockseq?e.clockseq:ol;if(null==i||null==a){var o=Jq();null==i&&(i=ms=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==a&&(a=ol=16383&(o[6]<<8|o[7]))}o=void 0!==e.msecs?e.msecs:(new Date).getTime();var s=void 0!==e.nsecs?e.nsecs:ql+1,c=o-pl+(s-ql)/1e4;if(0>c&&void 0===e.clockseq&&(a=a+1&16383),(0>c||o>pl)&&void 0===e.nsecs&&(s=0),1e4<=s)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=o,ql=s,ol=a,e=(1e4*(268435455&(o+=122192928e5))+s)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=o/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a,a=0;6>a;++a)r[n+a]=i[a];return t||Kq(r)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function t(e,i,a){W(this,t);var o=r.call(this,a,"RtmLocalInvitation",!0);return m(n(o),"state",Ba.IDLE),m(n(o),"localInvitationEnd$",Ca(gb(n(o),"LocalInvitationAccepted"),gb(n(o),"LocalInvitationRefused"),gb(n(o),"LocalInvitationFailure"),gb(n(o),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(o),"callId",Ud.v4()),m(n(o),"_content",""),m(n(o),"_channelId",""),m(n(o),"_response",""),m(n(o),"calleeId",void 0),m(n(o),"logger",void 0),m(n(o),"getSession",void 0),o.calleeId=e,o.getSession=i,o.logger=a,o}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var e,t=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark((function n(){var r,i,a;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,a=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new db("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||a){n.next=11;break}throw e=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(oe((function(e){return e.pipe(ca((function(e){if(!(e instanceof rl))throw e})),cd(2e3))})),hb(3e4),Ga((function(e){return Sa(e)&&t.warn("local invitation ack timed out"),Z(e)})),ob(this.localInvitationEnd$)).subscribe({next:function(){t.state===Ba.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Ba.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Ba.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&t.warn("local invitation expired"),Z(e)}))).subscribe({error:function(){t.state=Ba.FAILURE,t.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Ba.FAILURE,Sa(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",bf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(n)?t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function t(e){var i=e.invitationChannel,a=e.extraContent,o=e.callId,s=e.callerId,c=e.logger;e=e.getSession,W(this,t);var u=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(u),"state",kb.INVITATION_RECEIVED),m(n(u),"remoteInvitationEnd$",Ca(gb(n(u),"RemoteInvitationCanceled"),gb(n(u),"RemoteInvitationRefused"),gb(n(u),"RemoteInvitationAccepted"),gb(n(u),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(u),"callerId",void 0),m(n(u),"callId",void 0),m(n(u),"_getSession",void 0),m(n(u),"logger",void 0),m(n(u),"_content",void 0),m(n(u),"_channelId",void 0),m(n(u),"_response",""),u._channelId=i,u._content=a,u.callId=o,u.callerId=s,u._getSession=e,u.logger=c,u.remoteInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&u.warn("Remote invitation expired"),Z(e)}))).subscribe({error:function(){u.state=kb.FAILURE,u.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),u}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(e){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb((function(){return ad(J(w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),wb((function(t){return e=t.hasPeerReceived})),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=kb.FAILURE,Sa(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),t}(tb()),nD=function(e){function t(e,i){W(this,t);var a=r.call(this,i,"InvitationManager");return m(n(a),"getSession",void 0),m(n(a),"invitationDispatcher",new ea.EventEmitter),m(n(a),"outgoingLocalInvitations",new Map),m(n(a),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(a),"logger",void 0),a.getSession=cn(e),a.logger=i,a.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,r=e.callerId;e=e.channelId,a.receivedRemoteInvitations.has(t)||((n=new mD({callerId:r,callId:t,getSession:a.getSession,logger:i,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){a.receivedRemoteInvitations.delete(t)})),a.receivedRemoteInvitations.set(t,n),a.emit("remoteInvitationInstance",n))})),a.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=a.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),a.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=a.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),a.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=a.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),a.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=a.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),a}la(t,e);var r=ma(t);return Ha(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,a=void 0===(t=t.channel)?"":t,o=e.type;switch(t=e.peerId,e=e.serverReceivedTs,o){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:a});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(a,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Im("invitationType",o)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new lD(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(tb()),oD=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return lb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),qC(e,t,{leading:r,maxWait:t,trailing:i})},ub,cf;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function t(e,i,a,o){W(this,t);var s=r.call(this,o,"RtmChannel",!0);return m(n(s),"onMemberCountUpdated",oD((function(e){e!==s.memberCount&&(s.memberCount=e,s.emit("MemberCountUpdated",e))}),1e3)),m(n(s),"getSession",void 0),m(n(s),"memberCount",0),m(n(s),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(s),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(s),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(s),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(s),"channelId",void 0),m(n(s),"client",void 0),m(n(s),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=s.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(s.attributesSeqLru.set(e,r),t===s.channelId)){for(t={},r=0;r<n.length;r++){var a=n[r];e=a.key,i=a.ms;var o=a.value;if(a=a.origin,"string"!=typeof e||!U.isLong(i)||"string"!=typeof o||!za(a))break;t[e]={value:o,lastUpdateUserId:a,lastUpdateTs:i.toNumber()}}s.emit("AttributesUpdated",t)}})),m(n(s),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{text:n,messageType:S.MessageType.TEXT},t,r)})),m(n(s),"onChannelMediaMessage",(function(e){var t=e.memberId,n=e.properties,r=e.details,i=e.messageType;e.channelId===s.channelId&&("FILE"===i?s.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail])},t,n):"IMAGE"===i&&s.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(pa(r.media_height),10),width:parseInt(pa(r.media_width),10),thumbnailHeight:parseInt(pa(r.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(r.media_thumbnailwidth),10)},t,n))})),m(n(s),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:n,description:t},r,i)})),m(n(s),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===s.channelId){var i=e.instance.toString();e=e.seq.toString();var a={MemberLeft:s.memberLeftLru,MemberJoined:s.memberJoinedLru,MemberCountUpdated:void 0}[n];if(a){if(a.has(i+e))return void s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""));if(a.set(i+e,void 0),"string"!=typeof t)return;if(t!==s.getSession().context.uid){if((i=s.memberJoinStateLru.get(t))===cf.JOINED&&"MemberJoined"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""));if(i===cf.LEFT&&"MemberLeft"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""))}s.memberJoinStateLru.set(t,"MemberJoined"===n?cf.JOINED:cf.LEFT)}s.info("Channel %s - %s, memberId: %s",n,oa(s.channelId),"MemberCountUpdated"===n?"[unknown]":oa(t||"")),i=t===s.getSession().context.uid,"MemberLeft"===n&&za(t)||"MemberJoined"===n&&za(t)?(i||s.emit(n,t),s.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&s.onMemberCountUpdated(r)}})),s.getSession=cn(i),s.channelId=e,s.client=a,s.info("A channel created, id %s",oa(e)),s}la(t,e);var r=ma(t);return Ha(t,[{key:"join",value:function(){var e=J(w.mark((function e(){var t,n,r,i,a,o,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(this.channelId)){e.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:e.prev=2,t=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!t.joinedChannels.has(this)){e.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Uq,sid:Xa(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(e.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){e.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Wq,sid:Xa(t.instanceId)},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(20!==t.joinedChannels.size){e.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Tq,sid:Xa(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId)},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),e.next=23,t.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),this.info("The channel %s joined successfully",oa(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("channelMediaMessage",this.onChannelMediaMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),e.next=41;break;case 32:if(e.prev=32,e.t1=e.catch(12),this.logError(e.t1),!sa(e.t1)){e.next=37;break}throw e.t1;case 37:if(!Sa(e.t1)){e.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:Sq,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:e.t1});case 41:case"end":return e.stop()}}),e,this,[[2,6],[12,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=J(w.mark((function e(){var t,n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(n.joinedChannels.has(this)){e.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:e.prev=9,n.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,n.removeListener("channelTextMessage",this.onChannelTextMessage),n.removeListener("channelRawMessage",this.onChannelRawMessage),n.removeListener("channelMediaMessage",this.onChannelMediaMessage),n.removeListener("memberNotice",this.onMemberNotice),n.removeListener("channelAttributesUpdated",this.onAttributesUpdated),e.next=32;break;case 23:if(e.prev=23,e.t1=e.catch(9),this.logError(e.t1),!sa(e.t1)){e.next=30;break}throw void 0===e.t1.code&&(e.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Yq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Xq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new Wc("The channel leave failure",{code:Xq,originalError:e.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:0,sid:Xa(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 33:case"end":return e.stop()}}),e,this,[[0,4],[9,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o=this,s=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(1<s.length&&void 0!==s[1]?s[1]:{}).enableHistoricalMessaging,r=void 0!==n&&n,Tm(t,Hh),e.prev=2,i=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(i.joinedChannels.has(this)){e.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){e.next=16;break}return a=Date.now(),e.next=15,new Promise((function(e,n){var i=function(){var i=J(w.mark((function i(){var c;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return c=Date.now()-a,i.prev=1,i.next=4,Gg({message:t,peerId:o.channelId,toPeer:!1,session:o.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:c,logger:o.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 4:e(),i.next=12;break;case 7:i.prev=7,i.t0=i.catch(1),Sa(i.t0)&&n(new db(Yd(o.name,"sendMessageToPeer",1e4),Yk)),sa(i.t0)&&n(i.t0),n(new da("Channel message send failure",{code:hg,originalError:i.t0}));case 12:return i.prev=12,clearTimeout(s),i.finish(12);case 15:case"end":return i.stop()}}),i,null,[[1,7,12,15]])})));return function(){return i.apply(this,arguments)}}();o.client.internalEmitter.once("RECONNECTED",i);var s=setTimeout((function(){o.client.internalEmitter.off("RECONNECTED",i),n(new db(Yd(o.name,"sendMessageToPeer",1e4),Yk))}),9e3)}));case 15:return e.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){e.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return e.prev=18,e.next=21,Gg({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 21:e.next=31;break;case 23:if(e.prev=23,e.t1=e.catch(18),!Sa(e.t1)){e.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(e.t1)){e.next=30;break}throw this.logError(e.t1),e.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return e.stop()}}),e,this,[[2,6],[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.prev=1,t=this.getSession(),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(t.joinedChannels.has(this)){e.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return n=this.getSession().requestChannelMemberList(this.channelId),e.next=13,n.pipe(ba((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 13:return r=e.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),r.map(oa)),e.abrupt("return",r);case 18:if(e.prev=18,e.t1=e.catch(0),!sa(e.t1)){e.next=23;break}throw this.logError(e.t1),e.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return e.stop()}}),e,this,[[0,18],[1,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var e=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some((function(t){return t.channelId===e.channelId}))}}]),t}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function t(e,i,a,o){W(this,t);var s=r.call(this,i,"RtmClient",!0);return m(n(s),"connectionState",T.DISCONNECTED),m(n(s),"internalEmitter",new ea),m(n(s),"context",void 0),m(n(s),"attributes",{}),m(n(s),"loginPromise",void 0),m(n(s),"attributeDrafts",new Set),m(n(s),"session",void 0),m(n(s),"lastLoginTime",void 0),m(n(s),"reconnId",0),m(n(s),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(s),"invitationManager",void 0),m(n(s),"subscribedPeerStatusCache",{}),m(n(s),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(s),"peerUnreachableTimers",{}),m(n(s),"mediaTaskManager",void 0),m(n(s),"setParameters",void 0),m(n(s),"updateConfig",void 0),m(n(s),"userDropHandler",(function(e){if(s.connectionState!==T.ABORTED)switch(e){case 11:s.logError("Kicked off by remote session"),s.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:s.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),s.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:s.logError("User kicked off for unknown code: ".concat(e)),s.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}})),s.context=new ZC(e,a,i),s.mediaTaskManager=new fs(i),s.context.config=a,s.internalEmitter.setMaxListeners(512),s.setParameters=o.bind(n(s)),s.updateConfig=o.bind(n(s)),s.invitationManager=new nD((function(){return s.session}),i),s.invitationManager.on("remoteInvitationInstance",(function(e){s.emit("RemoteInvitationReceived",e)})),s}la(t,e);var r=ma(t);return Ha(t,[{key:"renewToken",value:function(){var e=J(w.mark((function e(t){var n,r,i,a=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){e.next=7;break}throw new K("The client is not logged in",uA);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd((function(){return Error("No available edge address to connect")})),oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(2500),Ka(4))})),Ka(1),hb(2e4),Ga((function(e){return Sa(e)&&a.warn("renewToken timed out"),Z(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==$q&&e.t0.code!==ar){e.next=23;break}throw new Ye("Invalid token",tA);case 23:if(e.t0.code!==Kh){e.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(e.t0)){e.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}));case 28:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",pA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!za(e)}))||256<t.length)){e.next=6;break}throw new I("invalid arguments",er);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=uc(Jk(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==S.PeerOnlineState.UNREACHABLE){var t=r[e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",m({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",aA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<t.length)){e.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(za(r=t[n])){e.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",r],Oq);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,a=i.groupInfos,o={},s=function(e){var t=(e=a[e]).group,n=e.memberCount;za(t)&&"number"==typeof n&&(u.session.joinedChannels.forEach((function(e){e.channelId===t&&e.onMemberCountUpdated(n)})),o[t]=n)},c=0;c<a.length;c++)s(c);return e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<s.length&&void 0!==s[2]?s[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return a=this.session.requestSetChannelAttributes(t,n,i).toPromise(),e.prev=7,e.next=10,a;case 10:o=uc(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,o),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ua(ua({},this.attributes),t),uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",er);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<u.length&&void 0!==u[2]?u[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,a=this.channelAttributesCacheLru.get(t,{}),o=uc(n,(function(e){return new Blob([e]).size})),s=ua(ua({},a),o),uf({attributes:n,attrSizeMap:s,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return c=this.session.requestAddOrUpdateChannelAttributes(t,n,i).toPromise(),e.prev=10,e.next=13,c;case 13:this.channelAttributesCacheLru.set(t,s),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t){var n,r,i,a;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:Gk(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)a=t[i],delete this.attributes[a];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<u.length&&void 0!==u[2]?u[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,Array.isArray(n)&&0!==n.length&&za(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a=this.session.requestDeleteChannelAttributesByKeys(t,n,i).toPromise(),e.prev=8,e.next=11,a;case 11:if(o=this.channelAttributesCacheLru.get(t))for(s=0;s<n.length;s++)c=n[s],delete o[c];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=J(w.mark((function e(){var t,n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!sa(e.t0)){e.next=17;break}throw e.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,a=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(1<a.length&&void 0!==a[1]?a[1]:{}).enableNotificationToChannelMembers,r=void 0!==n&&n,this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return i=this.session.requestClearChannelAttributes(t,r).toPromise(),e.prev=6,e.next=9,i;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return e.abrupt("return",Yp(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,a=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new I("arguments is not valid",Ja);case 22:o={},s=0;case 24:if(!(s<a.length)){e.next=32;break}if(c=a[s],u=c.key,l=c.ms,d=c.value,f=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&za(f)){e.next=28;break}return e.abrupt("break",32);case 28:o[u]={value:d,lastUpdateUserId:f,lastUpdateTs:l.toNumber()};case 29:s++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,uc(o,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",o);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,f;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:a={},o=this.channelAttributesCacheLru.get(t,{}),s=0;case 20:if(!(s<i.length)){e.next=29;break}if(c=i[s],u=c.key,l=c.ms,d=c.value,f=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&za(f)){e.next=24;break}return e.abrupt("break",29);case 24:o[u]=new Blob([d]).size,a[u]={value:d,lastUpdateUserId:f,lastUpdateTs:l.toNumber()};case 26:s++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,o),e.abrupt("return",a);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!sa(e.t0)){e.next=15;break}throw e.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return e.abrupt("return",Yp(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Uk=!0,n=Bg(),r=t.token,t.token===this.context.appId&&(r=void 0),setTimeout((function(){var e;eb("Session",{appId:o.context.appId,did:navigator.userAgent,elapse:fb(o.session&&o.session.startTime),index:{index1:t.uid,index2:o.context.appId,index3:"enableLogUpload=".concat(o.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(n),token:r||"",userId:t.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},null!==(e=o.context.config.enableCloudProxy)&&void 0!==e&&e)}),1e4),yd(t)&&za(t.uid)){e.next=7;break}throw new I("not a valid user id",Jh);case 7:if("string"!=typeof r||!r){e.next=11;break}this.context.token=r,e.next=13;break;case 11:if("string"==typeof r||null==r){e.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return i=Date.now(),this.context.sid=Xa(n),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:n}),this.info("RTM Client logging in as ".concat(oa(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(17),sa(e.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-i,sid:Xa(n),userId:t.uid},null!==(a=this.context.config.enableCloudProxy)&&void 0!==a&&a),this.context.token=void 0,e.t0;case 27:return e.prev=27,this.loginPromise=void 0,e.finish(27);case 30:Uk=!1;case 31:case"end":return e.stop()}}),e,this,[[17,22,27,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=J(w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){e.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 10:if(void 0!==this.session){e.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=J(w.mark((function e(t,n){var r,i,a,o,s,c,u=this,l=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=2<l.length&&void 0!==l[2]?l[2]:{}).enableOfflineMessaging,a=void 0!==i&&i,o=r.enableHistoricalMessaging,s=void 0!==o&&o,Tm(t,ve),this.connectionState!==T.RECONNECTING){e.next=5;break}return c=Date.now(),e.abrupt("return",new Promise((function(e,r){var i=function(){var i=J(w.mark((function i(){var l;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==u.session){i.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return l=Date.now()-c,i.prev=3,i.t0=e,i.next=7,Gg({message:t,peerId:n,toPeer:!0,session:u.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:l,logger:u.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:a}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Sa(i.t2)&&r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk)),sa(i.t2)&&r(i.t2),r(new da("Peer-to-peer message send failure",{code:cr,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(o),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[3,11,16,19]])})));return function(){return i.apply(this,arguments)}}();u.internalEmitter.once("RECONNECTED",i);var o=setTimeout((function(){u.internalEmitter.off("RECONNECTED",i),r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk))}),9e3)})));case 5:if(this.connectionState===T.CONNECTED){e.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,Gg({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:a}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Sa(e.t0)){e.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:e.t0});case 22:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],Zz);return new pD(e,(function(){return t.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],xc);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?vk(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){e.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return e.next=19,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 19:a=e.sent,o=a.errors,s=[],c=[],u=0;case 24:if(!(u<o.length)){e.next=32;break}if(l=o[u],d=l.code,"string"==typeof(f=l.account)){e.next=28;break}throw new da("Returned account is invalid",fr);case 28:0!==d&&s.push(f);case 29:u++,e.next=24;break;case 32:for(p=0;p<i.length;p++)h=i[p],s.includes(h)||(c.push(h),this.subscribedPeerStatusCache[h]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,v.subscribedPeerStatusCache[t]=e})),v.emit("PeersOnlineStatusChanged",e)})),0===s.length){e.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(i=t&&t.length?vk(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),a=0;a<i.length;a++)o=i[a],delete this.subscribedPeerStatusCache[o];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(t!==S.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return"IMAGE"===e.messageType?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},e):"FILE"===e.messageType?ua({fileName:"",description:"",thumbnail:new Blob,size:0},e):e}},{key:"downloadMedia",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v,m=this,g=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<g.length&&void 0!==g[1]?g[1]:{},"string"==typeof t){e.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(e.prev=3,r=t.split("z"),i=ra(r,3),a=i[0],o=i[1],s=i[2],c=a.slice(1,65),u=bD(c),l=parseInt(a.slice(65),10),d=parseInt(o,10),f=parseInt(s,10),!(Number.isNaN(l)||Number.isNaN(d)||Number.isNaN(f))){e.next=12;break}throw new I("Invalid mediaId content",cl);case 12:e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(3),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:e.t0});case 19:if(this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(void 0!==this.session){e.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return p=this.mediaTaskManager.addDownloadTask({unit:d,zone:l,hashHexStr:c,size:f},(function(){if(void 0===m.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return m.session.requestFileDownloadIndexGet({hash:u,zone:l,unit:d,size:f}).toPromise()}),n),e.next=26,this.mediaTaskManager.waitMediaTask(p);case 26:return h=e.sent,v=h.payload,e.abrupt("return",v);case 29:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,f,p,h,v,m,g,y,_,E,b,S,k,C,R,A=this,O=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<O.length&&void 0!==O[2]?O[2]:{},yd(n=1<O.length&&void 0!==O[1]?O[1]:{})){e.next=4;break}throw new I("Invalid params",wf);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,a=n.messageType,o=void 0===a?i?"IMAGE":"FILE":a,s=n.description,c=void 0===s?"":s,u=n.fileName,l=void 0===u?"":u,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof l&&(Pm(d)||void 0===d)&&Pm(t)){e.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!i||"FILE"!==o){e.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(f=t.size))){e.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return e.next=15,Ji(t);case 15:return p=e.sent,e.next=18,aD(p);case 18:if(h=e.sent,this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in",yA);case 21:if("IMAGE"!==o){e.next=29;break}return e.next=24,Xt(n,p);case 24:v=e.sent,m=v.height,g=v.width,y=v.thumbnailWidth,_=v.thumbnailHeight;case 29:return E=this.mediaTaskManager.addUploadTask({file:new Uint8Array(p),hash:h},(function(){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.fetchFileUploadIndexGet({hash:h,size:f})}),(function(e,t){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.requestFileUploadIndexSet({hash:h,unit:e,servers:t}).toPromise()}),r),e.next=32,this.mediaTaskManager.waitMediaTask(E);case 32:if(b=e.sent,S=b.zone,k=b.retUnit,"IMAGE"!==o){e.next=38;break}return C={height:m,width:g,fileName:l,size:f,description:c,thumbnail:d,messageType:o,thumbnailWidth:y,thumbnailHeight:_,mediaId:"0".concat($r(h)).concat(S,"z").concat(k,"z").concat(f,"z").concat(m,"z").concat(g)},e.abrupt("return",C);case 38:return R={fileName:l,size:f,description:c,mediaId:"0".concat($r(h)).concat(S,"z").concat(k,"z").concat(f),thumbnail:d,messageType:o},e.abrupt("return",R);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var e=J(w.mark((function e(t){var n,r,i,a,o=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){e.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=i=new ls(this.context,new Yr(this.context,this.logger,!1),r,this.logger),a=function(){o.connectionState===T.CONNECTED&&(o.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),o.session)&&o.session.once("userJoined",(function(){o.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)}))},i.on("connectionLost",a),i.on("tokenExpired",(function(){o.emit("TokenExpired")})),i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){o.emit("MessageFromPeer",{text:e.text,messageType:S.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerMediaMessage",(function(e){var t=e.peerId,n=e.properties,r=e.messageType;e=e.details,"FILE"===r?o.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail])},t,n):"IMAGE"===r&&o.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail]),height:parseInt(pa(e.media_height),10),width:parseInt(pa(e.media_width),10),thumbnailHeight:parseInt(pa(e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(e.media_thumbnailwidth),10)},t,n)})),this.session.on("peerRawMessage",(function(e){o.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:S.MessageType.RAW},e.peerId,e.properties)})),i.on("instanceChanged",(function(e){return r=e})),i.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=o.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(o.peerStatusSeqLru.set(t,e.seq),e.state!==o.subscribedPeerStatusCache[e.peerId]&&o.emit("PeersOnlineStatusChanged",m({},e.peerId,e.state)),o.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(o.peerUnreachableTimers[t]),e.state===S.PeerOnlineState.UNREACHABLE&&(o.peerUnreachableTimers[t]=setTimeout((function(){o.subscribedPeerStatusCache[e.peerId]===S.PeerOnlineState.UNREACHABLE&&(o.subscribedPeerStatusCache[e.peerId]=S.PeerOnlineState.ONLINE,o.emit("PeersOnlineStatusChanged",m({},e.peerId,S.PeerOnlineState.ONLINE)))}),3e4))):o.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),i.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],a=i.key,s=i.ms,c=i.value;if(i=i.origin,"string"!=typeof a||!U.isLong(s)||"string"!=typeof c||!za(i))break;n[a]=new Blob([c]).size}o.channelAttributesCacheLru.set(t,n)})),i.on("userJoined",(function(e){if(0!==Object.keys(o.attributes).length){if(void 0===o.session)return;o.session.requestSetLocalUserAttributes(o.attributes,e).toPromise()}if(0!==o.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==o.session&&o.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(o.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(o.subscribedPeerStatusCache).length&&i.requestSubscribePeersOnlineStatus(Object.keys(o.subscribedPeerStatusCache))})),this.lastLoginTime=Date.now(),e.prev=29,e.next=32,i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:i.connection.curOpenSockets.filter((function(e){return void 0!==e}))[0].ticket,instance:i.instanceId,useNewDomain:.5<=Math.random(),loginOpt:i.userJoinOptions.toLong()}),e.next=44;break;case 35:if(e.prev=35,e.t1=e.catch(29),!Sa(e.t1)){e.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(e.t1)){e.next=43;break}throw e.t1;case 43:throw new da("Login failure",{code:Zq,originalError:e.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return e.stop()}}),e,this,[[6,10],[29,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[e],oldState:os[this.connectionState],reason:qD[t],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===T.RECONNECTING&&e===T.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,r.subscribedPeerStatusCache[t]=e})),r.emit("PeersOnlineStatusChanged",e)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==T.ABORTED&&e!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",e),this.emit("ConnectionStateChanged",e,t)}}]),t}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var r=Object.keys(t).filter((function(e){return!(e in qs)}));if(0!==r.length)throw new I("Invalid RTM config: ".concat(r.join(", ")),Nq);var i=ua(ua({},qs),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new I("Invalid area config");if(null!=n){if(!n.every((function(e){return e in S.LegacyAreaCode})))throw new I("Invalid area codes: ".concat(n.filter((function(e){return!(e in S)})).join(", ")));M=xe(n.map((function(e){return zC[e]})))}n=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var a=DC(i);r=EC(i);var o=FC(i),s=GC(n,i),c=Tr(n,i),u=c("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i,a("The Agora RTM Web SDK version is %s","1.4.3-203"),t.enableCloudProxy&&a("RTM cloud proxy enabled"),t.enableLogUpload&&a("Log upload enabled"),M&&u("Area is set to %s",Array.from(M.CODES).map((function(e){return xf(F).find((function(t){return F[t]===e}))})).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),u("The App ID is %s",Um(e,4,10,"*".repeat(6))),a("The process ID is %s",gg),u("The build is %s","v1.4.3-17-g1e27aa38"),u("NODE_ENV is %s","production"),new rD(e,{genLogger:c,genTracker:s,info:a,warn:r,logError:o,loggerId:n},i,(function(e){for(var t=0,n=xf(e);t<n.length;t++){var r=n[t];try{var o=e[r];null!=o&&(e.enableCloudProxy&&a("RTM cloud proxy enabled"),e.enableLogUpload&&a("Log upload enabled"),i[r]=o)}catch(e){throw new I(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,t){Object.keys(Nc).includes(e)&&(Nc[e]=t)},getParameter:function(e){return Nc[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in S.AreaCode})))throw new I("Invalid area config");if(void 0!==e&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(void 0===e)M=xe(t.map((function(e){return F[e]})));else{if(t.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:t.map((function(e){return F[e]})),excludedArea:F[e]})}}});return Zd},module.exports=t()},2618:function(e,t,n){var r;!function(){"use strict";var i=!("undefined"===typeof window||!window.document||!window.document.createElement),a={canUseDOM:i,canUseWorkers:"undefined"!==typeof Worker,canUseEventListeners:i&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:i&&!!window.screen};void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()},888:function(e,t,n){"use strict";var r=n(9047);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},2007:function(e,t,n){e.exports=n(888)()},9047:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4463:function(e,t,n){"use strict";var r=n(2791),i=n(5296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},h={};function v(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(h,e)||!d.call(p,e)&&(f.test(e)?h[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),C=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),x=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var M,U=Object.assign;function j(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var F=!1;function V(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var c="\n"+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function B(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case k:return"StrictMode";case A:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case x:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function Z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Q(e,t){X(e,t);var n=q(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function ae(e,t){var n=q(t.value),r=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){he.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ge=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,ke=null;function Te(e){if(e=_i(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=bi(t),we(e.stateNode,e.type,t))}}function Ie(e){Se?ke?ke.push(e):ke=[e]:Se=e}function Ce(){if(Se){var e=Se,t=ke;if(ke=Se=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Re(e,t){return e(t)}function Ae(){}var Oe=!1;function Ne(e,t,n){if(Oe)return e(t,n);Oe=!0;try{return Re(e,t,n)}finally{Oe=!1,(null!==Se||null!==ke)&&(Ae(),Ce())}}function xe(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var De=!1;if(l)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(le){De=!1}function Le(e,t,n,r,i,a,o,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(l){this.onError(l)}}var Me=!1,Ue=null,je=!1,Fe=null,Ve={onError:function(e){Me=!0,Ue=e}};function Be(e,t,n,r,i,a,o,s,c){Me=!1,Ue=null,Le.apply(Ve,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ge(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return qe(i),e;if(o===r)return qe(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,ze=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Je=i.unstable_requestPaint,Xe=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var ut=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=dt(s):0!==(a&=o)&&(r=dt(a))}else 0!==(o=n&~i)?r=dt(o):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ht(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,St,kt,Tt,It=!1,Ct=[],Rt=null,At=null,Ot=null,Nt=new Map,xt=new Map,Dt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Ot=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xt.delete(t.pointerId)}}function Mt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ut(e){var t=yi(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ze(n)))return e.blockedOn=t,void Tt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ee=r,n.target.dispatchEvent(r),Ee=null,t.shift()}return!0}function Ft(e,t,n){jt(e)&&n.delete(t)}function Vt(){It=!1,null!==Rt&&jt(Rt)&&(Rt=null),null!==At&&jt(At)&&(At=null),null!==Ot&&jt(Ot)&&(Ot=null),Nt.forEach(Ft),xt.forEach(Ft)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Rt&&Bt(Rt,e),null!==At&&Bt(At,e),null!==Ot&&Bt(Ot,e),Nt.forEach(t),xt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Dt.shift()}var Zt=E.ReactCurrentBatchConfig,qt=!0;function Wt(e,t,n,r){var i=_t,a=Zt.transition;Zt.transition=null;try{_t=1,Kt(e,t,n,r)}finally{_t=i,Zt.transition=a}}function Ht(e,t,n,r){var i=_t,a=Zt.transition;Zt.transition=null;try{_t=4,Kt(e,t,n,r)}finally{_t=i,Zt.transition=a}}function Kt(e,t,n,r){if(qt){var i=Yt(e,t,n,r);if(null===i)qr(e,t,r,zt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Rt=Mt(Rt,e,t,n,r,i),!0;case"dragenter":return At=Mt(At,e,t,n,r,i),!0;case"mouseover":return Ot=Mt(Ot,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Nt.set(a,Mt(Nt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,xt.set(a,Mt(xt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==i;){var a=_i(i);if(null!==a&&bt(a),null===(a=Yt(e,t,n,r))&&qr(e,t,r,zt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else qr(e,t,r,null,n)}}var zt=null;function Yt(e,t,n,r){if(zt=null,null!==(e=yi(e=be(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return zt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Xt=null,Qt=null,$t=null;function en(){if($t)return $t;var e,t,n=Qt,r=n.length,i="value"in Xt?Xt.value:Xt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(un),dn=U({},un,{view:0,detail:0}),fn=an(dn),pn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),hn=an(pn),vn=an(U({},pn,{dataTransfer:0})),mn=an(U({},dn,{relatedTarget:0})),gn=an(U({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=U({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=an(yn),En=an(U({},un,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Tn(){return kn}var In=U({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(In),Rn=an(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=an(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),On=an(U({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),xn=an(Nn),Dn=[9,13,27,32],Pn=l&&"CompositionEvent"in window,Ln=null;l&&"documentMode"in document&&(Ln=document.documentMode);var Mn=l&&"TextEvent"in window&&!Ln,Un=l&&(!Pn||Ln&&8<Ln&&11>=Ln),jn=String.fromCharCode(32),Fn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Zn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ie(r),0<(t=Hr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Kn=null;function zn(e){jr(e,0)}function Yn(e){if(K(Ei(e)))return e}function Jn(e,t){if("change"===e)return t}var Xn=!1;if(l){var Qn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Qn=$n}else Qn=!1;Xn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),Kn=Hn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];Wn(t,Kn,e,be(e)),Ne(zn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ar(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=z((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function hr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=lr(n,a);var o=lr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,_r=!1;function Er(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==mr||mr!==z(r)||("selectionStart"in(r=mr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&cr(yr,r)||(yr=r,0<(r=Hr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},Sr={},kr={};function Tr(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in kr)return Sr[e]=n[t];return e}l&&(kr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Ir=Tr("animationend"),Cr=Tr("animationiteration"),Rr=Tr("animationstart"),Ar=Tr("transitionend"),Or=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xr(e,t){Or.set(e,t),c(t,[e])}for(var Dr=0;Dr<Nr.length;Dr++){var Pr=Nr[Dr];xr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}xr(Ir,"onAnimationEnd"),xr(Cr,"onAnimationIteration"),xr(Rr,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(Ar,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,c,u){if(Be.apply(this,arguments),Me){if(!Me)throw Error(a(198));var l=Ue;Me=!1,Ue=null,je||(je=!0,Fe=l)}}(r,t,void 0,e),e.currentTarget=null}function jr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;Ur(i,s,u),a=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,u=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;Ur(i,s,u),a=c}}}if(je)throw e=Fe,je=!1,Fe=null,e}function Fr(e,t){var n=t[vi];void 0===n&&(n=t[vi]=new Set);var r=e+"__bubble";n.has(r)||(Zr(t,e,2,!1),n.add(r))}function Vr(e,t,n){var r=0;t&&(r|=4),Zr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Br]){e[Br]=!0,o.forEach((function(t){"selectionchange"!==t&&(Mr.has(t)||Vr(t,!1,e),Vr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Vr("selectionchange",!1,t))}}function Zr(e,t,n,r){switch(Jt(t)){case 1:var i=Wt;break;case 4:i=Ht;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function qr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=yi(s)))return;if(5===(c=o.tag)||6===c){r=a=o;continue e}s=s.parentNode}}r=r.return}Ne((function(){var r=a,i=be(n),o=[];e:{var s=Or.get(e);if(void 0!==s){var c=ln,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":u="focus",c=mn;break;case"focusout":u="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=An;break;case Ir:case Cr:case Rr:c=gn;break;case Ar:c=On;break;case"scroll":c=fn;break;case"wheel":c=xn;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Rn}var l=0!==(4&t),d=!l&&"scroll"===e,f=l?null!==s?s+"Capture":null:s;l=[];for(var p,h=r;null!==h;){var v=(p=h).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==f&&(null!=(v=xe(h,f))&&l.push(Wr(h,v,p)))),d)break;h=h.return}0<l.length&&(s=new c(s,u,null,n,i),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Ee||!(u=n.relatedTarget||n.fromElement)||!yi(u)&&!u[hi])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?yi(u):null)&&(u!==(d=Ge(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=hn,v="onMouseLeave",f="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(l=Rn,v="onPointerLeave",f="onPointerEnter",h="pointer"),d=null==c?s:Ei(c),p=null==u?s:Ei(u),(s=new l(v,h+"leave",c,n,i)).target=d,s.relatedTarget=p,v=null,yi(i)===r&&((l=new l(f,h+"enter",u,n,i)).target=p,l.relatedTarget=d,v=l),d=v,c&&u)e:{for(f=u,h=0,p=l=c;p;p=Kr(p))h++;for(p=0,v=f;v;v=Kr(v))p++;for(;0<h-p;)l=Kr(l),h--;for(;0<p-h;)f=Kr(f),p--;for(;h--;){if(l===f||null!==f&&l===f.alternate)break e;l=Kr(l),f=Kr(f)}l=null}else l=null;null!==c&&zr(o,s,c,l,!1),null!==u&&null!==d&&zr(o,d,u,l,!0)}if("select"===(c=(s=r?Ei(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var m=Jn;else if(qn(s))if(Xn)m=or;else{m=ir;var g=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?Wn(o,m,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?Ei(r):window,e){case"focusin":(qn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,Er(o,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":Er(o,n,i)}var y;if(Pn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Gn?Vn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Un&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Gn&&(y=en()):(Qt="value"in(Xt=i)?Xt.value:Xt.textContent,Gn=!0)),0<(g=Hr(r,_)).length&&(_=new En(_,e,null,n,i),o.push({event:_,listeners:g}),y?_.data=y:null!==(y=Bn(n))&&(_.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Fn=!0,jn);case"textInput":return(e=t.data)===jn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Pn&&Vn(e,t)?(e=en(),$t=Qt=Xt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(i=new En("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}jr(o,t)}))}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=xe(e,n))&&r.unshift(Wr(e,a,i)),null!=(a=xe(e,t))&&r.push(Wr(e,a,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function zr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,u=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(c=xe(n,a))&&o.unshift(Wr(n,c,s)):i||null!=(c=xe(n,a))&&o.push(Wr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Xr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Jr,"")}function Qr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(a(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function ui(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),fi="__reactFiber$"+di,pi="__reactProps$"+di,hi="__reactContainer$"+di,vi="__reactEvents$"+di,mi="__reactListeners$"+di,gi="__reactHandles$"+di;function yi(e){var t=e[fi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[hi]||n[fi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[fi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[fi]||e[hi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ei(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function bi(e){return e[pi]||null}var wi=[],Si=-1;function ki(e){return{current:e}}function Ti(e){0>Si||(e.current=wi[Si],wi[Si]=null,Si--)}function Ii(e,t){Si++,wi[Si]=e.current,e.current=t}var Ci={},Ri=ki(Ci),Ai=ki(!1),Oi=Ci;function Ni(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function xi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Di(){Ti(Ai),Ti(Ri)}function Pi(e,t,n){if(Ri.current!==Ci)throw Error(a(168));Ii(Ri,t),Ii(Ai,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,Z(e)||"Unknown",i));return U({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Oi=Ri.current,Ii(Ri,e),Ii(Ai,Ai.current),!0}function Ui(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Li(e,t,Oi),r.__reactInternalMemoizedMergedChildContext=e,Ti(Ai),Ti(Ri),Ii(Ri,e)):Ti(Ai),Ii(Ai,n)}var ji=null,Fi=!1,Vi=!1;function Bi(e){null===ji?ji=[e]:ji.push(e)}function Gi(){if(!Vi&&null!==ji){Vi=!0;var e=0,t=_t;try{var n=ji;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}ji=null,Fi=!1}catch(i){throw null!==ji&&(ji=ji.slice(e+1)),Ke($e,Gi),i}finally{_t=t,Vi=!1}}return null}var Zi=[],qi=0,Wi=null,Hi=0,Ki=[],zi=0,Yi=null,Ji=1,Xi="";function Qi(e,t){Zi[qi++]=Hi,Zi[qi++]=Wi,Wi=e,Hi=t}function $i(e,t,n){Ki[zi++]=Ji,Ki[zi++]=Xi,Ki[zi++]=Yi,Yi=e;var r=Ji;e=Xi;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ji=1<<32-ot(t)+i|n<<i|r,Xi=a+e}else Ji=1<<a|n<<i|r,Xi=e}function ea(e){null!==e.return&&(Qi(e,1),$i(e,1,0))}function ta(e){for(;e===Wi;)Wi=Zi[--qi],Zi[qi]=null,Hi=Zi[--qi],Zi[qi]=null;for(;e===Yi;)Yi=Ki[--zi],Ki[zi]=null,Xi=Ki[--zi],Ki[zi]=null,Ji=Ki[--zi],Ki[zi]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=xu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=ui(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yi?{id:Ji,overflow:Xi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=xu(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ca(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ua(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(ca(e))throw Error(a(418));t=ui(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function la(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ia)return la(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ca(e))throw fa(),Error(a(418));for(;t;)oa(e,t),t=ui(t.nextSibling)}if(la(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=ui(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?ui(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=ra;e;)e=ui(e.nextSibling)}function pa(){ra=na=null,ia=!1}function ha(e){null===aa?aa=[e]:aa.push(e)}var va=E.ReactCurrentBatchConfig;function ma(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ga=ki(null),ya=null,_a=null,Ea=null;function ba(){Ea=_a=ya=null}function wa(e){var t=ga.current;Ti(ga),e._currentValue=t}function Sa(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ka(e,t){ya=e,Ea=_a=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Es=!0),e.firstContext=null)}function Ta(e){var t=e._currentValue;if(Ea!==e)if(e={context:e,memoizedValue:t,next:null},null===_a){if(null===ya)throw Error(a(308));_a=e,ya.dependencies={lanes:0,firstContext:e}}else _a=_a.next=e;return t}var Ia=null;function Ca(e){null===Ia?Ia=[e]:Ia.push(e)}function Ra(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ca(t)):(n.next=i.next,i.next=n),t.interleaved=n,Aa(e,r)}function Aa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oa=!1;function Na(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Da(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ac)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Aa(e,n)}return null===(i=r.interleaved)?(t.next=t,Ca(r)):(t.next=i.next,i.next=t),r.interleaved=t,Aa(e,n)}function La(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Ma(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ua(e,t,n,r){var i=e.updateQueue;Oa=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,u=c.next;c.next=null,null===o?a=u:o.next=u,o=c;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=u:s.next=u,l.lastBaseUpdate=c))}if(null!==a){var d=i.baseState;for(o=0,l=u=c=null,s=a;;){var f=s.lane,p=s.eventTime;if((r&f)===f){null!==l&&(l=l.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,v=s;switch(f=t,p=n,v.tag){case 1:if("function"===typeof(h=v.payload)){d=h.call(p,d,f);break e}d=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null===(f="function"===typeof(h=v.payload)?h.call(p,d,f):h)||void 0===f)break e;d=U({},d,f);break e;case 2:Oa=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=i.effects)?i.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(u=l=p,c=d):l=l.next=p,o|=f;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}if(null===l&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Uc|=o,e.lanes=o,e.memoizedState=d}}function ja(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Fa=(new r.Component).refs;function Va(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ba={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tu(),i=nu(e),a=Da(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Pa(e,a,i))&&(ru(t,e,i,r),La(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tu(),i=nu(e),a=Da(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Pa(e,a,i))&&(ru(t,e,i,r),La(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),r=nu(e),i=Da(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Pa(e,i,r))&&(ru(t,e,r,n),La(t,e,r))}};function Ga(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,a))}function Za(e,t,n){var r=!1,i=Ci,a=t.contextType;return"object"===typeof a&&null!==a?a=Ta(a):(i=xi(t)?Oi:Ri.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ni(e,i):Ci),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ba,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function qa(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ba.enqueueReplaceState(t,t.state,null)}function Wa(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Fa,Na(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Ta(a):(a=xi(t)?Oi:Ri.current,i.context=Ni(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Va(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ba.enqueueReplaceState(i,i.state,null),Ua(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Ha(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===Fa&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ka(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function za(e){return(0,e._init)(e._payload)}function Ya(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pu(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=ju(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){var a=n.type;return a===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===x&&za(a)===t.type)?((r=i(t,n.props)).ref=Ha(e,t,n),r.return=e,r):((r=Lu(n.type,n.key,n.props,null,e.mode,r)).ref=Ha(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Mu(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=ju(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Lu(t.type,t.key,t.props,null,e.mode,n)).ref=Ha(e,null,t),n.return=e,n;case w:return(t=Fu(t,e.mode,n)).return=e,t;case x:return f(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Mu(t,e.mode,n,null)).return=e,t;Ka(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?u(e,t,n,r):null;case w:return n.key===i?l(e,t,n,r):null;case x:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:d(e,t,n,r,null);Ka(e,n)}return null}function h(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return h(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return d(t,e=e.get(n)||null,r,i,null);Ka(t,r)}return null}function v(i,a,s,c){for(var u=null,l=null,d=a,v=a=0,m=null;null!==d&&v<s.length;v++){d.index>v?(m=d,d=null):m=d.sibling;var g=p(i,d,s[v],c);if(null===g){null===d&&(d=m);break}e&&d&&null===g.alternate&&t(i,d),a=o(g,a,v),null===l?u=g:l.sibling=g,l=g,d=m}if(v===s.length)return n(i,d),ia&&Qi(i,v),u;if(null===d){for(;v<s.length;v++)null!==(d=f(i,s[v],c))&&(a=o(d,a,v),null===l?u=d:l.sibling=d,l=d);return ia&&Qi(i,v),u}for(d=r(i,d);v<s.length;v++)null!==(m=h(d,i,v,s[v],c))&&(e&&null!==m.alternate&&d.delete(null===m.key?v:m.key),a=o(m,a,v),null===l?u=m:l.sibling=m,l=m);return e&&d.forEach((function(e){return t(i,e)})),ia&&Qi(i,v),u}function m(i,s,c,u){var l=L(c);if("function"!==typeof l)throw Error(a(150));if(null==(c=l.call(c)))throw Error(a(151));for(var d=l=null,v=s,m=s=0,g=null,y=c.next();null!==v&&!y.done;m++,y=c.next()){v.index>m?(g=v,v=null):g=v.sibling;var _=p(i,v,y.value,u);if(null===_){null===v&&(v=g);break}e&&v&&null===_.alternate&&t(i,v),s=o(_,s,m),null===d?l=_:d.sibling=_,d=_,v=g}if(y.done)return n(i,v),ia&&Qi(i,m),l;if(null===v){for(;!y.done;m++,y=c.next())null!==(y=f(i,y.value,u))&&(s=o(y,s,m),null===d?l=y:d.sibling=y,d=y);return ia&&Qi(i,m),l}for(v=r(i,v);!y.done;m++,y=c.next())null!==(y=h(v,i,m,y.value,u))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=o(y,s,m),null===d?l=y:d.sibling=y,d=y);return e&&v.forEach((function(e){return t(i,e)})),ia&&Qi(i,m),l}return function e(r,a,o,c){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var u=o.key,l=a;null!==l;){if(l.key===u){if((u=o.type)===S){if(7===l.tag){n(r,l.sibling),(a=i(l,o.props.children)).return=r,r=a;break e}}else if(l.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===x&&za(u)===l.type){n(r,l.sibling),(a=i(l,o.props)).ref=Ha(r,l,o),a.return=r,r=a;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===S?((a=Mu(o.props.children,r.mode,c,o.key)).return=r,r=a):((c=Lu(o.type,o.key,o.props,null,r.mode,c)).ref=Ha(r,a,o),c.return=r,r=c)}return s(r);case w:e:{for(l=o.key;null!==a;){if(a.key===l){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Fu(o,r.mode,c)).return=r,r=a}return s(r);case x:return e(r,a,(l=o._init)(o._payload),c)}if(te(o))return v(r,a,o,c);if(L(o))return m(r,a,o,c);Ka(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=ju(o,r.mode,c)).return=r,r=a),s(r)):n(r,a)}}var Ja=Ya(!0),Xa=Ya(!1),Qa={},$a=ki(Qa),eo=ki(Qa),to=ki(Qa);function no(e){if(e===Qa)throw Error(a(174));return e}function ro(e,t){switch(Ii(to,t),Ii(eo,e),Ii($a,Qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ti($a),Ii($a,t)}function io(){Ti($a),Ti(eo),Ti(to)}function ao(e){no(to.current);var t=no($a.current),n=ce(t,e.type);t!==n&&(Ii(eo,e),Ii($a,n))}function oo(e){eo.current===e&&(Ti($a),Ti(eo))}var so=ki(0);function co(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function lo(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var fo=E.ReactCurrentDispatcher,po=E.ReactCurrentBatchConfig,ho=0,vo=null,mo=null,go=null,yo=!1,_o=!1,Eo=0,bo=0;function wo(){throw Error(a(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function ko(e,t,n,r,i,o){if(ho=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,fo.current=null===e||null===e.memoizedState?ss:cs,e=n(r,i),_o){o=0;do{if(_o=!1,Eo=0,25<=o)throw Error(a(301));o+=1,go=mo=null,t.updateQueue=null,fo.current=us,e=n(r,i)}while(_o)}if(fo.current=os,t=null!==mo&&null!==mo.next,ho=0,go=mo=vo=null,yo=!1,t)throw Error(a(300));return e}function To(){var e=0!==Eo;return Eo=0,e}function Io(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function Ro(e,t){return"function"===typeof t?t(e):t}function Ao(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=mo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var c=s=null,u=null,l=o;do{var d=l.lane;if((ho&d)===d)null!==u&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===u?(c=u=f,s=r):u=u.next=f,vo.lanes|=d,Uc|=d}l=l.next}while(null!==l&&l!==o);null===u?s=r:u.next=c,sr(r,t.memoizedState)||(Es=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,vo.lanes|=o,Uc|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Oo(e){var t=Co(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(Es=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function No(){}function xo(e,t){var n=vo,r=Co(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,Es=!0),r=r.queue,qo(Lo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Fo(9,Po.bind(null,n,r,i,t),void 0,null),null===Oc)throw Error(a(349));0!==(30&ho)||Do(n,t,i)}return i}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Po(e,t,n,r){t.value=n,t.getSnapshot=r,Mo(t)&&Uo(e)}function Lo(e,t,n){return n((function(){Mo(t)&&Uo(e)}))}function Mo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Uo(e){var t=Aa(e,1);null!==t&&ru(t,e,1,-1)}function jo(e){var t=Io();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ro,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function Fo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Vo(){return Co().memoizedState}function Bo(e,t,n,r){var i=Io();vo.flags|=e,i.memoizedState=Fo(1|t,n,void 0,void 0===r?null:r)}function Go(e,t,n,r){var i=Co();r=void 0===r?null:r;var a=void 0;if(null!==mo){var o=mo.memoizedState;if(a=o.destroy,null!==r&&So(r,o.deps))return void(i.memoizedState=Fo(t,n,a,r))}vo.flags|=e,i.memoizedState=Fo(1|t,n,a,r)}function Zo(e,t){return Bo(8390656,8,e,t)}function qo(e,t){return Go(2048,8,e,t)}function Wo(e,t){return Go(4,2,e,t)}function Ho(e,t){return Go(4,4,e,t)}function Ko(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Go(4,4,Ko.bind(null,t,e),n)}function Yo(){}function Jo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Xo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qo(e,t,n){return 0===(21&ho)?(e.baseState&&(e.baseState=!1,Es=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),vo.lanes|=n,Uc|=n,e.baseState=!0),t)}function $o(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=po.transition;po.transition={};try{e(!1),t()}finally{_t=n,po.transition=r}}function es(){return Co().memoizedState}function ts(e,t,n){var r=nu(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))is(t,n);else if(null!==(n=Ra(e,t,n,r))){ru(n,e,r,tu()),as(n,t,r)}}function ns(e,t,n){var r=nu(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))is(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var c=t.interleaved;return null===c?(i.next=i,Ca(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(u){}null!==(n=Ra(e,t,i,r))&&(ru(n,e,r,i=tu()),as(n,t,r))}}function rs(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function is(e,t){_o=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ta,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ta,useCallback:function(e,t){return Io().memoizedState=[e,void 0===t?null:t],e},useContext:Ta,useEffect:Zo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Bo(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Bo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Bo(4,2,e,t)},useMemo:function(e,t){var n=Io();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Io();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Io().memoizedState=e},useState:jo,useDebugValue:Yo,useDeferredValue:function(e){return Io().memoizedState=e},useTransition:function(){var e=jo(!1),t=e[0];return e=$o.bind(null,e[1]),Io().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=vo,i=Io();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Oc)throw Error(a(349));0!==(30&ho)||Do(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Zo(Lo.bind(null,r,o,e),[e]),r.flags|=2048,Fo(9,Po.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Io(),t=Oc.identifierPrefix;if(ia){var n=Xi;t=":"+t+"R"+(n=(Ji&~(1<<32-ot(Ji)-1)).toString(32)+n),0<(n=Eo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cs={readContext:Ta,useCallback:Jo,useContext:Ta,useEffect:qo,useImperativeHandle:zo,useInsertionEffect:Wo,useLayoutEffect:Ho,useMemo:Xo,useReducer:Ao,useRef:Vo,useState:function(){return Ao(Ro)},useDebugValue:Yo,useDeferredValue:function(e){return Qo(Co(),mo.memoizedState,e)},useTransition:function(){return[Ao(Ro)[0],Co().memoizedState]},useMutableSource:No,useSyncExternalStore:xo,useId:es,unstable_isNewReconciler:!1},us={readContext:Ta,useCallback:Jo,useContext:Ta,useEffect:qo,useImperativeHandle:zo,useInsertionEffect:Wo,useLayoutEffect:Ho,useMemo:Xo,useReducer:Oo,useRef:Vo,useState:function(){return Oo(Ro)},useDebugValue:Yo,useDeferredValue:function(e){var t=Co();return null===mo?t.memoizedState=e:Qo(t,mo.memoizedState,e)},useTransition:function(){return[Oo(Ro)[0],Co().memoizedState]},useMutableSource:No,useSyncExternalStore:xo,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ps="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Da(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wc||(Wc=!0,Hc=r),fs(0,t)},n}function vs(e,t,n){(n=Da(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){fs(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof r&&(null===Kc?Kc=new Set([this]):Kc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ps;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Iu.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Da(-1,1)).tag=2,Pa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var _s=E.ReactCurrentOwner,Es=!1;function bs(e,t,n,r){t.child=null===e?Xa(t,null,n,r):Ja(t,e.child,n,r)}function ws(e,t,n,r,i){n=n.render;var a=t.ref;return ka(t,i),r=ko(e,t,n,r,a,i),n=To(),null===e||Es?(ia&&n&&ea(t),t.flags|=1,bs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ws(e,t,i))}function Ss(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Du(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lu(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ks(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Ws(e,t,i)}return t.flags|=1,(e=Pu(a,r)).ref=t.ref,e.return=t,t.child=e}function ks(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(cr(a,r)&&e.ref===t.ref){if(Es=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Ws(e,t,i);0!==(131072&e.flags)&&(Es=!0)}}return Cs(e,t,n,r,i)}function Ts(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(Pc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ii(Pc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ii(Pc,Dc),Dc|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ii(Pc,Dc),Dc|=r;return bs(e,t,i,n),t.child}function Is(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,r,i){var a=xi(n)?Oi:Ri.current;return a=Ni(t,a),ka(t,i),n=ko(e,t,n,r,a,i),r=To(),null===e||Es?(ia&&r&&ea(t),t.flags|=1,bs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ws(e,t,i))}function Rs(e,t,n,r,i){if(xi(n)){var a=!0;Mi(t)}else a=!1;if(ka(t,i),null===t.stateNode)qs(e,t),Za(t,n,r),Wa(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=Ta(u):u=Ni(t,u=xi(n)?Oi:Ri.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==u)&&qa(t,o,r,u),Oa=!1;var f=t.memoizedState;o.state=f,Ua(t,r,o,i),c=t.memoizedState,s!==r||f!==c||Ai.current||Oa?("function"===typeof l&&(Va(t,n,l,r),c=t.memoizedState),(s=Oa||Ga(t,n,s,r,f,c,u))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,xa(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:ma(t.type,s),o.props=u,d=t.pendingProps,f=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ta(c):c=Ni(t,c=xi(n)?Oi:Ri.current);var p=n.getDerivedStateFromProps;(l="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||f!==c)&&qa(t,o,r,c),Oa=!1,f=t.memoizedState,o.state=f,Ua(t,r,o,i);var h=t.memoizedState;s!==d||f!==h||Ai.current||Oa?("function"===typeof p&&(Va(t,n,p,r),h=t.memoizedState),(u=Oa||Ga(t,n,u,r,f,h,c)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,h,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,h,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=c,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return As(e,t,n,r,a,i)}function As(e,t,n,r,i,a){Is(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&Ui(t,n,!1),Ws(e,t,a);r=t.stateNode,_s.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ja(t,e.child,null,a),t.child=Ja(t,null,s,a)):bs(e,t,s,a),t.memoizedState=r.state,i&&Ui(t,n,!0),t.child}function Os(e){var t=e.stateNode;t.pendingContext?Pi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pi(0,t.context,!1),ro(e,t.containerInfo)}function Ns(e,t,n,r,i){return pa(),ha(i),t.flags|=256,bs(e,t,n,r),t.child}var xs,Ds,Ps,Ls,Ms={dehydrated:null,treeContext:null,retryLane:0};function Us(e){return{baseLanes:e,cachePool:null,transitions:null}}function js(e,t,n){var r,i=t.pendingProps,o=so.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ii(so,1&o),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,s?(i=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Uu(c,i,0,null),e=Mu(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Us(n),t.memoizedState=Ms,e):Fs(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Vs(e,t,s,r=ds(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Uu({mode:"visible",children:r.children},i,0,null),(o=Mu(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Ja(t,e.child,null,s),t.child.memoizedState=Us(s),t.memoizedState=Ms,o);if(0===(1&t.mode))return Vs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Vs(e,t,s,r=ds(o=Error(a(419)),r,void 0))}if(c=0!==(s&e.childLanes),Es||c){if(null!==(r=Oc)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Aa(e,i),ru(r,e,i,-1))}return mu(),Vs(e,t,s,r=ds(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ru.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=ui(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(Ki[zi++]=Ji,Ki[zi++]=Xi,Ki[zi++]=Yi,Ji=e.id,Xi=e.overflow,Yi=t),t=Fs(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,o,n);if(s){s=i.fallback,c=t.mode,r=(o=e.child).sibling;var u={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=u,t.deletions=null):(i=Pu(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Pu(r,s):(s=Mu(s,c,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,c=null===(c=e.child.memoizedState)?Us(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=Ms,i}return e=(s=e.child).sibling,i=Pu(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fs(e,t){return(t=Uu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Vs(e,t,n,r){return null!==r&&ha(r),Ja(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Sa(e.return,t,n)}function Gs(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Zs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(bs(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ii(so,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===co(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Gs(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===co(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Gs(t,!0,n,null,a);break;case"together":Gs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ws(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Uc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Pu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function zs(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return xi(t.type)&&Di(),Ks(t),null;case 3:return r=t.stateNode,io(),Ti(Ai),Ti(Ri),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(su(aa),aa=null))),Ds(e,t),Ks(t),null;case 5:oo(t);var i=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ks(t),null}if(e=no($a.current),da(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[fi]=t,r[pi]=o,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":J(r,o),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Fr("invalid",r);break;case"textarea":ie(r,o),Fr("invalid",r)}for(var c in ye(n,o),i=null,o)if(o.hasOwnProperty(c)){var u=o[c];"children"===c?"string"===typeof u?r.textContent!==u&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,u,e),i=["children",u]):"number"===typeof u&&r.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,u,e),i=["children",""+u]):s.hasOwnProperty(c)&&null!=u&&"onScroll"===c&&Fr("scroll",r)}switch(n){case"input":H(r),$(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[fi]=t,e[pi]=r,xs(e,t,!1,!1),t.stateNode=e;e:{switch(c=_e(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":J(e,r),i=Y(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(o in ye(n,i),u=i)if(u.hasOwnProperty(o)){var l=u[o];"style"===o?me(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&fe(e,l):"number"===typeof l&&fe(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Fr("scroll",e):null!=l&&_(e,o,l,c))}switch(n){case"input":H(e),$(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no($a.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[fi]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fi]=t,t.stateNode=r}return Ks(t),null;case 13:if(Ti(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))fa(),pa(),t.flags|=98560,o=!1;else if(o=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[fi]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),o=!1}else null!==aa&&(su(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Lc&&(Lc=3):mu())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return io(),Ds(e,t),null===e&&Gr(t.stateNode.containerInfo),Ks(t),null;case 10:return wa(t.type._context),Ks(t),null;case 19:if(Ti(so),null===(o=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)Hs(o,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=co(e))){for(t.flags|=128,Hs(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ii(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Xe()>Zc&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=co(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ia)return Ks(t),null}else 2*Xe()-o.renderingStartTime>Zc&&1073741824!==n&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xe(),t.sibling=null,n=so.current,Ii(so,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return fu(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ys(e,t){switch(ta(t),t.tag){case 1:return xi(t.type)&&Di(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return io(),Ti(Ai),Ti(Ri),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Ti(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ti(so),null;case 4:return io(),null;case 10:return wa(t.type._context),null;case 22:case 23:return fu(),null;default:return null}}xs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ps=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,no($a.current);var a,o=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),o=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var c=i[l];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(c=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&u!==c&&(null!=u||null!=c))if("style"===l)if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(l,n)),n=u;else"dangerouslySetInnerHTML"===l?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(o=o||[]).push(l,u)):"children"===l?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(l,""+u):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=u&&"onScroll"===l&&Fr("scroll",e),o||c===u||(o=[])):(o=o||[]).push(l,u))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Ls=function(e,t,n,r){n!==r&&(t.flags|=4)};var Js=!1,Xs=!1,Qs="function"===typeof WeakSet?WeakSet:Set,$s=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Tu(e,t,r)}else n.current=null}function tc(e,t,n){try{n()}catch(r){Tu(e,t,r)}}var nc=!1;function rc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&tc(t,n,a)}i=i.next}while(i!==r)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ac(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fi],delete t[pi],delete t[vi],delete t[mi],delete t[gi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var dc=null,fc=!1;function pc(e,t,n){for(n=n.child;null!==n;)hc(e,t,n),n=n.sibling}function hc(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Xs||ec(n,t);case 6:var r=dc,i=fc;dc=null,pc(e,t,n),fc=i,null!==(dc=r)&&(fc?(e=dc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dc.removeChild(n.stateNode));break;case 18:null!==dc&&(fc?(e=dc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Gt(e)):ci(dc,n.stateNode));break;case 4:r=dc,i=fc,dc=n.stateNode.containerInfo,fc=!0,pc(e,t,n),dc=r,fc=i;break;case 0:case 11:case 14:case 15:if(!Xs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&tc(n,t,o),i=i.next}while(i!==r)}pc(e,t,n);break;case 1:if(!Xs&&(ec(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Tu(n,t,s)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Xs=(r=Xs)||null!==n.memoizedState,pc(e,t,n),Xs=r):pc(e,t,n);break;default:pc(e,t,n)}}function vc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach((function(t){var r=Au.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:dc=c.stateNode,fc=!1;break e;case 3:case 4:dc=c.stateNode.containerInfo,fc=!0;break e}c=c.return}if(null===dc)throw Error(a(160));hc(o,s,i),dc=null,fc=!1;var u=i.alternate;null!==u&&(u.return=null),i.return=null}catch(l){Tu(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),yc(e),4&r){try{rc(3,e,e.return),ic(3,e)}catch(m){Tu(e,e.return,m)}try{rc(5,e,e.return)}catch(m){Tu(e,e.return,m)}}break;case 1:mc(t,e),yc(e),512&r&&null!==n&&ec(n,n.return);break;case 5:if(mc(t,e),yc(e),512&r&&null!==n&&ec(n,n.return),32&e.flags){var i=e.stateNode;try{fe(i,"")}catch(m){Tu(e,e.return,m)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===o.type&&null!=o.name&&X(i,o),_e(c,s);var l=_e(c,o);for(s=0;s<u.length;s+=2){var d=u[s],f=u[s+1];"style"===d?me(i,f):"dangerouslySetInnerHTML"===d?de(i,f):"children"===d?fe(i,f):_(i,d,f,l)}switch(c){case"input":Q(i,o);break;case"textarea":ae(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var h=o.value;null!=h?ne(i,!!o.multiple,h,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[pi]=o}catch(m){Tu(e,e.return,m)}}break;case 6:if(mc(t,e),yc(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(m){Tu(e,e.return,m)}}break;case 3:if(mc(t,e),yc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(m){Tu(e,e.return,m)}break;case 4:default:mc(t,e),yc(e);break;case 13:mc(t,e),yc(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Gc=Xe())),4&r&&vc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xs=(l=Xs)||d,mc(t,e),Xs=l):mc(t,e),yc(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for($s=e,d=e.child;null!==d;){for(f=$s=d;null!==$s;){switch(h=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:rc(4,p,p.return);break;case 1:ec(p,p.return);var v=p.stateNode;if("function"===typeof v.componentWillUnmount){r=p,n=p.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){Tu(r,n,m)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){wc(f);continue}}null!==h?(h.return=p,$s=h):wc(f)}d=d.sibling}e:for(d=null,f=e;;){if(5===f.tag){if(null===d){d=f;try{i=f.stateNode,l?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=f.stateNode,s=void 0!==(u=f.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=ve("display",s))}catch(m){Tu(e,e.return,m)}}}else if(6===f.tag){if(null===d)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(m){Tu(e,e.return,m)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:mc(t,e),yc(e),4&r&&vc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sc(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(fe(i,""),r.flags&=-33),lc(e,cc(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;uc(e,cc(e),o);break;default:throw Error(a(161))}}catch(s){Tu(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _c(e,t,n){$s=e,Ec(e,t,n)}function Ec(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var i=$s,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Js;if(!o){var s=i.alternate,c=null!==s&&null!==s.memoizedState||Xs;s=Js;var u=Xs;if(Js=o,(Xs=c)&&!u)for($s=i;null!==$s;)c=(o=$s).child,22===o.tag&&null!==o.memoizedState?Sc(i):null!==c?(c.return=o,$s=c):Sc(i);for(;null!==a;)$s=a,Ec(a,t,n),a=a.sibling;$s=i,Js=s,Xs=u}bc(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,$s=a):bc(e)}}function bc(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xs||ic(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xs)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ma(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&ja(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}ja(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&Gt(f)}}}break;default:throw Error(a(163))}Xs||512&t.flags&&ac(t)}catch(p){Tu(t,t.return,p)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wc(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Sc(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){Tu(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Tu(t,i,c)}}var a=t.return;try{ac(t)}catch(c){Tu(t,a,c)}break;case 5:var o=t.return;try{ac(t)}catch(c){Tu(t,o,c)}}}catch(c){Tu(t,t.return,c)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var kc,Tc=Math.ceil,Ic=E.ReactCurrentDispatcher,Cc=E.ReactCurrentOwner,Rc=E.ReactCurrentBatchConfig,Ac=0,Oc=null,Nc=null,xc=0,Dc=0,Pc=ki(0),Lc=0,Mc=null,Uc=0,jc=0,Fc=0,Vc=null,Bc=null,Gc=0,Zc=1/0,qc=null,Wc=!1,Hc=null,Kc=null,zc=!1,Yc=null,Jc=0,Xc=0,Qc=null,$c=-1,eu=0;function tu(){return 0!==(6&Ac)?Xe():-1!==$c?$c:$c=Xe()}function nu(e){return 0===(1&e.mode)?1:0!==(2&Ac)&&0!==xc?xc&-xc:null!==va.transition?(0===eu&&(eu=vt()),eu):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function ru(e,t,n,r){if(50<Xc)throw Xc=0,Qc=null,Error(a(185));gt(e,n,r),0!==(2&Ac)&&e===Oc||(e===Oc&&(0===(2&Ac)&&(jc|=n),4===Lc&&cu(e,xc)),iu(e,r),1===n&&0===Ac&&0===(1&t.mode)&&(Zc=Xe()+500,Fi&&Gi()))}function iu(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,c=i[o];-1===c?0!==(s&n)&&0===(s&r)||(i[o]=pt(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ft(e,e===Oc?xc:0);if(0===r)null!==n&&ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&ze(n),1===t)0===e.tag?function(e){Fi=!0,Bi(e)}(uu.bind(null,e)):Bi(uu.bind(null,e)),oi((function(){0===(6&Ac)&&Gi()})),n=null;else{switch(Et(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ou(n,au.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function au(e,t){if($c=-1,eu=0,0!==(6&Ac))throw Error(a(327));var n=e.callbackNode;if(Su()&&e.callbackNode!==n)return null;var r=ft(e,e===Oc?xc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gu(e,r);else{t=r;var i=Ac;Ac|=2;var o=vu();for(Oc===e&&xc===t||(qc=null,Zc=Xe()+500,pu(e,t));;)try{_u();break}catch(c){hu(e,c)}ba(),Ic.current=o,Ac=i,null!==Nc?t=0:(Oc=null,xc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(i=ht(e))&&(r=i,t=ou(e,i))),1===t)throw n=Mc,pu(e,0),cu(e,r),iu(e,Xe()),n;if(6===t)cu(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gu(e,r))&&(0!==(o=ht(e))&&(r=o,t=ou(e,o))),1===t))throw n=Mc,pu(e,0),cu(e,r),iu(e,Xe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:wu(e,Bc,qc);break;case 3:if(cu(e,r),(130023424&r)===r&&10<(t=Gc+500-Xe())){if(0!==ft(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(wu.bind(null,e,Bc,qc),t);break}wu(e,Bc,qc);break;case 4:if(cu(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tc(r/1960))-r)){e.timeoutHandle=ri(wu.bind(null,e,Bc,qc),r);break}wu(e,Bc,qc);break;default:throw Error(a(329))}}}return iu(e,Xe()),e.callbackNode===n?au.bind(null,e):null}function ou(e,t){var n=Vc;return e.current.memoizedState.isDehydrated&&(pu(e,t).flags|=256),2!==(e=gu(e,t))&&(t=Bc,Bc=n,null!==t&&su(t)),e}function su(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function cu(e,t){for(t&=~Fc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uu(e){if(0!==(6&Ac))throw Error(a(327));Su();var t=ft(e,0);if(0===(1&t))return iu(e,Xe()),null;var n=gu(e,t);if(0!==e.tag&&2===n){var r=ht(e);0!==r&&(t=r,n=ou(e,r))}if(1===n)throw n=Mc,pu(e,0),cu(e,t),iu(e,Xe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wu(e,Bc,qc),iu(e,Xe()),null}function lu(e,t){var n=Ac;Ac|=1;try{return e(t)}finally{0===(Ac=n)&&(Zc=Xe()+500,Fi&&Gi())}}function du(e){null!==Yc&&0===Yc.tag&&0===(6&Ac)&&Su();var t=Ac;Ac|=1;var n=Rc.transition,r=_t;try{if(Rc.transition=null,_t=1,e)return e()}finally{_t=r,Rc.transition=n,0===(6&(Ac=t))&&Gi()}}function fu(){Dc=Pc.current,Ti(Pc)}function pu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Nc)for(n=Nc.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Di();break;case 3:io(),Ti(Ai),Ti(Ri),lo();break;case 5:oo(r);break;case 4:io();break;case 13:case 19:Ti(so);break;case 10:wa(r.type._context);break;case 22:case 23:fu()}n=n.return}if(Oc=e,Nc=e=Pu(e.current,null),xc=Dc=t,Lc=0,Mc=null,Fc=jc=Uc=0,Bc=Vc=null,null!==Ia){for(t=0;t<Ia.length;t++)if(null!==(r=(n=Ia[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}Ia=null}return e}function hu(e,t){for(;;){var n=Nc;try{if(ba(),fo.current=os,yo){for(var r=vo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}yo=!1}if(ho=0,go=mo=vo=null,_o=!1,Eo=0,Cc.current=null,null===n||null===n.return){Lc=1,Mc=t,Nc=null;break}e:{var o=e,s=n.return,c=n,u=t;if(t=xc,c.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var l=u,d=c,f=d.tag;if(0===(1&d.mode)&&(0===f||11===f||15===f)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var h=gs(s);if(null!==h){h.flags&=-257,ys(h,s,c,0,t),1&h.mode&&ms(o,l,t),u=l;var v=(t=h).updateQueue;if(null===v){var m=new Set;m.add(u),t.updateQueue=m}else v.add(u);break e}if(0===(1&t)){ms(o,l,t),mu();break e}u=Error(a(426))}else if(ia&&1&c.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,c,0,t),ha(ls(u,c));break e}}o=u=ls(u,c),4!==Lc&&(Lc=2),null===Vc?Vc=[o]:Vc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ma(o,hs(0,u,t));break e;case 1:c=u;var y=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Kc||!Kc.has(_)))){o.flags|=65536,t&=-t,o.lanes|=t,Ma(o,vs(o,c,t));break e}}o=o.return}while(null!==o)}bu(n)}catch(E){t=E,Nc===n&&null!==n&&(Nc=n=n.return);continue}break}}function vu(){var e=Ic.current;return Ic.current=os,null===e?os:e}function mu(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Oc||0===(268435455&Uc)&&0===(268435455&jc)||cu(Oc,xc)}function gu(e,t){var n=Ac;Ac|=2;var r=vu();for(Oc===e&&xc===t||(qc=null,pu(e,t));;)try{yu();break}catch(i){hu(e,i)}if(ba(),Ac=n,Ic.current=r,null!==Nc)throw Error(a(261));return Oc=null,xc=0,Lc}function yu(){for(;null!==Nc;)Eu(Nc)}function _u(){for(;null!==Nc&&!Ye();)Eu(Nc)}function Eu(e){var t=kc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?bu(e):Nc=t,Cc.current=null}function bu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=zs(n,t,Dc)))return void(Nc=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Nc=n);if(null===e)return Lc=6,void(Nc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===Lc&&(Lc=5)}function wu(e,t,n){var r=_t,i=Rc.transition;try{Rc.transition=null,_t=1,function(e,t,n,r){do{Su()}while(null!==Yc);if(0!==(6&Ac))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Oc&&(Nc=Oc=null,xc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||zc||(zc=!0,Ou(tt,(function(){return Su(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Rc.transition,Rc.transition=null;var s=_t;_t=1;var c=Ac;Ac|=4,Cc.current=null,function(e,t){if(ei=qt,pr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break e}var s=0,c=-1,u=-1,l=0,d=0,f=e,p=null;t:for(;;){for(var h;f!==n||0!==i&&3!==f.nodeType||(c=s+i),f!==o||0!==r&&3!==f.nodeType||(u=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(h=f.firstChild);)p=f,f=h;for(;;){if(f===e)break t;if(p===n&&++l===i&&(c=s),p===o&&++d===r&&(u=s),null!==(h=f.nextSibling))break;p=(f=p).parentNode}f=h}n=-1===c||-1===u?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},qt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,y=t.stateNode,_=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:ma(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(a(163))}}catch(b){Tu(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}v=nc,nc=!1}(e,n),gc(n,e),hr(ti),qt=!!ei,ti=ei=null,e.current=n,_c(n,e,i),Je(),Ac=c,_t=s,Rc.transition=o}else e.current=n;if(zc&&(zc=!1,Yc=e,Jc=i),o=e.pendingLanes,0===o&&(Kc=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),iu(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Wc)throw Wc=!1,e=Hc,Hc=null,e;0!==(1&Jc)&&0!==e.tag&&Su(),o=e.pendingLanes,0!==(1&o)?e===Qc?Xc++:(Xc=0,Qc=e):Xc=0,Gi()}(e,t,n,r)}finally{Rc.transition=i,_t=r}return null}function Su(){if(null!==Yc){var e=Et(Jc),t=Rc.transition,n=_t;try{if(Rc.transition=null,_t=16>e?16:e,null===Yc)var r=!1;else{if(e=Yc,Yc=null,Jc=0,0!==(6&Ac))throw Error(a(331));var i=Ac;for(Ac|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var c=o.deletions;if(null!==c){for(var u=0;u<c.length;u++){var l=c[u];for($s=l;null!==$s;){var d=$s;switch(d.tag){case 0:case 11:case 15:rc(8,d,o)}var f=d.child;if(null!==f)f.return=d,$s=f;else for(;null!==$s;){var p=(d=$s).sibling,h=d.return;if(oc(d),d===l){$s=null;break}if(null!==p){p.return=h,$s=p;break}$s=h}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:rc(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var _=e.current;for($s=_;null!==$s;){var E=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==E)E.return=s,$s=E;else e:for(s=_;null!==$s;){if(0!==(2048&(c=$s).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(w){Tu(c,c.return,w)}if(c===s){$s=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,$s=b;break e}$s=c.return}}if(Ac=i,Gi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(w){}r=!0}return r}finally{_t=n,Rc.transition=t}}return!1}function ku(e,t,n){e=Pa(e,t=hs(0,t=ls(n,t),1),1),t=tu(),null!==e&&(gt(e,1,t),iu(e,t))}function Tu(e,t,n){if(3===e.tag)ku(e,e,n);else for(;null!==t;){if(3===t.tag){ku(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Kc||!Kc.has(r))){t=Pa(t,e=vs(t,e=ls(n,e),1),1),e=tu(),null!==t&&(gt(t,1,e),iu(t,e));break}}t=t.return}}function Iu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Oc===e&&(xc&n)===n&&(4===Lc||3===Lc&&(130023424&xc)===xc&&500>Xe()-Gc?pu(e,0):Fc|=n),iu(e,t)}function Cu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=tu();null!==(e=Aa(e,t))&&(gt(e,t,n),iu(e,n))}function Ru(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cu(e,n)}function Au(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Cu(e,n)}function Ou(e,t){return Ke(e,t)}function Nu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xu(e,t,n,r){return new Nu(e,t,n,r)}function Du(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pu(e,t){var n=e.alternate;return null===n?((n=xu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lu(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Du(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Mu(n.children,i,o,t);case k:s=8,i|=8;break;case T:return(e=xu(12,n,t,2|i)).elementType=T,e.lanes=o,e;case A:return(e=xu(13,n,t,i)).elementType=A,e.lanes=o,e;case O:return(e=xu(19,n,t,i)).elementType=O,e.lanes=o,e;case D:return Uu(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case C:s=9;break e;case R:s=11;break e;case N:s=14;break e;case x:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=xu(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Mu(e,t,n,r){return(e=xu(7,e,r,t)).lanes=n,e}function Uu(e,t,n,r){return(e=xu(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function ju(e,t,n){return(e=xu(6,e,null,t)).lanes=n,e}function Fu(e,t,n){return(t=xu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vu(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bu(e,t,n,r,i,a,o,s,c){return e=new Vu(e,t,n,s,c),1===t?(t=1,!0===a&&(t|=8)):t=0,a=xu(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Na(a),e}function Gu(e){if(!e)return Ci;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(xi(n))return Li(e,n,t)}return t}function Zu(e,t,n,r,i,a,o,s,c){return(e=Bu(n,r,!0,e,0,a,0,s,c)).context=Gu(null),n=e.current,(a=Da(r=tu(),i=nu(n))).callback=void 0!==t&&null!==t?t:null,Pa(n,a,i),e.current.lanes=i,gt(e,i,r),iu(e,r),e}function qu(e,t,n,r){var i=t.current,a=tu(),o=nu(i);return n=Gu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Da(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Pa(i,t,o))&&(ru(e,i,o,a),La(e,i,o)),o}function Wu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ku(e,t){Hu(e,t),(e=e.alternate)&&Hu(e,t)}kc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ai.current)Es=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Es=!1,function(e,t,n){switch(t.tag){case 3:Os(t),pa();break;case 5:ao(t);break;case 1:xi(t.type)&&Mi(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ii(ga,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ii(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?js(e,t,n):(Ii(so,1&so.current),null!==(e=Ws(e,t,n))?e.sibling:null);Ii(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Zs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ii(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Ts(e,t,n)}return Ws(e,t,n)}(e,t,n);Es=0!==(131072&e.flags)}else Es=!1,ia&&0!==(1048576&t.flags)&&$i(t,Hi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qs(e,t),e=t.pendingProps;var i=Ni(t,Ri.current);ka(t,n),i=ko(null,t,r,e,i,n);var o=To();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xi(r)?(o=!0,Mi(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Na(t),i.updater=Ba,t.stateNode=i,i._reactInternals=t,Wa(t,r,e,n),t=As(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),bs(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Du(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===N)return 14}return 2}(r),e=ma(r,e),i){case 0:t=Cs(null,t,r,e,n);break e;case 1:t=Rs(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,ma(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Cs(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 1:return r=t.type,i=t.pendingProps,Rs(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 3:e:{if(Os(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,xa(e,t),Ua(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ns(e,t,r,n,i=ls(Error(a(423)),t));break e}if(r!==i){t=Ns(e,t,r,n,i=ls(Error(a(424)),t));break e}for(ra=ui(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=Xa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),r===i){t=Ws(e,t,n);break e}bs(e,t,r,n)}t=t.child}return t;case 5:return ao(t),null===e&&ua(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),Is(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return js(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ja(t,null,r,n):bs(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ws(e,t,r,i=t.elementType===r?i:ma(r,i),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ii(ga,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Ai.current){t=Ws(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var u=c.firstContext;null!==u;){if(u.context===r){if(1===o.tag){(u=Da(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),l.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),Sa(o.return,n,t),c.lanes|=n;break}u=u.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Sa(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,ka(t,n),r=r(i=Ta(i)),t.flags|=1,bs(e,t,r,n),t.child;case 14:return i=ma(r=t.type,t.pendingProps),Ss(e,t,r,i=ma(r.type,i),n);case 15:return ks(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ma(r,i),qs(e,t),t.tag=1,xi(r)?(e=!0,Mi(t)):e=!1,ka(t,n),Za(t,r,i),Wa(t,r,i,n),As(null,t,r,!0,e,n);case 19:return Zs(e,t,n);case 22:return Ts(e,t,n)}throw Error(a(156,t.tag))};var zu="function"===typeof reportError?reportError:function(e){console.error(e)};function Yu(e){this._internalRoot=e}function Ju(e){this._internalRoot=e}function Xu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $u(){}function el(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=Wu(o);s.call(e)}}qu(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=Wu(o);a.call(e)}}var o=Zu(t,r,e,0,null,!1,0,"",$u);return e._reactRootContainer=o,e[hi]=o.current,Gr(8===e.nodeType?e.parentNode:e),du(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Wu(c);s.call(e)}}var c=Bu(e,0,!1,null,0,!1,0,"",$u);return e._reactRootContainer=c,e[hi]=c.current,Gr(8===e.nodeType?e.parentNode:e),du((function(){qu(t,c,n,r)})),c}(n,t,e,i,r);return Wu(o)}Ju.prototype.render=Yu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));qu(e,t,null,null)},Ju.prototype.unmount=Yu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;du((function(){qu(null,e,null,null)})),t[hi]=null}},Ju.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ut(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),iu(t,Xe()),0===(6&Ac)&&(Zc=Xe()+500,Gi()))}break;case 13:du((function(){var t=Aa(e,1);if(null!==t){var n=tu();ru(t,e,1,n)}})),Ku(e,1)}},wt=function(e){if(13===e.tag){var t=Aa(e,134217728);if(null!==t)ru(t,e,134217728,tu());Ku(e,134217728)}},St=function(e){if(13===e.tag){var t=nu(e),n=Aa(e,t);if(null!==n)ru(n,e,t,tu());Ku(e,t)}},kt=function(){return _t},Tt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},we=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(a(90));K(r),Q(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=lu,Ae=du;var tl={usingClientEntryPoint:!1,Events:[_i,Ei,bi,Ie,Ce,lu]},nl={findFiberByHostInstance:yi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{it=il.inject(rl),at=il}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xu(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xu(e))throw Error(a(299));var n=!1,r="",i=zu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Bu(e,1,!1,null,0,n,0,r,i),e[hi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Yu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return du(e)},t.hydrate=function(e,t,n){if(!Qu(t))throw Error(a(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xu(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=zu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Zu(t,null,e,1,null!=n?n:null,i,0,o,s),e[hi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Ju(t)},t.render=function(e,t,n){if(!Qu(t))throw Error(a(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qu(e))throw Error(a(40));return!!e._reactRootContainer&&(du((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[hi]=null}))})),!0)},t.unstable_batchedUpdates=lu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qu(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},6910:function(e,t,n){"use strict";n.d(t,{F_:function(){return l}});var r=n(6635),i=n(2791);function a(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)},c=function(e){return{loading:void 0===e||null===e,value:e}},u=function(e){var t=e?e():void 0,n=(0,i.useReducer)((function(e,t){switch(t.type){case"error":return s(s({},e),{error:t.error,loading:!1,value:void 0});case"reset":return c(t.defaultValue);case"value":return s(s({},e),{error:void 0,loading:!1,value:t.value});default:return e}}),c(t)),r=n[0],a=n[1],o=(0,i.useCallback)((function(){var t=e?e():void 0;a({type:"reset",defaultValue:t})}),[e]),u=(0,i.useCallback)((function(e){a({type:"error",error:e})}),[]),l=(0,i.useCallback)((function(e){a({type:"value",value:e})}),[]);return(0,i.useMemo)((function(){return{error:r.error,loading:r.loading,reset:o,setError:u,setValue:l,value:r.value}}),[r.error,r.loading,o,u,l,r.value])},l=function(e,t){var n=u((function(){return e.currentUser})),s=n.error,c=n.loading,l=n.setError,d=n.setValue,f=n.value;return(0,i.useEffect)((function(){var n=(0,r.Aj)(e,(function(e){return a(void 0,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:if(!(null===t||void 0===t?void 0:t.onUserChanged))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.onUserChanged(e)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),l(n),[3,4];case 4:return d(e),[2]}}))}))}),l);return function(){n()}}),[e]),[f,c,s]}},9983:function(e,t,n){"use strict";n.d(t,{w_:function(){return u}});var r=n(2791),i={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=r.createContext&&r.createContext(i),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function c(e){return e&&e.map((function(e,t){return r.createElement(e.tag,o({key:t},e.attr),c(e.child))}))}function u(e){return function(t){return r.createElement(l,o({attr:o({},e.attr)},t),c(e.child))}}function l(e){var t=function(t){var n,i=e.attr,a=e.size,c=e.title,u=s(e,["attr","size","title"]),l=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,u,{className:n,style:o(o({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),c&&r.createElement("title",null,c),e.children)};return void 0!==a?r.createElement(a.Consumer,null,(function(e){return t(e)})):t(i)}},1213:function(e,t,n){"use strict";n.d(t,{$iT:function(){return i}});var r=n(9983);function i(e){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor"}}]})(e)}},3688:function(e,t,n){"use strict";function r(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!==n&&void 0!==n?n:null}.bind(this))}function a(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}function o(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!==typeof e.getDerivedStateFromProps&&"function"!==typeof t.getSnapshotBeforeUpdate)return e;var n=null,o=null,s=null;if("function"===typeof t.componentWillMount?n="componentWillMount":"function"===typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"===typeof t.componentWillReceiveProps?o="componentWillReceiveProps":"function"===typeof t.UNSAFE_componentWillReceiveProps&&(o="UNSAFE_componentWillReceiveProps"),"function"===typeof t.componentWillUpdate?s="componentWillUpdate":"function"===typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==o||null!==s){var c=e.displayName||e.name,u="function"===typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+c+" uses "+u+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==o?"\n  "+o:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"===typeof e.getDerivedStateFromProps&&(t.componentWillMount=r,t.componentWillReceiveProps=i),"function"===typeof t.getSnapshotBeforeUpdate){if("function"!==typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=a;var l=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var r=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;l.call(this,e,t,r)}}return e}n.r(t),n.d(t,{polyfill:function(){return o}}),r.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,a.__suppressDeprecationWarning=!0},2240:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bodyOpenClassName=t.portalClassName=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2791),o=h(a),s=h(n(4164)),c=h(n(2007)),u=h(n(4334)),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(5858)),d=n(3663),f=h(d),p=n(3688);function h(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var m=t.portalClassName="ReactModalPortal",g=t.bodyOpenClassName="ReactModal__Body--open",y=d.canUseDOM&&void 0!==s.default.createPortal,_=function(e){return document.createElement(e)},E=function(){return y?s.default.createPortal:s.default.unstable_renderSubtreeIntoContainer};function b(e){return e()}var w=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,c=Array(a),l=0;l<a;l++)c[l]=arguments[l];return n=i=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),i.removePortal=function(){!y&&s.default.unmountComponentAtNode(i.node);var e=b(i.props.parentSelector);e&&e.contains(i.node)?e.removeChild(i.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},i.portalRef=function(e){i.portal=e},i.renderPortal=function(e){var n=E()(i,o.default.createElement(u.default,r({defaultStyles:t.defaultStyles},e)),i.node);i.portalRef(n)},v(i,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentDidMount",value:function(){d.canUseDOM&&(y||(this.node=_("div")),this.node.className=this.props.portalClassName,b(this.props.parentSelector).appendChild(this.node),!y&&this.renderPortal(this.props))}},{key:"getSnapshotBeforeUpdate",value:function(e){return{prevParent:b(e.parentSelector),nextParent:b(this.props.parentSelector)}}},{key:"componentDidUpdate",value:function(e,t,n){if(d.canUseDOM){var r=this.props,i=r.isOpen,a=r.portalClassName;e.portalClassName!==a&&(this.node.className=a);var o=n.prevParent,s=n.nextParent;s!==o&&(o.removeChild(this.node),s.appendChild(this.node)),(e.isOpen||i)&&!y&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&y?(!this.node&&y&&(this.node=_("div")),E()(o.default.createElement(u.default,r({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){l.setElement(e)}}]),t}(a.Component);w.propTypes={isOpen:c.default.bool.isRequired,style:c.default.shape({content:c.default.object,overlay:c.default.object}),portalClassName:c.default.string,bodyOpenClassName:c.default.string,htmlOpenClassName:c.default.string,className:c.default.oneOfType([c.default.string,c.default.shape({base:c.default.string.isRequired,afterOpen:c.default.string.isRequired,beforeClose:c.default.string.isRequired})]),overlayClassName:c.default.oneOfType([c.default.string,c.default.shape({base:c.default.string.isRequired,afterOpen:c.default.string.isRequired,beforeClose:c.default.string.isRequired})]),appElement:c.default.oneOfType([c.default.instanceOf(f.default),c.default.instanceOf(d.SafeHTMLCollection),c.default.instanceOf(d.SafeNodeList),c.default.arrayOf(c.default.instanceOf(f.default))]),onAfterOpen:c.default.func,onRequestClose:c.default.func,closeTimeoutMS:c.default.number,ariaHideApp:c.default.bool,shouldFocusAfterRender:c.default.bool,shouldCloseOnOverlayClick:c.default.bool,shouldReturnFocusAfterClose:c.default.bool,preventScroll:c.default.bool,parentSelector:c.default.func,aria:c.default.object,data:c.default.object,role:c.default.string,contentLabel:c.default.string,shouldCloseOnEsc:c.default.bool,overlayRef:c.default.func,contentRef:c.default.func,id:c.default.string,overlayElement:c.default.func,contentElement:c.default.func},w.defaultProps={isOpen:!1,portalClassName:m,bodyOpenClassName:g,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return o.default.createElement("div",e,t)},contentElement:function(e,t){return o.default.createElement("div",e,t)}},w.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,p.polyfill)(w),t.default=w},4334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2791),s=m(n(2007)),c=v(n(8844)),u=m(n(870)),l=v(n(5858)),d=v(n(6554)),f=n(3663),p=m(f),h=m(n(8484));function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}n(5670);var g={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},y=0,_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setOverlayRef=function(e){n.overlay=e,n.props.overlayRef&&n.props.overlayRef(e)},n.setContentRef=function(e){n.content=e,n.props.contentRef&&n.props.contentRef(e)},n.afterClose=function(){var e=n.props,t=e.appElement,r=e.ariaHideApp,i=e.htmlOpenClassName,a=e.bodyOpenClassName,o=e.parentSelector,s=o&&o().ownerDocument||document;a&&d.remove(s.body,a),i&&d.remove(s.getElementsByTagName("html")[0],i),r&&y>0&&0===(y-=1)&&l.show(t),n.props.shouldFocusAfterRender&&(n.props.shouldReturnFocusAfterClose?(c.returnFocus(n.props.preventScroll),c.teardownScopedFocus()):c.popWithoutFocus()),n.props.onAfterClose&&n.props.onAfterClose(),h.default.deregister(n)},n.open=function(){n.beforeOpen(),n.state.afterOpen&&n.state.beforeClose?(clearTimeout(n.closeTimer),n.setState({beforeClose:!1})):(n.props.shouldFocusAfterRender&&(c.setupScopedFocus(n.node),c.markForFocusLater()),n.setState({isOpen:!0},(function(){n.openAnimationFrame=requestAnimationFrame((function(){n.setState({afterOpen:!0}),n.props.isOpen&&n.props.onAfterOpen&&n.props.onAfterOpen({overlayEl:n.overlay,contentEl:n.content})}))})))},n.close=function(){n.props.closeTimeoutMS>0?n.closeWithTimeout():n.closeWithoutTimeout()},n.focusContent=function(){return n.content&&!n.contentHasFocus()&&n.content.focus({preventScroll:!0})},n.closeWithTimeout=function(){var e=Date.now()+n.props.closeTimeoutMS;n.setState({beforeClose:!0,closesAt:e},(function(){n.closeTimer=setTimeout(n.closeWithoutTimeout,n.state.closesAt-Date.now())}))},n.closeWithoutTimeout=function(){n.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},n.afterClose)},n.handleKeyDown=function(e){(function(e){return"Tab"===e.code||9===e.keyCode})(e)&&(0,u.default)(n.content,e),n.props.shouldCloseOnEsc&&function(e){return"Escape"===e.code||27===e.keyCode}(e)&&(e.stopPropagation(),n.requestClose(e))},n.handleOverlayOnClick=function(e){null===n.shouldClose&&(n.shouldClose=!0),n.shouldClose&&n.props.shouldCloseOnOverlayClick&&(n.ownerHandlesClose()?n.requestClose(e):n.focusContent()),n.shouldClose=null},n.handleContentOnMouseUp=function(){n.shouldClose=!1},n.handleOverlayOnMouseDown=function(e){n.props.shouldCloseOnOverlayClick||e.target!=n.overlay||e.preventDefault()},n.handleContentOnClick=function(){n.shouldClose=!1},n.handleContentOnMouseDown=function(){n.shouldClose=!1},n.requestClose=function(e){return n.ownerHandlesClose()&&n.props.onRequestClose(e)},n.ownerHandlesClose=function(){return n.props.onRequestClose},n.shouldBeClosed=function(){return!n.state.isOpen&&!n.state.beforeClose},n.contentHasFocus=function(){return document.activeElement===n.content||n.content.contains(document.activeElement)},n.buildClassName=function(e,t){var r="object"===("undefined"===typeof t?"undefined":i(t))?t:{base:g[e],afterOpen:g[e]+"--after-open",beforeClose:g[e]+"--before-close"},a=r.base;return n.state.afterOpen&&(a=a+" "+r.afterOpen),n.state.beforeClose&&(a=a+" "+r.beforeClose),"string"===typeof t&&t?a+" "+t:a},n.attributesFromObject=function(e,t){return Object.keys(t).reduce((function(n,r){return n[e+"-"+r]=t[r],n}),{})},n.state={afterOpen:!1,beforeClose:!1},n.shouldClose=null,n.moveFromContentToOverlay=null,n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&!e.isOpen?this.open():!this.props.isOpen&&e.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!t.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,i=e.bodyOpenClassName,a=e.parentSelector,o=a&&a().ownerDocument||document;i&&d.add(o.body,i),r&&d.add(o.getElementsByTagName("html")[0],r),n&&(y+=1,l.hide(t)),h.default.register(this)}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,i=e.overlayClassName,a=e.defaultStyles,o=e.children,s=n?{}:a.content,c=i?{}:a.overlay;if(this.shouldBeClosed())return null;var u={ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:r({},c,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},l=r({id:t,ref:this.setContentRef,style:r({},s,this.props.style.content),className:this.buildClassName("content",n),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",r({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),d=this.props.contentElement(l,o);return this.props.overlayElement(u,d)}}]),t}(o.Component);_.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},_.propTypes={isOpen:s.default.bool.isRequired,defaultStyles:s.default.shape({content:s.default.object,overlay:s.default.object}),style:s.default.shape({content:s.default.object,overlay:s.default.object}),className:s.default.oneOfType([s.default.string,s.default.object]),overlayClassName:s.default.oneOfType([s.default.string,s.default.object]),parentSelector:s.default.func,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,ariaHideApp:s.default.bool,appElement:s.default.oneOfType([s.default.instanceOf(p.default),s.default.instanceOf(f.SafeHTMLCollection),s.default.instanceOf(f.SafeNodeList),s.default.arrayOf(s.default.instanceOf(p.default))]),onAfterOpen:s.default.func,onAfterClose:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,role:s.default.string,contentLabel:s.default.string,aria:s.default.object,data:s.default.object,children:s.default.node,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func,testId:s.default.string},t.default=_,e.exports=t.default},5858:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){s&&(s.removeAttribute?s.removeAttribute("aria-hidden"):null!=s.length?s.forEach((function(e){return e.removeAttribute("aria-hidden")})):document.querySelectorAll(s).forEach((function(e){return e.removeAttribute("aria-hidden")})));s=null},t.log=function(){0},t.assertNodeList=c,t.setElement=function(e){var t=e;if("string"===typeof t&&o.canUseDOM){var n=document.querySelectorAll(t);c(n,t),t=n}return s=t||s},t.validateElement=u,t.hide=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=u(e)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.setAttribute("aria-hidden","true")}}catch(o){n=!0,r=o}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},t.show=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=u(e)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.removeAttribute("aria-hidden")}}catch(o){n=!0,r=o}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},t.documentNotReadyOrSSRTesting=function(){s=null};var r,i=n(2391),a=(r=i)&&r.__esModule?r:{default:r},o=n(3663);var s=null;function c(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function u(e){var t=e||s;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,a.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}},5670:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){for(var e=[o,s],t=0;t<e.length;t++){var n=e[t];n&&(n.parentNode&&n.parentNode.removeChild(n))}o=s=null,c=[]},t.log=function(){console.log("bodyTrap ----------"),console.log(c.length);for(var e=[o,s],t=0;t<e.length;t++){var n=e[t]||{};console.log(n.nodeName,n.className,n.id)}console.log("edn bodyTrap ----------")};var r,i=n(8484),a=(r=i)&&r.__esModule?r:{default:r};var o=void 0,s=void 0,c=[];function u(){0!==c.length&&c[c.length-1].focusContent()}a.default.subscribe((function(e,t){o||s||((o=document.createElement("div")).setAttribute("data-react-modal-body-trap",""),o.style.position="absolute",o.style.opacity="0",o.setAttribute("tabindex","0"),o.addEventListener("focus",u),(s=o.cloneNode()).addEventListener("focus",u)),(c=t).length>0?(document.body.firstChild!==o&&document.body.insertBefore(o,document.body.firstChild),document.body.lastChild!==s&&document.body.appendChild(s)):(o.parentElement&&o.parentElement.removeChild(o),s.parentElement&&s.parentElement.removeChild(s))}))},6554:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){var e=document.getElementsByTagName("html")[0];for(var t in n)i(e,n[t]);var a=document.body;for(var o in r)i(a,r[o]);n={},r={}},t.log=function(){0};var n={},r={};function i(e,t){e.classList.remove(t)}t.add=function(e,t){return i=e.classList,a="html"==e.nodeName.toLowerCase()?n:r,void t.split(" ").forEach((function(e){!function(e,t){e[t]||(e[t]=0),e[t]+=1}(a,e),i.add(e)}));var i,a},t.remove=function(e,t){return i=e.classList,a="html"==e.nodeName.toLowerCase()?n:r,void t.split(" ").forEach((function(e){!function(e,t){e[t]&&(e[t]-=1)}(a,e),0===a[e]&&i.remove(e)}));var i,a}},8844:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){o=[]},t.log=function(){0},t.handleBlur=u,t.handleFocus=l,t.markForFocusLater=function(){o.push(document.activeElement)},t.returnFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;try{return void(0!==o.length&&(t=o.pop()).focus({preventScroll:e}))}catch(n){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},t.popWithoutFocus=function(){o.length>0&&o.pop()},t.setupScopedFocus=function(e){s=e,window.addEventListener?(window.addEventListener("blur",u,!1),document.addEventListener("focus",l,!0)):(window.attachEvent("onBlur",u),document.attachEvent("onFocus",l))},t.teardownScopedFocus=function(){s=null,window.addEventListener?(window.removeEventListener("blur",u),document.removeEventListener("focus",l)):(window.detachEvent("onBlur",u),document.detachEvent("onFocus",l))};var r,i=n(9750),a=(r=i)&&r.__esModule?r:{default:r};var o=[],s=null,c=!1;function u(){c=!0}function l(){if(c){if(c=!1,!s)return;setTimeout((function(){s.contains(document.activeElement)||((0,a.default)(s)[0]||s).focus()}),0)}}},8484:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(){console.log("portalOpenInstances ----------"),console.log(r.openInstances.length),r.openInstances.forEach((function(e){return console.log(e)})),console.log("end portalOpenInstances ----------")},t.resetState=function(){r=new n};var n=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.register=function(e){-1===t.openInstances.indexOf(e)&&(t.openInstances.push(e),t.emit("register"))},this.deregister=function(e){var n=t.openInstances.indexOf(e);-1!==n&&(t.openInstances.splice(n,1),t.emit("deregister"))},this.subscribe=function(e){t.subscribers.push(e)},this.emit=function(e){t.subscribers.forEach((function(n){return n(e,t.openInstances.slice())}))},this.openInstances=[],this.subscribers=[]},r=new n;t.default=r},3663:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canUseDOM=t.SafeNodeList=t.SafeHTMLCollection=void 0;var r,i=n(2618);var a=((r=i)&&r.__esModule?r:{default:r}).default,o=a.canUseDOM?window.HTMLElement:{};t.SafeHTMLCollection=a.canUseDOM?window.HTMLCollection:{},t.SafeNodeList=a.canUseDOM?window.NodeList:{},t.canUseDOM=a.canUseDOM;t.default=o},870:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.default)(e);if(!n.length)return void t.preventDefault();var r=void 0,i=t.shiftKey,s=n[0],c=n[n.length-1],u=o();if(e===u){if(!i)return;r=c}c!==u||i||(r=s);s===u&&i&&(r=c);if(r)return t.preventDefault(),void r.focus();var l=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null==l||"Chrome"==l[1]||null!=/\biPod\b|\biPad\b/g.exec(navigator.userAgent))return;var d=n.indexOf(u);d>-1&&(d+=i?-1:1);if("undefined"===typeof(r=n[d]))return t.preventDefault(),void(r=i?c:s).focus();t.preventDefault(),r.focus()};var r,i=n(9750),a=(r=i)&&r.__esModule?r:{default:r};function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.activeElement.shadowRoot?o(e.activeElement.shadowRoot):e.activeElement}e.exports=t.default},9750:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var n=[].slice.call(t.querySelectorAll("*"),0).reduce((function(t,n){return t.concat(n.shadowRoot?e(n.shadowRoot):[n])}),[]);return n.filter(s)};var n="none",r="contents",i=/input|select|textarea|button|object|iframe/;function a(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;try{var i=window.getComputedStyle(e),a=i.getPropertyValue("display");return t?a!==r&&function(e,t){return"visible"!==t.getPropertyValue("overflow")||e.scrollWidth<=0&&e.scrollHeight<=0}(e,i):a===n}catch(o){return console.warn("Failed to inspect element style"),!1}}function o(e,t){var n=e.nodeName.toLowerCase();return(i.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e,n=e.getRootNode&&e.getRootNode();t&&t!==document.body;){if(n&&t===n&&(t=n.host.parentNode),a(t))return!1;t=t.parentNode}return!0}(e)}function s(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||t>=0)&&o(e,!n)}e.exports=t.default},7948:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2240),a=(r=i)&&r.__esModule?r:{default:r};t.default=a.default,e.exports=t.default},7689:function(e,t,n){"use strict";var r;n.d(t,{AW:function(){return P},F0:function(){return L},TH:function(){return E},Z5:function(){return M},s0:function(){return w}});var i=n(3433),a=n(5671),o=n(3144),s=n(136),c=n(9388),u=n(2791),l=n(8278);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}var f=u.createContext(null);var p=u.createContext(null);var h=u.createContext(null);var v=u.createContext(null);var m=u.createContext(null);var g=u.createContext({outlet:null,matches:[],isDataRoute:!1});var y=u.createContext(null);function _(){return null!=u.useContext(m)}function E(){return _()||(0,l.J0)(!1),u.useContext(m).location}function b(e){u.useContext(v).static||u.useLayoutEffect(e)}function w(){return u.useContext(g).isDataRoute?function(){var e=N(A.UseNavigateStable).router,t=D(O.UseNavigateStable),n=u.useRef(!1);return b((function(){n.current=!0})),u.useCallback((function(r,i){void 0===i&&(i={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,d({fromRouteId:t},i)))}),[e,t])}():function(){_()||(0,l.J0)(!1);var e=u.useContext(f),t=u.useContext(v),n=t.basename,r=t.navigator,i=u.useContext(g).matches,a=E().pathname,o=JSON.stringify((0,l.Zq)(i).map((function(e){return e.pathnameBase}))),s=u.useRef(!1);return b((function(){s.current=!0})),u.useCallback((function(t,i){if(void 0===i&&(i={}),s.current)if("number"!==typeof t){var c=(0,l.pC)(t,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==n&&(c.pathname="/"===c.pathname?n:(0,l.RQ)([n,c.pathname])),(i.replace?r.replace:r.push)(c,i.state,i)}else r.go(t)}),[n,r,o,a,e])}()}function S(e,t,n){_()||(0,l.J0)(!1);var r,i=u.useContext(v).navigator,a=u.useContext(g).matches,o=a[a.length-1],s=o?o.params:{},c=(o&&o.pathname,o?o.pathnameBase:"/"),f=(o&&o.route,E());if(t){var p,h="string"===typeof t?(0,l.cP)(t):t;"/"===c||(null==(p=h.pathname)?void 0:p.startsWith(c))||(0,l.J0)(!1),r=h}else r=f;var y=r.pathname||"/",b="/"===c?y:y.slice(c.length)||"/",w=(0,l.fp)(e,{pathname:b});var S=R(w&&w.map((function(e){return Object.assign({},e,{params:Object.assign({},s,e.params),pathname:(0,l.RQ)([c,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:(0,l.RQ)([c,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})})),a,n);return t&&S?u.createElement(m.Provider,{value:{location:d({pathname:"/",search:"",hash:"",state:null,key:"default"},r),navigationType:l.aU.Pop}},S):S}function k(){var e=function(){var e,t=u.useContext(y),n=x(O.UseRouteError),r=D(O.UseRouteError);if(t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=(0,l.WK)(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),n?u.createElement("pre",{style:i},n):null,null)}var T=u.createElement(k,null),I=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).state={location:e.location,revalidation:e.revalidation,error:e.error},r}return(0,o.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("React Router caught the following error during render",e,t)}},{key:"render",value:function(){return this.state.error?u.createElement(g.Provider,{value:this.props.routeContext},u.createElement(y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}},{key:"getDerivedStateFromProps",value:function(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}}]),n}(u.Component);function C(e){var t=e.routeContext,n=e.match,r=e.children,i=u.useContext(f);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),u.createElement(g.Provider,{value:t},r)}function R(e,t,n){var r;if(void 0===t&&(t=[]),void 0===n&&(n=null),null==e){var i;if(null==(i=n)||!i.errors)return null;e=n.matches}var a=e,o=null==(r=n)?void 0:r.errors;if(null!=o){var s=a.findIndex((function(e){return e.route.id&&(null==o?void 0:o[e.route.id])}));s>=0||(0,l.J0)(!1),a=a.slice(0,Math.min(a.length,s+1))}return a.reduceRight((function(e,r,i){var s=r.route.id?null==o?void 0:o[r.route.id]:null,c=null;n&&(c=r.route.errorElement||T);var l=t.concat(a.slice(0,i+1)),d=function(){var t;return t=s?c:r.route.Component?u.createElement(r.route.Component,null):r.route.element?r.route.element:e,u.createElement(C,{match:r,routeContext:{outlet:e,matches:l,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?u.createElement(I,{location:n.location,revalidation:n.revalidation,component:c,error:s,children:d(),routeContext:{outlet:null,matches:l,isDataRoute:!0}}):d()}),null)}var A=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(A||{}),O=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(O||{});function N(e){var t=u.useContext(f);return t||(0,l.J0)(!1),t}function x(e){var t=u.useContext(p);return t||(0,l.J0)(!1),t}function D(e){var t=function(e){var t=u.useContext(g);return t||(0,l.J0)(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||(0,l.J0)(!1),n.route.id}(r||(r=n.t(u,2))).startTransition;function P(e){(0,l.J0)(!1)}function L(e){var t=e.basename,n=void 0===t?"/":t,r=e.children,i=void 0===r?null:r,a=e.location,o=e.navigationType,s=void 0===o?l.aU.Pop:o,c=e.navigator,d=e.static,f=void 0!==d&&d;_()&&(0,l.J0)(!1);var p=n.replace(/^\/*/,"/"),h=u.useMemo((function(){return{basename:p,navigator:c,static:f}}),[p,c,f]);"string"===typeof a&&(a=(0,l.cP)(a));var g=a,y=g.pathname,E=void 0===y?"/":y,b=g.search,w=void 0===b?"":b,S=g.hash,k=void 0===S?"":S,T=g.state,I=void 0===T?null:T,C=g.key,R=void 0===C?"default":C,A=u.useMemo((function(){var e=(0,l.Zn)(E,p);return null==e?null:{location:{pathname:e,search:w,hash:k,state:I,key:R},navigationType:s}}),[p,E,w,k,I,R,s]);return null==A?null:u.createElement(v.Provider,{value:h},u.createElement(m.Provider,{children:i,value:A}))}function M(e){var t=e.children,n=e.location;return S(F(t),n)}var U=function(e){return e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error",e}(U||{}),j=new Promise((function(){}));u.Component;function F(e,t){void 0===t&&(t=[]);var n=[];return u.Children.forEach(e,(function(e,r){if(u.isValidElement(e)){var a=[].concat((0,i.Z)(t),[r]);if(e.type!==u.Fragment){e.type!==P&&(0,l.J0)(!1),e.props.index&&e.props.children&&(0,l.J0)(!1);var o={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=F(e.props.children,a)),n.push(o)}else n.push.apply(n,F(e.props.children,a))}})),n}},6374:function(e,t,n){"use strict";var r=n(2791),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,a={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:l,props:a,_owner:s.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}function y(){}function _(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var E=_.prototype=new y;E.constructor=_,v(E,g.prototype),E.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,i)&&!k.hasOwnProperty(i)&&(a[i]=t[i]);var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===a[i]&&(a[i]=c[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:S.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===a?"."+R(c,0):a,b(o)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),A(o,t,i,"",(function(e){return e}))):null!=o&&(I(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(c=0,a=""===a?".":a+":",b(e))for(var u=0;u<e.length;u++){var l=a+R(s=e[u],u);c+=A(s,t,i,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),u=0;!(s=e.next()).done;)c+=A(s=s.value,t,i,l=a+R(s,u++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function O(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x={current:null},D={transition:null},P={ReactCurrentDispatcher:x,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};t.Children={map:O,forEach:function(e,t,n){O(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return O(e,(function(){t++})),t},toArray:function(e){return O(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=o,t.PureComponent=_,t.StrictMode=a,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)w.call(t,u)&&!k.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return x.current.useCallback(e,t)},t.useContext=function(e){return x.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return x.current.useDeferredValue(e)},t.useEffect=function(e,t){return x.current.useEffect(e,t)},t.useId=function(){return x.current.useId()},t.useImperativeHandle=function(e,t,n){return x.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return x.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return x.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return x.current.useMemo(e,t)},t.useReducer=function(e,t,n){return x.current.useReducer(e,t,n)},t.useRef=function(e){return x.current.useRef(e)},t.useState=function(e){return x.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return x.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return x.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,c=e[s],u=s+1,l=e[u];if(0>a(c,n))u<i&&0>a(l,c)?(e[r]=l,e[u]=n,r=u):(e[r]=c,e[s]=n,r=s);else{if(!(u<i&&0>a(l,n)))break e;e[r]=l,e[u]=n,r=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var u=[],l=[],d=1,f=null,p=3,h=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(u,t)}t=r(l)}}function b(e){if(m=!1,E(e),!v)if(null!==r(u))v=!0,D(w);else{var t=r(l);null!==t&&P(b,t.startTime-e)}}function w(e,n){v=!1,m&&(m=!1,y(I),I=-1),h=!0;var a=p;try{for(E(n),f=r(u);null!==f&&(!(f.expirationTime>n)||e&&!A());){var o=f.callback;if("function"===typeof o){f.callback=null,p=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===r(u)&&i(u),E(n)}else i(u);f=r(u)}if(null!==f)var c=!0;else{var d=r(l);null!==d&&P(b,d.startTime-n),c=!1}return c}finally{f=null,p=a,h=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,k=!1,T=null,I=-1,C=5,R=-1;function A(){return!(t.unstable_now()-R<C)}function O(){if(null!==T){var e=t.unstable_now();R=e;var n=!0;try{n=T(!0,e)}finally{n?S():(k=!1,T=null)}}else k=!1}if("function"===typeof _)S=function(){_(O)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,x=N.port2;N.port1.onmessage=O,S=function(){x.postMessage(null)}}else S=function(){g(O,0)};function D(e){T=e,k||(k=!0,S())}function P(e,n){I=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||h||(v=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(l,e),null===r(u)&&e===r(l)&&(m?(y(I),I=-1):m=!0,P(b,a-o))):(e.sortIndex=s,n(u,e),v||h||(v=!0,D(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},7399:function(e){e.exports={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}},2391:function(e){"use strict";var t=function(){};e.exports=t},5462:function(){},8660:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAYAAAAEN20fAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJwSURBVHgB7VdLctpAEO1pwHF2LIDKLsoJgm8AFzDWCQwnCGzi4A1ikWCysX0CkhNI5AIhJ7BvYJYJZKFdUhCm060PVlQGA8HCC78qStJopvvxXvdIUlm7Y2SU6ikFJdgBiGAwJaqlMwiWgt2QEIgAGVS9tAJ17DEDukxpuIYEoQEMQNVSBKV0OMgkLr6bzSEkiBdcFkymJecYDv5BPIaEMUN8E56rQv+Mwgu253qqwXQfWJm7GgSjE7heinuovubsTgkeCBJ7D/Eq3qW3RDS1mYrLZwYKmX63BVuGxJTYrH3WzyU5fcytQU2vPD7eRK5m7y44kxk1/teqrG1lM2rfjqgw5HzlIN+Nlz+6QLpmop8dMLNLb4DgSKzK2++LsCF8K/bnVsg2MdG/D+IdivGFrtlwx5V3da10IxgyFKauNrEqZ3frOFdYuRJzXGnWXdNy43NxUZCfh6cXgV1DfyJZeeesJzLDPZA5hS9dG5HOg6EhaVWWmIvW4LKAIp/vJX2Wa5a3KjJL+y1ak7c/FmUOP0SOwF/kiBVj8+3SXXspkZDMqNKsRirc4Lq5ydkf6vG5YoVCmhe7WDE6PDHvsiKONKwIJmPxv3UUahu8FsfzfL/7cqp/eQQz+LylgEJyomRtZJ4OVo1/ryJRiLxiFSkYyLUkFhu8rghI8PFb0BWDdWKvrEiIoO3KhX7H4rTSScbtXWr/YOVgA6ylSBRiFReBKQrIT5QabUhCsLYi/5AxTxw+OLAFbKzItvFEJI4nInE8GiLz9uW36Wre7gwhQfDL82veg3wisl3Ld4X3fQFJg8LDJ0zNqCY7I+wI3q5M1P4LTu0ExyBj/ggAAAAASUVORK5CYII="},3016:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHTSURBVHgBvZZNVsIwEMf/E/x6rlj6ZGE9gXgDvQE3EE8AnAA4QcELiDfwBnAD8QTW90RdduMK6DiBAhH7CYH/e22TdNJfMmkyQxCdd7lJQF2KRYRiwJNH77NGbVgUlTrsgmawSAUBGl8N6sCSFBGqSQakUINFKTbcGAkEHFgGvqcZnbnswJK0S9/SjAopXsgFxBSvGezKsCQl1zDNKAB8WJKaAoMUG+84w6CyivRNNr4nhYuIl/5BgFuvQdaAanYP0NsHbAk8Ajr7gC2B8mFfKINFIxOGu4AtgVo0xeqQZtyUXK5iByKzUnrgvoaFVf8nwKWvZ29RyqwcTnFPqz1XPC3gEZb1Byjr5nGwci0xKjpWwqIoqnHNtVrVUY2esCug43JxrPACIzRlCcRF6XcCVPSy8HxpvG/xWiowhDoC7ZtQ+UgrLuWQv7qMuf2/yMIsRyPhWfeNBcZCGb2A0TZHngQzpb2UCIyFiqtIfq5Rg3pZYaH8VOACOinAldlVzPYZeA7KHKAzAReS2dQlqWryFhmAymMsLuzIoX4txY23SK4ZmgrXtiXFuxzd/I2BJniiUBU36/W9SrIVWHtr4Dp8DDmh1CzpKssgHJ1JhOdz96NGrV85LbFUx3k00AAAAABJRU5ErkJggg=="},440:function(e,t,n){"use strict";e.exports=n.p+"static/media/user-profile.c32ce5aa19464610cf39.png"},3897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},5372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3405:function(e,t,n){var r=n(3897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},7156:function(e){function t(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,c,"next",e)}function c(e){t(o,i,a,s,c,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},3515:function(e,t,n){var r=n(6015),i=n(9617);function a(t,n,o){return i()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e,t,n){var r=n(4062);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4704:function(e,t,n){var r=n(6116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},6389:function(e,t,n){var r=n(3808),i=n(9617),a=n(4993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},8416:function(e,t,n){var r=n(4062);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},1588:function(e,t,n){var r=n(1753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},1655:function(e,t,n){var r=n(6015);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},6035:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},9617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},9498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},2218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},4993:function(e,t,n){var r=n(8698).default,i=n(6115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},a=Object.prototype,o=a.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(t){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof E?t:E,a=Object.create(i.prototype),o=new D(r||[]);return s(a,"_invoke",{value:A(e,n,o)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var v="suspendedStart",m="suspendedYield",g="executing",y="completed",_={};function E(){}function b(){}function w(){}var S={};f(S,u,(function(){return this}));var k=Object.getPrototypeOf,T=k&&k(k(P([])));T&&T!==a&&o.call(T,u)&&(S=T);var I=w.prototype=E.prototype=Object.create(S);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(i,a,s,c){var u=h(e[i],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==r(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;s(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function A(e,n,r){var i=v;return function(a,o){if(i===g)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:t,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var c=O(s,r);if(c){if(c===_)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=h(e,n,r);if("normal"===u.type){if(i=r.done?y:m,u.arg===_)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),_;var a=h(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,_;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,_):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function P(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=w,s(I,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,d,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},C(R.prototype),f(R.prototype,l,(function(){return this})),n.AsyncIterator=R,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new R(p(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(I),f(I,d,"Generator"),f(I,u,(function(){return this})),f(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=P,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),_}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6015:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7424:function(e,t,n){var r=n(5372),i=n(8872),a=n(6116),o=n(2218);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},1753:function(e,t,n){var r=n(3808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(3405),i=n(9498),a=n(6116),o=n(2281);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},5036:function(e,t,n){var r=n(8698).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},4062:function(e,t,n){var r=n(8698).default,i=n(5036);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6116:function(e,t,n){var r=n(3897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},3496:function(e,t,n){var r=n(3808),i=n(6015),a=n(6035),o=n(3515);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},3878:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},7326:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},5861:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,c,"next",e)}function c(e){r(o,i,a,s,c,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return i}})},5671:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return r}})},5647:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9611),i=n(8814);function a(e,t,n){return a=(0,i.Z)()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&(0,r.Z)(a,n.prototype),a},a.apply(null,arguments)}},3144:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9142);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,r.Z)(i.key),i)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}},7762:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(181);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,r.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}},9388:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(1120),i=n(8814),a=n(2963);function o(e){var t=(0,i.Z)();return function(){var n,i=(0,r.Z)(e);if(t){var o=(0,r.Z)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return(0,a.Z)(this,n)}}},4942:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9142);function i(e,t,n){return(t=(0,r.Z)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1752:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1120);function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},i.apply(this,arguments)}},1120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},136:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9611);function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},8814:function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,{Z:function(){return r}})},9199:function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},5267:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},1413:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(4942);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},4925:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,{Z:function(){return r}})},2963:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1002),i=n(7326);function a(e,t){if(t&&("object"===(0,r.Z)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(e)}},4165:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1002);function i(){i=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,a=Object.create(i.prototype),s=new x(r||[]);return o(a,"_invoke",{value:R(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",g="completed",y={};function _(){}function E(){}function b(){}var w={};d(w,c,(function(){return this}));var S=Object.getPrototypeOf,k=S&&S(S(D([])));k&&k!==n&&a.call(k,c)&&(w=k);var T=b.prototype=_.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(i,o,s,c){var u=p(e[i],e,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==(0,r.Z)(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function R(t,n,r){var i=h;return function(a,o){if(i===m)throw new Error("Generator is already running");if(i===g){if("throw"===a)throw o;return{value:e,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=m;var u=p(t,n,r);if("normal"===u.type){if(i=r.done?g:v,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var a=p(i,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function D(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(a.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError((0,r.Z)(t)+" is not iterable")}return E.prototype=b,o(T,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:E,configurable:!0}),E.displayName=d(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,d(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},I(C.prototype),d(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new C(f(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},I(T),d(T,l,"Generator"),d(T,c,(function(){return this})),d(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=D,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:D(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}},9611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},9439:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(3878);var i=n(181),a=n(5267);function o(e,t){return(0,r.Z)(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||(0,i.Z)(e,t)||(0,a.Z)()}},168:function(e,t,n){"use strict";function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}n.d(t,{Z:function(){return r}})},4506:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(3878),i=n(9199),a=n(181),o=n(5267);function s(e){return(0,r.Z)(e)||(0,i.Z)(e)||(0,a.Z)(e)||(0,o.Z)()}},3433:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(907);var i=n(9199),a=n(181);function o(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,i.Z)(e)||(0,a.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},9142:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1002);function i(e){var t=function(e,t){if("object"!==(0,r.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==(0,r.Z)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,r.Z)(t)?t:String(t)}},1002:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{Z:function(){return r}})},181:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(907);function i(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}},8664:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(1120),i=n(9611);var a=n(5647);function o(e){var t="function"===typeof Map?new Map:void 0;return o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return(0,a.Z)(e,arguments,(0,r.Z)(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,i.Z)(o,e)},o(e)}},7825:function(e,t,n){"use strict";n.d(t,{Jn:function(){return K},qX:function(){return Z},Xd:function(){return G},Mq:function(){return Y},ZF:function(){return z},KN:function(){return J}});var r,i,a=n(3433),o=n(4165),s=n(5861),c=n(7762),u=n(4942),l=n(5671),d=n(3144),f=n(3258),p=n(6781),h=n(5854),v=n(1413),m=function(e,t){return t.some((function(t){return e instanceof t}))};var g=new WeakMap,y=new WeakMap,_=new WeakMap,E=new WeakMap,b=new WeakMap;var w={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return y.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return T(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function S(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(I(this),n),T(g.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return T(e.apply(I(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[I(this),t].concat(r));return _.set(a,t.sort?t.sort():[t]),T(a)}}function k(e){return"function"===typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(!y.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));y.set(e,t)}}(e),m(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,w):e)}function T(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(T(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&g.set(t,e)})).catch((function(){})),b.set(t,e),t}(e);if(E.has(e))return E.get(e);var t=k(e);return t!==e&&(E.set(e,t),b.set(t,e)),t}var I=function(e){return b.get(e)};var C,R,A=["get","getKey","getAll","getAllKeys","count"],O=["put","add","delete","clear"],N=new Map;function x(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(N.get(t))return N.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=O.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||A.includes(n))){var a=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,s,c,u,l,d,f=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),c=s.store,u=f.length,l=new Array(u>1?u-1:0),d=1;d<u;d++)l[d-1]=f[d];return r&&(c=c.index(l.shift())),e.next=6,Promise.all([(a=c)[n].apply(a,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return N.set(t,a),a}}}w=function(e){return(0,v.Z)((0,v.Z)({},e),{},{get:function(t,n,r){return x(t,n)||e.get(t,n,r)},has:function(t,n){return!!x(t,n)||e.has(t,n)}})}(w);var D=function(){function e(t){(0,l.Z)(this,e),this.container=t}return(0,d.Z)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var P="@firebase/app",L="0.9.19",M=new p.Yd("@firebase/app"),U="[DEFAULT]",j=(C={},(0,u.Z)(C,P,"fire-core"),(0,u.Z)(C,"@firebase/app-compat","fire-core-compat"),(0,u.Z)(C,"@firebase/analytics","fire-analytics"),(0,u.Z)(C,"@firebase/analytics-compat","fire-analytics-compat"),(0,u.Z)(C,"@firebase/app-check","fire-app-check"),(0,u.Z)(C,"@firebase/app-check-compat","fire-app-check-compat"),(0,u.Z)(C,"@firebase/auth","fire-auth"),(0,u.Z)(C,"@firebase/auth-compat","fire-auth-compat"),(0,u.Z)(C,"@firebase/database","fire-rtdb"),(0,u.Z)(C,"@firebase/database-compat","fire-rtdb-compat"),(0,u.Z)(C,"@firebase/functions","fire-fn"),(0,u.Z)(C,"@firebase/functions-compat","fire-fn-compat"),(0,u.Z)(C,"@firebase/installations","fire-iid"),(0,u.Z)(C,"@firebase/installations-compat","fire-iid-compat"),(0,u.Z)(C,"@firebase/messaging","fire-fcm"),(0,u.Z)(C,"@firebase/messaging-compat","fire-fcm-compat"),(0,u.Z)(C,"@firebase/performance","fire-perf"),(0,u.Z)(C,"@firebase/performance-compat","fire-perf-compat"),(0,u.Z)(C,"@firebase/remote-config","fire-rc"),(0,u.Z)(C,"@firebase/remote-config-compat","fire-rc-compat"),(0,u.Z)(C,"@firebase/storage","fire-gcs"),(0,u.Z)(C,"@firebase/storage-compat","fire-gcs-compat"),(0,u.Z)(C,"@firebase/firestore","fire-fst"),(0,u.Z)(C,"@firebase/firestore-compat","fire-fst-compat"),(0,u.Z)(C,"fire-js","fire-js"),(0,u.Z)(C,"firebase","fire-js-all"),C),F=new Map,V=new Map;function B(e,t){try{e.container.addComponent(t)}catch(n){M.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function G(e){var t=e.name;if(V.has(t))return M.debug("There were multiple attempts to register component ".concat(t,".")),!1;V.set(t,e);var n,r=(0,c.Z)(F.values());try{for(r.s();!(n=r.n()).done;){B(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function Z(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}var q=(R={},(0,u.Z)(R,"no-app","No Firebase App '{$appName}' has been created - call initializeApp() first"),(0,u.Z)(R,"bad-app-name","Illegal App name: '{$appName}"),(0,u.Z)(R,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,u.Z)(R,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,u.Z)(R,"no-options","Need to provide options, when not being deployed to hosting via source."),(0,u.Z)(R,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,u.Z)(R,"invalid-log-argument","First argument to `onLog` must be null or a function."),(0,u.Z)(R,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),(0,u.Z)(R,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),(0,u.Z)(R,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),(0,u.Z)(R,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),R),W=new h.LL("app","Firebase",q),H=function(){function e(t,n,r){var i=this;(0,l.Z)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new f.wA("app",(function(){return i}),"PUBLIC"))}return(0,d.Z)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw W.create("app-deleted",{appName:this._name})}}]),e}(),K="10.4.0";function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;"object"!==typeof t&&(t={name:t});var r=Object.assign({name:U,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw W.create("bad-app-name",{appName:String(i)});if(n||(n=(0,h.aH)()),!n)throw W.create("no-options");var a=F.get(i);if(a){if((0,h.vZ)(n,a.options)&&(0,h.vZ)(r,a.config))return a;throw W.create("duplicate-app",{appName:i})}var o,s=new f.H0(i),u=(0,c.Z)(V.values());try{for(u.s();!(o=u.n()).done;){var l=o.value;s.addComponent(l)}}catch(p){u.e(p)}finally{u.f()}var d=new H(n,r,s);return F.set(i,d),d}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=F.get(e);if(!t&&e===U&&(0,h.aH)())return z();if(!t)throw W.create("no-app",{appName:e});return t}function J(e,t,n){var r,i=null!==(r=j[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void M.warn(s.join(" "))}G(new f.wA("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}var X="firebase-heartbeat-database",Q=1,$="firebase-heartbeat-store",ee=null;function te(){return ee||(ee=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),c=T(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(T(s.result),e.oldVersion,e.newVersion,T(s.transaction),e)})),r&&s.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),c.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(e){return a(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),c}(X,Q,{upgrade:function(e,t){if(0===t)e.createObjectStore($)}}).catch((function(e){throw W.create("idb-open",{originalErrorMessage:e.message})}))),ee}function ne(e){return re.apply(this,arguments)}function re(){return(re=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,te();case 3:return n=e.sent,e.next=6,n.transaction($).objectStore($).get(oe(t));case 6:return r=e.sent,e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(0),e.t0 instanceof h.ZR?M.warn(e.t0.message):(i=W.create("idb-get",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),M.warn(i.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function ie(e,t){return ae.apply(this,arguments)}function ae(){return(ae=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,i,a,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,te();case 3:return r=e.sent,i=r.transaction($,"readwrite"),a=i.objectStore($),e.next=8,a.put(n,oe(t));case 8:return e.next=10,i.done;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),e.t0 instanceof h.ZR?M.warn(e.t0.message):(s=W.create("idb-set",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),M.warn(s.message));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function oe(e){return"".concat(e.name,"!").concat(e.options.appId)}var se=function(){function e(t){var n=this;(0,l.Z)(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new de(r),this._heartbeatsCachePromise=this._storage.read().then((function(e){return n._heartbeatsCache=e,e}))}return(0,d.Z)(e,[{key:"triggerHeartbeat",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.getProvider("platform-logger").getImmediate(),n=t.getPlatformInfoString(),r=ce(),null!==this._heartbeatsCache){e.next=7;break}return e.next=6,this._heartbeatsCachePromise;case 6:this._heartbeatsCache=e.sent;case 7:if(this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((function(e){return e.date===r}))){e.next=11;break}return e.abrupt("return");case 11:this._heartbeatsCache.heartbeats.push({date:r,agent:n});case 12:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),e.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._heartbeatsCache){e.next=3;break}return e.next=3,this._heartbeatsCachePromise;case 3:if(null!==this._heartbeatsCache&&0!==this._heartbeatsCache.heartbeats.length){e.next=5;break}return e.abrupt("return","");case 5:if(t=ce(),n=ue(this._heartbeatsCache.heartbeats),r=n.heartbeatsToSend,i=n.unsentEntries,a=(0,h.L)(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,!(i.length>0)){e.next=15;break}return this._heartbeatsCache.heartbeats=i,e.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:e.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ce(){return(new Date).toISOString().substring(0,10)}function ue(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,r=[],i=e.slice(),a=(0,c.Z)(e);try{var o=function(){var e=t.value,a=r.find((function(t){return t.agent===e.agent}));if(a){if(a.dates.push(e.date),fe(r)>n)return a.dates.pop(),0}else if(r.push({agent:e.agent,dates:[e.date]}),fe(r)>n)return r.pop(),0;i=i.slice(1)};for(a.s();!(t=a.n()).done&&0!==o(););}catch(s){a.e(s)}finally{a.f()}return{heartbeatsToSend:r,unsentEntries:i}}var le,de=function(){function e(t){(0,l.Z)(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return(0,d.Z)(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.hl)()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.abrupt("return",(0,h.eu)().then((function(){return!0})).catch((function(){return!1})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return",{heartbeats:[]});case 7:return e.next=9,ne(this.app);case 9:return t=e.sent,e.abrupt("return",t||{heartbeats:[]});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"overwrite",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",ie(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:t.heartbeats}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",ie(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[].concat((0,a.Z)(r.heartbeats),(0,a.Z)(t.heartbeats))}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function fe(e){return(0,h.L)(JSON.stringify({version:2,heartbeats:e})).length}le="",G(new f.wA("platform-logger",(function(e){return new D(e)}),"PRIVATE")),G(new f.wA("heartbeat",(function(e){return new se(e)}),"PRIVATE")),J(P,L,le),J(P,L,"esm2017"),J("fire-js","")},3258:function(e,t,n){"use strict";n.d(t,{H0:function(){return h},wA:function(){return d}});var r=n(4165),i=n(3433),a=n(5861),o=n(9439),s=n(7762),c=n(5671),u=n(3144),l=n(5854),d=function(){function e(t,n,r){(0,c.Z)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return(0,u.Z)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),f="[DEFAULT]",p=function(){function e(t,n){(0,c.Z)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return(0,u.Z)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:f})}catch(l){}var t,n=(0,s.Z)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,o.Z)(t.value,2),i=r[0],a=r[1],c=this.normalizeInstanceIdentifier(i);try{var u=this.getOrInitializeService({instanceIdentifier:c});a.resolve(u)}catch(l){}}}catch(d){n.e(d)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,i.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,i.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),c=(0,s.Z)(this.instancesDeferred.entries());try{for(c.s();!(i=c.n()).done;){var u=(0,o.Z)(i.value,2),l=u[0],d=u[1];r===this.normalizeInstanceIdentifier(l)&&d.resolve(a)}}catch(f){c.e(f)}finally{c.f()}return a}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(o){}}}catch(c){i.e(c)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===f?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.component?this.component.multipleInstances?e:f:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var h=function(){function e(t){(0,c.Z)(this,e),this.name=t,this.providers=new Map}return(0,u.Z)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new p(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},6463:function(e,t,n){"use strict";var r,i,a=n(4165),o=n(7762),s=n(3433),c=n(5861),u=n(4942),l=n(7825),d=n(3258),f=n(5854),p=n(1413),h=function(e,t){return t.some((function(t){return e instanceof t}))};var v=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,_=new WeakMap;var E={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function b(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(k(this),n),S(v.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return S(e.apply(k(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[k(this),t].concat(r));return g.set(a,t.sort?t.sort():[t]),S(a)}}function w(e){return"function"===typeof e?b(e):(e instanceof IDBTransaction&&function(e){if(!m.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));m.set(e,t)}}(e),h(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,E):e)}function S(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(S(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&v.set(t,e)})).catch((function(){})),_.set(t,e),t}(e);if(y.has(e))return y.get(e);var t=w(e);return t!==e&&(y.set(e,t),_.set(t,e)),t}var k=function(e){return _.get(e)};var T,I=["get","getKey","getAll","getAllKeys","count"],C=["put","add","delete","clear"],R=new Map;function A(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(R.get(t))return R.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=C.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||I.includes(n))){var o=function(){var e=(0,c.Z)((0,a.Z)().mark((function e(t){var o,s,c,u,l,d,f=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),c=s.store,u=f.length,l=new Array(u>1?u-1:0),d=1;d<u;d++)l[d-1]=f[d];return r&&(c=c.index(l.shift())),e.next=6,Promise.all([(o=c)[n].apply(o,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return R.set(t,o),o}}}E=function(e){return(0,p.Z)((0,p.Z)({},e),{},{get:function(t,n,r){return A(t,n)||e.get(t,n,r)},has:function(t,n){return!!A(t,n)||e.has(t,n)}})}(E);var O="@firebase/installations",N="0.6.4",x=1e4,D="w:".concat(N),P="FIS_v2",L="https://firebaseinstallations.googleapis.com/v1",M=36e5,U=(T={},(0,u.Z)(T,"missing-app-config-values",'Missing App configuration value: "{$valueName}"'),(0,u.Z)(T,"not-registered","Firebase Installation is not registered."),(0,u.Z)(T,"installation-not-found","Firebase Installation not found."),(0,u.Z)(T,"request-failed",'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"'),(0,u.Z)(T,"app-offline","Could not process request. Application offline."),(0,u.Z)(T,"delete-pending-registration","Can't delete installation while there is a pending registration request."),T),j=new f.LL("installations","Installations",U);function F(e){return e instanceof f.ZR&&e.code.includes("request-failed")}function V(e){var t=e.projectId;return"".concat(L,"/projects/").concat(t,"/installations")}function B(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}function G(e,t){return Z.apply(this,arguments)}function Z(){return(Z=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:return r=e.sent,i=r.error,e.abrupt("return",j.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function W(e,t){var n=t.refreshToken,r=q(e);return r.append("Authorization",function(e){return"".concat(P," ").concat(e)}(n)),r}function H(e){return K.apply(this,arguments)}function K(){return(K=(0,c.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:if(!((n=e.sent).status>=500&&n.status<600)){e.next=5;break}return e.abrupt("return",t());case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return Y.apply(this,arguments)}function Y(){return(Y=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c,u,l,d,f,p,h,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,o=n.fid,s=V(r),c=q(r),!(u=i.getImmediate({optional:!0}))){e.next=10;break}return e.next=8,u.getHeartbeatsHeader();case 8:(l=e.sent)&&c.append("x-firebase-client",l);case 10:return d={fid:o,authVersion:P,appId:r.appId,sdkVersion:D},f={method:"POST",headers:c,body:JSON.stringify(d)},e.next=14,H((function(){return fetch(s,f)}));case 14:if(!(p=e.sent).ok){e.next=23;break}return e.next=18,p.json();case 18:return h=e.sent,v={fid:h.fid||o,registrationStatus:2,refreshToken:h.refreshToken,authToken:B(h.authToken)},e.abrupt("return",v);case 23:return e.next=25,G("Create Installation",p);case 25:throw e.sent;case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return new Promise((function(t){setTimeout(t,e)}))}var X=/^[cdef][\w-]{21}$/,Q="";function $(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){var t=(n=e,btoa(String.fromCharCode.apply(String,(0,s.Z)(n))).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return X.test(t)?t:Q}catch(n){return Q}}function ee(e){return"".concat(e.appName,"!").concat(e.appId)}var te=new Map;function ne(e,t){var n=ee(e);re(n,t),function(e,t){var n=ae();n&&n.postMessage({key:e,fid:t});oe()}(n,t)}function re(e,t){var n=te.get(e);if(n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t)}}catch(a){i.e(a)}finally{i.f()}}}var ie=null;function ae(){return!ie&&"BroadcastChannel"in self&&((ie=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){re(e.data.key,e.data.fid)}),ie}function oe(){0===te.size&&ie&&(ie.close(),ie=null)}var se="firebase-installations-database",ce=1,ue="firebase-installations-store",le=null;function de(){return le||(le=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),c=S(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(S(s.result),e.oldVersion,e.newVersion,S(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),c.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(){return a()}))})).catch((function(){})),c}(se,ce,{upgrade:function(e,t){if(0===t)e.createObjectStore(ue)}})),le}function fe(e,t){return pe.apply(this,arguments)}function pe(){return(pe=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ee(t),e.next=3,de();case 3:return i=e.sent,o=i.transaction(ue,"readwrite"),s=o.objectStore(ue),e.next=8,s.get(r);case 8:return c=e.sent,e.next=11,s.put(n,r);case 11:return e.next=13,o.done;case 13:return c&&c.fid===n.fid||ne(t,n.fid),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return ve.apply(this,arguments)}function ve(){return(ve=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ee(t),e.next=3,de();case 3:return r=e.sent,i=r.transaction(ue,"readwrite"),e.next=7,i.objectStore(ue).delete(n);case 7:return e.next=9,i.done;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e,t){return ge.apply(this,arguments)}function ge(){return(ge=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ee(t),e.next=3,de();case 3:return i=e.sent,o=i.transaction(ue,"readwrite"),s=o.objectStore(ue),e.next=8,s.get(r);case 8:if(c=e.sent,void 0!==(u=n(c))){e.next=15;break}return e.next=13,s.delete(r);case 13:e.next=17;break;case 15:return e.next=17,s.put(u,r);case 17:return e.next=19,o.done;case 19:return!u||c&&c.fid===u.fid||ne(t,u.fid),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){return _e.apply(this,arguments)}function _e(){return(_e=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me(t.appConfig,(function(e){var r=Ee(e),i=be(t,r);return n=i.registrationPromise,i.installationEntry}));case 2:if((r=e.sent).fid!==Q){e.next=8;break}return e.next=6,n;case 6:return e.t0=e.sent,e.abrupt("return",{installationEntry:e.t0});case 8:return e.abrupt("return",{installationEntry:r,registrationPromise:n});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return Ie(e||{fid:$(),registrationStatus:0})}function be(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(j.create("app-offline"))};var n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=function(e,t){return we.apply(this,arguments)}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Se(e)}:{installationEntry:t}}function we(){return(we=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z(t,n);case 3:return r=e.sent,e.abrupt("return",fe(t.appConfig,r));case 7:if(e.prev=7,e.t0=e.catch(0),!F(e.t0)||409!==e.t0.customData.serverCode){e.next=14;break}return e.next=12,he(t.appConfig);case 12:e.next=16;break;case 14:return e.next=16,fe(t.appConfig,{fid:n.fid,registrationStatus:0});case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Se(e){return ke.apply(this,arguments)}function ke(){return(ke=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t.appConfig);case 2:n=e.sent;case 3:if(1!==n.registrationStatus){e.next=11;break}return e.next=6,J(100);case 6:return e.next=8,Te(t.appConfig);case 8:n=e.sent,e.next=3;break;case 11:if(0!==n.registrationStatus){e.next=22;break}return e.next=14,ye(t);case 14:if(r=e.sent,i=r.installationEntry,!(o=r.registrationPromise)){e.next=21;break}return e.abrupt("return",o);case 21:return e.abrupt("return",i);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){return me(e,(function(e){if(!e)throw j.create("installation-not-found");return Ie(e)}))}function Ie(e){return 1===(t=e).registrationStatus&&t.registrationTime+x<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}function Ce(e,t){return Re.apply(this,arguments)}function Re(){return(Re=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c,u,l,d,f,p,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,o=Ae(r,n),s=W(r,n),!(c=i.getImmediate({optional:!0}))){e.next=9;break}return e.next=7,c.getHeartbeatsHeader();case 7:(u=e.sent)&&s.append("x-firebase-client",u);case 9:return l={installation:{sdkVersion:D,appId:r.appId}},d={method:"POST",headers:s,body:JSON.stringify(l)},e.next=13,H((function(){return fetch(o,d)}));case 13:if(!(f=e.sent).ok){e.next=22;break}return e.next=17,f.json();case 17:return p=e.sent,h=B(p),e.abrupt("return",h);case 22:return e.next=24,G("Generate Auth Token",f);case 24:throw e.sent;case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e,t){var n=t.fid;return"".concat(V(e),"/").concat(n,"/authTokens:generate")}function Oe(e){return Ne.apply(this,arguments)}function Ne(){return Ne=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],e.next=3,me(t.appConfig,(function(e){if(!Ue(e))throw j.create("not-registered");var i=e.authToken;if(!n&&je(i))return e;if(1===i.requestStatus)return r=xe(t,n),e;if(!navigator.onLine)throw j.create("app-offline");var a=Fe(e);return r=Le(t,a),a}));case 3:if(i=e.sent,!r){e.next=10;break}return e.next=7,r;case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=i.authToken;case 11:return o=e.t0,e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),Ne.apply(this,arguments)}function xe(e,t){return De.apply(this,arguments)}function De(){return(De=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pe(t.appConfig);case 2:r=e.sent;case 3:if(1!==r.authToken.requestStatus){e.next=11;break}return e.next=6,J(100);case 6:return e.next=8,Pe(t.appConfig);case 8:r=e.sent,e.next=3;break;case 11:if(0!==(i=r.authToken).requestStatus){e.next=16;break}return e.abrupt("return",Oe(t,n));case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e){return me(e,(function(e){if(!Ue(e))throw j.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+x<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e}))}function Le(e,t){return Me.apply(this,arguments)}function Me(){return(Me=(0,c.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ce(t,n);case 3:return r=e.sent,i=Object.assign(Object.assign({},n),{authToken:r}),e.next=7,fe(t.appConfig,i);case 7:return e.abrupt("return",r);case 10:if(e.prev=10,e.t0=e.catch(0),!F(e.t0)||401!==e.t0.customData.serverCode&&404!==e.t0.customData.serverCode){e.next=17;break}return e.next=15,he(t.appConfig);case 15:e.next=20;break;case 17:return o=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),e.next=20,fe(t.appConfig,o);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function Ue(e){return void 0!==e&&2===e.registrationStatus}function je(e){return 2===e.requestStatus&&!function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+M}(e)}function Fe(e){var t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function Ve(){return(Ve=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,ye(n);case 3:return r=e.sent,i=r.installationEntry,(o=r.registrationPromise)?o.catch(console.error):Oe(n).catch(console.error),e.abrupt("return",i.fid);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(){return Be=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],r=t,e.next=4,Ge(r);case 4:return e.next=6,Oe(r,n);case 6:return i=e.sent,e.abrupt("return",i.token);case 8:case"end":return e.stop()}}),e)}))),Be.apply(this,arguments)}function Ge(e){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,c.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t);case 2:if(n=e.sent,!(r=n.registrationPromise)){e.next=7;break}return e.next=7,r;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(e){return j.create("missing-app-config-values",{valueName:e})}var We="installations",He=function(e){var t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw qe("App Configuration");if(!e.name)throw qe("App Name");for(var t=0,n=["projectId","apiKey","appId"];t<n.length;t++){var r=n[t];if(!e.options[r])throw qe(r)}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,l.qX)(t,"heartbeat"),_delete:function(){return Promise.resolve()}}},Ke=function(e){var t=e.getProvider("app").getImmediate(),n=(0,l.qX)(t,We).getImmediate(),r={getId:function(){return function(e){return Ve.apply(this,arguments)}(n)},getToken:function(e){return function(e){return Be.apply(this,arguments)}(n,e)}};return r};(0,l.Xd)(new d.wA(We,He,"PUBLIC")),(0,l.Xd)(new d.wA("installations-internal",Ke,"PRIVATE")),(0,l.KN)(O,N),(0,l.KN)(O,N,"esm2017")},6781:function(e,t,n){"use strict";n.d(t,{Yd:function(){return p},in:function(){return i}});var r,i,a=n(5671),o=n(3144),s=n(4942),c=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var u={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},l=i.INFO,d=(r={},(0,s.Z)(r,i.DEBUG,"log"),(0,s.Z)(r,i.VERBOSE,"log"),(0,s.Z)(r,i.INFO,"info"),(0,s.Z)(r,i.WARN,"warn"),(0,s.Z)(r,i.ERROR,"error"),r),f=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=d[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},p=function(){function e(t){(0,a.Z)(this,e),this.name=t,this._logLevel=l,this._logHandler=f,this._userLogHandler=null,c.push(this)}return(0,o.Z)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?u[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}()},6635:function(e,t,n){"use strict";n.d(t,{w9:function(){return kt},v0:function(){return zr},Aj:function(){return Xt},aF:function(){return Zt},e5:function(){return Kt},gQ:function(){return zt}});var r=n(1752),i=n(1120),a=n(7326),o=n(136),s=n(9388),c=n(7762),u=n(4165),l=n(9439),d=n(5861),f=n(3433),p=n(4942),h=n(3144),v=n(5671),m=n(5854),g=n(7825),y=n(6781);function _(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var E,b=n(3258);function w(e){return void 0!==e&&void 0!==e.enterprise}var S=(0,h.Z)((function e(t){if((0,v.Z)(this,e),this.siteKey="",this.emailPasswordEnabled=!1,void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some((function(e){return"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState}))}));function k(){return(0,p.Z)({},"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.")}var T=k,I=new m.LL("auth","Firebase",k()),C=new y.Yd("@firebase/auth");function R(e){if(C.logLevel<=y.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];C.warn.apply(C,["Auth (".concat(g.Jn,"): ").concat(e)].concat(n))}}function A(e){if(C.logLevel<=y.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];C.error.apply(C,["Auth (".concat(g.Jn,"): ").concat(e)].concat(n))}}function O(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw D.apply(void 0,[e].concat(n))}function N(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.apply(void 0,[e].concat(n))}function x(e,t,n){var r=Object.assign(Object.assign({},T()),(0,p.Z)({},t,n));return new m.LL("auth","Firebase",r).create(t,{appName:e.name})}function D(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){var i,a=n[0],o=(0,f.Z)(n.slice(1));return o[0]&&(o[0].appName=e.name),(i=e._errorFactory).create.apply(i,[a].concat((0,f.Z)(o)))}return I.create.apply(I,[e].concat(n))}function P(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw D.apply(void 0,[t].concat(r))}}function L(e){var t="INTERNAL ASSERTION FAILED: "+e;throw A(t),new Error(t)}function M(e,t){e||L(t)}function U(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function j(){return"http:"===F()||"https:"===F()}function F(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}var V=function(){function e(t,n){(0,v.Z)(this,e),this.shortDelay=t,this.longDelay=n,M(n>t,"Short delay should be less than long delay!"),this.isMobile=(0,m.uI)()||(0,m.b$)()}return(0,h.Z)(e,[{key:"get",value:function(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(j()||(0,m.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}]),e}();function B(e,t){M(e.emulator,"Emulator should always be set here");var n=e.emulator.url;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}var G=function(){function e(){(0,v.Z)(this,e)}return(0,h.Z)(e,null,[{key:"initialize",value:function(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}},{key:"fetch",value:function(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void L("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"headers",value:function(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void L("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void L("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}]),e}(),Z=(E={},(0,p.Z)(E,"CREDENTIAL_MISMATCH","custom-token-mismatch"),(0,p.Z)(E,"MISSING_CUSTOM_TOKEN","internal-error"),(0,p.Z)(E,"INVALID_IDENTIFIER","invalid-email"),(0,p.Z)(E,"MISSING_CONTINUE_URI","internal-error"),(0,p.Z)(E,"INVALID_PASSWORD","wrong-password"),(0,p.Z)(E,"MISSING_PASSWORD","missing-password"),(0,p.Z)(E,"EMAIL_EXISTS","email-already-in-use"),(0,p.Z)(E,"PASSWORD_LOGIN_DISABLED","operation-not-allowed"),(0,p.Z)(E,"INVALID_IDP_RESPONSE","invalid-credential"),(0,p.Z)(E,"INVALID_PENDING_TOKEN","invalid-credential"),(0,p.Z)(E,"FEDERATED_USER_ID_ALREADY_LINKED","credential-already-in-use"),(0,p.Z)(E,"MISSING_REQ_TYPE","internal-error"),(0,p.Z)(E,"EMAIL_NOT_FOUND","user-not-found"),(0,p.Z)(E,"RESET_PASSWORD_EXCEED_LIMIT","too-many-requests"),(0,p.Z)(E,"EXPIRED_OOB_CODE","expired-action-code"),(0,p.Z)(E,"INVALID_OOB_CODE","invalid-action-code"),(0,p.Z)(E,"MISSING_OOB_CODE","internal-error"),(0,p.Z)(E,"CREDENTIAL_TOO_OLD_LOGIN_AGAIN","requires-recent-login"),(0,p.Z)(E,"INVALID_ID_TOKEN","invalid-user-token"),(0,p.Z)(E,"TOKEN_EXPIRED","user-token-expired"),(0,p.Z)(E,"USER_NOT_FOUND","user-token-expired"),(0,p.Z)(E,"TOO_MANY_ATTEMPTS_TRY_LATER","too-many-requests"),(0,p.Z)(E,"PASSWORD_DOES_NOT_MEET_REQUIREMENTS","password-does-not-meet-requirements"),(0,p.Z)(E,"INVALID_CODE","invalid-verification-code"),(0,p.Z)(E,"INVALID_SESSION_INFO","invalid-verification-id"),(0,p.Z)(E,"INVALID_TEMPORARY_PROOF","invalid-credential"),(0,p.Z)(E,"MISSING_SESSION_INFO","missing-verification-id"),(0,p.Z)(E,"SESSION_EXPIRED","code-expired"),(0,p.Z)(E,"MISSING_ANDROID_PACKAGE_NAME","missing-android-pkg-name"),(0,p.Z)(E,"UNAUTHORIZED_DOMAIN","unauthorized-continue-uri"),(0,p.Z)(E,"INVALID_OAUTH_CLIENT_ID","invalid-oauth-client-id"),(0,p.Z)(E,"ADMIN_ONLY_OPERATION","admin-restricted-operation"),(0,p.Z)(E,"INVALID_MFA_PENDING_CREDENTIAL","invalid-multi-factor-session"),(0,p.Z)(E,"MFA_ENROLLMENT_NOT_FOUND","multi-factor-info-not-found"),(0,p.Z)(E,"MISSING_MFA_ENROLLMENT_ID","missing-multi-factor-info"),(0,p.Z)(E,"MISSING_MFA_PENDING_CREDENTIAL","missing-multi-factor-session"),(0,p.Z)(E,"SECOND_FACTOR_EXISTS","second-factor-already-in-use"),(0,p.Z)(E,"SECOND_FACTOR_LIMIT_EXCEEDED","maximum-second-factor-count-exceeded"),(0,p.Z)(E,"BLOCKING_FUNCTION_ERROR_RESPONSE","internal-error"),(0,p.Z)(E,"RECAPTCHA_NOT_ENABLED","recaptcha-not-enabled"),(0,p.Z)(E,"MISSING_RECAPTCHA_TOKEN","missing-recaptcha-token"),(0,p.Z)(E,"INVALID_RECAPTCHA_TOKEN","invalid-recaptcha-token"),(0,p.Z)(E,"INVALID_RECAPTCHA_ACTION","invalid-recaptcha-action"),(0,p.Z)(E,"MISSING_CLIENT_TYPE","missing-client-type"),(0,p.Z)(E,"MISSING_RECAPTCHA_VERSION","missing-recaptcha-version"),(0,p.Z)(E,"INVALID_RECAPTCHA_VERSION","invalid-recaptcha-version"),(0,p.Z)(E,"INVALID_REQ_TYPE","invalid-req-type"),E),q=new V(3e4,6e4);function W(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function H(e,t,n,r){return K.apply(this,arguments)}function K(){return K=(0,d.Z)((0,u.Z)().mark((function e(t,n,r,i){var a,o=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},e.abrupt("return",z(t,a,(0,d.Z)((0,u.Z)().mark((function e(){var a,o,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},o={},i&&("GET"===n?o=i:a={body:JSON.stringify(i)}),s=(0,m.xO)(Object.assign({key:t.config.apiKey},o)).slice(1),e.next=6,t._getAdditionalHeaders();case 6:return(c=e.sent)["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode),e.abrupt("return",G.fetch()(Q(t,t.config.apiHost,r,s),Object.assign({method:n,headers:c,referrerPolicy:"no-referrer"},a)));case 10:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function z(e,t,n){return Y.apply(this,arguments)}function Y(){return(Y=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){var i,a,o,s,c,d,f,p,h,v;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._canInitEmulator=!1,i=Object.assign(Object.assign({},Z),n),e.prev=2,a=new $(t),e.next=6,Promise.race([r(),a.promise]);case 6:return o=e.sent,a.clearNetworkTimeout(),e.next=10,o.json();case 10:if(!("needConfirmation"in(s=e.sent))){e.next=13;break}throw ee(t,"account-exists-with-different-credential",s);case 13:if(!o.ok||"errorMessage"in s){e.next=17;break}return e.abrupt("return",s);case 17:if(c=o.ok?s.errorMessage:s.error.message,d=c.split(" : "),f=(0,l.Z)(d,2),p=f[0],h=f[1],"FEDERATED_USER_ID_ALREADY_LINKED"!==p){e.next=23;break}throw ee(t,"credential-already-in-use",s);case 23:if("EMAIL_EXISTS"!==p){e.next=27;break}throw ee(t,"email-already-in-use",s);case 27:if("USER_DISABLED"!==p){e.next=29;break}throw ee(t,"user-disabled",s);case 29:if(v=i[p]||p.toLowerCase().replace(/[_\s]+/g,"-"),!h){e.next=34;break}throw x(t,v,h);case 34:O(t,v);case 35:e.next=42;break;case 37:if(e.prev=37,e.t0=e.catch(2),!(e.t0 instanceof m.ZR)){e.next=41;break}throw e.t0;case 41:O(t,"network-request-failed",{message:String(e.t0)});case 42:case"end":return e.stop()}}),e,null,[[2,37]])})))).apply(this,arguments)}function J(e,t,n,r){return X.apply(this,arguments)}function X(){return X=(0,d.Z)((0,u.Z)().mark((function e(t,n,r,i){var a,o,s=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>4&&void 0!==s[4]?s[4]:{},e.next=3,H(t,n,r,i,a);case 3:return"mfaPendingCredential"in(o=e.sent)&&O(t,"multi-factor-auth-required",{_serverResponse:o}),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function Q(e,t,n,r){var i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?B(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}var $=function(){function e(t){var n=this;(0,v.Z)(this,e),this.auth=t,this.timer=null,this.promise=new Promise((function(e,t){n.timer=setTimeout((function(){return t(N(n.auth,"network-request-failed"))}),q.get())}))}return(0,h.Z)(e,[{key:"clearNetworkTimeout",value:function(){clearTimeout(this.timer)}}]),e}();function ee(e,t,n){var r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);var i=N(e,t,r);return i.customData._tokenResponse=n,i}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"GET","/v2/recaptchaConfig",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){return ie.apply(this,arguments)}function ie(){return(ie=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:delete",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t){return oe.apply(this,arguments)}function oe(){return(oe=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:lookup",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(n){}}function ce(){return ce=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],r=(0,m.m9)(t),e.next=4,r.getIdToken(n);case 4:return i=e.sent,P((a=le(i))&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error"),o="object"===typeof a.firebase?a.firebase:void 0,s=null===o||void 0===o?void 0:o.sign_in_provider,e.abrupt("return",{claims:a,token:i,authTime:se(ue(a.auth_time)),issuedAtTime:se(ue(a.iat)),expirationTime:se(ue(a.exp)),signInProvider:s||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null});case 10:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function ue(e){return 1e3*Number(e)}function le(e){var t=e.split("."),n=(0,l.Z)(t,3),r=n[0],i=n[1],a=n[2];if(void 0===r||void 0===i||void 0===a)return A("JWT malformed, contained fewer than 3 sections"),null;try{var o=(0,m.tV)(i);return o?JSON.parse(o):(A("Failed to decode base64 JWT payload"),null)}catch(s){return A("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function de(e,t){return fe.apply(this,arguments)}function fe(){return fe=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>2&&void 0!==r[2]&&r[2])){e.next=3;break}return e.abrupt("return",n);case 3:return e.prev=3,e.next=6,n;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof m.ZR&&pe(e.t0))){e.next=15;break}if(t.auth.currentUser!==t){e.next=15;break}return e.next=15,t.auth.signOut();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),fe.apply(this,arguments)}function pe(e){var t=e.code;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}var he=function(){function e(t){(0,v.Z)(this,e),this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}return(0,h.Z)(e,[{key:"_start",value:function(){this.isRunning||(this.isRunning=!0,this.schedule())}},{key:"_stop",value:function(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}},{key:"getInterval",value:function(e){var t;if(e){var n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}this.errorBackoff=3e4;var r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}},{key:"schedule",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isRunning){var n=this.getInterval(t);this.timerId=setTimeout((0,d.Z)((0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.iteration();case 2:case"end":return t.stop()}}),t)}))),n)}}},{key:"iteration",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.user.getIdToken(!0);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")&&this.schedule(!0),e.abrupt("return");case 9:this.schedule();case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),ve=function(){function e(t,n){(0,v.Z)(this,e),this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}return(0,h.Z)(e,[{key:"_initializeTime",value:function(){this.lastSignInTime=se(this.lastLoginAt),this.creationTime=se(this.createdAt)}},{key:"_copy",value:function(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}},{key:"toJSON",value:function(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}]),e}();function me(e){return ge.apply(this,arguments)}function ge(){return(ge=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,c,l,d,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.auth,e.next=3,t.getIdToken();case 3:return i=e.sent,e.next=6,de(t,ae(r,{idToken:i}));case 6:P(null===(a=e.sent)||void 0===a?void 0:a.users.length,r,"internal-error"),o=a.users[0],t._notifyReloadListener(o),s=(null===(n=o.providerUserInfo)||void 0===n?void 0:n.length)?o.providerUserInfo.map((function(e){var t=e.providerId,n=_(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=_e(t.providerData,s),l=t.isAnonymous,d=!(t.email&&o.passwordHash)&&!(null===c||void 0===c?void 0:c.length),f=!!l&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new ve(o.createdAt,o.lastLoginAt),isAnonymous:f},Object.assign(t,p);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return(ye=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.m9)(t),e.next=3,me(n);case 3:return e.next=5,n.auth._persistUserIfCurrent(n);case 5:n.auth._notifyListenersIfCurrent(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e,t){var n=e.filter((function(e){return!t.some((function(t){return t.providerId===e.providerId}))}));return[].concat((0,f.Z)(n),(0,f.Z)(t))}function Ee(e,t){return be.apply(this,arguments)}function be(){return(be=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t,{},(0,d.Z)((0,u.Z)().mark((function e(){var r,i,a,o,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,m.xO)({grant_type:"refresh_token",refresh_token:n}).slice(1),i=t.config,a=i.tokenApiHost,o=i.apiKey,s=Q(t,a,"/v1/token","key=".concat(o)),e.next=5,t._getAdditionalHeaders();case 5:return(c=e.sent)["Content-Type"]="application/x-www-form-urlencoded",e.abrupt("return",G.fetch()(s,{method:"POST",headers:c,body:r}));case 8:case"end":return e.stop()}}),e)}))));case 2:return r=e.sent,e.abrupt("return",{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=function(){function e(){(0,v.Z)(this,e),this.refreshToken=null,this.accessToken=null,this.expirationTime=null}return(0,h.Z)(e,[{key:"isExpired",get:function(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function(e){P(e.idToken,"internal-error"),P("undefined"!==typeof e.idToken,"internal-error"),P("undefined"!==typeof e.refreshToken,"internal-error");var t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){var t=le(e);return P(t,"internal-error"),P("undefined"!==typeof t.exp,"internal-error"),P("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}},{key:"getToken",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],P(!this.accessToken||this.refreshToken,t,"user-token-expired"),n||!this.accessToken||this.isExpired){e.next=4;break}return e.abrupt("return",this.accessToken);case 4:if(!this.refreshToken){e.next=8;break}return e.next=7,this.refresh(t,this.refreshToken);case 7:return e.abrupt("return",this.accessToken);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearRefreshToken",value:function(){this.refreshToken=null}},{key:"refresh",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee(t,n);case 2:r=e.sent,i=r.accessToken,a=r.refreshToken,o=r.expiresIn,this.updateTokensAndExpiration(i,a,Number(o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTokensAndExpiration",value:function(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}},{key:"toJSON",value:function(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}},{key:"_clone",value:function(){return Object.assign(new e,this.toJSON())}},{key:"_performRefresh",value:function(){return L("not implemented")}}],[{key:"fromJSON",value:function(t,n){var r=n.refreshToken,i=n.accessToken,a=n.expirationTime,o=new e;return r&&(P("string"===typeof r,"internal-error",{appName:t}),o.refreshToken=r),i&&(P("string"===typeof i,"internal-error",{appName:t}),o.accessToken=i),a&&(P("number"===typeof a,"internal-error",{appName:t}),o.expirationTime=a),o}}]),e}();function Se(e,t){P("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}var ke=function(){function e(t){(0,v.Z)(this,e);var n=t.uid,r=t.auth,i=t.stsTokenManager,a=_(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new he(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?(0,f.Z)(a.providerData):[],this.metadata=new ve(a.createdAt||void 0,a.lastLoginAt||void 0)}return(0,h.Z)(e,[{key:"getIdToken",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(this,this.stsTokenManager.getToken(this.auth,t));case 2:if(P(n=e.sent,this.auth,"internal-error"),this.accessToken===n){e.next=9;break}return this.accessToken=n,e.next=8,this.auth._persistUserIfCurrent(this);case 8:this.auth._notifyListenersIfCurrent(this);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdTokenResult",value:function(e){return function(e){return ce.apply(this,arguments)}(this,e)}},{key:"reload",value:function(){return function(e){return ye.apply(this,arguments)}(this)}},{key:"_assign",value:function(e){this!==e&&(P(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((function(e){return Object.assign({},e)})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}},{key:"_clone",value:function(t){var n=new e(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}},{key:"_onReload",value:function(e){P(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}},{key:"_notifyReloadListener",value:function(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}},{key:"_startProactiveRefresh",value:function(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],r=!1,t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),!n){e.next=6;break}return e.next=6,me(this);case 6:return e.next=8,this.auth._persistUserIfCurrent(this);case 8:r&&this.auth._notifyListenersIfCurrent(this);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdToken();case 2:return t=e.sent,e.next=5,de(this,re(this.auth,{idToken:t}));case 5:return this.stsTokenManager.clearRefreshToken(),e.abrupt("return",this.auth.signOut());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((function(e){return Object.assign({},e)})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function(t,n){var r,i,a,o,s,c,u,l,d=null!==(r=n.displayName)&&void 0!==r?r:void 0,f=null!==(i=n.email)&&void 0!==i?i:void 0,p=null!==(a=n.phoneNumber)&&void 0!==a?a:void 0,h=null!==(o=n.photoURL)&&void 0!==o?o:void 0,v=null!==(s=n.tenantId)&&void 0!==s?s:void 0,m=null!==(c=n._redirectEventId)&&void 0!==c?c:void 0,g=null!==(u=n.createdAt)&&void 0!==u?u:void 0,y=null!==(l=n.lastLoginAt)&&void 0!==l?l:void 0,_=n.uid,E=n.emailVerified,b=n.isAnonymous,w=n.providerData,S=n.stsTokenManager;P(_&&S,t,"internal-error");var k=we.fromJSON(this.name,S);P("string"===typeof _,t,"internal-error"),Se(d,t.name),Se(f,t.name),P("boolean"===typeof E,t,"internal-error"),P("boolean"===typeof b,t,"internal-error"),Se(p,t.name),Se(h,t.name),Se(v,t.name),Se(m,t.name),Se(g,t.name),Se(y,t.name);var T=new e({uid:_,auth:t,email:f,emailVerified:E,displayName:d,isAnonymous:b,photoURL:h,phoneNumber:p,tenantId:v,stsTokenManager:k,createdAt:g,lastLoginAt:y});return w&&Array.isArray(w)&&(T.providerData=w.map((function(e){return Object.assign({},e)}))),m&&(T._redirectEventId=m),T}},{key:"_fromIdTokenResponse",value:function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n,r){var i,a,o,s=arguments;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=s.length>2&&void 0!==s[2]&&s[2],(a=new we).updateFromServerResponse(r),o=new e({uid:r.localId,auth:n,stsTokenManager:a,isAnonymous:i}),t.next=6,me(o);case 6:return t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),Te=new Map;function Ie(e){M(e instanceof Function,"Expected a class definition");var t=Te.get(e);return t?(M(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Te.set(e,t),t)}var Ce=function(){function e(){(0,v.Z)(this,e),this.type="NONE",this.storage={}}return(0,h.Z)(e,[{key:"_isAvailable",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.storage[t]=n;case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.storage[t],e.abrupt("return",void 0===n?null:n);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this.storage[t];case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),e}();Ce.type="NONE";var Re=Ce;function Ae(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}var Oe=function(){function e(t,n,r){(0,v.Z)(this,e),this.persistence=t,this.auth=n,this.userKey=r;var i=this.auth,a=i.config,o=i.name;this.fullUserKey=Ae(this.userKey,a.apiKey,o),this.fullPersistenceKey=Ae("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}return(0,h.Z)(e,[{key:"setCurrentUser",value:function(e){return this.persistence._set(this.fullUserKey,e.toJSON())}},{key:"getCurrentUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.persistence._get(this.fullUserKey);case 2:return t=e.sent,e.abrupt("return",t?ke._fromJSON(this.auth,t):null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeCurrentUser",value:function(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistence!==t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getCurrentUser();case 4:return n=e.sent,e.next=7,this.removeCurrentUser();case 7:if(this.persistence=t,!n){e.next=10;break}return e.abrupt("return",this.setCurrentUser(n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n,r){var i,a,o,s,l,f,p,h,v,m,g,y=arguments;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=y.length>2&&void 0!==y[2]?y[2]:"authUser",r.length){t.next=3;break}return t.abrupt("return",new e(Ie(Re),n,i));case 3:return t.next=5,Promise.all(r.map(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._isAvailable();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",t);case 4:return e.abrupt("return",void 0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:a=t.sent.filter((function(e){return e})),o=a[0]||Ie(Re),s=Ae(i,n.config.apiKey,n.name),l=null,f=(0,c.Z)(r),t.prev=10,f.s();case 12:if((p=f.n()).done){t.next=29;break}return h=p.value,t.prev=14,t.next=17,h._get(s);case 17:if(!(v=t.sent)){t.next=23;break}return m=ke._fromJSON(n,v),h!==o&&(l=m),o=h,t.abrupt("break",29);case 23:t.next=27;break;case 25:t.prev=25,t.t0=t.catch(14);case 27:t.next=12;break;case 29:t.next=34;break;case 31:t.prev=31,t.t1=t.catch(10),f.e(t.t1);case 34:return t.prev=34,f.f(),t.finish(34);case 37:if(g=a.filter((function(e){return e._shouldAllowMigration})),o._shouldAllowMigration&&g.length){t.next=40;break}return t.abrupt("return",new e(o,n,i));case 40:if(o=g[0],!l){t.next=44;break}return t.next=44,o._set(s,l.toJSON());case 44:return t.next=46,Promise.all(r.map(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===o){e.next=8;break}return e.prev=1,e.next=4,t._remove(s);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()));case 46:return t.abrupt("return",new e(o,n,i));case 47:case"end":return t.stop()}}),t,null,[[10,31,34,37],[14,25]])})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function Ne(e){var t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Le(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(xe(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ue(t))return"Blackberry";if(je(t))return"Webos";if(De(t))return"Safari";if((t.includes("chrome/")||Pe(t))&&!t.includes("edge/"))return"Chrome";if(Me(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null===n||void 0===n?void 0:n.length)?n[1]:"Other"}function xe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/firefox\//i.test(e)}function De(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/crios\//i.test(e)}function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/iemobile/i.test(e)}function Me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/android/i.test(e)}function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/blackberry/i.test(e)}function je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/webos/i.test(e)}function Fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return Fe(e)||Me(e)||je(e)||Ue(e)||/windows phone/i.test(e)||Le(e)}function Be(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Ne((0,m.z$)());break;case"Worker":t="".concat(Ne((0,m.z$)()),"-").concat(e);break;default:t=e}var r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(g.Jn,"/").concat(r)}var Ge=function(){function e(t){(0,v.Z)(this,e),this.auth=t,this.queue=[]}return(0,h.Z)(e,[{key:"pushCallback",value:function(e,t){var n=this,r=function(t){return new Promise((function(n,r){try{n(e(t))}catch(i){r(i)}}))};r.onAbort=t,this.queue.push(r);var i=this.queue.length-1;return function(){n.queue[i]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.auth.currentUser!==t){e.next=2;break}return e.abrupt("return");case 2:n=[],e.prev=3,r=(0,c.Z)(this.queue),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=14;break}return a=i.value,e.next=11,a(t);case 11:a.onAbort&&n.push(a.onAbort);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:e.next=30;break;case 24:e.prev=24,e.t1=e.catch(3),n.reverse(),o=(0,c.Z)(n);try{for(o.s();!(s=o.n()).done;){l=s.value;try{l()}catch(u){}}}catch(d){o.e(d)}finally{o.f()}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===e.t1||void 0===e.t1?void 0:e.t1.message});case 30:case"end":return e.stop()}}),e,this,[[3,24],[5,16,19,22]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ze(e){return qe.apply(this,arguments)}function qe(){return qe=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",H(t,"GET","/v2/passwordPolicy",W(t,n)));case 2:case"end":return e.stop()}}),e)}))),qe.apply(this,arguments)}var We=function(){function e(t){var n,r,i,a;(0,v.Z)(this,e);var o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(n=o.minPasswordLength)&&void 0!==n?n:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(r=t.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(a=t.forceUpgradeOnSignin)&&void 0!==a&&a,this.schemaVersion=t.schemaVersion}return(0,h.Z)(e,[{key:"validatePassword",value:function(e){var t,n,r,i,a,o,s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null===(t=s.meetsMinPasswordLength)||void 0===t||t),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(r=s.containsLowercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(i=s.containsUppercaseLetter)||void 0===i||i),s.isValid&&(s.isValid=null===(a=s.containsNumericCharacter)||void 0===a||a),s.isValid&&(s.isValid=null===(o=s.containsNonAlphanumericCharacter)||void 0===o||o),s}},{key:"validatePasswordLengthOptions",value:function(e,t){var n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}},{key:"validatePasswordCharacterOptions",value:function(e,t){var n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(var r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}},{key:"updatePasswordCharacterOptionsStatuses",value:function(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}]),e}(),He=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ze(this),this.idTokenSubscription=new ze(this),this.beforeStateQueue=new Ge(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=I,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}return(0,h.Z)(e,[{key:"_initializeWithPersistence",value:function(e,t){var n=this;return t&&(this._popupRedirectResolver=Ie(t)),this._initializationPromise=this.queue((0,d.Z)((0,u.Z)().mark((function r(){var i,a;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n._deleted){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,Oe.create(n,e);case 4:if(n.persistenceManager=r.sent,!n._deleted){r.next=7;break}return r.abrupt("return");case 7:if(!(null===(i=n._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)){r.next=15;break}return r.prev=8,r.next=11,n._popupRedirectResolver._initialize(n);case 11:r.next=15;break;case 13:r.prev=13,r.t0=r.catch(8);case 15:return r.next=17,n.initializeCurrentUser(t);case 17:if(n.lastNotifiedUid=(null===(a=n.currentUser)||void 0===a?void 0:a.uid)||null,!n._deleted){r.next=20;break}return r.abrupt("return");case 20:n._isInitialized=!0;case 21:case"end":return r.stop()}}),r,null,[[8,13]])})))),this._initializationPromise}},{key:"_onStorageEvent",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deleted){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.assertedPersistence.getCurrentUser();case 4:if(t=e.sent,this.currentUser||t){e.next=7;break}return e.abrupt("return");case 7:if(!this.currentUser||!t||this.currentUser.uid!==t.uid){e.next=12;break}return this._currentUser._assign(t),e.next=11,this.currentUser.getIdToken();case 11:return e.abrupt("return");case 12:return e.next=14,this._updateCurrentUser(t,!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeCurrentUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.assertedPersistence.getCurrentUser();case 2:if(r=e.sent,i=r,a=!1,!t||!this.config.authDomain){e.next=14;break}return e.next=8,this.getOrInitRedirectPersistenceManager();case 8:return o=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null===i||void 0===i?void 0:i._redirectEventId,e.next=12,this.tryRedirectSignIn(t);case 12:c=e.sent,o&&o!==s||!(null===c||void 0===c?void 0:c.user)||(i=c.user,a=!0);case 14:if(i){e.next=16;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 16:if(i._redirectEventId){e.next=32;break}if(!a){e.next=27;break}return e.prev=18,e.next=21,this.beforeStateQueue.runMiddleware(i);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(18),i=r,this._popupRedirectResolver._overrideRedirectResult(this,(function(){return Promise.reject(e.t0)}));case 27:if(!i){e.next=31;break}return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 31:return e.abrupt("return",this.directlySetCurrentUser(null));case 32:return P(this._popupRedirectResolver,this,"argument-error"),e.next=35,this.getOrInitRedirectPersistenceManager();case 35:if(!this.redirectUser||this.redirectUser._redirectEventId!==i._redirectEventId){e.next=37;break}return e.abrupt("return",this.directlySetCurrentUser(i));case 37:return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 38:case"end":return e.stop()}}),e,this,[[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"tryRedirectSignIn",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,this._popupRedirectResolver._completeRedirectFn(this,t,!0);case 4:n=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,this._setRedirectUser(null);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reloadAndSetCurrentUserOrClear",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(t);case 3:e.next=9;break;case 5:if(e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")){e.next=9;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 9:return e.abrupt("return",this.directlySetCurrentUser(t));case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"useDeviceLanguage",value:function(){this.languageCode=function(){if("undefined"===typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}},{key:"_delete",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._deleted=!0;case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCurrentUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t?(0,m.m9)(t):null)&&P(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),e.abrupt("return",this._updateCurrentUser(n&&n._clone(this)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCurrentUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r=this,i=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],!this._deleted){e.next=3;break}return e.abrupt("return");case 3:if(t&&P(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n){e.next=7;break}return e.next=7,this.beforeStateQueue.runMiddleware(t);case 7:return e.abrupt("return",this.queue((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.directlySetCurrentUser(t);case 2:r.notifyAuthListeners();case 3:case"end":return e.stop()}}),e)})))));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeStateQueue.runMiddleware(null);case 2:if(!this.redirectPersistenceManager&&!this._popupRedirectResolver){e.next=5;break}return e.next=5,this._setRedirectUser(null);case 5:return e.abrupt("return",this._updateCurrentUser(null,!0));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setPersistence",value:function(e){var t=this;return this.queue((0,d.Z)((0,u.Z)().mark((function n(){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.assertedPersistence.setPersistence(Ie(e));case 2:case"end":return n.stop()}}),n)}))))}},{key:"_getRecaptchaConfig",value:function(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}},{key:"validatePassword",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._getPasswordPolicyInternal()){e.next=3;break}return e.next=3,this._updatePasswordPolicy();case 3:if((n=this._getPasswordPolicyInternal()).schemaVersion===this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION){e.next=6;break}return e.abrupt("return",Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})));case 6:return e.abrupt("return",n.validatePassword(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPasswordPolicyInternal",value:function(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}},{key:"_updatePasswordPolicy",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze(this);case 2:t=e.sent,n=new We(t),null===this.tenantId?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getPersistence",value:function(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function(e){this._errorFactory=new m.LL("auth","Firebase",e())}},{key:"onAuthStateChanged",value:function(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}},{key:"beforeAuthStateChanged",value:function(e,t){return this.beforeStateQueue.pushCallback(e,t)}},{key:"onIdTokenChanged",value:function(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}},{key:"authStateReady",value:function(){var e=this;return new Promise((function(t,n){if(e.currentUser)t();else var r=e.onAuthStateChanged((function(){r(),t()}),n)}))}},{key:"toJSON",value:function(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}},{key:"_setRedirectUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrInitRedirectPersistenceManager(n);case 2:return r=e.sent,e.abrupt("return",null===t?r.removeCurrentUser():r.setCurrentUser(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOrInitRedirectPersistenceManager",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.redirectPersistenceManager){e.next=9;break}return P(n=t&&Ie(t)||this._popupRedirectResolver,this,"argument-error"),e.next=5,Oe.create(this,[Ie(n._redirectPersistence)],"redirectUser");case 5:return this.redirectPersistenceManager=e.sent,e.next=8,this.redirectPersistenceManager.getCurrentUser();case 8:this.redirectUser=e.sent;case 9:return e.abrupt("return",this.redirectPersistenceManager);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_redirectUserForId",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInitialized){e.next=3;break}return e.next=3,this.queue((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))));case 3:if((null===(n=this._currentUser)||void 0===n?void 0:n._redirectEventId)!==t){e.next=5;break}return e.abrupt("return",this._currentUser);case 5:if((null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)!==t){e.next=7;break}return e.abrupt("return",this.redirectUser);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_persistUserIfCurrent",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.currentUser){e.next=2;break}return e.abrupt("return",this.queue((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.directlySetCurrentUser(t));case 1:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_notifyListenersIfCurrent",value:function(e){e===this.currentUser&&this.notifyAuthListeners()}},{key:"_key",value:function(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}},{key:"_stopProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}},{key:"_currentUser",get:function(){return this.currentUser}},{key:"notifyAuthListeners",value:function(){var e,t;if(this._isInitialized){this.idTokenSubscription.next(this.currentUser);var n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}}},{key:"registerStateListener",value:function(e,t,n,r){var i=this;if(this._deleted)return function(){};var a="function"===typeof t?t:t.next.bind(t),o=!1,s=this._isInitialized?Promise.resolve():this._initializationPromise;if(P(s,this,"internal-error"),s.then((function(){o||a(i.currentUser)})),"function"===typeof t){var c=e.addObserver(t,n,r);return function(){o=!0,c()}}var u=e.addObserver(t);return function(){o=!0,u()}}},{key:"directlySetCurrentUser",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,!t){e.next=8;break}return e.next=6,this.assertedPersistence.setCurrentUser(t);case 6:e.next=10;break;case 8:return e.next=10,this.assertedPersistence.removeCurrentUser();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){return this.operations=this.operations.then(e,e),this.operations}},{key:"assertedPersistence",get:function(){return P(this.persistenceManager,this,"internal-error"),this.persistenceManager}},{key:"_logFramework",value:function(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Be(this.config.clientPlatform,this._getFrameworks()))}},{key:"_getFrameworks",value:function(){return this.frameworks}},{key:"_getAdditionalHeaders",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n,r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.Z)({},"X-Client-Version",this.clientVersion),this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId),e.next=4,null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();case 4:return(r=e.sent)&&(n["X-Firebase-Client"]=r),e.next=8,this._getAppCheckToken();case 8:return(i=e.sent)&&(n["X-Firebase-AppCheck"]=i),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getAppCheckToken",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();case 2:return(null===(n=e.sent)||void 0===n?void 0:n.error)&&R("Error while retrieving App Check token: ".concat(n.error)),e.abrupt("return",null===n||void 0===n?void 0:n.token);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function Ke(e){return(0,m.m9)(e)}var ze=function(){function e(t){var n=this;(0,v.Z)(this,e),this.auth=t,this.observer=null,this.addObserver=(0,m.ne)((function(e){return n.observer=e}))}return(0,h.Z)(e,[{key:"next",get:function(){return P(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}]),e}();function Ye(e){return new Promise((function(t,n){var r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=function(e){var t=N("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Je(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}var Xe=function(){function e(t){(0,v.Z)(this,e),this.type="recaptcha-enterprise",this.auth=Ke(t)}return(0,h.Z)(e,[{key:"verify",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n,r,i,a,o=this,s=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e,n,r){var i=window.grecaptcha;w(i)?i.enterprise.ready((function(){i.enterprise.execute(e,{action:t}).then((function(e){n(e)})).catch((function(){n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))},i=function(){return i=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=5;break}if(null!=t.tenantId||null==t._agentRecaptchaConfig){e.next=3;break}return e.abrupt("return",t._agentRecaptchaConfig.siteKey);case 3:if(null==t.tenantId||void 0===t._tenantRecaptchaConfigs[t.tenantId]){e.next=5;break}return e.abrupt("return",t._tenantRecaptchaConfigs[t.tenantId].siteKey);case 5:return e.abrupt("return",new Promise(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(n,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((function(e){if(void 0!==e.recaptchaKey){var i=new S(e);return null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,n(i.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))})).catch((function(e){r(e)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)},r=function(e){return i.apply(this,arguments)},t=s.length>0&&void 0!==s[0]?s[0]:"verify",n=s.length>1&&void 0!==s[1]&&s[1],e.abrupt("return",new Promise((function(e,t){r(o.auth).then((function(r){if(!n&&w(window.grecaptcha))a(r,e,t);else{if("undefined"===typeof window)return void t(new Error("RecaptchaVerifier is only supported in browser"));Ye("https://www.google.com/recaptcha/enterprise.js?render="+r).then((function(){a(r,e,t)})).catch((function(e){t(e)}))}})).catch((function(e){t(e)}))})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function Qe(e,t,n){return $e.apply(this,arguments)}function $e(){return $e=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){var i,a,o,s,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]&&c[3],a=new Xe(t),e.prev=2,e.next=5,a.verify(r);case 5:o=e.sent,e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,a.verify(r,!0);case 12:o=e.sent;case 13:return s=Object.assign({},n),i?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,null,[[2,8]])}))),$e.apply(this,arguments)}function et(e,t,n){var r=Ke(e);P(r._canInitEmulator,r,"emulator-config-failed"),P(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!!(null===n||void 0===n?void 0:n.disableWarnings),a=tt(t),o=function(e){var t=tt(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};var r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){var a=i[1];return{host:a,port:nt(r.substr(a.length+1))}}var o=r.split(":"),s=(0,l.Z)(o,2);return{host:s[0],port:nt(s[1])}}(t),s=o.host,c=o.port,u=null===c?"":":".concat(c);r.config.emulator={url:"".concat(a,"//").concat(s).concat(u,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:c,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function tt(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nt(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}var rt=function(){function e(t,n){(0,v.Z)(this,e),this.providerId=t,this.signInMethod=n}return(0,h.Z)(e,[{key:"toJSON",value:function(){return L("not implemented")}},{key:"_getIdTokenResponse",value:function(e){return L("not implemented")}},{key:"_linkToIdToken",value:function(e,t){return L("not implemented")}},{key:"_getReauthenticationResolver",value:function(e){return L("not implemented")}}]),e}();function it(e,t){return at.apply(this,arguments)}function at(){return(at=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:update",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e,t){return st.apply(this,arguments)}function st(){return(st=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(t,"POST","/v1/accounts:signInWithPassword",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t){return ut.apply(this,arguments)}function ut(){return(ut=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(t,"POST","/v1/accounts:signInWithEmailLink",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t){return dt.apply(this,arguments)}function dt(){return(dt=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(t,"POST","/v1/accounts:signInWithEmailLink",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ft=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,v.Z)(this,n),(a=t.call(this,"password",i))._email=e,a._password=r,a._tenantId=o,a}return(0,h.Z)(n,[{key:"toJSON",value:function(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?12:13;break;case 3:if(r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},!(null===(n=t._getRecaptchaConfig())||void 0===n?void 0:n.emailPasswordEnabled)){e.next=11;break}return e.next=7,Qe(t,r,"signInWithPassword");case 7:return i=e.sent,e.abrupt("return",ot(t,i));case 11:return e.abrupt("return",ot(t,r).catch(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(n){var i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.code!=="auth/".concat("missing-recaptcha-token")){e.next=8;break}return console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow."),e.next=4,Qe(t,r,"signInWithPassword");case 4:return i=e.sent,e.abrupt("return",ot(t,i));case 8:return e.abrupt("return",Promise.reject(n));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return e.abrupt("return",ct(t,{email:this._email,oobCode:this._password}));case 13:O(t,"internal-error");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_linkToIdToken",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?4:5;break;case 3:return e.abrupt("return",it(t,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password}));case 4:return e.abrupt("return",lt(t,{idToken:n,email:this._email,oobCode:this._password}));case 5:O(t,"internal-error");case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getReauthenticationResolver",value:function(e){return this._getIdTokenResponse(e)}}],[{key:"_fromEmailAndPassword",value:function(e,t){return new n(e,t,"password")}},{key:"_fromEmailAndCode",value:function(e,t){return new n(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}}]),n}(rt);function pt(e,t){return ht.apply(this,arguments)}function ht(){return(ht=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(t,"POST","/v1/accounts:signInWithIdp",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var vt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).pendingToken=null,e}return(0,h.Z)(n,[{key:"toJSON",value:function(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}},{key:"_getIdTokenResponse",value:function(e){return pt(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,t){var n=this.buildRequest();return n.idToken=t,pt(e,n)}},{key:"_getReauthenticationResolver",value:function(e){var t=this.buildRequest();return t.autoCreate=!1,pt(e,t)}},{key:"buildRequest",value:function(){var e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{var t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,m.xO)(t)}return e}}],[{key:"_fromParams",value:function(e){var t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):O("argument-error"),t}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e,r=t.providerId,i=t.signInMethod,a=_(t,["providerId","signInMethod"]);if(!r||!i)return null;var o=new n(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}}]),n}(rt);function mt(e,t){return gt.apply(this,arguments)}function gt(){return(gt=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:sendVerificationCode",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(){return(yt=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J(t,"POST","/v1/accounts:signInWithPhoneNumber",W(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(){return(_t=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t,"POST","/v1/accounts:signInWithPhoneNumber",W(t,n));case 2:if(!(r=e.sent).temporaryProof){e.next=5;break}throw ee(t,"account-exists-with-different-credential",r);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Et=(0,p.Z)({},"USER_NOT_FOUND","user-not-found");function bt(){return(bt=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign(Object.assign({},n),{operation:"REAUTH"}),e.abrupt("return",J(t,"POST","/v1/accounts:signInWithPhoneNumber",W(t,r),Et));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,"phone","phone")).params=e,r}return(0,h.Z)(n,[{key:"_getIdTokenResponse",value:function(e){return function(e,t){return yt.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_linkToIdToken",value:function(e,t){return function(e,t){return _t.apply(this,arguments)}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}},{key:"_getReauthenticationResolver",value:function(e){return function(e,t){return bt.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_makeVerificationRequest",value:function(){var e=this.params,t=e.temporaryProof,n=e.phoneNumber,r=e.verificationId,i=e.verificationCode;return t&&n?{temporaryProof:t,phoneNumber:n}:{sessionInfo:r,code:i}}},{key:"toJSON",value:function(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}}],[{key:"_fromVerification",value:function(e,t){return new n({verificationId:e,verificationCode:t})}},{key:"_fromTokenResponse",value:function(e,t){return new n({phoneNumber:e,temporaryProof:t})}},{key:"fromJSON",value:function(e){"string"===typeof e&&(e=JSON.parse(e));var t=e,r=t.verificationId,i=t.verificationCode,a=t.phoneNumber,o=t.temporaryProof;return i||r||a||o?new n({verificationId:r,verificationCode:i,phoneNumber:a,temporaryProof:o}):null}}]),n}(rt);var St=function(){function e(t){var n,r,i,a,o,s;(0,v.Z)(this,e);var c=(0,m.zd)((0,m.pd)(t)),u=null!==(n=c.apiKey)&&void 0!==n?n:null,l=null!==(r=c.oobCode)&&void 0!==r?r:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=c.mode)&&void 0!==i?i:null);P(u&&l&&d,"argument-error"),this.apiKey=u,this.operation=d,this.code=l,this.continueUrl=null!==(a=c.continueUrl)&&void 0!==a?a:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=c.tenantId)&&void 0!==s?s:null}return(0,h.Z)(e,null,[{key:"parseLink",value:function(t){var n=function(e){var t=(0,m.zd)((0,m.pd)(e)).link,n=t?(0,m.zd)((0,m.pd)(t)).deep_link_id:null,r=(0,m.zd)((0,m.pd)(e)).deep_link_id;return(r?(0,m.zd)((0,m.pd)(r)).link:null)||r||n||t||e}(t);try{return new e(n)}catch(r){return null}}}]),e}();var kt=function(){function e(){(0,v.Z)(this,e),this.providerId=e.PROVIDER_ID}return(0,h.Z)(e,null,[{key:"credential",value:function(e,t){return ft._fromEmailAndPassword(e,t)}},{key:"credentialWithLink",value:function(e,t){var n=St.parseLink(t);return P(n,"argument-error"),ft._fromEmailAndCode(e,n.code,n.tenantId)}}]),e}();kt.PROVIDER_ID="password",kt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",kt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var Tt=function(){function e(t){(0,v.Z)(this,e),this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}return(0,h.Z)(e,[{key:"setDefaultLanguage",value:function(e){this.defaultLanguageCode=e}},{key:"setCustomParameters",value:function(e){return this.customParameters=e,this}},{key:"getCustomParameters",value:function(){return this.customParameters}}]),e}(),It=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).scopes=[],e}return(0,h.Z)(n,[{key:"addScope",value:function(e){return this.scopes.includes(e)||this.scopes.push(e),this}},{key:"getScopes",value:function(){return(0,f.Z)(this.scopes)}}]),n}(Tt),Ct=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,v.Z)(this,n),t.call(this,"facebook.com")}return(0,h.Z)(n,null,[{key:"credential",value:function(e){return vt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(It);Ct.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ct.PROVIDER_ID="facebook.com";var Rt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this,"google.com")).addScope("profile"),e}return(0,h.Z)(n,null,[{key:"credential",value:function(e,t){return vt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthIdToken,i=t.oauthAccessToken;if(!r&&!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(It);Rt.GOOGLE_SIGN_IN_METHOD="google.com",Rt.PROVIDER_ID="google.com";var At=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,v.Z)(this,n),t.call(this,"github.com")}return(0,h.Z)(n,null,[{key:"credential",value:function(e){return vt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(It);At.GITHUB_SIGN_IN_METHOD="github.com",At.PROVIDER_ID="github.com";var Ot=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,v.Z)(this,n),t.call(this,"twitter.com")}return(0,h.Z)(n,null,[{key:"credential",value:function(e,t){return vt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthAccessToken,i=t.oauthTokenSecret;if(!r||!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(It);Ot.TWITTER_SIGN_IN_METHOD="twitter.com",Ot.PROVIDER_ID="twitter.com";var Nt=function(){function e(t){(0,v.Z)(this,e),this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}return(0,h.Z)(e,null,[{key:"_fromIdTokenResponse",value:function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n,r,i){var a,o,s,c,l=arguments;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>3&&void 0!==l[3]&&l[3],t.next=3,ke._fromIdTokenResponse(n,i,a);case 3:return o=t.sent,s=xt(i),c=new e({user:o,providerId:s,_tokenResponse:i,operationType:r}),t.abrupt("return",c);case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"_forOperation",value:function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n,r,i){var a;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._updateTokensIfNecessary(i,!0);case 2:return a=xt(i),t.abrupt("return",new e({user:n,providerId:a,_tokenResponse:i,operationType:r}));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),e}();function xt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}var Dt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i,o){var s,c;return(0,v.Z)(this,n),(s=t.call(this,r.code,r.message)).operationType=i,s.user=o,Object.setPrototypeOf((0,a.Z)(s),n.prototype),s.customData={appName:e.name,tenantId:null!==(c=e.tenantId)&&void 0!==c?c:void 0,_serverResponse:r.customData._serverResponse,operationType:i},s}return(0,h.Z)(n,null,[{key:"_fromErrorAndOperation",value:function(e,t,r,i){return new n(e,t,r,i)}}]),n}(m.ZR);function Pt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((function(n){if(n.code==="auth/".concat("multi-factor-auth-required"))throw Dt._fromErrorAndOperation(e,n,t,r);throw n}))}function Lt(e,t){return Mt.apply(this,arguments)}function Mt(){return Mt=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]&&a[2],e.t0=de,e.t1=t,e.t2=n,e.t3=t.auth,e.next=7,t.getIdToken();case 7:return e.t4=e.sent,e.t5=e.t2._linkToIdToken.call(e.t2,e.t3,e.t4),e.t6=r,e.next=12,(0,e.t0)(e.t1,e.t5,e.t6);case 12:return i=e.sent,e.abrupt("return",Nt._forOperation(t,"link",i));case 14:case"end":return e.stop()}}),e)}))),Mt.apply(this,arguments)}function Ut(e,t){return jt.apply(this,arguments)}function jt(){return jt=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a,o,s,c,l=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],i=t.auth,a="reauthenticate",e.prev=3,e.next=6,de(t,Pt(i,a,n,t),r);case 6:return P((o=e.sent).idToken,i,"internal-error"),P(s=le(o.idToken),i,"internal-error"),c=s.sub,P(t.uid===c,i,"user-mismatch"),e.abrupt("return",Nt._forOperation(t,a,o));case 15:throw e.prev=15,e.t0=e.catch(3),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("user-not-found")&&O(i,"user-mismatch"),e.t0;case 19:case"end":return e.stop()}}),e,null,[[3,15]])}))),jt.apply(this,arguments)}function Ft(e,t){return Vt.apply(this,arguments)}function Vt(){return Vt=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a,o,s=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i="signIn",e.next=4,Pt(t,i,n);case 4:return a=e.sent,e.next=7,Nt._fromIdTokenResponse(t,i,a);case 7:if(o=e.sent,r){e.next=11;break}return e.next=11,t._updateCurrentUser(o.user);case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)}))),Vt.apply(this,arguments)}function Bt(e,t){return Gt.apply(this,arguments)}function Gt(){return(Gt=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ft(Ke(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zt(e,t){return qt.apply(this,arguments)}function qt(){return(qt=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ut((0,m.m9)(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=Ke(t))._getPasswordPolicyInternal()){e.next=4;break}return e.next=4,n._updatePasswordPolicy();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(e,t,n){return Bt((0,m.m9)(e),kt.credential(t,n)).catch(function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw n.code==="auth/".concat("password-does-not-meet-requirements")&&Wt(e),n;case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}function zt(e,t){return Yt((0,m.m9)(e),null,t)}function Yt(e,t,n){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){var i,a,o,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.auth,e.next=3,t.getIdToken();case 3:return a=e.sent,o={idToken:a,returnSecureToken:!0},n&&(o.email=n),r&&(o.password=r),e.next=9,de(t,it(i,o));case 9:return s=e.sent,e.next=12,t._updateTokensIfNecessary(s,!0);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e,t,n,r){return(0,m.m9)(e).onAuthStateChanged(t,n,r)}function Qt(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:start",W(e,t))}function $t(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:finalize",W(e,t))}new WeakMap;var en="__sak",tn=function(){function e(t,n){(0,v.Z)(this,e),this.storageRetriever=t,this.type=n}return(0,h.Z)(e,[{key:"_isAvailable",value:function(){try{return this.storage?(this.storage.setItem(en,"1"),this.storage.removeItem(en),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"_set",value:function(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}},{key:"_get",value:function(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}},{key:"_remove",value:function(e){return this.storage.removeItem(e),Promise.resolve()}},{key:"storage",get:function(){return this.storageRetriever()}}]),e}();var nn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this,(function(){return window.localStorage}),"LOCAL")).boundEventHandler=function(t,n){return e.onStorageEvent(t,n)},e.listeners={},e.localCache={},e.pollTimer=null,e.safariLocalStorageNotSynced=function(){var e=(0,m.z$)();return De(e)||Fe(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),e.fallbackToPolling=Ve(),e._shouldAllowMigration=!0,e}return(0,h.Z)(n,[{key:"forAllChangedKeys",value:function(e){for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.storage.getItem(r),a=this.localCache[r];i!==a&&e(r,a,i)}}},{key:"onStorageEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.key){var r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}var a=function(){var e=t.storage.getItem(r);(n||t.localCache[r]!==e)&&t.notifyListeners(r,e)},o=this.storage.getItem(r);(0,m.w1)()&&10===document.documentMode&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,10):a()}else this.forAllChangedKeys((function(e,n,r){t.notifyListeners(e,r)}))}},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t?JSON.parse(t):t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval((function(){e.forAllChangedKeys((function(t,n,r){e.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:r}),!0)}))}),1e3)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"attachListener",value:function(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}},{key:"_set",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,a){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.Z)((0,i.Z)(n.prototype),"_set",this).call(this,t,a);case 2:this.localCache[t]=JSON.stringify(a);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.Z)((0,i.Z)(n.prototype),"_get",this).call(this,t);case 2:return a=e.sent,this.localCache[t]=JSON.stringify(a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.Z)((0,i.Z)(n.prototype),"_remove",this).call(this,t);case 2:delete this.localCache[t];case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(tn);nn.type="LOCAL";var rn=nn,an=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,v.Z)(this,n),t.call(this,(function(){return window.sessionStorage}),"SESSION")}return(0,h.Z)(n,[{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),n}(tn);an.type="SESSION";var on=an;function sn(e){return Promise.all(e.map(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return n=e.sent,e.abrupt("return",{fulfilled:!0,value:n});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{fulfilled:!1,reason:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()))}var cn=function(){function e(t){(0,v.Z)(this,e),this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}return(0,h.Z)(e,[{key:"isListeningto",value:function(e){return this.eventTarget===e}},{key:"handleEvent",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,c,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t).data,i=r.eventId,a=r.eventType,o=r.data,null===(s=this.handlersMap[a])||void 0===s?void 0:s.size){e.next=5;break}return e.abrupt("return");case 5:return n.ports[0].postMessage({status:"ack",eventId:i,eventType:a}),c=Array.from(s).map(function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(n.origin,o));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,sn(c);case 9:l=e.sent,n.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:l});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscribe",value:function(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}},{key:"_unsubscribe",value:function(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}],[{key:"_getInstance",value:function(t){var n=this.receivers.find((function(e){return e.isListeningto(t)}));if(n)return n;var r=new e(t);return this.receivers.push(r),r}}]),e}();function un(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="",r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}cn.receivers=[];var ln=function(){function e(t){(0,v.Z)(this,e),this.target=t,this.handlers=new Set}return(0,h.Z)(e,[{key:"removeMessageHandler",value:function(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}},{key:"_send",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a,o,s=this,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:50,i="undefined"!==typeof MessageChannel?new MessageChannel:null){e.next=4;break}throw new Error("connection_unavailable");case 4:return e.abrupt("return",new Promise((function(e,c){var u=un("",20);i.port1.start();var l=setTimeout((function(){c(new Error("unsupported_event"))}),r);o={messageChannel:i,onMessage:function(t){var n=t;if(n.data.eventId===u)switch(n.data.status){case"ack":clearTimeout(l),a=setTimeout((function(){c(new Error("timeout"))}),3e3);break;case"done":clearTimeout(a),e(n.data.response);break;default:clearTimeout(l),clearTimeout(a),c(new Error("invalid_response"))}}},s.handlers.add(o),i.port1.addEventListener("message",o.onMessage),s.target.postMessage({eventType:t,eventId:u,data:n},[i.port2])})).finally((function(){o&&s.removeMessageHandler(o)})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function dn(){return window}function fn(e){dn().location.href=e}function pn(){return"undefined"!==typeof dn().WorkerGlobalScope&&"function"===typeof dn().importScripts}function hn(){return vn.apply(this,arguments)}function vn(){return(vn=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===navigator||void 0===navigator?void 0:navigator.serviceWorker){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,navigator.serviceWorker.ready;case 5:return t=e.sent,e.abrupt("return",t.active);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function mn(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}var gn="firebaseLocalStorageDb",yn="firebaseLocalStorage",_n="fbase_key",En=function(){function e(t){(0,v.Z)(this,e),this.request=t}return(0,h.Z)(e,[{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.request.addEventListener("success",(function(){t(e.request.result)})),e.request.addEventListener("error",(function(){n(e.request.error)}))}))}}]),e}();function bn(e,t){return e.transaction([yn],t?"readwrite":"readonly").objectStore(yn)}function wn(){var e=indexedDB.deleteDatabase(gn);return new En(e).toPromise()}function Sn(){var e=indexedDB.open(gn,1);return new Promise((function(t,n){e.addEventListener("error",(function(){n(e.error)})),e.addEventListener("upgradeneeded",(function(){var t=e.result;try{t.createObjectStore(yn,{keyPath:_n})}catch(r){n(r)}})),e.addEventListener("success",(0,d.Z)((0,u.Z)().mark((function n(){var r;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=e.result).objectStoreNames.contains(yn)){n.next=12;break}return r.close(),n.next=5,wn();case 5:return n.t0=t,n.next=8,Sn();case 8:n.t1=n.sent,(0,n.t0)(n.t1),n.next=13;break;case 12:t(r);case 13:case"end":return n.stop()}}),n)}))))}))}function kn(e,t,n){return Tn.apply(this,arguments)}function Tn(){return(Tn=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){var i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=bn(t,!0).put((i={},(0,p.Z)(i,_n,n),(0,p.Z)(i,"value",r),i)),e.abrupt("return",new En(a).toPromise());case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function In(e,t){return Cn.apply(this,arguments)}function Cn(){return(Cn=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=bn(t,!1).get(n),e.next=3,new En(r).toPromise();case 3:return i=e.sent,e.abrupt("return",void 0===i?null:i.value);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rn(e,t){var n=bn(e,!0).delete(t);return new En(n).toPromise()}var An=function(){function e(){(0,v.Z)(this,e),this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((function(){}),(function(){}))}return(0,h.Z)(e,[{key:"_openDb",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.db){e.next=2;break}return e.abrupt("return",this.db);case 2:return e.next=4,Sn();case 4:return this.db=e.sent,e.abrupt("return",this.db);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_withRetries",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:return e.prev=2,e.next=5,this._openDb();case 5:return r=e.sent,e.next=8,t(r);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(2),!(n++>3)){e.next=15;break}throw e.t0;case 15:this.db&&(this.db.close(),this.db=void 0);case 16:e.next=1;break;case 18:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeServiceWorkerMessaging",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",pn()?this.initializeReceiver():this.initializeSender());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeReceiver",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.receiver=cn._getInstance(pn()?self:null),this.receiver._subscribe("keyChanged",function(){var e=(0,d.Z)((0,u.Z)().mark((function e(n,r){var i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._poll();case 2:return i=e.sent,e.abrupt("return",{keyProcessed:i.includes(r.key)});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.receiver._subscribe("ping",function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",["keyChanged"]);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeSender",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn();case 2:if(this.activeServiceWorker=e.sent,this.activeServiceWorker){e.next=5;break}return e.abrupt("return");case 5:return this.sender=new ln(this.activeServiceWorker),e.next=8,this.sender._send("ping",{},800);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return");case 11:(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyServiceWorker",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sender&&this.activeServiceWorker&&mn()===this.activeServiceWorker){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_isAvailable",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,indexedDB){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Sn();case 5:return t=e.sent,e.next=8,kn(t,en,"1");case 8:return e.next=10,Rn(t,en);case 10:return e.abrupt("return",!0);case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_withPendingWrite",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pendingWrites++,e.prev=1,e.next=4,t();case 4:return e.prev=4,this.pendingWrites--,e.finish(4);case 7:case"end":return e.stop()}}),e,this,[[1,,4,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._withRetries((function(e){return kn(e,t,n)}));case 2:return r.localCache[t]=n,e.abrupt("return",r.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){return In(e,t)}));case 2:return n=e.sent,this.localCache[t]=n,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite((0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._withRetries((function(e){return Rn(e,t)}));case 2:return delete n.localCache[t],e.abrupt("return",n.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_poll",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n,r,i,a,o,s,l,d,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){var t=bn(e,!1).getAll();return new En(t).toPromise()}));case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:if(0===this.pendingWrites){e.next=7;break}return e.abrupt("return",[]);case 7:n=[],r=new Set,i=(0,c.Z)(t);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.fbase_key,l=o.value,r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(l)&&(this.notifyListeners(s,l),n.push(s))}catch(u){i.e(u)}finally{i.f()}for(d=0,f=Object.keys(this.localCache);d<f.length;d++)p=f[d],this.localCache[p]&&!r.has(p)&&(this.notifyListeners(p,null),n.push(p));return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval((0,d.Z)((0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._poll());case 1:case"end":return t.stop()}}),t)}))),800)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}]),e}();An.type="LOCAL";var On=An;function Nn(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:start",W(e,t))}function xn(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:finalize",W(e,t))}Je("rcb"),new V(3e4,6e4);var Dn="recaptcha";function Pn(e,t,n){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){var i,a,o,s,c,l,d,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.verify();case 2:if(a=e.sent,e.prev=3,P("string"===typeof a,t,"argument-error"),P(r.type===Dn,t,"argument-error"),!("session"in(o="string"===typeof n?{phoneNumber:n}:n))){e.next=26;break}if(s=o.session,!("phoneNumber"in o)){e.next=17;break}return P("enroll"===s.type,t,"internal-error"),e.next=13,Qt(t,{idToken:s.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}});case 13:return c=e.sent,e.abrupt("return",c.phoneSessionInfo.sessionInfo);case 17:return P("signin"===s.type,t,"internal-error"),P(l=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid,t,"missing-multi-factor-info"),e.next=22,Nn(t,{mfaPendingCredential:s.credential,mfaEnrollmentId:l,phoneSignInInfo:{recaptchaToken:a}});case 22:return d=e.sent,e.abrupt("return",d.phoneResponseInfo.sessionInfo);case 24:e.next=31;break;case 26:return e.next=28,mt(t,{phoneNumber:o.phoneNumber,recaptchaToken:a});case 28:return f=e.sent,p=f.sessionInfo,e.abrupt("return",p);case 31:return e.prev=31,r._reset(),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[3,,31,34]])})))).apply(this,arguments)}var Mn=function(){function e(t){(0,v.Z)(this,e),this.providerId=e.PROVIDER_ID,this.auth=Ke(t)}return(0,h.Z)(e,[{key:"verifyPhoneNumber",value:function(e,t){return Pn(this.auth,e,(0,m.m9)(t))}}],[{key:"credential",value:function(e,t){return wt._fromVerification(e,t)}},{key:"credentialFromResult",value:function(t){var n=t;return e.credentialFromTaggedObject(n)}},{key:"credentialFromError",value:function(t){return e.credentialFromTaggedObject(t.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var n=t.phoneNumber,r=t.temporaryProof;return n&&r?wt._fromTokenResponse(n,r):null}}]),e}();function Un(e,t){return t?Ie(t):(P(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Mn.PROVIDER_ID="phone",Mn.PHONE_SIGN_IN_METHOD="phone";var jn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,"custom","custom")).params=e,r}return(0,h.Z)(n,[{key:"_getIdTokenResponse",value:function(e){return pt(e,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function(e,t){return pt(e,this._buildIdpRequest(t))}},{key:"_getReauthenticationResolver",value:function(e){return pt(e,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}]),n}(rt);function Fn(e){return Ft(e.auth,new jn(e),e.bypassAuthState)}function Vn(e){var t=e.auth,n=e.user;return P(n,t,"internal-error"),Ut(n,new jn(e),e.bypassAuthState)}function Bn(e){return Gn.apply(this,arguments)}function Gn(){return(Gn=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.auth,P(r=t.user,n,"internal-error"),e.abrupt("return",Lt(r,new jn(t),t.bypassAuthState));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zn=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,v.Z)(this,e),this.auth=t,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}return(0,h.Z)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n,r){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.pendingPromise={resolve:n,reject:r},t.prev=1,t.next=4,e.resolver._initialize(e.auth);case 4:return e.eventManager=t.sent,t.next=7,e.onExecution();case 7:e.eventManager.registerConsumer(e),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.reject(t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"onAuthEvent",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.urlResponse,r=t.sessionId,i=t.postBody,a=t.tenantId,o=t.error,s=t.type,!o){e.next=4;break}return this.reject(o),e.abrupt("return");case 4:return c={auth:this.auth,requestUri:n,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState},e.prev=5,e.t0=this,e.next=9,this.getIdpTask(s)(c);case 9:e.t1=e.sent,e.t0.resolve.call(e.t0,e.t1),e.next=16;break;case 13:e.prev=13,e.t2=e.catch(5),this.reject(e.t2);case 16:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onError",value:function(e){this.reject(e)}},{key:"getIdpTask",value:function(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Fn;case"linkViaPopup":case"linkViaRedirect":return Bn;case"reauthViaPopup":case"reauthViaRedirect":return Vn;default:O(this.auth,"internal-error")}}},{key:"resolve",value:function(e){M(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}},{key:"reject",value:function(e){M(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}]),e}(),qn=new V(2e3,1e4);var Wn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i,o,s){var c;return(0,v.Z)(this,n),(c=t.call(this,e,r,o,s)).provider=i,c.authWindow=null,c.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=(0,a.Z)(c),c}return(0,h.Z)(n,[{key:"executeNotNull",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute();case 2:return P(t=e.sent,this.auth,"internal-error"),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,n=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(1===this.filter.length,"Popup operations only handle one event"),t=un(),e.next=4,this.resolver._openPopup(this.auth,this.provider,this.filter[0],t);case 4:this.authWindow=e.sent,this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((function(e){n.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(function(e){e||n.reject(N(n.auth,"web-storage-unsupported"))})),this.pollUserCancellation();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"eventId",get:function(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}},{key:"cancel",value:function(){this.reject(N(this.auth,"cancelled-popup-request"))}},{key:"cleanUp",value:function(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}},{key:"pollUserCancellation",value:function(){var e=this;!function t(){var n,r;(null===(r=null===(n=e.authWindow)||void 0===n?void 0:n.window)||void 0===r?void 0:r.closed)?e.pollId=window.setTimeout((function(){e.pollId=null,e.reject(N(e.auth,"popup-closed-by-user"))}),8e3):e.pollId=window.setTimeout(t,qn.get())}()}}]),n}(Zn);Wn.currentPopupAction=null;var Hn="pendingRedirect",Kn=new Map,zn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,v.Z)(this,n),(i=t.call(this,e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a)).eventId=null,i}return(0,h.Z)(n,[{key:"execute",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){var t,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Kn.get(this.auth._key())){e.next=21;break}return e.prev=2,e.next=5,Yn(this.resolver,this.auth);case 5:if(!e.sent){e.next=12;break}return e.next=9,(0,r.Z)((0,i.Z)(n.prototype),"execute",this).call(this);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=null;case 13:a=e.t0,t=function(){return Promise.resolve(a)},e.next=20;break;case 17:e.prev=17,e.t1=e.catch(2),t=function(){return Promise.reject(e.t1)};case 20:Kn.set(this.auth._key(),t);case 21:return this.bypassAuthState||Kn.set(this.auth._key(),(function(){return Promise.resolve(null)})),e.abrupt("return",t());case 23:case"end":return e.stop()}}),e,this,[[2,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthEvent",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("signInViaRedirect"!==t.type){e.next=4;break}return e.abrupt("return",(0,r.Z)((0,i.Z)(n.prototype),"onAuthEvent",this).call(this,t));case 4:if("unknown"!==t.type){e.next=7;break}return this.resolve(null),e.abrupt("return");case 7:if(!t.eventId){e.next=17;break}return e.next=10,this.auth._redirectUserForId(t.eventId);case 10:if(!(a=e.sent)){e.next=16;break}return this.user=a,e.abrupt("return",(0,r.Z)((0,i.Z)(n.prototype),"onAuthEvent",this).call(this,t));case 16:this.resolve(null);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanUp",value:function(){}}]),n}(Zn);function Yn(e,t){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$n(n),i=Qn(t),e.next=4,i._isAvailable();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i._get(r);case 8:return e.t0=e.sent,a="true"===e.t0,e.next=12,i._remove(r);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xn(e,t){Kn.set(e._key(),t)}function Qn(e){return Ie(e._redirectPersistence)}function $n(e){return Ae(Hn,e.config.apiKey,e.name)}function er(e,t){return tr.apply(this,arguments)}function tr(){return tr=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r,i,a,o,s,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]&&c[2],i=Ke(t),a=Un(i,n),o=new zn(i,a,r),e.next=6,o.execute();case 6:if(!(s=e.sent)||r){e.next=13;break}return delete s.user._redirectEventId,e.next=11,i._persistUserIfCurrent(s.user);case 11:return e.next=13,i._setRedirectUser(null,n);case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e)}))),tr.apply(this,arguments)}var nr=function(){function e(t){(0,v.Z)(this,e),this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}return(0,h.Z)(e,[{key:"registerConsumer",value:function(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}},{key:"unregisterConsumer",value:function(e){this.consumers.delete(e)}},{key:"onEvent",value:function(e){var t=this;if(this.hasEventBeenHandled(e))return!1;var n=!1;return this.consumers.forEach((function(r){t.isEventForConsumer(e,r)&&(n=!0,t.sendToConsumer(e,r),t.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ir(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}},{key:"sendToConsumer",value:function(e,t){var n;if(e.error&&!ir(e)){var r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(N(this.auth,r))}else t.onAuthEvent(e)}},{key:"isEventForConsumer",value:function(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}},{key:"hasEventBeenHandled",value:function(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(rr(e))}},{key:"saveEventToCache",value:function(e){this.cachedEventUids.add(rr(e)),this.lastProcessedEventTime=Date.now()}}]),e}();function rr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((function(e){return e})).join("-")}function ir(e){var t=e.type,n=e.error;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}function ar(e){return or.apply(this,arguments)}function or(){return or=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",H(t,"GET","/v1/projects",n));case 2:case"end":return e.stop()}}),e)}))),or.apply(this,arguments)}var sr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cr=/^https?/;function ur(){return(ur=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i,a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.emulator){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ar(t);case 4:n=e.sent,r=n.authorizedDomains,i=(0,c.Z)(r),e.prev=7,i.s();case 9:if((a=i.n()).done){e.next=20;break}if(o=a.value,e.prev=11,!lr(o)){e.next=14;break}return e.abrupt("return");case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(7),i.e(e.t1);case 25:return e.prev=25,i.f(),e.finish(25);case 28:O(t,"unauthorized-domain");case 29:case"end":return e.stop()}}),e,null,[[7,22,25,28],[11,16]])})))).apply(this,arguments)}function lr(e){var t=U(),n=new URL(t),r=n.protocol,i=n.hostname;if(e.startsWith("chrome-extension://")){var a=new URL(e);return""===a.hostname&&""===i?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&a.hostname===i}if(!cr.test(r))return!1;if(sr.test(e))return i===e;var o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}var dr=new V(3e4,6e4);function fr(){var e=dn().___jsl;if(null===e||void 0===e?void 0:e.H)for(var t=0,n=Object.keys(e.H);t<n.length;t++){var r=n[t];if(e.H[r].r=e.H[r].r||[],e.H[r].L=e.H[r].L||[],e.H[r].r=(0,f.Z)(e.H[r].L),e.CP)for(var i=0;i<e.CP.length;i++)e.CP[i]=null}}var pr=null;function hr(e){return pr=pr||function(e){return new Promise((function(t,n){var r,i,a;function o(){fr(),gapi.load("gapi.iframes",{callback:function(){t(gapi.iframes.getContext())},ontimeout:function(){fr(),n(N(e,"network-request-failed"))},timeout:dr.get()})}if(null===(i=null===(r=dn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=dn().gapi)||void 0===a?void 0:a.load)){var s=Je("iframefcb");return dn()[s]=function(){gapi.load?o():n(N(e,"network-request-failed"))},Ye("https://apis.google.com/js/api.js?onload=".concat(s)).catch((function(e){return n(e)}))}o()}})).catch((function(e){throw pr=null,e}))}(e),pr}var vr=new V(5e3,15e3),mr="__/auth/iframe",gr="emulator/auth/iframe",yr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_r=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Er(e){var t=e.config;P(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?B(t,gr):"https://".concat(e.config.authDomain,"/").concat(mr),r={apiKey:t.apiKey,appName:e.name,v:g.Jn},i=_r.get(e.config.apiHost);i&&(r.eid=i);var a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat((0,m.xO)(r).slice(1))}function br(e){return wr.apply(this,arguments)}function wr(){return wr=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hr(t);case 2:return n=e.sent,P(r=dn().gapi,t,"internal-error"),e.abrupt("return",n.open({where:document.body,url:Er(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yr,dontclear:!0},(function(e){return new Promise(function(){var n=(0,d.Z)((0,u.Z)().mark((function n(r,i){var a,o,s;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(){dn().clearTimeout(o),r(e)},n.next=3,e.restyle({setHideOnLeave:!1});case 3:a=N(t,"network-request-failed"),o=dn().setTimeout((function(){i(a)}),vr.get()),e.ping(s).then(s,(function(){i(a)}));case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())})));case 6:case"end":return e.stop()}}),e)}))),wr.apply(this,arguments)}var Sr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},kr=function(){function e(t){(0,v.Z)(this,e),this.window=t,this.associatedEvent=null}return(0,h.Z)(e,[{key:"close",value:function(){if(this.window)try{this.window.close()}catch(e){}}}]),e}();function Tr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600,a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),s="",c=Object.assign(Object.assign({},Sr),{width:r.toString(),height:i.toString(),top:a,left:o}),u=(0,m.z$)().toLowerCase();n&&(s=Pe(u)?"_blank":n),xe(u)&&(t=t||"http://localhost",c.scrollbars="yes");var d=Object.entries(c).reduce((function(e,t){var n=(0,l.Z)(t,2),r=n[0],i=n[1];return"".concat(e).concat(r,"=").concat(i,",")}),"");if(function(){var e;return Fe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==s)return function(e,t){var n=document.createElement("a");n.href=e,n.target=t;var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",s),new kr(null);var f=window.open(t||"",s,d);P(f,e,"popup-blocked");try{f.focus()}catch(p){}return new kr(f)}var Ir="__/auth/handler",Cr="emulator/auth/handler",Rr=encodeURIComponent("fac");function Ar(e,t,n,r,i,a){return Or.apply(this,arguments)}function Or(){return(Or=(0,d.Z)((0,u.Z)().mark((function e(t,n,r,i,a,o){var s,c,d,f,p,h,v,y,_,E,b,w,S;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P(t.config.authDomain,t,"auth-domain-config-required"),P(t.config.apiKey,t,"invalid-api-key"),s={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:i,v:g.Jn,eventId:a},n instanceof Tt)for(n.setDefaultLanguage(t.languageCode),s.providerId=n.providerId||"",(0,m.xb)(n.getCustomParameters())||(s.customParameters=JSON.stringify(n.getCustomParameters())),c=0,d=Object.entries(o||{});c<d.length;c++)f=(0,l.Z)(d[c],2),p=f[0],h=f[1],s[p]=h;for(n instanceof It&&(v=n.getScopes().filter((function(e){return""!==e}))).length>0&&(s.scopes=v.join(",")),t.tenantId&&(s.tid=t.tenantId),y=s,_=0,E=Object.keys(y);_<E.length;_++)b=E[_],void 0===y[b]&&delete y[b];return e.next=10,t._getAppCheckToken();case 10:return w=e.sent,S=w?"#".concat(Rr,"=").concat(encodeURIComponent(w)):"",e.abrupt("return","".concat(Nr(t),"?").concat((0,m.xO)(y).slice(1)).concat(S));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nr(e){var t=e.config;return t.emulator?B(t,Cr):"https://".concat(t.authDomain,"/").concat(Ir)}var xr="webStorageSupport",Dr=function(){function e(){(0,v.Z)(this,e),this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=on,this._completeRedirectFn=er,this._overrideRedirectResult=Xn}return(0,h.Z)(e,[{key:"_openPopup",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n,r,i){var a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(null===(a=this.eventManagers[t._key()])||void 0===a?void 0:a.manager,"_initialize() not called before _openPopup()"),e.next=3,Ar(t,n,r,U(),i);case 3:return o=e.sent,e.abrupt("return",Tr(t,o,un()));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_openRedirect",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n,r,i){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._originValidation(t);case 2:return e.next=4,Ar(t,n,r,U(),i);case 4:return fn(e.sent),e.abrupt("return",new Promise((function(){})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_initialize",value:function(e){var t=this,n=e._key();if(this.eventManagers[n]){var r=this.eventManagers[n],i=r.manager,a=r.promise;return i?Promise.resolve(i):(M(a,"If manager is not set, promise should be"),a)}var o=this.initAndGetManager(e);return this.eventManagers[n]={promise:o},o.catch((function(){delete t.eventManagers[n]})),o}},{key:"initAndGetManager",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,br(t);case 2:return n=e.sent,r=new nr(t),n.register("authEvent",(function(e){return P(null===e||void 0===e?void 0:e.authEvent,t,"invalid-auth-event"),{status:r.onEvent(e.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=n,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isIframeWebStorageSupported",value:function(e,t){this.iframes[e._key()].send(xr,{type:xr},(function(n){var r,i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[xr];void 0!==i&&t(!!i),O(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return ur.apply(this,arguments)}(e)),this.originValidationPromises[t]}},{key:"_shouldInitProactively",get:function(){return Ve()||De()||Fe()}}]),e}(),Pr=Dr,Lr=function(){function e(t){(0,v.Z)(this,e),this.factorId=t}return(0,h.Z)(e,[{key:"_process",value:function(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return L("unexpected MultiFactorSessionType")}}}]),e}(),Mr=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,"phone")).credential=e,r}return(0,h.Z)(n,[{key:"_finalizeEnroll",value:function(e,t,n){return function(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:finalize",W(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},{key:"_finalizeSignIn",value:function(e,t){return function(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:finalize",W(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}],[{key:"_fromCredential",value:function(e){return new n(e)}}]),n}(Lr);(function(){function e(){(0,v.Z)(this,e)}return(0,h.Z)(e,null,[{key:"assertion",value:function(e){return Mr._fromCredential(e)}}]),e}()).FACTOR_ID="phone";var Ur=function(){function e(){(0,v.Z)(this,e)}return(0,h.Z)(e,null,[{key:"assertionForEnrollment",value:function(e,t){return jr._fromSecret(e,t)}},{key:"assertionForSignIn",value:function(e,t){return jr._fromEnrollmentId(e,t)}},{key:"generateSecret",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n,r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P("undefined"!==typeof(null===(n=(r=t).user)||void 0===n?void 0:n.auth),"internal-error"),e.next=4,a=r.user.auth,o={idToken:r.credential,totpEnrollmentInfo:{}},H(a,"POST","/v2/accounts/mfaEnrollment:start",W(a,o));case 4:return i=e.sent,e.abrupt("return",Fr._fromStartTotpMfaEnrollmentResponse(i,r.user.auth));case 6:case"end":return e.stop()}var a,o}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Ur.FACTOR_ID="totp";var jr=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,"totp")).otp=e,a.enrollmentId=r,a.secret=i,a}return(0,h.Z)(n,[{key:"_finalizeEnroll",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P("undefined"!==typeof this.secret,t,"argument-error"),e.abrupt("return",$t(t,{idToken:n,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_finalizeSignIn",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(void 0!==this.enrollmentId&&void 0!==this.otp,t,"argument-error"),r={verificationCode:this.otp},e.abrupt("return",xn(t,{mfaPendingCredential:n,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"_fromSecret",value:function(e,t){return new n(t,void 0,e)}},{key:"_fromEnrollmentId",value:function(e,t){return new n(t,e)}}]),n}(Lr),Fr=function(){function e(t,n,r,i,a,o,s){(0,v.Z)(this,e),this.sessionInfo=o,this.auth=s,this.secretKey=t,this.hashingAlgorithm=n,this.codeLength=r,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=a}return(0,h.Z)(e,[{key:"_makeTotpVerificationInfo",value:function(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}},{key:"generateQrCodeUrl",value:function(e,t){var n,r=!1;return(Vr(e)||Vr(t))&&(r=!0),r&&(Vr(e)&&(e=(null===(n=this.auth.currentUser)||void 0===n?void 0:n.email)||"unknownuser"),Vr(t)&&(t=this.auth.name)),"otpauth://totp/".concat(t,":").concat(e,"?secret=").concat(this.secretKey,"&issuer=").concat(t,"&algorithm=").concat(this.hashingAlgorithm,"&digits=").concat(this.codeLength)}}],[{key:"_fromStartTotpMfaEnrollmentResponse",value:function(t,n){return new e(t.totpSessionInfo.sharedSecretKey,t.totpSessionInfo.hashingAlgorithm,t.totpSessionInfo.verificationCodeLength,t.totpSessionInfo.periodSec,new Date(t.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),t.totpSessionInfo.sessionInfo,n)}}]),e}();function Vr(e){return"undefined"===typeof e||0===(null===e||void 0===e?void 0:e.length)}var Br="@firebase/auth",Gr="1.3.0",Zr=function(){function e(t){(0,v.Z)(this,e),this.auth=t,this.internalListeners=new Map}return(0,h.Z)(e,[{key:"getUid",value:function(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}},{key:"getToken",value:function(){var e=(0,d.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertAuthConfigured(),e.next=3,this.auth._initializationPromise;case 3:if(this.auth.currentUser){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,this.auth.currentUser.getIdToken(t);case 7:return n=e.sent,e.abrupt("return",{accessToken:n});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addAuthTokenListener",value:function(e){if(this.assertAuthConfigured(),!this.internalListeners.has(e)){var t=this.auth.onIdTokenChanged((function(t){e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}}},{key:"removeAuthTokenListener",value:function(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}},{key:"assertAuthConfigured",value:function(){P(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}]),e}();var qr,Wr=(0,m.Pz)("authIdTokenMaxAge")||300,Hr=null,Kr=function(e){return function(){var t=(0,d.Z)((0,u.Z)().mark((function t(n){var r,i,a;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n,!t.t0){t.next=5;break}return t.next=4,n.getIdTokenResult();case 4:t.t0=t.sent;case 5:if(r=t.t0,!((i=r&&((new Date).getTime()-Date.parse(r.issuedAtTime))/1e3)&&i>Wr)){t.next=9;break}return t.abrupt("return");case 9:if(a=null===r||void 0===r?void 0:r.token,Hr!==a){t.next=12;break}return t.abrupt("return");case 12:return Hr=a,t.next=15,fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:"Bearer ".concat(a)}:{}});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};function zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,g.Mq)(),t=(0,g.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();var n=function(e,t){var n=(0,g.qX)(e,"auth");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if((0,m.vZ)(i,null!==t&&void 0!==t?t:{}))return r;O(r,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Pr,persistence:[On,rn,on]}),r=(0,m.Pz)("authTokenSyncURL");if(r){var i=Kr(r);!function(e,t,n){(0,m.m9)(e).beforeAuthStateChanged(t,n)}(n,i,(function(){return i(n.currentUser)})),function(e,t,n,r){(0,m.m9)(e).onIdTokenChanged(t,n,r)}(n,(function(e){return i(e)}))}var a=(0,m.q4)("auth");return a&&et(n,"http://".concat(a)),n}qr="Browser",(0,g.Xd)(new b.wA("auth",(function(e,t){var n=t.options,r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),o=r.options,s=o.apiKey,c=o.authDomain;P(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});var u={apiKey:s,authDomain:c,clientPlatform:qr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Be(qr)},l=new He(r,i,a,u);return function(e,t){var n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ie);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((function(e,t,n){e.getProvider("auth-internal").initialize()}))),(0,g.Xd)(new b.wA("auth-internal",(function(e){return function(e){return new Zr(e)}(Ke(e.getProvider("auth").getImmediate()))}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,g.KN)(Br,Gr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(qr)),(0,g.KN)(Br,Gr,"esm2017")},2481:function(e,t,n){"use strict";n.d(t,{ET:function(){return Bf},hJ:function(){return Nd},oe:function(){return Vf},JU:function(){return xd},QT:function(){return Lf},PL:function(){return Uf},ad:function(){return Md},nP:function(){return Hf},cf:function(){return Gf},Xo:function(){return Sf},IO:function(){return _f},Bt:function(){return Wf},pl:function(){return jf},r7:function(){return Ff}});var r,i=n(5647),a=n(1752),o=n(1120),s=n(9439),c=n(8664),u=n(7762),l=n(4165),d=n(5861),f=n(136),p=n(9388),h=n(3433),v=n(5671),m=n(3144),g=n(7825),y=n(3258),_=n(6781),E=n(5854),b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},w={},S=S||{},k=b||self;function T(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function I(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var C="closure_uid_"+(1e9*Math.random()>>>0),R=0;function A(e,t,n){return e.call.apply(e.bind,arguments)}function O(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function N(e,t,n){return(N=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:O).apply(null,arguments)}function x(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function D(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function P(){this.s=this.s,this.o=this.o}P.prototype.s=!1,P.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,C)&&e[C]||(e[C]=++R))},P.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var L=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function M(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function U(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(T(r)){var i=e.length||0,a=r.length||0;e.length=i+a;for(var o=0;o<a;o++)e[i+o]=r[o]}else e.push(r)}}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.h=function(){this.defaultPrevented=!0};var F=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{k.addEventListener("test",(function(){}),t),k.removeEventListener("test",(function(){}),t)}catch(n){}return e}();function V(e){return/^[\s\xa0]*$/.test(e)}function B(){var e=k.navigator;return e&&(e=e.userAgent)?e:""}function G(e){return-1!=B().indexOf(e)}function Z(e){return Z[" "](e),e}Z[" "]=function(){};var q,W,H=G("Opera"),K=G("Trident")||G("MSIE"),z=G("Edge"),Y=z||K,J=G("Gecko")&&!(-1!=B().toLowerCase().indexOf("webkit")&&!G("Edge"))&&!(G("Trident")||G("MSIE"))&&!G("Edge"),X=-1!=B().toLowerCase().indexOf("webkit")&&!G("Edge");function Q(){var e=k.document;return e?e.documentMode:void 0}e:{var $="",ee=function(){var e=B();return J?/rv:([^\);]+)(\)|;)/.exec(e):z?/Edge\/([\d\.]+)/.exec(e):K?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):X?/WebKit\/(\S+)/.exec(e):H?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(ee&&($=ee?ee[1]:""),K){var te=Q();if(null!=te&&te>parseFloat($)){q=String(te);break e}}q=$}if(k.document&&K){var ne=Q();W=ne||(parseInt(q,10)||void 0)}else W=void 0;var re=W;function ie(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(J){e:{try{Z(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:ae[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ie.$.h.call(this)}}D(ie,j);var ae={2:"touch",3:"pen",4:"mouse"};ie.prototype.h=function(){ie.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var oe="closure_listenable_"+(1e6*Math.random()|0),se=0;function ce(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++se,this.fa=this.ia=!1}function ue(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function le(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function de(e){var t={};for(var n in e)t[n]=e[n];return t}var fe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function pe(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<fe.length;a++)n=fe[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function he(e){this.src=e,this.g={},this.h=0}function ve(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=L(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(ue(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function me(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.fa&&a.listener==t&&a.capture==!!n&&a.la==r)return i}return-1}he.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=me(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new ce(t,this.src,a,!!r,i)).ia=n,e.push(t)),t};var ge="closure_lm_"+(1e6*Math.random()|0),ye={};function _e(e,t,n,r,i){if(r&&r.once)return be(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)_e(e,t[a],n,r,i);return null}return n=Re(n),e&&e[oe]?e.O(t,n,I(r)?!!r.capture:!!r,i):Ee(e,t,n,!1,r,i)}function Ee(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=I(i)?!!i.capture:!!i,s=Ie(e);if(s||(e[ge]=s=new he(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Te;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)F||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ke(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function be(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)be(e,t[a],n,r,i);return null}return n=Re(n),e&&e[oe]?e.P(t,n,I(r)?!!r.capture:!!r,i):Ee(e,t,n,!0,r,i)}function we(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)we(e,t[a],n,r,i);else r=I(r)?!!r.capture:!!r,n=Re(n),e&&e[oe]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=me(a=e.g[t],n,r,i))&&(ue(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Ie(e))&&(t=e.g[t.toString()],e=-1,t&&(e=me(t,n,r,i)),(n=-1<e?t[e]:null)&&Se(n))}function Se(e){if("number"!==typeof e&&e&&!e.fa){var t=e.src;if(t&&t[oe])ve(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ke(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ie(t))?(ve(n,e),0==n.h&&(n.src=null,t[ge]=null)):ue(e)}}}function ke(e){return e in ye?ye[e]:ye[e]="on"+e}function Te(e,t){if(e.fa)e=!0;else{t=new ie(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Se(e),e=n.call(r,t)}return e}function Ie(e){return(e=e[ge])instanceof he?e:null}var Ce="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(e){return"function"===typeof e?e:(e[Ce]||(e[Ce]=function(t){return e.handleEvent(t)}),e[Ce])}function Ae(){P.call(this),this.i=new he(this),this.S=this,this.J=null}function Oe(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"===typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var i=t;pe(t=new j(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=Ne(o,r,!0,t)&&i}if(i=Ne(o=t.g=e,r,!0,t)&&i,i=Ne(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Ne(o=t.g=n[a],r,!1,t)&&i}function Ne(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.fa&&o.capture==n){var s=o.listener,c=o.la||o.src;o.ia&&ve(e.i,o),i=!1!==s.call(c,r)&&i}}return i&&!r.defaultPrevented}D(Ae,P),Ae.prototype[oe]=!0,Ae.prototype.removeEventListener=function(e,t,n,r){we(this,e,t,n,r)},Ae.prototype.N=function(){if(Ae.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ue(n[r]);delete t.g[e],t.h--}}this.J=null},Ae.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ae.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var xe=k.JSON.stringify,De=function(){function e(t,n){(0,v.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,m.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}();function Pe(){var e=Ge,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Le=function(){function e(){(0,v.Z)(this,e),this.h=this.g=null}return(0,m.Z)(e,[{key:"add",value:function(e,t){var n=Me.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),Me=new De((function(){return new Ue}),(function(e){return e.reset()})),Ue=function(){function e(){(0,v.Z)(this,e),this.next=this.g=this.h=null}return(0,m.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function je(e){var t=1;e=e.split(":");for(var n=[];0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Fe(e){k.setTimeout((function(){throw e}),0)}var Ve,Be=!1,Ge=new Le,Ze=function(){var e=k.Promise.resolve(void 0);Ve=function(){e.then(qe)}},qe=function(){for(var e;e=Pe();){try{e.h.call(e.g)}catch(n){Fe(n)}var t=Me;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Be=!1};function We(e,t){Ae.call(this),this.h=e||1,this.g=t||k,this.j=N(this.qb,this),this.l=Date.now()}function He(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Ke(e,t,n){if("function"===typeof e)n&&(e=N(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=N(e.handleEvent,e)}return 2147483647<Number(t)?-1:k.setTimeout(e,t||0)}function ze(e){e.g=Ke((function(){e.g=null,e.i&&(e.i=!1,ze(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}D(We,Ae),(r=We.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Oe(this,"tick"),this.ga&&(He(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){We.$.N.call(this),He(this),delete this.g};var Ye=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return(0,m.Z)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:ze(this)}},{key:"N",value:function(){(0,a.Z)((0,o.Z)(n.prototype),"N",this).call(this),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(P);function Je(e){P.call(this),this.h=e,this.g={}}D(Je,P);var Xe=[];function Qe(e,t,n,r){Array.isArray(n)||(n&&(Xe[0]=n.toString()),n=Xe);for(var i=0;i<n.length;i++){var a=_e(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function $e(e){le(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Se(e)}),e),e.g={}}function et(){this.g=!0}function tt(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return xe(n)}catch(s){return t}}(e,n)+(r?" "+r:"")}))}Je.prototype.N=function(){Je.$.N.call(this),$e(this)},Je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},et.prototype.Ea=function(){this.g=!1},et.prototype.info=function(){};var nt={},rt=null;function it(){return rt=rt||new Ae}function at(e){j.call(this,nt.Ta,e)}function ot(e){var t=it();Oe(t,new at(t))}function st(e,t){j.call(this,nt.STAT_EVENT,e),this.stat=t}function ct(e){var t=it();Oe(t,new st(t,e))}function ut(e,t){j.call(this,nt.Ua,e),this.size=t}function lt(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return k.setTimeout((function(){e()}),t)}nt.Ta="serverreachability",D(at,j),nt.STAT_EVENT="statevent",D(st,j),nt.Ua="timingevent",D(ut,j);var dt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ft={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function pt(){}function ht(e){return e.h||(e.h=e.i())}function vt(){}pt.prototype.h=null;var mt,gt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function yt(){j.call(this,"d")}function _t(){j.call(this,"c")}function Et(){}function bt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Je(this),this.P=St,e=Y?125:void 0,this.V=new We(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new wt}function wt(){this.i=null,this.g="",this.h=!1}D(yt,j),D(_t,j),D(Et,pt),Et.prototype.g=function(){return new XMLHttpRequest},Et.prototype.i=function(){return{}},mt=new Et;var St=45e3,kt={},Tt={};function It(e,t,n){e.L=1,e.v=Wt(Vt(t)),e.s=n,e.S=!0,Ct(e,null)}function Ct(e,t){e.G=Date.now(),Nt(e),e.A=Vt(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),an(n.i,"t",r),e.C=0,n=e.l.J,e.h=new wt,e.g=or(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Ye(N(e.Pa,e,e.g),e.O)),Qe(e.U,e.g,"readystatechange",e.nb),t=e.I?de(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),ot(),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",s=a.split("&"),c=0;c<s.length;c++){var u=s[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function Rt(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function At(e,t,n){for(var r,i=!0;!e.J&&e.C<n.length;){if((r=Ot(e,n))==Tt){4==t&&(e.o=4,ct(14),i=!1),tt(e.j,e.m,null,"[Incomplete Response]");break}if(r==kt){e.o=4,ct(15),tt(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}tt(e.j,e.m,r,null),Mt(e,r)}Rt(e)&&r!=Tt&&r!=kt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ct(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(t),t.M=!0,ct(11))):(tt(e.j,e.m,n,"[Invalid Chunked Response]"),Lt(e),Pt(e))}function Ot(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Tt:(n=Number(t.substring(n,r)),isNaN(n)?kt:(r+=1)+n>t.length?Tt:(t=t.slice(r,r+n),e.C=r+n,t))}function Nt(e){e.Y=Date.now()+e.P,xt(e,e.P)}function xt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=lt(N(e.lb,e),t)}function Dt(e){e.B&&(k.clearTimeout(e.B),e.B=null)}function Pt(e){0==e.l.H||e.J||tr(e.l,e)}function Lt(e){Dt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,He(e.V),$e(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Mt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||fn(n.i,e)))if(!e.K&&fn(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;er(n),qn(n)}Xn(n),ct(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=lt(N(n.ib,n),6e3));if(1>=dn(n.i)&&n.oa){try{n.oa()}catch(a){}n.oa=void 0}}else rr(n,11)}else if((e.K||n.g==e)&&er(n),!V(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.V=a[0],a=a[1],2==n.H)if("c"==a[0]){n.K=a[1],n.pa=a[2];var o=a[3];null!=o&&(n.ra=o,n.l.info("VER="+n.ra));var s=a[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));var c=a[5];null!=c&&"number"===typeof c&&0<c&&(r=1.5*c,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;var u=e.g;if(u){var l=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var d=r.i;d.g||-1==l.indexOf("spdy")&&-1==l.indexOf("quic")&&-1==l.indexOf("h2")||(d.j=d.l,d.g=new Set,d.h&&(pn(d,d.h),d.h=null))}if(r.F){var f=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.Da=f,qt(r.I,r.F,f))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var p=e;if((r=n).wa=ar(r,r.J?r.pa:null,r.Y),p.K){hn(r.i,p);var h=p,v=r.L;v&&h.setTimeout(v),h.B&&(Dt(h),Nt(h)),r.g=p}else Jn(r);0<n.j.length&&Hn(n)}else"stop"!=a[0]&&"close"!=a[0]||rr(n,7);else 3==n.H&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?rr(n,7):Zn(n):"noop"!=a[0]&&n.h&&n.h.Aa(a),n.A=0)}ot()}catch(a){}}function Ut(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(T(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(T(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(T(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}(r=bt.prototype).setTimeout=function(e){this.P=e},r.nb=function(e){e=e.target;var t=this.M;t&&3==Un(e)?t.l():this.Pa(e)},r.Pa=function(e){try{if(e==this.g)e:{var t=Un(this.g),n=this.g.Ia();this.g.da();if(!(3>t)&&(3!=t||Y||this.g&&(this.h.h||this.g.ja()||jn(this.g)))){this.J||4!=t||7==n||ot(),Dt(this);var r=this.g.da();this.ca=r;t:if(Rt(this)){var i=jn(this.g);e="";var a=i.length,o=4==Un(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Lt(this),Pt(this);var s="";break t}this.h.i=new k.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==a-1});i.splice(0,a),this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.ja();if(this.i=200==r,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.u,this.A,this.m,this.W,t,r),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(c)){var l=c;break t}}l=null}if(!(r=l)){this.i=!1,this.o=3,ct(12),Lt(this),Pt(this);break e}tt(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mt(this,r)}this.S?(At(this,t,s),Y&&this.i&&3==t&&(Qe(this.U,this.V,"tick",this.mb),this.V.start())):(tt(this.j,this.m,s,null),Mt(this,s)),4==t&&Lt(this),this.i&&!this.J&&(4==t?tr(this.l,this):(this.i=!1,Nt(this)))}else(function(e){var t={};e=(e.g&&2<=Un(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(var n=0;n<e.length;n++)if(!V(e[n])){var r=je(e[n]),i=r[0];if("string"===typeof(r=r[1])){r=r.trim();var a=t[i]||[];t[i]=a,a.push(r)}}!function(e,t){for(var n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==r&&0<s.indexOf("Unknown SID")?(this.o=3,ct(12)):(this.o=0,ct(13)),Lt(this),Pt(this)}}}catch(t){}},r.mb=function(){if(this.g){var e=Un(this.g),t=this.g.ja();this.C<t.length&&(Dt(this),At(this,e,t),this.i&&4!=e&&Nt(this))}},r.cancel=function(){this.J=!0,Lt(this)},r.lb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(ot(),ct(17)),Lt(this),this.o=2,Pt(this)):xt(this,this.Y-e)};var jt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ft(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Ft){this.h=e.h,Bt(this,e.j),this.s=e.s,this.g=e.g,Gt(this,e.m),this.l=e.l;var t=e.i,n=new en;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Zt(this,n),this.o=e.o}else e&&(t=String(e).match(jt))?(this.h=!1,Bt(this,t[1]||"",!0),this.s=Ht(t[2]||""),this.g=Ht(t[3]||"",!0),Gt(this,t[4]),this.l=Ht(t[5]||"",!0),Zt(this,t[6]||"",!0),this.o=Ht(t[7]||"")):(this.h=!1,this.i=new en(null,this.h))}function Vt(e){return new Ft(e)}function Bt(e,t,n){e.j=n?Ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Gt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Zt(e,t,n){t instanceof en?(e.i=t,function(e,t){t&&!e.j&&(tn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(nn(this,t),an(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Kt(t,Qt)),e.i=new en(t,e.h))}function qt(e,t,n){e.i.set(t,n)}function Wt(e){return qt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Kt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,zt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function zt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ft.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Kt(t,Yt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Kt(t,Yt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Kt(n,"/"==n.charAt(0)?Xt:Jt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Kt(n,$t)),e.join("")};var Yt=/[#\/\?@]/g,Jt=/[#\?:]/g,Xt=/[#\?]/g,Qt=/[#\?@]/g,$t=/#/g;function en(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tn(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function nn(e,t){tn(e),t=on(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function rn(e,t){return tn(e),t=on(e,t),e.g.has(t)}function an(e,t,n){nn(e,t),0<n.length&&(e.i=null,e.g.set(on(e,t),M(n)),e.h+=n.length)}function on(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=en.prototype).add=function(e,t){tn(this),this.i=null,e=on(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){tn(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.ta=function(){tn(this);for(var e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.Z=function(e){tn(this);var t=[];if("string"===typeof e)rn(this,e)&&(t=t.concat(this.g.get(on(this,e))));else{e=Array.from(this.g.values());for(var n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return tn(this),this.i=null,rn(this,e=on(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var o=i;""!==a[r]&&(o+="="+encodeURIComponent(String(a[r]))),e.push(o)}}return this.i=e.join("&")};var sn=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.g=t,this.map=n}));function cn(e){this.l=e||un,k.PerformanceNavigationTiming?e=0<(e=k.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var un=10;function ln(e){return!!e.h||!!e.g&&e.g.size>=e.j}function dn(e){return e.h?1:e.g?e.g.size:0}function fn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function pn(e,t){e.g?e.g.add(t):e.h=t}function hn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function vn(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,u.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.F)}}catch(a){r.e(a)}finally{r.f()}return n}return M(e.i)}cn.prototype.cancel=function(){if(this.i=vn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,u.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}};var mn,gn=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"stringify",value:function(e){return k.JSON.stringify(e,void 0)}},{key:"parse",value:function(e){return k.JSON.parse(e,void 0)}}]),e}();function yn(){this.g=new gn}function _n(e,t,n){var r=n||"";try{Ut(e,(function(e,n){var i=e;I(e)&&(i=xe(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function En(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function bn(e){this.l=e.ec||null,this.j=e.ob||!1}function wn(e,t){Ae.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Sn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}D(bn,pt),bn.prototype.g=function(){return new wn(this.l,this.j)},bn.prototype.i=(mn={},function(){return mn}),D(wn,Ae);var Sn=0;function kn(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Tn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,In(e)}function In(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=wn.prototype).open=function(e,t){if(this.readyState!=Sn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,In(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||k).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((function(){})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Tn(this)),this.readyState=Sn},r.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof k.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;kn(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Tn(this):In(this),3==this.readyState&&kn(this)}},r.Za=function(e){this.g&&(this.response=this.responseText=e,Tn(this))},r.Ya=function(e){this.g&&(this.response=e,Tn(this))},r.ka=function(){this.g&&Tn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(wn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Cn=k.JSON.parse;function Rn(e){Ae.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=An,this.L=this.M=!1}D(Rn,Ae);var An="",On=/^https?$/i,Nn=["POST","PUT"];function xn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Dn(e),Ln(e)}function Dn(e){e.F||(e.F=!0,Oe(e,"complete"),Oe(e,"error"))}function Pn(e){if(e.h&&"undefined"!=typeof S&&(!e.C[1]||4!=Un(e)||2!=e.da()))if(e.v&&4==Un(e))Ke(e.La,0,e);else if(Oe(e,"readystatechange"),4==Un(e)){e.h=!1;try{var t,n=e.da();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.I).match(jt)[1]||null;!a&&k.self&&k.self.location&&(a=k.self.location.protocol.slice(0,-1)),i=!On.test(a?a.toLowerCase():"")}t=i}if(t)Oe(e,"complete"),Oe(e,"success");else{e.m=6;try{var o=2<Un(e)?e.g.statusText:""}catch(s){o=""}e.j=o+" ["+e.da()+"]",Dn(e)}}finally{Ln(e)}}}function Ln(e,t){if(e.g){Mn(e);var n=e.g,r=e.C[0]?function(){}:null;e.g=null,e.C=null,t||Oe(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Mn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(k.clearTimeout(e.A),e.A=null)}function Un(e){return e.g?e.g.readyState:0}function jn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case An:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Wr){return null}}function Fn(e){var t="";return le(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Vn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Fn(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):qt(e,t,n))}function Bn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Gn(e){this.Ga=0,this.j=[],this.l=new et,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Bn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Bn("baseRetryDelayMs",5e3,e),this.hb=Bn("retryDelaySeedMs",1e4,e),this.eb=Bn("forwardChannelMaxRetries",2,e),this.xa=Bn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new cn(e&&e.concurrentRequestLimit),this.Ja=new yn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Zn(e){if(Wn(e),3==e.H){var t=e.W++,n=Vt(e.I);if(qt(n,"SID",e.K),qt(n,"RID",t),qt(n,"TYPE","terminate"),zn(e,n),(t=new bt(e,e.l,t)).L=2,t.v=Wt(Vt(n)),n=!1,k.navigator&&k.navigator.sendBeacon)try{n=k.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&k.Image&&((new Image).src=t.v,n=!0),n||(t.g=or(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Nt(t)}ir(e)}function qn(e){e.g&&(Qn(e),e.g.cancel(),e.g=null)}function Wn(e){qn(e),e.u&&(k.clearTimeout(e.u),e.u=null),er(e),e.i.cancel(),e.m&&("number"===typeof e.m&&k.clearTimeout(e.m),e.m=null)}function Hn(e){if(!ln(e.i)&&!e.m){e.m=!0;var t=e.Na;Ve||Ze(),Be||(Ve(),Be=!0),Ge.add(t,e),e.C=0}}function Kn(e,t){var n;n=t?t.m:e.W++;var r=Vt(e.I);qt(r,"SID",e.K),qt(r,"RID",n),qt(r,"AID",e.V),zn(e,r),e.o&&e.s&&Vn(r,e.o,e.s),n=new bt(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Yn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),pn(e.i,n),It(n,r,t)}function zn(e,t){e.na&&le(e.na,(function(e,n){qt(t,n,e)})),e.h&&Ut({},(function(e,n){qt(t,n,e)}))}function Yn(e,t,n){n=Math.min(e.j.length,n);var r=e.h?N(e.h.Va,e.h,e):null;e:for(var i=e.j,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].g,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,c=0;c<n;c++){var u=i[c].g,l=i[c].map;if(0>(u-=a))a=Math.max(0,i[c].g-100),s=!1;else try{_n(l,o,"req"+u+"_")}catch(d){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.j.splice(0,n),t.F=e,r}function Jn(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Ve||Ze(),Be||(Ve(),Be=!0),Ge.add(t,e),e.A=0}}function Xn(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=lt(N(e.Ma,e),nr(e,e.A)),e.A++,!0)}function Qn(e){null!=e.B&&(k.clearTimeout(e.B),e.B=null)}function $n(e){e.g=new bt(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Vt(e.wa);qt(t,"RID","rpc"),qt(t,"SID",e.K),qt(t,"AID",e.V),qt(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&qt(t,"TO",e.qa),qt(t,"TYPE","xmlhttp"),zn(e,t),e.o&&e.s&&Vn(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Wt(Vt(t)),n.s=null,n.S=!0,Ct(n,e)}function er(e){null!=e.v&&(k.clearTimeout(e.v),e.v=null)}function tr(e,t){var n=null;if(e.g==t){er(e),Qn(e),e.g=null;var r=2}else{if(!fn(e.i,t))return;n=t.F,hn(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;Oe(r=it(),new ut(r,n)),Hn(e)}else Jn(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(dn(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):!(1==e.H||2==e.H||e.C>=(e.cb?0:e.eb))&&(e.m=lt(N(e.Na,e,t),nr(e,e.C)),e.C++,!0))}(e,t)||2==r&&Xn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:rr(e,5);break;case 4:rr(e,10);break;case 3:rr(e,6);break;default:rr(e,2)}}function nr(e,t){var n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function rr(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=N(e.pb,e);n||(n=new Ft("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Bt(n,"https"),Wt(n)),function(e,t){var n=new et;if(k.Image){var r=new Image;r.onload=x(En,n,r,"TestLoadImage: loaded",!0,t),r.onerror=x(En,n,r,"TestLoadImage: error",!1,t),r.onabort=x(En,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=x(En,n,r,"TestLoadImage: timeout",!1,t),k.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else ct(2);e.H=0,e.h&&e.h.za(t),ir(e),Wn(e)}function ir(e){if(e.H=0,e.ma=[],e.h){var t=vn(e.i);0==t.length&&0==e.j.length||(U(e.ma,t),U(e.ma,e.j),e.i.i.length=0,M(e.j),e.j.length=0),e.h.ya()}}function ar(e,t,n){var r=n instanceof Ft?Vt(n):new Ft(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Gt(r,r.m);else{var i=k.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new Ft(null);r&&Bt(a,r),t&&(a.g=t),i&&Gt(a,i),n&&(a.l=n),r=a}return n=e.F,t=e.Da,n&&t&&qt(r,n,t),qt(r,"VER",e.ra),zn(e,r),r}function or(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Rn(new bn({ob:!0})):new Rn(e.va)).Oa(e.J),t}function sr(){}function cr(){if(K&&!(10<=Number(re)))throw Error("Environmental error: no available transport.")}function ur(e,t){Ae.call(this),this.g=new Gn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!V(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!V(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new fr(this)}function lr(e){yt.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function dr(){_t.call(this),this.status=1}function fr(e){this.g=e}function pr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function hr(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],o=t+(a^n&(i^a))+r[0]+3614090360&4294967295;o=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(o<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((a=(t=n+((o=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=a+((o=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function vr(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}(r=Rn.prototype).Oa=function(e){this.M=e},r.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():mt.g(),this.C=this.u?ht(this.u):ht(mt),this.g.onreadystatechange=N(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(c){return void xn(this,c)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));var a,o=(0,u.Z)(r.keys());try{for(o.s();!(a=o.n()).done;){var c=a.value;n.set(c,r.get(c))}}catch(v){o.e(v)}finally{o.f()}}r=Array.from(n.keys()).find((function(e){return"content-type"==e.toLowerCase()})),i=k.FormData&&e instanceof k.FormData,!(0<=L(Nn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var l,d=(0,u.Z)(n);try{for(d.s();!(l=d.n()).done;){var f=(0,s.Z)(l.value,2),p=f[0],h=f[1];this.g.setRequestHeader(p,h)}}catch(v){d.e(v)}finally{d.f()}this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Mn(this),0<this.B&&((this.L=function(e){return K&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=N(this.ua,this)):this.A=Ke(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(c){xn(this,c)}},r.ua=function(){"undefined"!=typeof S&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Oe(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Oe(this,"complete"),Oe(this,"abort"),Ln(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ln(this,!0)),Rn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?Pn(this):this.kb())},r.kb=function(){Pn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<Un(this)?this.g.status:-1}catch(mn){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(mn){return""}},r.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Cn(t)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=Gn.prototype).ra=8,r.H=1,r.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;var t=new bt(this,this.l,e),n=this.s;if(this.U&&(n?pe(n=de(n),this.U):n=this.U),null!==this.o||this.O||(t.I=n,n=null),this.P)e:{for(var r=0,i=0;i<this.j.length;i++){var a=this.j[i];if(void 0===(a="__data__"in a.map&&"string"===typeof(a=a.map.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.j.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=Yn(this,t,r),qt(i=Vt(this.I),"RID",e),qt(i,"CVER",22),this.F&&qt(i,"X-HTTP-Session-Id",this.F),zn(this,i),n&&(this.O?r="headers="+encodeURIComponent(String(Fn(n)))+"&"+r:this.o&&Vn(i,this.o,n)),pn(this.i,t),this.bb&&qt(i,"TYPE","init"),this.P?(qt(i,"$req",r),qt(i,"SID","null"),t.aa=!0,It(t,i,null)):It(t,i,r),this.H=2}}else 3==this.H&&(e?Kn(this,e):0==this.j.length||ln(this.i)||Kn(this))},r.Ma=function(){if(this.u=null,$n(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=lt(N(this.jb,this),e)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ct(10),qn(this),$n(this))},r.ib=function(){null!=this.v&&(this.v=null,qn(this),Xn(this),ct(19))},r.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ct(2)):(this.l.info("Failed to ping google.com"),ct(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=sr.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},cr.prototype.g=function(e,t){return new ur(e,t)},D(ur,Ae),ur.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;ct(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=ar(e,null,e.Y),Hn(e)},ur.prototype.close=function(){Zn(this.g)},ur.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=xe(e),e=n);t.j.push(new sn(t.fb++,e)),3==t.H&&Hn(t)},ur.prototype.N=function(){this.g.h=null,delete this.j,Zn(this.g),delete this.g,ur.$.N.call(this)},D(lr,yt),D(dr,_t),D(fr,sr),fr.prototype.Ba=function(){Oe(this.g,"a")},fr.prototype.Aa=function(e){Oe(this.g,new lr(e))},fr.prototype.za=function(e){Oe(this.g,new dr)},fr.prototype.ya=function(){Oe(this.g,"b")},D(pr,(function(){this.blockSize=-1})),pr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},pr.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)hr(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){hr(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){hr(this,r),i=0;break}}this.h=i,this.i+=t},pr.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var mr={};function gr(e){return-128<=e&&128>e?function(e,t){var n=mr;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new vr([0|e],0>e?-1:0)})):new vr([0|e],0>e?-1:0)}function yr(e){if(isNaN(e)||!isFinite(e))return Er;if(0>e)return Tr(yr(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=_r;return new vr(t,0)}var _r=4294967296,Er=gr(0),br=gr(1),wr=gr(16777216);function Sr(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function kr(e){return-1==e.h}function Tr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new vr(n,~e.h).add(br)}function Ir(e,t){return e.add(Tr(t))}function Cr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Rr(e,t){this.g=e,this.h=t}function Ar(e,t){if(Sr(t))throw Error("division by zero");if(Sr(e))return new Rr(Er,Er);if(kr(e))return t=Ar(Tr(e),t),new Rr(Tr(t.g),Tr(t.h));if(kr(t))return t=Ar(e,Tr(t)),new Rr(Tr(t.g),t.h);if(30<e.g.length){if(kr(e)||kr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=br,r=t;0>=r.X(e);)n=Or(n),r=Or(r);var i=Nr(n,1),a=Nr(r,1);for(r=Nr(r,2),n=Nr(n,2);!Sr(r);){var o=a.add(r);0>=o.X(e)&&(i=i.add(n),a=o),r=Nr(r,1),n=Nr(n,1)}return t=Ir(e,i.R(t)),new Rr(i,t)}for(i=Er;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(a=yr(n)).R(t);kr(o)||0<o.X(e);)o=(a=yr(n-=r)).R(t);Sr(a)&&(a=br),i=i.add(a),e=Ir(e,o)}return new Rr(i,e)}function Or(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new vr(n,e.h)}function Nr(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.D(a+n)>>>t|e.D(a+n+1)<<32-t:e.D(a+n);return new vr(i,e.h)}(r=vr.prototype).ea=function(){if(kr(this))return-Tr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:_r+r)*t,t*=_r}return e},r.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Sr(this))return"0";if(kr(this))return"-"+Tr(this).toString(e);for(var t=yr(Math.pow(e,6)),n=this,r="";;){var i=Ar(n,t).g,a=((0<(n=Ir(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Sr(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},r.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},r.X=function(e){return kr(e=Ir(this,e))?-1:Sr(e)?0:1},r.abs=function(){return kr(this)?Tr(this):this},r.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.D(i))+(65535&e.D(i)),o=(a>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new vr(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(e){if(Sr(this)||Sr(e))return Er;if(kr(this))return kr(e)?Tr(this).R(Tr(e)):Tr(Tr(this).R(e));if(kr(e))return Tr(this.R(Tr(e)));if(0>this.X(wr)&&0>e.X(wr))return yr(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.D(r)>>>16,o=65535&this.D(r),s=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Cr(n,2*r+2*i),n[2*r+2*i+1]+=a*c,Cr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*s,Cr(n,2*r+2*i+1),n[2*r+2*i+2]+=a*s,Cr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new vr(n,0)},r.gb=function(e){return Ar(this,e).h},r.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new vr(n,this.h&e.h)},r.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new vr(n,this.h|e.h)},r.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new vr(n,this.h^e.h)},cr.prototype.createWebChannel=cr.prototype.g,ur.prototype.send=ur.prototype.u,ur.prototype.open=ur.prototype.m,ur.prototype.close=ur.prototype.close,dt.NO_ERROR=0,dt.TIMEOUT=8,dt.HTTP_ERROR=6,ft.COMPLETE="complete",vt.EventType=gt,gt.OPEN="a",gt.CLOSE="b",gt.ERROR="c",gt.MESSAGE="d",Ae.prototype.listen=Ae.prototype.O,Rn.prototype.listenOnce=Rn.prototype.P,Rn.prototype.getLastError=Rn.prototype.Sa,Rn.prototype.getLastErrorCode=Rn.prototype.Ia,Rn.prototype.getStatus=Rn.prototype.da,Rn.prototype.getResponseJson=Rn.prototype.Wa,Rn.prototype.getResponseText=Rn.prototype.ja,Rn.prototype.send=Rn.prototype.ha,Rn.prototype.setWithCredentials=Rn.prototype.Oa,pr.prototype.digest=pr.prototype.l,pr.prototype.reset=pr.prototype.reset,pr.prototype.update=pr.prototype.j,vr.prototype.add=vr.prototype.add,vr.prototype.multiply=vr.prototype.R,vr.prototype.modulo=vr.prototype.gb,vr.prototype.compare=vr.prototype.X,vr.prototype.toNumber=vr.prototype.ea,vr.prototype.toString=vr.prototype.toString,vr.prototype.getBits=vr.prototype.D,vr.fromNumber=yr,vr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Tr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=yr(Math.pow(n,8)),i=Er,a=0;a<t.length;a+=8){var o=Math.min(8,t.length-a),s=parseInt(t.substring(a,a+o),n);8>o?(o=yr(Math.pow(n,o)),i=i.R(o).add(yr(s))):i=(i=i.R(r)).add(yr(s))}return i};var xr=w.createWebChannelTransport=function(){return new cr},Dr=w.getStatEventTarget=function(){return it()},Pr=w.ErrorCode=dt,Lr=w.EventType=ft,Mr=w.Event=nt,Ur=w.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},jr=(w.FetchXmlHttpFactory=bn,w.WebChannel=vt),Fr=w.XhrIo=Rn,Vr=w.Md5=pr,Br=w.Integer=vr,Gr="@firebase/firestore",Zr=function(){function e(t){(0,v.Z)(this,e),this.uid=t}return(0,m.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Zr.UNAUTHENTICATED=new Zr(null),Zr.GOOGLE_CREDENTIALS=new Zr("google-credentials-uid"),Zr.FIRST_PARTY=new Zr("first-party-uid"),Zr.MOCK_USER=new Zr("mock-user");var qr="10.4.0",Wr=new _.Yd("@firebase/firestore");function Hr(){return Wr.logLevel}function Kr(e){if(Wr.logLevel<=_.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Jr);Wr.debug.apply(Wr,["Firestore (".concat(qr,"): ").concat(e)].concat((0,h.Z)(i)))}}function zr(e){if(Wr.logLevel<=_.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Jr);Wr.error.apply(Wr,["Firestore (".concat(qr,"): ").concat(e)].concat((0,h.Z)(i)))}}function Yr(e){if(Wr.logLevel<=_.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Jr);Wr.warn.apply(Wr,["Firestore (".concat(qr,"): ").concat(e)].concat((0,h.Z)(i)))}}function Jr(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Xr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(qr,") INTERNAL ASSERTION FAILED: ")+e;throw zr(t),new Error(t)}function Qr(e,t){e||Xr()}function $r(e,t){return e}var ei={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,m.Z)(n)}(E.ZR),ni=(0,m.Z)((function e(){var t=this;(0,v.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),ri=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),ii=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Zr.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),ai=function(){function e(t){(0,v.Z)(this,e),this.token=t,this.changeListener=null}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),oi=function(){function e(t){(0,v.Z)(this,e),this.t=t,this.currentUser=Zr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new ni;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new ni,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){Kr("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(Kr("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new ni)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(Kr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Qr("string"==typeof n.accessToken),new ri(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Qr(null===e||"string"==typeof e),new Zr(e)}}]),e}(),si=function(){function e(t,n,r){(0,v.Z)(this,e),this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=Zr.FIRST_PARTY,this.I=new Map}return(0,m.Z)(e,[{key:"T",value:function(){return this.P?this.P():null}},{key:"headers",get:function(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}]),e}(),ci=function(){function e(t,n,r){(0,v.Z)(this,e),this.l=t,this.h=n,this.P=r}return(0,m.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new si(this.l,this.h,this.P))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Zr.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ui=(0,m.Z)((function e(t){(0,v.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),li=function(){function e(t){(0,v.Z)(this,e),this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}return(0,m.Z)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&Kr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.R;return n.R=e.token,Kr("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){Kr("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.A.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.A.getImmediate({optional:!0});e?i(e):Kr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(Qr("string"==typeof t.token),e.R=t.token,new ui(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function di(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var fi=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,null,[{key:"V",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62),n="";n.length<20;)for(var r=di(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62));return n}}]),e}();function pi(e,t){return e<t?-1:e>t?1:0}function hi(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}var vi=function(){function e(t,n){if((0,v.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new ti(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ti(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new ti(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ti(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,m.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?pi(this.nanoseconds,e.nanoseconds):pi(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),mi=function(){function e(t){(0,v.Z)(this,e),this.timestamp=t}return(0,m.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new vi(0,0))}},{key:"max",value:function(){return new e(new vi(253402300799,999999999))}}]),e}(),gi=function(){function e(t,n,r){(0,v.Z)(this,e),void 0===n?n=0:n>t.length&&Xr(),void 0===r?r=t.length-n:r>t.length-n&&Xr(),this.segments=t,this.offset=n,this.len=r}return(0,m.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),yi=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new ti(ei.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,(0,h.Z)(s.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),_i=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ei=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return _i.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new ti(ei.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new ti(ei.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new ti(ei.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(r+=s,i++):(a(),i++)}if(a(),o)throw new ti(ei.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),bi=function(){function e(t){(0,v.Z)(this,e),this.path=t}return(0,m.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===yi.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(yi.fromString(t))}},{key:"fromName",value:function(t){return new e(yi.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(yi.emptyPath())}},{key:"comparator",value:function(e,t){return yi.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new yi(t.slice()))}}]),e}(),wi=(0,m.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));wi.UNKNOWN_ID=-1;function Si(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=mi.fromTimestamp(1e9===r?new vi(n+1,0):new vi(n,r));return new Ti(i,bi.empty(),t)}function ki(e){return new Ti(e.readTime,e.key,-1)}var Ti=function(){function e(t,n,r){(0,v.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,m.Z)(e,null,[{key:"min",value:function(){return new e(mi.min(),bi.empty(),-1)}},{key:"max",value:function(){return new e(mi.max(),bi.empty(),-1)}}]),e}();function Ii(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=bi.comparator(e.documentKey,t.documentKey))?n:pi(e.largestBatchId,t.largestBatchId)}var Ci="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ri=function(){function e(){(0,v.Z)(this,e),this.onCommittedListeners=[]}return(0,m.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function Ai(e){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===ei.FAILED_PRECONDITION&&t.message===Ci){e.next=2;break}throw t;case 2:Kr("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ni=function(){function e(t){var n=this;(0,v.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,m.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,u.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var i=t.length,a=new Array(i),o=0,s=function(){var s=c;n(t[s]).next((function(t){a[s]=t,++o===i&&e(a)}),(function(e){return r(e)}))},c=0;c<i;c++)s()}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function i(){!0===t()?n().next((function(){i()}),r):e()}()}))}}]),e}();function xi(e){return"IndexedDbTransactionError"===e.name}var Di=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.oe(e)},this._e=function(e){return n.writeSequenceNumber(e)})}return(0,m.Z)(e,[{key:"oe",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this._e&&this._e(e),e}}]),e}();function Pi(e){return null==e}function Li(e){return 0===e&&1/e==-1/0}function Mi(e){return"number"==typeof e&&Number.isInteger(e)&&!Li(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Di.ae=-1;var Ui=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),ji=([].concat((0,h.Z)(Ui),["documentOverlays"]),["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"]),Fi=ji;[].concat(Fi,["indexConfiguration","indexState","indexEntries"]);function Vi(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Bi(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Gi(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Zi=function(){function e(t,n){(0,v.Z)(this,e),this.comparator=t,this.root=n||Wi.EMPTY}return(0,m.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Wi.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Wi.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new qi(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new qi(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new qi(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new qi(this.root,e,this.comparator,!0)}}]),e}(),qi=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,m.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Wi=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,m.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Xr();if(this.right.isRed())throw Xr();var e=this.left.check();if(e!==this.right.check())throw Xr();return e+(this.isRed()?0:1)}}]),e}();Wi.EMPTY=null,Wi.RED=!0,Wi.BLACK=!1,Wi.EMPTY=new(function(){function e(){(0,v.Z)(this,e),this.size=0}return(0,m.Z)(e,[{key:"key",get:function(){throw Xr()}},{key:"value",get:function(){throw Xr()}},{key:"color",get:function(){throw Xr()}},{key:"left",get:function(){throw Xr()}},{key:"right",get:function(){throw Xr()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Wi(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Hi=function(){function e(t){(0,v.Z)(this,e),this.comparator=t,this.data=new Zi(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Ki(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Ki(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Ki=function(){function e(t){(0,v.Z)(this,e),this.iter=t}return(0,m.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();var zi=function(){function e(t){(0,v.Z)(this,e),this.fields=t,t.sort(Ei.comparator)}return(0,m.Z)(e,[{key:"unionWith",value:function(t){var n,r=new Hi(Ei.comparator),i=(0,u.Z)(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(l){i.e(l)}finally{i.f()}var o,s=(0,u.Z)(t);try{for(s.s();!(o=s.n()).done;){var c=o.value;r=r.add(c)}}catch(l){s.e(l)}finally{s.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=(0,u.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return hi(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}(),Yi=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).name="Base64DecodeError",e}return(0,m.Z)(n)}((0,c.Z)(Error));var Ji=function(e){function t(e){(0,v.Z)(this,t),this.binaryString=e}return(0,m.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return pi(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){var n=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Yi("Invalid base64 string: "+e):e}}(e);return new t(n)}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);Ji.EMPTY_BYTE_STRING=new Ji("");var Xi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qi(e){if(Qr(!!e),"string"==typeof e){var t=0,n=Xi.exec(e);if(Qr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:$i(e.seconds),nanos:$i(e.nanos)}}function $i(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ea(e){return"string"==typeof e?Ji.fromBase64String(e):Ji.fromUint8Array(e)}function ta(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function na(e){var t=e.mapValue.fields.__previous_value__;return ta(t)?na(t):t}function ra(e){var t=Qi(e.mapValue.fields.__local_write_time__.timestampValue);return new vi(t.seconds,t.nanos)}var ia=(0,m.Z)((function e(t,n,r,i,a,o,s,c,u){(0,v.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=c,this.useFetchStreams=u})),aa=function(){function e(t,n){(0,v.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,m.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}(),oa={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function sa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ta(e)?4:ba(e)?9007199254740991:10:Xr()}function ca(e,t){if(e===t)return!0;var n=sa(e);if(n!==sa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ra(e).isEqual(ra(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Qi(e.timestampValue),r=Qi(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ea(e.bytesValue).isEqual(ea(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return $i(e.geoPointValue.latitude)===$i(t.geoPointValue.latitude)&&$i(e.geoPointValue.longitude)===$i(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return $i(e.integerValue)===$i(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=$i(e.doubleValue),r=$i(t.doubleValue);return n===r?Li(n)===Li(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return hi(e.arrayValue.values||[],t.arrayValue.values||[],ca);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Vi(n)!==Vi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ca(n[i],r[i])))return!1;return!0}(e,t);default:return Xr()}}function ua(e,t){return void 0!==(e.values||[]).find((function(e){return ca(e,t)}))}function la(e,t){if(e===t)return 0;var n=sa(e),r=sa(t);if(n!==r)return pi(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return pi(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=$i(e.integerValue||e.doubleValue),r=$i(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return da(e.timestampValue,t.timestampValue);case 4:return da(ra(e),ra(t));case 5:return pi(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ea(e),r=ea(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=pi(n[i],r[i]);if(0!==a)return a}return pi(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=pi($i(e.latitude),$i(t.latitude));return 0!==n?n:pi($i(e.longitude),$i(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=la(n[i],r[i]);if(a)return a}return pi(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===oa.mapValue&&t===oa.mapValue)return 0;if(e===oa.mapValue)return 1;if(t===oa.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=pi(r[o],a[o]);if(0!==s)return s;var c=la(n[r[o]],i[a[o]]);if(0!==c)return c}return pi(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Xr()}}function da(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return pi(e,t);var n=Qi(e),r=Qi(t),i=pi(n.seconds,r.seconds);return 0!==i?i:pi(n.nanos,r.nanos)}function fa(e){return pa(e)}function pa(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Qi(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ea(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return bi.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,u.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=pa(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,u.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(pa(e.fields[o]))}}catch(s){a.e(s)}finally{a.f()}return r+"}"}(e.mapValue):Xr()}function ha(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function va(e){return!!e&&"integerValue"in e}function ma(e){return!!e&&"arrayValue"in e}function ga(e){return!!e&&"nullValue"in e}function ya(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function _a(e){return!!e&&"mapValue"in e}function Ea(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Bi(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Ea(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ea(e.arrayValue.values[r]);return n}return Object.assign({},e)}function ba(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}var wa=function(){function e(t){(0,v.Z)(this,e),this.value=t}return(0,m.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!_a(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ea(t)}},{key:"setAll",value:function(e){var t=this,n=Ei.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Ea(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());_a(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return ca(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];_a(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){Bi(t,(function(t,n){return e[t]=n}));var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(Ea(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Sa(e){var t=[];return Bi(e.fields,(function(e,n){var r=new Ei([e]);if(_a(n)){var i=Sa(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=(0,u.Z)(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(r.child(s))}}catch(c){o.e(c)}finally{o.f()}}}else t.push(r)})),new zi(t)}var ka=function(){function e(t,n,r,i,a,o,s){(0,v.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=s}return(0,m.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return!this.createTime.isEqual(mi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=wa.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=wa.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=mi.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,mi.min(),mi.min(),mi.min(),wa.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,mi.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,mi.min(),mi.min(),wa.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,mi.min(),mi.min(),wa.empty(),2)}}]),e}(),Ta=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.position=t,this.inclusive=n}));function Ia(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?bi.comparator(bi.fromName(o.referenceValue),n.key):la(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function Ca(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!ca(e.position[n],t.position[n]))return!1;return!0}var Ra=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,v.Z)(this,e),this.field=t,this.dir=n}));function Aa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Oa=(0,m.Z)((function e(){(0,v.Z)(this,e)})),Na=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(la(t,this.value)):null!==t&&sa(this.value)===sa(t)&&this.matchesComparison(la(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Xr()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}},{key:"getFirstInequalityField",value:function(){return this.isInequality()?this.field:null}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Fa(e,t,r):"array-contains"===t?new Za(e,r):"in"===t?new qa(e,r):"not-in"===t?new Wa(e,r):"array-contains-any"===t?new Ha(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new Va(e,n):new Ba(e,n)}}]),n}(Oa),xa=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).filters=e,i.op=r,i.ce=null,i}return(0,m.Z)(n,[{key:"matches",value:function(e){return Da(this)?void 0===this.filters.find((function(t){return!t.matches(e)})):void 0!==this.filters.find((function(t){return t.matches(e)}))}},{key:"getFlattenedFilters",value:function(){return null!==this.ce||(this.ce=this.filters.reduce((function(e,t){return e.concat(t.getFlattenedFilters())}),[])),this.ce}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}},{key:"getFirstInequalityField",value:function(){var e=this.le((function(e){return e.isInequality()}));return null!==e?e.field:null}},{key:"le",value:function(e){var t,n=(0,u.Z)(this.getFlattenedFilters());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e(r))return r}}catch(i){n.e(i)}finally{n.f()}return null}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(Oa);function Da(e){return"and"===e.op}function Pa(e){return La(e)&&Da(e)}function La(e){var t,n=(0,u.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){if(t.value instanceof xa)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}function Ma(e){if(e instanceof Na)return e.field.canonicalString()+e.op.toString()+fa(e.value);if(Pa(e))return e.filters.map((function(e){return Ma(e)})).join(",");var t=e.filters.map((function(e){return Ma(e)})).join(",");return"".concat(e.op,"(").concat(t,")")}function Ua(e,t){return e instanceof Na?function(e,t){return t instanceof Na&&e.op===t.op&&e.field.isEqual(t.field)&&ca(e.value,t.value)}(e,t):e instanceof xa?function(e,t){return t instanceof xa&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((function(e,n,r){return e&&Ua(n,t.filters[r])}),!0)}(e,t):void Xr()}function ja(e){return e instanceof Na?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(fa(e.value))}(e):e instanceof xa?function(e){return e.op.toString()+" {"+e.getFilters().map(ja).join(" ,")+"}"}(e):"Filter"}var Fa=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,i)).key=bi.fromName(i.referenceValue),a}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=bi.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(Na),Va=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"in",r)).keys=Ga("in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Na),Ba=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=Ga("not-in",r),i}return(0,m.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Na);function Ga(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return bi.fromName(e.referenceValue)}))}var Za=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return ma(t)&&ua(t.arrayValue,this.value)}}]),n}(Na),qa=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&ua(this.value.arrayValue,t)}}]),n}(Na),Wa=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"not-in",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){if(ua(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!ua(this.value.arrayValue,t)}}]),n}(Na),Ha=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,m.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!ma(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return ua(t.value.arrayValue,e)}))}}]),n}(Na),Ka=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=s,this.he=null}));function za(e){return new Ka(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Ya(e){var t=$r(e);if(null===t.he){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return Ma(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Pi(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return fa(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return fa(e)})).join(",")),t.he=n}return t.he}function Ja(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Aa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(!Ua(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ca(e.startAt,t.startAt)&&Ca(e.endAt,t.endAt)}function Xa(e){return bi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Qa=(0,m.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=s,this.endAt=c,this.Pe=null,this.Ie=null,this.de=null,this.startAt,this.endAt}));function $a(e,t,n,r,i,a,o,s){return new Qa(e,t,n,r,i,a,o,s)}function eo(e){return new Qa(e)}function to(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function no(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ro(e){var t,n=(0,u.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value.getFirstInequalityField();if(null!==r)return r}}catch(i){n.e(i)}finally{n.f()}return null}function io(e){return null!==e.collectionGroup}function ao(e){var t=$r(e);if(null===t.Pe){t.Pe=[];var n=ro(t),r=no(t);if(null!==n&&null===r)n.isKeyField()||t.Pe.push(new Ra(n)),t.Pe.push(new Ra(Ei.keyField(),"asc"));else{var i,a=!1,o=(0,u.Z)(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.Pe.push(s),s.field.isKeyField()&&(a=!0)}}catch(l){o.e(l)}finally{o.f()}if(!a){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.Pe.push(new Ra(Ei.keyField(),c))}}}return t.Pe}function oo(e){var t=$r(e);return t.Ie||(t.Ie=so(t,ao(e))),t.Ie}function so(e,t){if("F"===e.limitType)return za(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map((function(e){var t="desc"===e.dir?"asc":"desc";return new Ra(e.field,t)}));var n=e.endAt?new Ta(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ta(e.startAt.position,e.startAt.inclusive):null;return za(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}function co(e,t){t.getFirstInequalityField(),ro(e);var n=e.filters.concat([t]);return new Qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function uo(e,t,n){return new Qa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function lo(e,t){return Ja(oo(e),oo(t))&&e.limitType===t.limitType}function fo(e){return"".concat(Ya(oo(e)),"|lt:").concat(e.limitType)}function po(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return ja(e)})).join(", "),"]")),Pi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return fa(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return fa(e)})).join(",")),"Target(".concat(t,")")}(oo(e)),"; limitType=").concat(e.limitType,")")}function ho(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):bi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,u.Z)(ao(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,u.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=Ia(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,ao(e),t))&&!(e.endAt&&!function(e,t,n){var r=Ia(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,ao(e),t))}(e,t)}function vo(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function mo(e){return function(t,n){var r,i=!1,a=(0,u.Z)(ao(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=go(o,t,n);if(0!==s)return s;i=i||o.field.isKeyField()}}catch(c){a.e(c)}finally{a.f()}return 0}}function go(e,t,n){var r=e.field.isKeyField()?bi.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?la(r,i):Xr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Xr()}}var yo=function(){function e(t,n){(0,v.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return(0,m.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],c=a[1];if(this.equalsFn(o,e))return c}}catch(l){i.e(l)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){Bi(this.inner,(function(t,n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],c=a[1];e(o,c)}}catch(l){i.e(l)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return Gi(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),_o=new Zi(bi.comparator);function Eo(){return _o}var bo=new Zi(bi.comparator);function wo(){for(var e=bo,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.insert(o.key,o)}return e}function So(e){var t=bo;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function ko(){return Io()}function To(){return Io()}function Io(){return new yo((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var Co=new Zi(bi.comparator),Ro=new Hi(bi.comparator);function Ao(){for(var e=Ro,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var Oo=new Hi(pi);function No(){return Oo}function xo(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Li(t)?"-0":t}}function Do(e){return{integerValue:""+e}}function Po(e,t){return Mi(t)?Do(t):xo(e,t)}var Lo=(0,m.Z)((function e(){(0,v.Z)(this,e),this._=void 0}));function Mo(e,t,n){return e instanceof Fo?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ta(t)&&(t=na(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Vo?Bo(e,t):e instanceof Go?Zo(e,t):function(e,t){var n=jo(e,t),r=Wo(n)+Wo(e.Te);return va(n)&&va(e.Te)?Do(r):xo(e.serializer,r)}(e,t)}function Uo(e,t,n){return e instanceof Vo?Bo(e,t):e instanceof Go?Zo(e,t):n}function jo(e,t){return e instanceof qo?function(e){return va(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}var Fo=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(Lo),Vo=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(Lo);function Bo(e,t){var n,r=Ho(t),i=(0,u.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return ca(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Go=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,m.Z)(n)}(Lo);function Zo(e,t){var n,r=Ho(t),i=(0,u.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!ca(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var qo=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).serializer=e,i.Te=r,i}return(0,m.Z)(n)}(Lo);function Wo(e){return $i(e.integerValue||e.doubleValue)}function Ho(e){return ma(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ko=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.field=t,this.transform=n}));var zo=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.version=t,this.transformResults=n})),Yo=function(){function e(t,n){(0,v.Z)(this,e),this.updateTime=t,this.exists=n}return(0,m.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Jo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Xo=(0,m.Z)((function e(){(0,v.Z)(this,e)}));function Qo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ls(e.key,Yo.none()):new rs(e.key,e.data,Yo.none());var n,r=e.data,i=wa.empty(),a=new Hi(Ei.comparator),o=(0,u.Z)(t.fields);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!a.has(s)){var c=r.field(s);null===c&&s.length>1&&(s=s.popLast(),c=r.field(s)),null===c?i.delete(s):i.set(s,c),a=a.add(s)}}}catch(l){o.e(l)}finally{o.f()}return new is(e.key,i,new zi(a.toArray()),Yo.none())}function $o(e,t,n){e instanceof rs?function(e,t,n){var r=e.value.clone(),i=os(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof is?function(e,t,n){if(Jo(e.precondition,t)){var r=os(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(as(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function es(e,t,n,r){return e instanceof rs?function(e,t,n,r){if(!Jo(e.precondition,t))return n;var i=e.value.clone(),a=ss(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof is?function(e,t,n,r){if(!Jo(e.precondition,t))return n;var i=ss(e.fieldTransforms,r,t),a=t.data;return a.setAll(as(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return Jo(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ts(e,t){var n,r=null,i=(0,u.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),s=jo(a.transform,o||null);null!=s&&(null===r&&(r=wa.empty()),r.set(a.field,s))}}catch(c){i.e(c)}finally{i.f()}return r||null}function ns(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&hi(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Vo&&t instanceof Vo||e instanceof Go&&t instanceof Go?hi(e.elements,t.elements,ca):e instanceof qo&&t instanceof qo?ca(e.Te,t.Te):e instanceof Fo&&t instanceof Fo}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var rs=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,v.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Xo),is=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,v.Z)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=s,o.type=1,o}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(Xo);function as(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function os(e,t,n){var r=new Map;Qr(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Uo(o,s,n[i]))}return r}function ss(e,t,n){var r,i=new Map,a=(0,u.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.transform,c=n.data.field(o.field);i.set(o.field,Mo(s,c,t))}}catch(l){a.e(l)}finally{a.f()}return i}var cs,us,ls=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Xo),ds=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,m.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Xo),fs=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,m.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&$o(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=(0,u.Z)(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=es(i,e,t,this.localWriteTime))}}catch(c){r.e(c)}finally{r.f()}var a,o=(0,u.Z)(this.mutations);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.key.isEqual(e.key)&&(t=es(s,e,t,this.localWriteTime))}}catch(c){o.e(c)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=To();return this.mutations.forEach((function(i){var a=e.get(i.key),o=a.overlayedDocument,s=n.applyToLocalView(o,a.mutatedFields),c=Qo(o,s=t.has(i.key)?null:s);null!==c&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(mi.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),Ao())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&hi(this.mutations,e.mutations,(function(e,t){return ns(e,t)}))&&hi(this.baseMutations,e.baseMutations,(function(e,t){return ns(e,t)}))}}]),e}(),ps=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,m.Z)(e,null,[{key:"from",value:function(t,n,r){Qr(t.mutations.length===r.length);for(var i=Co,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),hs=function(){function e(t,n){(0,v.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,m.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),vs=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.count=t,this.unchangedNames=n}));function ms(e){switch(e){default:return Xr();case ei.CANCELLED:case ei.UNKNOWN:case ei.DEADLINE_EXCEEDED:case ei.RESOURCE_EXHAUSTED:case ei.INTERNAL:case ei.UNAVAILABLE:case ei.UNAUTHENTICATED:return!1;case ei.INVALID_ARGUMENT:case ei.NOT_FOUND:case ei.ALREADY_EXISTS:case ei.PERMISSION_DENIED:case ei.FAILED_PRECONDITION:case ei.ABORTED:case ei.OUT_OF_RANGE:case ei.UNIMPLEMENTED:case ei.DATA_LOSS:return!0}}function gs(e){if(void 0===e)return zr("GRPC error has no .code"),ei.UNKNOWN;switch(e){case cs.OK:return ei.OK;case cs.CANCELLED:return ei.CANCELLED;case cs.UNKNOWN:return ei.UNKNOWN;case cs.DEADLINE_EXCEEDED:return ei.DEADLINE_EXCEEDED;case cs.RESOURCE_EXHAUSTED:return ei.RESOURCE_EXHAUSTED;case cs.INTERNAL:return ei.INTERNAL;case cs.UNAVAILABLE:return ei.UNAVAILABLE;case cs.UNAUTHENTICATED:return ei.UNAUTHENTICATED;case cs.INVALID_ARGUMENT:return ei.INVALID_ARGUMENT;case cs.NOT_FOUND:return ei.NOT_FOUND;case cs.ALREADY_EXISTS:return ei.ALREADY_EXISTS;case cs.PERMISSION_DENIED:return ei.PERMISSION_DENIED;case cs.FAILED_PRECONDITION:return ei.FAILED_PRECONDITION;case cs.ABORTED:return ei.ABORTED;case cs.OUT_OF_RANGE:return ei.OUT_OF_RANGE;case cs.UNIMPLEMENTED:return ei.UNIMPLEMENTED;case cs.DATA_LOSS:return ei.DATA_LOSS;default:return Xr()}}(us=cs||(cs={}))[us.OK=0]="OK",us[us.CANCELLED=1]="CANCELLED",us[us.UNKNOWN=2]="UNKNOWN",us[us.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",us[us.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",us[us.NOT_FOUND=5]="NOT_FOUND",us[us.ALREADY_EXISTS=6]="ALREADY_EXISTS",us[us.PERMISSION_DENIED=7]="PERMISSION_DENIED",us[us.UNAUTHENTICATED=16]="UNAUTHENTICATED",us[us.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",us[us.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",us[us.ABORTED=10]="ABORTED",us[us.OUT_OF_RANGE=11]="OUT_OF_RANGE",us[us.UNIMPLEMENTED=12]="UNIMPLEMENTED",us[us.INTERNAL=13]="INTERNAL",us[us.UNAVAILABLE=14]="UNAVAILABLE",us[us.DATA_LOSS=15]="DATA_LOSS";var ys=null;function _s(){return new TextEncoder}var Es=new Br([4294967295,4294967295],0);function bs(e){var t=_s().encode(e),n=new Vr;return n.update(t),new Uint8Array(n.digest())}function ws(e){var t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new Br([n,r],0),new Br([i,a],0)]}var Ss=function(){function e(t,n,r){if((0,v.Z)(this,e),this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ks("Invalid padding: ".concat(n));if(r<0)throw new ks("Invalid hash count: ".concat(r));if(t.length>0&&0===this.hashCount)throw new ks("Invalid hash count: ".concat(r));if(0===t.length&&0!==n)throw new ks("Invalid padding when bitmap length is 0: ".concat(n));this.Ae=8*t.length-n,this.Re=Br.fromNumber(this.Ae)}return(0,m.Z)(e,[{key:"Ve",value:function(e,t,n){var r=e.add(t.multiply(Br.fromNumber(n)));return 1===r.compare(Es)&&(r=new Br([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Re).toNumber()}},{key:"me",value:function(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"mightContain",value:function(e){if(0===this.Ae)return!1;for(var t=ws(bs(e)),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var o=this.Ve(r,i,a);if(!this.me(o))return!1}return!0}},{key:"insert",value:function(e){if(0!==this.Ae)for(var t=ws(bs(e)),n=(0,s.Z)(t,2),r=n[0],i=n[1],a=0;a<this.hashCount;a++){var o=this.Ve(r,i,a);this.fe(o)}}},{key:"fe",value:function(e){var t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}],[{key:"create",value:function(t,n,r){var i=t%8==0?0:8-t%8,a=new e(new Uint8Array(Math.ceil(t/8)),i,n);return r.forEach((function(e){return a.insert(e)})),a}}]),e}(),ks=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).name="BloomFilterError",e}return(0,m.Z)(n)}((0,c.Z)(Error)),Ts=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n,r){var i=new Map;return i.set(t,Is.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(mi.min(),i,new Zi(pi),Eo(),Ao())}}]),e}(),Is=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,m.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n,r){return new e(r,n,Ao(),Ao(),Ao())}}]),e}(),Cs=(0,m.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.ge=t,this.removedTargetIds=n,this.key=r,this.pe=i})),Rs=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.targetId=t,this.ye=n})),As=(0,m.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ji.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,v.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Os=function(){function e(){(0,v.Z)(this,e),this.we=0,this.Se=Ds(),this.be=Ji.EMPTY_BYTE_STRING,this.De=!1,this.Ce=!0}return(0,m.Z)(e,[{key:"current",get:function(){return this.De}},{key:"resumeToken",get:function(){return this.be}},{key:"ve",get:function(){return 0!==this.we}},{key:"Fe",get:function(){return this.Ce}},{key:"Me",value:function(e){e.approximateByteSize()>0&&(this.Ce=!0,this.be=e)}},{key:"xe",value:function(){var e=Ao(),t=Ao(),n=Ao();return this.Se.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Xr()}})),new Is(this.be,this.De,e,t,n)}},{key:"Oe",value:function(){this.Ce=!1,this.Se=Ds()}},{key:"Ne",value:function(e,t){this.Ce=!0,this.Se=this.Se.insert(e,t)}},{key:"Be",value:function(e){this.Ce=!0,this.Se=this.Se.remove(e)}},{key:"Le",value:function(){this.we+=1}},{key:"ke",value:function(){this.we-=1}},{key:"qe",value:function(){this.Ce=!0,this.De=!0}}]),e}(),Ns=function(){function e(t){(0,v.Z)(this,e),this.Qe=t,this.Ke=new Map,this.$e=Eo(),this.Ue=xs(),this.We=new Zi(pi)}return(0,m.Z)(e,[{key:"Ge",value:function(e){var t,n=(0,u.Z)(e.ge);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.pe&&e.pe.isFoundDocument()?this.ze(r,e.pe):this.je(r,e.key,e.pe)}}catch(s){n.e(s)}finally{n.f()}var i,a=(0,u.Z)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.je(o,e.key,e.pe)}}catch(s){a.e(s)}finally{a.f()}}},{key:"He",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.Je(n);switch(e.state){case 0:t.Ye(n)&&r.Me(e.resumeToken);break;case 1:r.ke(),r.ve||r.Oe(),r.Me(e.resumeToken);break;case 2:r.ke(),r.ve||t.removeTarget(n);break;case 3:t.Ye(n)&&(r.qe(),r.Me(e.resumeToken));break;case 4:t.Ye(n)&&(t.Ze(n),r.Me(e.resumeToken));break;default:Xr()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Ke.forEach((function(e,r){n.Ye(r)&&t(r)}))}},{key:"Xe",value:function(e){var t=e.targetId,n=e.ye.count,r=this.et(t);if(r){var i=r.target;if(Xa(i))if(0===n){var a=new bi(i.path);this.je(t,a,ka.newNoDocument(a,mi.min()))}else Qr(1===n);else{var o=this.tt(t);if(o!==n){var s=this.nt(e),c=s?this.rt(s,e,o):1;if(0!==c){this.Ze(t);var u=2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.We=this.We.insert(t,u)}null==ys||ys.it(function(e,t,n,r,i){var a,o,s,c,u,l,d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},f=t.unchangedNames;return f&&(d.bloomFilter={applied:0===i,hashCount:null!==(a=null==f?void 0:f.hashCount)&&void 0!==a?a:0,bitmapLength:null!==(c=null===(s=null===(o=null==f?void 0:f.bits)||void 0===o?void 0:o.bitmap)||void 0===s?void 0:s.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==f?void 0:f.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:function(e){var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(o,e.ye,this.Qe.st(),s,c))}}}}},{key:"nt",value:function(e){var t=e.ye.unchangedNames;if(!t||!t.bits)return null;var n,r,i=t.bits,a=i.bitmap,o=void 0===a?"":a,s=i.padding,c=void 0===s?0:s,u=t.hashCount,l=void 0===u?0:u;try{n=ea(o).toUint8Array()}catch(e){if(e instanceof Yi)return Yr("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new Ss(n,c,l)}catch(e){return Yr(e instanceof ks?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.Ae?null:r}},{key:"rt",value:function(e,t,n){return t.ye.count===n-this.ot(e,t.targetId)?0:2}},{key:"ot",value:function(e,t){var n=this,r=this.Qe.getRemoteKeysForTarget(t),i=0;return r.forEach((function(r){var a=n.Qe.st(),o="projects/".concat(a.projectId,"/databases/").concat(a.database,"/documents/").concat(r.path.canonicalString());e.mightContain(o)||(n.je(t,r,null),i++)})),i}},{key:"_t",value:function(e){var t=this,n=new Map;this.Ke.forEach((function(r,i){var a=t.et(i);if(a){if(r.current&&Xa(a.target)){var o=new bi(a.target.path);null!==t.$e.get(o)||t.ut(i,o)||t.je(i,o,ka.newNoDocument(o,e))}r.Fe&&(n.set(i,r.xe()),r.Oe())}}));var r=Ao();this.Ue.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.et(e);return!n||"TargetPurposeLimboResolution"===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))})),this.$e.forEach((function(t,n){return n.setReadTime(e)}));var i=new Ts(e,n,this.We,this.$e,r);return this.$e=Eo(),this.Ue=xs(),this.We=new Zi(pi),i}},{key:"ze",value:function(e,t){if(this.Ye(e)){var n=this.ut(e,t.key)?2:0;this.Je(e).Ne(t.key,n),this.$e=this.$e.insert(t.key,t),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}}},{key:"je",value:function(e,t,n){if(this.Ye(e)){var r=this.Je(e);this.ut(e,t)?r.Ne(t,1):r.Be(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),n&&(this.$e=this.$e.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Ke.delete(e)}},{key:"tt",value:function(e){var t=this.Je(e).xe();return this.Qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Le",value:function(e){this.Je(e).Le()}},{key:"Je",value:function(e){var t=this.Ke.get(e);return t||(t=new Os,this.Ke.set(e,t)),t}},{key:"ct",value:function(e){var t=this.Ue.get(e);return t||(t=new Hi(pi),this.Ue=this.Ue.insert(e,t)),t}},{key:"Ye",value:function(e){var t=null!==this.et(e);return t||Kr("WatchChangeAggregator","Detected inactive target",e),t}},{key:"et",value:function(e){var t=this.Ke.get(e);return t&&t.ve?null:this.Qe.lt(e)}},{key:"Ze",value:function(e){var t=this;this.Ke.set(e,new Os),this.Qe.getRemoteKeysForTarget(e).forEach((function(n){t.je(e,n,null)}))}},{key:"ut",value:function(e,t){return this.Qe.getRemoteKeysForTarget(e).has(t)}}]),e}();function xs(){return new Zi(bi.comparator)}function Ds(){return new Zi(bi.comparator)}var Ps={asc:"ASCENDING",desc:"DESCENDING"},Ls={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ms={and:"AND",or:"OR"},Us=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.databaseId=t,this.useProto3Json=n}));function js(e,t){return e.useProto3Json||Pi(t)?t:{value:t}}function Fs(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vs(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Bs(e,t){return Fs(e,t.toTimestamp())}function Gs(e){return Qr(!!e),mi.fromTimestamp(function(e){var t=Qi(e);return new vi(t.seconds,t.nanos)}(e))}function Zs(e,t){return function(e){return new yi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function qs(e){var t=yi.fromString(e);return Qr(lc(t)),t}function Ws(e,t){return Zs(e.databaseId,t.path)}function Hs(e,t){var n=qs(t);if(n.get(1)!==e.databaseId.projectId)throw new ti(ei.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ti(ei.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new bi(Js(n))}function Ks(e,t){return Zs(e.databaseId,t)}function zs(e){var t=qs(e);return 4===t.length?yi.emptyPath():Js(t)}function Ys(e){return new yi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Js(e){return Qr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Xs(e,t,n){return{name:Ws(e,t),fields:n.value.mapValue.fields}}function Qs(e,t){var n;if(t instanceof rs)n={update:Xs(e,t.key,t.value)};else if(t instanceof ls)n={delete:Ws(e,t.key)};else if(t instanceof is)n={update:Xs(e,t.key,t.data),updateMask:uc(t.fieldMask)};else{if(!(t instanceof ds))return Xr();n={verify:Ws(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Fo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Go)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof qo)return{fieldPath:t.field.canonicalString(),increment:n.Te};throw Xr()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Bs(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Xr()}(e,t.precondition)),n}function $s(e,t){return{documents:[Ks(e,t.path)]}}function ec(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ks(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ks(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return cc(xa.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:oc(e.field),direction:rc(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o=js(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function tc(e){var t=zs(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Qr(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=function(e){var t=nc(e);return t instanceof xa&&Pa(t)?t.getFilters():[t]}(n.where));var s=[];n.orderBy&&(s=function(e){return e.map((function(e){return function(e){return new Ra(sc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}))}(n.orderBy));var c=null;n.limit&&(c=function(e){var t;return Pi(t="object"==typeof e?e.value:e)?null:t}(n.limit));var u=null;n.startAt&&(u=function(e){var t=!!e.before,n=e.values||[];return new Ta(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Ta(n,t)}(n.endAt)),$a(t,i,s,o,c,"F",u,l)}function nc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=sc(e.unaryFilter.field);return Na.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=sc(e.unaryFilter.field);return Na.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=sc(e.unaryFilter.field);return Na.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=sc(e.unaryFilter.field);return Na.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Xr()}}(e):void 0!==e.fieldFilter?function(e){return Na.create(sc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return xa.create(e.compositeFilter.filters.map((function(e){return nc(e)})),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Xr()}}(e.compositeFilter.op))}(e):Xr()}function rc(e){return Ps[e]}function ic(e){return Ls[e]}function ac(e){return Ms[e]}function oc(e){return{fieldPath:e.canonicalString()}}function sc(e){return Ei.fromServerFormat(e.fieldPath)}function cc(e){return e instanceof Na?function(e){if("=="===e.op){if(ya(e.value))return{unaryFilter:{field:oc(e.field),op:"IS_NAN"}};if(ga(e.value))return{unaryFilter:{field:oc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ya(e.value))return{unaryFilter:{field:oc(e.field),op:"IS_NOT_NAN"}};if(ga(e.value))return{unaryFilter:{field:oc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oc(e.field),op:ic(e.op),value:e.value}}}(e):e instanceof xa?function(e){var t=e.getFilters().map((function(e){return cc(e)}));return 1===t.length?t[0]:{compositeFilter:{op:ac(e.op),filters:t}}}(e):Xr()}function uc(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function lc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}var dc=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mi.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:mi.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ji.EMPTY_BYTE_STRING,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,v.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=c}return(0,m.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}},{key:"withExpectedCount",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}]),e}(),fc=(0,m.Z)((function e(t){(0,v.Z)(this,e),this.ht=t}));function pc(e){var t=tc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?uo(t,t.limit,"L"):t}var hc=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"dt",value:function(e,t){this.Tt(e,t),t.Et()}},{key:"Tt",value:function(e,t){if("nullValue"in e)this.At(t,5);else if("booleanValue"in e)this.At(t,10),t.Rt(e.booleanValue?1:0);else if("integerValue"in e)this.At(t,15),t.Rt($i(e.integerValue));else if("doubleValue"in e){var n=$i(e.doubleValue);isNaN(n)?this.At(t,13):(this.At(t,15),Li(n)?t.Rt(0):t.Rt(n))}else if("timestampValue"in e){var r=e.timestampValue;this.At(t,20),"string"==typeof r?t.Vt(r):(t.Vt("".concat(r.seconds||"")),t.Rt(r.nanos||0))}else if("stringValue"in e)this.ft(e.stringValue,t),this.gt(t);else if("bytesValue"in e)this.At(t,30),t.yt(ea(e.bytesValue)),this.gt(t);else if("referenceValue"in e)this.wt(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.At(t,45),t.Rt(i.latitude||0),t.Rt(i.longitude||0)}else"mapValue"in e?ba(e)?this.At(t,Number.MAX_SAFE_INTEGER):(this.St(e.mapValue,t),this.gt(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.gt(t)):Xr()}},{key:"ft",value:function(e,t){this.At(t,25),this.Dt(e,t)}},{key:"Dt",value:function(e,t){t.Vt(e)}},{key:"St",value:function(e,t){var n=e.fields||{};this.At(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.ft(a,t),this.Tt(n[a],t)}}},{key:"bt",value:function(e,t){var n=e.values||[];this.At(t,50);var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.Tt(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"wt",value:function(e,t){var n=this;this.At(t,37),bi.fromName(e).path.forEach((function(e){n.At(t,60),n.Dt(e,t)}))}},{key:"At",value:function(e,t){e.Rt(t)}},{key:"gt",value:function(e){e.Rt(2)}}]),e}();hc.Ct=new hc;var vc=function(){function e(){(0,v.Z)(this,e),this.an=new mc}return(0,m.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.an.add(t),Ni.resolve()}},{key:"getCollectionParents",value:function(e,t){return Ni.resolve(this.an.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Ni.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Ni.resolve()}},{key:"deleteAllFieldIndexes",value:function(e){return Ni.resolve()}},{key:"createTargetIndexes",value:function(e,t){return Ni.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return Ni.resolve(null)}},{key:"getIndexType",value:function(e,t){return Ni.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return Ni.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Ni.resolve(null)}},{key:"getMinOffset",value:function(e,t){return Ni.resolve(Ti.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return Ni.resolve(Ti.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return Ni.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Ni.resolve()}}]),e}(),mc=function(){function e(){(0,v.Z)(this,e),this.index={}}return(0,m.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Hi(yi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Hi(yi.comparator)).toArray()}}]),e}();new Uint8Array(0);var gc=function(){function e(t,n,r){(0,v.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,m.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();gc.DEFAULT_COLLECTION_PERCENTILE=10,gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gc.DEFAULT=new gc(41943040,gc.DEFAULT_COLLECTION_PERCENTILE,gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gc.DISABLED=new gc(-1,0,0);var yc=function(){function e(t){(0,v.Z)(this,e),this.Nn=t}return(0,m.Z)(e,[{key:"next",value:function(){return this.Nn+=2,this.Nn}}],[{key:"Bn",value:function(){return new e(0)}},{key:"Ln",value:function(){return new e(-1)}}]),e}();var _c=function(){function e(){(0,v.Z)(this,e),this.changes=new yo((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,m.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,ka.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Ni.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}();var Ec=(0,m.Z)((function e(t,n){(0,v.Z)(this,e),this.overlayedDocument=t,this.mutatedFields=n})),bc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return(0,m.Z)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)})).next((function(e){return null!==r&&es(r.mutation,e,zi.empty(),vi.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,Ao()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ao(),i=ko();return this.populateOverlays(e,i,t).next((function(){return n.computeViews(e,t,i,r).next((function(e){var t=wo();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=ko();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,Ao())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var i=Eo(),a=Io(),o=Io();return t.forEach((function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof is)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),es(o.mutation,t,o.mutation.getFieldMask(),vi.now())):a.set(t.key,zi.empty())})),this.recalculateAndSaveOverlays(e,i).next((function(e){return e.forEach((function(e,t){return a.set(e,t)})),t.forEach((function(e,t){var n;return o.set(e,new Ec(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),o}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=Io(),i=new Zi((function(e,t){return e-t})),a=Ao();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,a=(0,u.Z)(e);try{var o=function(){var e=n.value;e.keys().forEach((function(n){var a=t.get(n);if(null!==a){var o=r.get(n)||zi.empty();o=e.applyToLocalView(a,o),r.set(n,o);var s=(i.get(e.batchId)||Ao()).add(n);i=i.insert(e.batchId,s)}}))};for(a.s();!(n=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}})).next((function(){for(var o=[],s=i.getReverseIterator(),c=function(){var i=s.getNext(),c=i.key,u=i.value,l=To();u.forEach((function(e){if(!a.has(e)){var n=Qo(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}})),o.push(n.documentOverlayCache.saveOverlays(e,c,l))};s.hasNext();)c();return Ni.waitFor(o)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){return function(e){return bi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):io(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(a){var o=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):Ni.resolve(ko()),s=-1,c=a;return o.next((function(t){return Ni.forEach(t,(function(t,n){return s<n.largestBatchId&&(s=n.largestBatchId),a.get(t)?Ni.resolve():i.remoteDocumentCache.getEntry(e,t).next((function(e){c=c.insert(t,e)}))})).next((function(){return i.populateOverlays(e,t,a)})).next((function(){return i.computeViews(e,c,t,Ao())})).next((function(e){return{batchId:s,changes:So(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new bi(t)).next((function(e){var t=wo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n,r){var i=this,a=t.collectionGroup,o=wo();return this.indexManager.getCollectionParents(e,a).next((function(s){return Ni.forEach(s,(function(s){var c=function(e,t){return new Qa(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(a));return i.getDocumentsMatchingCollectionQuery(e,c,n,r).next((function(e){e.forEach((function(e,t){o=o.insert(e,t)}))}))})).next((function(){return o}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n,r){var i,a=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((function(o){return i=o,a.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)})).next((function(e){i.forEach((function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,ka.newInvalidDocument(r)))}));var n=wo();return e.forEach((function(e,r){var a=i.get(e);void 0!==a&&es(a.mutation,r,zi.empty(),vi.now()),ho(t,r)&&(n=n.insert(e,r))})),n}))}}]),e}(),wc=function(){function e(t){(0,v.Z)(this,e),this.serializer=t,this.lr=new Map,this.hr=new Map}return(0,m.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Ni.resolve(this.lr.get(t))}},{key:"saveBundleMetadata",value:function(e,t){return this.lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Gs(e.createTime)}}(t)),Ni.resolve()}},{key:"getNamedQuery",value:function(e,t){return Ni.resolve(this.hr.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.hr.set(t.name,function(e){return{name:e.name,query:pc(e.bundledQuery),readTime:Gs(e.readTime)}}(t)),Ni.resolve()}}]),e}(),Sc=function(){function e(){(0,v.Z)(this,e),this.overlays=new Zi(bi.comparator),this.Pr=new Map}return(0,m.Z)(e,[{key:"getOverlay",value:function(e,t){return Ni.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=ko();return Ni.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,i){r.It(e,t,i)})),Ni.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Pr.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.Pr.delete(n)),Ni.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=ko(),i=t.length+1,a=new bi(t.child("")),o=this.overlays.getIteratorFrom(a);o.hasNext();){var s=o.getNext().value,c=s.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&s.largestBatchId>n&&r.set(s.getKey(),s)}return Ni.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Zi((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var o=a.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var s=i.get(o.largestBatchId);null===s&&(s=ko(),i=i.insert(o.largestBatchId,s)),s.set(o.getKey(),o)}}for(var c=ko(),u=i.getIterator();u.hasNext()&&(u.getNext().value.forEach((function(e,t){return c.set(e,t)})),!(c.size()>=r)););return Ni.resolve(c)}},{key:"It",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Pr.get(r.largestBatchId).delete(n.key);this.Pr.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new hs(t,n));var a=this.Pr.get(t);void 0===a&&(a=Ao(),this.Pr.set(t,a)),this.Pr.set(t,a.add(n.key))}}]),e}(),kc=function(){function e(){(0,v.Z)(this,e),this.Ir=new Hi(Tc.dr),this.Tr=new Hi(Tc.Er)}return(0,m.Z)(e,[{key:"isEmpty",value:function(){return this.Ir.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Tc(e,t);this.Ir=this.Ir.add(n),this.Tr=this.Tr.add(n)}},{key:"Ar",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.Rr(new Tc(e,t))}},{key:"Vr",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"mr",value:function(e){var t=this,n=new bi(new yi([])),r=new Tc(n,e),i=new Tc(n,e+1),a=[];return this.Tr.forEachInRange([r,i],(function(e){t.Rr(e),a.push(e.key)})),a}},{key:"gr",value:function(){var e=this;this.Ir.forEach((function(t){return e.Rr(t)}))}},{key:"Rr",value:function(e){this.Ir=this.Ir.delete(e),this.Tr=this.Tr.delete(e)}},{key:"pr",value:function(e){var t=new bi(new yi([])),n=new Tc(t,e),r=new Tc(t,e+1),i=Ao();return this.Tr.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Tc(e,0),n=this.Ir.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Tc=function(){function e(t,n){(0,v.Z)(this,e),this.key=t,this.yr=n}return(0,m.Z)(e,null,[{key:"dr",value:function(e,t){return bi.comparator(e.key,t.key)||pi(e.yr,t.yr)}},{key:"Er",value:function(e,t){return pi(e.yr,t.yr)||bi.comparator(e.key,t.key)}}]),e}(),Ic=function(){function e(t,n){(0,v.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.wr=1,this.Sr=new Hi(Tc.dr)}return(0,m.Z)(e,[{key:"checkEmpty",value:function(e){return Ni.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.wr;this.wr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new fs(i,t,n,r);this.mutationQueue.push(a);var o,s=(0,u.Z)(r);try{for(s.s();!(o=s.n()).done;){var c=o.value;this.Sr=this.Sr.add(new Tc(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast())}}catch(l){s.e(l)}finally{s.f()}return Ni.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Ni.resolve(this.br(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.Dr(n),i=r<0?0:r;return Ni.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Ni.resolve(0===this.mutationQueue.length?-1:this.wr-1)}},{key:"getAllMutationBatches",value:function(e){return Ni.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Tc(t,0),i=new Tc(t,Number.POSITIVE_INFINITY),a=[];return this.Sr.forEachInRange([r,i],(function(e){var t=n.br(e.yr);a.push(t)})),Ni.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Hi(pi);return t.forEach((function(e){var t=new Tc(e,0),i=new Tc(e,Number.POSITIVE_INFINITY);n.Sr.forEachInRange([t,i],(function(e){r=r.add(e.yr)}))})),Ni.resolve(this.Cr(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;bi.isDocumentKey(i)||(i=i.child(""));var a=new Tc(new bi(i),0),o=new Hi(pi);return this.Sr.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.yr)),!0)}),a),Ni.resolve(this.Cr(o))}},{key:"Cr",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.br(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Qr(0===this.vr(t.batchId,"removed")),this.mutationQueue.shift();var r=this.Sr;return Ni.forEach(t.mutations,(function(i){var a=new Tc(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.Sr=r}))}},{key:"xn",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Tc(t,0),r=this.Sr.firstAfterOrEqual(n);return Ni.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,Ni.resolve()}},{key:"vr",value:function(e,t){return this.Dr(e)}},{key:"Dr",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"br",value:function(e){var t=this.Dr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),Cc=function(){function e(t){(0,v.Z)(this,e),this.Fr=t,this.docs=new Zi(bi.comparator),this.size=0}return(0,m.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Fr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Ni.resolve(n?n.document.mutableCopy():ka.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=Eo();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():ka.newInvalidDocument(e))})),Ni.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=Eo(),a=t.path,o=new bi(a.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var c=s.getNext(),u=c.key,l=c.value.document;if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||Ii(ki(l),n)<=0||(r.has(l.key)||ho(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return Ni.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){Xr()}},{key:"Mr",value:function(e,t){return Ni.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Rc(this)}},{key:"getSize",value:function(e){return Ni.resolve(this.size)}}]),e}(),Rc=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).ur=e,r}return(0,m.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.ur.addEntry(e,i)):t.ur.removeEntry(r)})),Ni.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.ur.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.ur.getEntries(e,t)}}]),n}(_c),Ac=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.Or=new yo((function(e){return Ya(e)}),Ja),this.lastRemoteSnapshotVersion=mi.min(),this.highestTargetId=0,this.Nr=0,this.Br=new kc,this.targetCount=0,this.Lr=yc.Bn()}return(0,m.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Or.forEach((function(e,n){return t(n)})),Ni.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Ni.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Ni.resolve(this.Nr)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Lr.next(),Ni.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Nr&&(this.Nr=t),Ni.resolve()}},{key:"Qn",value:function(e){this.Or.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Lr=new yc(t),this.highestTargetId=t),e.sequenceNumber>this.Nr&&(this.Nr=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Qn(t),this.targetCount+=1,Ni.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Qn(t),Ni.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Or.delete(t.target),this.Br.mr(t.targetId),this.targetCount-=1,Ni.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Or.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Or.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)})),Ni.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Ni.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Or.get(t)||null;return Ni.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Br.Ar(t,n),Ni.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Br.Vr(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Ni.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Br.mr(t),Ni.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Br.pr(t);return Ni.resolve(n)}},{key:"containsKey",value:function(e,t){return Ni.resolve(this.Br.containsKey(t))}}]),e}(),Oc=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.kr={},this.overlays={},this.qr=new Di(0),this.Qr=!1,this.Qr=!0,this.referenceDelegate=t(this),this.Kr=new Ac(this),this.indexManager=new vc,this.remoteDocumentCache=function(e){return new Cc(e)}((function(e){return r.referenceDelegate.$r(e)})),this.serializer=new fc(n),this.Ur=new wc(this.serializer)}return(0,m.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Qr=!1,Promise.resolve()}},{key:"started",get:function(){return this.Qr}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Sc,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.kr[e.toKey()];return n||(n=new Ic(t,this.referenceDelegate),this.kr[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Kr}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ur}},{key:"runTransaction",value:function(e,t,n){var r=this;Kr("MemoryPersistence","Starting transaction:",e);var i=new Nc(this.qr.next());return this.referenceDelegate.Wr(),n(i).next((function(e){return r.referenceDelegate.Gr(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"zr",value:function(e,t){return Ni.or(Object.values(this.kr).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),Nc=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,m.Z)(n)}(Ri),xc=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.jr=new kc,this.Hr=null}return(0,m.Z)(e,[{key:"Yr",get:function(){if(this.Hr)return this.Hr;throw Xr()}},{key:"addReference",value:function(e,t,n){return this.jr.addReference(n,t),this.Yr.delete(n.toString()),Ni.resolve()}},{key:"removeReference",value:function(e,t,n){return this.jr.removeReference(n,t),this.Yr.add(n.toString()),Ni.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Yr.add(t.toString()),Ni.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.jr.mr(t.targetId).forEach((function(e){return n.Yr.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Yr.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Wr",value:function(){this.Hr=new Set}},{key:"Gr",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ni.forEach(this.Yr,(function(r){var i=bi.fromPath(r);return t.Zr(e,i).next((function(e){e||n.removeEntry(i,mi.min())}))})).next((function(){return t.Hr=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Zr(e,t).next((function(e){e?n.Yr.delete(t.toString()):n.Yr.add(t.toString())}))}},{key:"$r",value:function(e){return 0}},{key:"Zr",value:function(e,t){var n=this;return Ni.or([function(){return Ni.resolve(n.jr.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.zr(e,t)}])}}],[{key:"Jr",value:function(t){return new e(t)}}]),e}();var Dc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.targetId=t,this.fromCache=n,this.Qi=r,this.Ki=i}return(0,m.Z)(e,null,[{key:"$i",value:function(t,n){var r,i=Ao(),a=Ao(),o=(0,u.Z)(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(c){o.e(c)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Pc=function(){function e(){(0,v.Z)(this,e),this._documentReadCount=0}return(0,m.Z)(e,[{key:"documentReadCount",get:function(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function(e){this._documentReadCount+=e}}]),e}(),Lc=function(){function e(){(0,v.Z)(this,e),this.Ui=!1,this.Wi=!1,this.Gi=100,this.zi=8}return(0,m.Z)(e,[{key:"initialize",value:function(e,t){this.ji=e,this.indexManager=t,this.Ui=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a={result:null};return this.Hi(e,t).next((function(e){a.result=e})).next((function(){if(!a.result)return i.Ji(e,t,r,n).next((function(e){a.result=e}))})).next((function(){if(!a.result){var n=new Pc;return i.Yi(e,t,n).next((function(r){if(a.result=r,i.Wi)return i.Zi(e,t,n,r.size)}))}})).next((function(){return a.result}))}},{key:"Zi",value:function(e,t,n,r){return n.documentReadCount<this.Gi?(Hr()<=_.in.DEBUG&&Kr("QueryEngine","SDK will not create cache indexes for query:",po(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Gi,"documents"),Ni.resolve()):(Hr()<=_.in.DEBUG&&Kr("QueryEngine","Query:",po(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.zi*r?(Hr()<=_.in.DEBUG&&Kr("QueryEngine","The SDK decides to create cache indexes for query:",po(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oo(t))):Ni.resolve())}},{key:"Hi",value:function(e,t){var n=this;if(to(t))return Ni.resolve(null);var r=oo(t);return this.indexManager.getIndexType(e,r).next((function(i){return 0===i?null:(null!==t.limit&&1===i&&(t=uo(t,null,"F"),r=oo(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next((function(i){var a=Ao.apply(void 0,(0,h.Z)(i));return n.ji.getDocuments(e,a).next((function(i){return n.indexManager.getMinOffset(e,r).next((function(r){var o=n.Xi(t,i);return n.es(t,o,a,r.readTime)?n.Hi(e,uo(t,null,"F")):n.ts(e,o,t,r)}))}))})))}))}},{key:"Ji",value:function(e,t,n,r){var i=this;return to(t)||r.isEqual(mi.min())?Ni.resolve(null):this.ji.getDocuments(e,n).next((function(a){var o=i.Xi(t,a);return i.es(t,o,n,r)?Ni.resolve(null):(Hr()<=_.in.DEBUG&&Kr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),po(t)),i.ts(e,o,t,Si(r,-1)).next((function(e){return e})))}))}},{key:"Xi",value:function(e,t){var n=new Hi(mo(e));return t.forEach((function(t,r){ho(e,r)&&(n=n.add(r))})),n}},{key:"es",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Yi",value:function(e,t,n){return Hr()<=_.in.DEBUG&&Kr("QueryEngine","Using full collection scan to execute query:",po(t)),this.ji.getDocumentsMatchingQuery(e,t,Ti.min(),n)}},{key:"ts",value:function(e,t,n,r){return this.ji.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),Mc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.persistence=t,this.ns=n,this.serializer=i,this.rs=new Zi(pi),this.ss=new yo((function(e){return Ya(e)}),Ja),this.os=new Map,this._s=t.getRemoteDocumentCache(),this.Kr=t.getTargetCache(),this.Ur=t.getBundleCache(),this.us(r)}return(0,m.Z)(e,[{key:"us",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bc(this._s,this.mutationQueue,this.documentOverlayCache,this.indexManager),this._s.setIndexManager(this.indexManager),this.ns.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.rs)}))}}]),e}();function Uc(e,t,n,r){return new Mc(e,t,n,r)}function jc(e,t){return Fc.apply(this,arguments)}function Fc(){return Fc=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(i){return t=i,r.us(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var i,a=[],o=[],s=Ao(),c=(0,u.Z)(t);try{for(c.s();!(i=c.n()).done;){var l=i.value;a.push(l.batchId);var d,f=(0,u.Z)(l.mutations);try{for(f.s();!(d=f.n()).done;){var p=d.value;s=s.add(p.key)}}catch(E){f.e(E)}finally{f.f()}}}catch(E){c.e(E)}finally{c.f()}var h,v=(0,u.Z)(n);try{for(v.s();!(h=v.n()).done;){var m=h.value;o.push(m.batchId);var g,y=(0,u.Z)(m.mutations);try{for(y.s();!(g=y.n()).done;){var _=g.value;s=s.add(_.key)}}catch(E){y.e(E)}finally{y.f()}}}catch(E){v.e(E)}finally{v.f()}return r.localDocuments.getDocuments(e,s).next((function(e){return{cs:e,removedBatchIds:a,addedBatchIds:o}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),Fc.apply(this,arguments)}function Vc(e,t){var n=$r(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n._s.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=Ni.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);Qr(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((function(){return e.mutationQueue.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=Ao(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function Bc(e){var t=$r(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Kr.getLastRemoteSnapshotVersion(e)}))}function Gc(e,t){var n=$r(e),r=t.snapshotVersion,i=n.rs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n._s.newChangeBuffer({trackRemovals:!0});i=n.rs;var o=[];t.targetChanges.forEach((function(a,s){var c=i.get(s);if(c){o.push(n.Kr.removeMatchingKeys(e,a.removedDocuments,s).next((function(){return n.Kr.addMatchingKeys(e,a.addedDocuments,s)})));var u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(s)?u=u.withResumeToken(Ji.EMPTY_BYTE_STRING,mi.min()).withLastLimboFreeSnapshotVersion(mi.min()):a.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(a.resumeToken,r)),i=i.insert(s,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,a)&&o.push(n.Kr.updateTargetData(e,u))}}));var s=Eo(),c=Ao();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Zc(e,a,t.documentUpdates).next((function(e){s=e.ls,c=e.hs}))),!r.isEqual(mi.min())){var u=n.Kr.getLastRemoteSnapshotVersion(e).next((function(t){return n.Kr.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(u)}return Ni.waitFor(o).next((function(){return a.apply(e)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(e,s,c)})).next((function(){return s}))})).then((function(e){return n.rs=i,e}))}function Zc(e,t,n){var r=Ao(),i=Ao();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=Eo();return n.forEach((function(n,a){var o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(mi.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||0===a.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):Kr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",a.version)})),{ls:r,hs:i}}))}function qc(e,t){var n=$r(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}function Wc(e,t){var n=$r(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Kr.getTargetData(e,t).next((function(i){return i?(r=i,Ni.resolve(r)):n.Kr.allocateTargetId(e).next((function(i){return r=new dc(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Kr.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.rs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.rs=n.rs.insert(e.targetId,e),n.ss.set(t,e.targetId)),e}))}function Hc(e,t,n){return Kc.apply(this,arguments)}function Kc(){return Kc=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=$r(t),a=i.rs.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),xi(e.t1)){e.next=12;break}throw e.t1;case 12:Kr("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.rs=i.rs.remove(n),i.ss.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),Kc.apply(this,arguments)}function zc(e,t,n){var r=$r(e),i=mi.min(),a=Ao();return r.persistence.runTransaction("Execute query","readwrite",(function(e){return function(e,t,n){var r=$r(e),i=r.ss.get(n);return void 0!==i?Ni.resolve(r.rs.get(i)):r.Kr.getTargetData(t,n)}(r,e,oo(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Kr.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.ns.getDocumentsMatchingQuery(e,t,n?i:mi.min(),n?a:Ao())})).next((function(e){return Yc(r,vo(t),e),{documents:e,Ps:a}}))}))}function Yc(e,t,n){var r=e.os.get(t)||mi.min();n.forEach((function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.os.set(t,r)}var Jc=function(){function e(){(0,v.Z)(this,e),this.activeTargetIds=No()}return(0,m.Z)(e,[{key:"Rs",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Vs",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"As",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Xc=function(){function e(){(0,v.Z)(this,e),this.ro=new Jc,this.io={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,m.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.ro.Rs(e),this.io[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.io[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.ro.Vs(e)}},{key:"isLocalQueryTarget",value:function(e){return this.ro.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.io[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.ro.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.ro.activeTargetIds.has(e)}},{key:"start",value:function(){return this.ro=new Jc,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),Qc=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"so",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),$c=function(){function e(){var t=this;(0,v.Z)(this,e),this.oo=function(){return t._o()},this.ao=function(){return t.uo()},this.co=[],this.lo()}return(0,m.Z)(e,[{key:"so",value:function(e){this.co.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.oo),window.removeEventListener("offline",this.ao)}},{key:"lo",value:function(){window.addEventListener("online",this.oo),window.addEventListener("offline",this.ao)}},{key:"_o",value:function(){Kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,u.Z)(this.co);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"uo",value:function(){Kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,u.Z)(this.co);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"C",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),eu=null;function tu(){return null===eu?eu=268435456+Math.round(2147483648*Math.random()):eu++,"0x"+eu.toString(16)}var nu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ru=function(){function e(t){(0,v.Z)(this,e),this.ho=t.ho,this.Po=t.Po}return(0,m.Z)(e,[{key:"Io",value:function(e){this.To=e}},{key:"Eo",value:function(e){this.Ao=e}},{key:"onMessage",value:function(e){this.Ro=e}},{key:"close",value:function(){this.Po()}},{key:"send",value:function(e){this.ho(e)}},{key:"Vo",value:function(){this.To()}},{key:"mo",value:function(e){this.Ao(e)}},{key:"fo",value:function(e){this.Ro(e)}}]),e}(),iu="WebChannelConnection",au=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r.longPollingOptions=e.longPollingOptions,r}return(0,m.Z)(n,[{key:"vo",value:function(e,t,n,r){var i=tu();return new Promise((function(a,o){var s=new Fr;s.setWithCredentials(!0),s.listenOnce(Lr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Pr.NO_ERROR:var t=s.getResponseJson();Kr(iu,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case Pr.TIMEOUT:Kr(iu,"RPC '".concat(e,"' ").concat(i," timed out")),o(new ti(ei.DEADLINE_EXCEEDED,"Request time out"));break;case Pr.HTTP_ERROR:var n=s.getStatus();if(Kr(iu,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson();Array.isArray(r)&&(r=r[0]);var c=null==r?void 0:r.error;if(c&&c.status&&c.message){var u=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(ei).indexOf(t)>=0?t:ei.UNKNOWN}(c.status);o(new ti(u,c.message))}else o(new ti(ei.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ti(ei.UNAVAILABLE,"Connection failed."));break;default:Xr()}}finally{Kr(iu,"RPC '".concat(e,"' ").concat(i," completed."))}}));var c=JSON.stringify(r);Kr(iu,"RPC '".concat(e,"' ").concat(i," sending request:"),r),s.send(t,"POST",c,n,15)}))}},{key:"Mo",value:function(e,t,n){var r=tu(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=xr(),o=Dr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Co(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;var u=i.join("");Kr(iu,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(u),s);var l=a.createWebChannel(u,s),d=!1,f=!1,p=new ru({ho:function(t){f?Kr(iu,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(d||(Kr(iu,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),d=!0),Kr(iu,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},Po:function(){return l.close()}}),h=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return h(l,jr.EventType.OPEN,(function(){f||Kr(iu,"RPC '".concat(e,"' stream ").concat(r," transport opened."))})),h(l,jr.EventType.CLOSE,(function(){f||(f=!0,Kr(iu,"RPC '".concat(e,"' stream ").concat(r," transport closed")),p.mo())})),h(l,jr.EventType.ERROR,(function(t){f||(f=!0,Yr(iu,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),p.mo(new ti(ei.UNAVAILABLE,"The operation could not be completed")))})),h(l,jr.EventType.MESSAGE,(function(t){var n;if(!f){var i=t.data[0];Qr(!!i);var a=i,o=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(o){Kr(iu,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);var s=o.status,c=function(e){var t=cs[e];if(void 0!==t)return gs(t)}(s),u=o.message;void 0===c&&(c=ei.INTERNAL,u="Unknown error status: "+s+" with message "+o.message),f=!0,p.mo(new ti(c,u)),l.close()}else Kr(iu,"RPC '".concat(e,"' stream ").concat(r," received:"),i),p.fo(i)}})),h(o,Mr.STAT_EVENT,(function(t){t.stat===Ur.PROXY?Kr(iu,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Ur.NOPROXY&&Kr(iu,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((function(){p.Vo()}),0),p}}]),n}(function(){function e(t){(0,v.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=n+"://"+t.host,this.yo="projects/".concat(r,"/databases/").concat(i),this.wo="(default)"===this.databaseId.database?"project_id=".concat(r):"project_id=".concat(r,"&database_id=").concat(i)}return(0,m.Z)(e,[{key:"So",get:function(){return!1}},{key:"bo",value:function(e,t,n,r,i){var a=tu(),o=this.Do(e,t);Kr("RestConnection","Sending RPC '".concat(e,"' ").concat(a,":"),o,n);var s={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Co(s,r,i),this.vo(e,o,s,n).then((function(t){return Kr("RestConnection","Received RPC '".concat(e,"' ").concat(a,": "),t),t}),(function(t){throw Yr("RestConnection","RPC '".concat(e,"' ").concat(a," failed with error: "),t,"url: ",o,"request:",n),t}))}},{key:"Fo",value:function(e,t,n,r,i,a){return this.bo(e,t,n,r,i)}},{key:"Co",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+qr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"Do",value:function(e,t){var n=nu[e];return"".concat(this.po,"/v1/").concat(t,":").concat(n)}}]),e}());function ou(){return"undefined"!=typeof document?document:null}function su(e){return new Us(e,!0)}var cu=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,v.Z)(this,e),this._i=t,this.timerId=n,this.xo=r,this.Oo=i,this.No=a,this.Bo=0,this.Lo=null,this.ko=Date.now(),this.reset()}return(0,m.Z)(e,[{key:"reset",value:function(){this.Bo=0}},{key:"qo",value:function(){this.Bo=this.No}},{key:"Qo",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Bo+this.Ko()),r=Math.max(0,Date.now()-this.ko),i=Math.max(0,n-r);i>0&&Kr("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Bo," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Lo=this._i.enqueueAfterDelay(this.timerId,i,(function(){return t.ko=Date.now(),e()})),this.Bo*=this.Oo,this.Bo<this.xo&&(this.Bo=this.xo),this.Bo>this.No&&(this.Bo=this.No)}},{key:"$o",value:function(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}},{key:"cancel",value:function(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}},{key:"Ko",value:function(){return(Math.random()-.5)*this.Bo}}]),e}(),uu=function(){function e(t,n,r,i,a,o,s,c){(0,v.Z)(this,e),this._i=t,this.Uo=r,this.Wo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=c,this.state=0,this.Go=0,this.zo=null,this.jo=null,this.stream=null,this.Ho=new cu(t,n)}return(0,m.Z)(e,[{key:"Jo",value:function(){return 1===this.state||5===this.state||this.Yo()}},{key:"Yo",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.Zo()}},{key:"stop",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Jo(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Xo",value:function(){this.state=0,this.Ho.reset()}},{key:"e_",value:function(){var e=this;this.Yo()&&null===this.zo&&(this.zo=this._i.enqueueAfterDelay(this.Uo,6e4,(function(){return e.t_()})))}},{key:"n_",value:function(e){this.r_(),this.stream.send(e)}},{key:"t_",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Yo()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"r_",value:function(){this.zo&&(this.zo.cancel(),this.zo=null)}},{key:"i_",value:function(){this.jo&&(this.jo.cancel(),this.jo=null)}},{key:"close",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.r_(),this.i_(),this.Ho.cancel(),this.Go++,4!==t?this.Ho.reset():n&&n.code===ei.RESOURCE_EXHAUSTED?(zr(n.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Ho.qo()):n&&n.code===ei.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.s_(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Eo(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"s_",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.o_(this.Go),n=this.Go;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,s.Z)(t,2),i=r[0],a=r[1];e.Go===n&&e.__(i,a)}),(function(n){t((function(){var t=new ti(ei.UNKNOWN,"Fetching auth token failed: "+n.message);return e.a_(t)}))}))}},{key:"__",value:function(e,t){var n=this,r=this.o_(this.Go);this.stream=this.u_(e,t),this.stream.Io((function(){r((function(){return n.state=2,n.jo=n._i.enqueueAfterDelay(n.Wo,1e4,(function(){return n.Yo()&&(n.state=3),Promise.resolve()})),n.listener.Io()}))})),this.stream.Eo((function(e){r((function(){return n.a_(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"Zo",value:function(){var e=this;this.state=5,this.Ho.Qo((0,d.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"a_",value:function(e){return Kr("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"o_",value:function(e){var t=this;return function(n){t._i.enqueueAndForget((function(){return t.Go===e?n():(Kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),lu=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a,o,s){var c;return(0,v.Z)(this,n),(c=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,s)).serializer=o,c}return(0,m.Z)(n,[{key:"u_",value:function(e,t){return this.connection.Mo("Listen",e,t)}},{key:"onMessage",value:function(e){this.Ho.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Xr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(Qr(void 0===t||"string"==typeof t),Ji.fromBase64String(t||"")):(Qr(void 0===t||t instanceof Uint8Array),Ji.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&function(e){var t=void 0===e.code?ei.UNKNOWN:gs(e.code);return new ti(t,e.message||"")}(o);n=new As(r,i,a,s||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var u=Hs(e,c.document.name),l=Gs(c.document.updateTime),d=c.document.createTime?Gs(c.document.createTime):mi.min(),f=new wa({mapValue:{fields:c.document.fields}}),p=ka.newFoundDocument(u,l,d,f),h=c.targetIds||[],v=c.removedTargetIds||[];n=new Cs(h,v,p.key,p)}else if("documentDelete"in t){t.documentDelete;var m=t.documentDelete;m.document;var g=Hs(e,m.document),y=m.readTime?Gs(m.readTime):mi.min(),_=ka.newNoDocument(g,y),E=m.removedTargetIds||[];n=new Cs([],E,_.key,_)}else if("documentRemove"in t){t.documentRemove;var b=t.documentRemove;b.document;var w=Hs(e,b.document),S=b.removedTargetIds||[];n=new Cs([],S,w,null)}else{if(!("filter"in t))return Xr();t.filter;var k=t.filter;k.targetId;var T=k.count,I=void 0===T?0:T,C=k.unchangedNames,R=new vs(I,C),A=k.targetId;n=new Rs(A,R)}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return mi.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?mi.min():t.readTime?Gs(t.readTime):mi.min()}(e);return this.listener.c_(t,n)}},{key:"l_",value:function(e){var t={};t.database=Ys(this.serializer),t.addTarget=function(e,t){var n,r=t.target;if((n=Xa(r)?{documents:$s(e,r)}:{query:ec(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Vs(e,t.resumeToken);var i=js(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(mi.min())>0){n.readTime=Fs(e,t.snapshotVersion.toTimestamp());var a=js(e,t.expectedCount);null!==a&&(n.expectedCount=a)}return n}(this.serializer,e);var n=function(e,t){var n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xr()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.n_(t)}},{key:"h_",value:function(e){var t={};t.database=Ys(this.serializer),t.removeTarget=e,this.n_(t)}}]),n}(uu),du=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a,o,s){var c;return(0,v.Z)(this,n),(c=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,s)).serializer=o,c.P_=!1,c}return(0,m.Z)(n,[{key:"I_",get:function(){return this.P_}},{key:"start",value:function(){this.P_=!1,this.lastStreamToken=void 0,(0,a.Z)((0,o.Z)(n.prototype),"start",this).call(this)}},{key:"s_",value:function(){this.P_&&this.d_([])}},{key:"u_",value:function(e,t){return this.connection.Mo("Write",e,t)}},{key:"onMessage",value:function(e){if(Qr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.P_){this.Ho.reset();var t=function(e,t){return e&&e.length>0?(Qr(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Gs(e.updateTime):Gs(t);return n.isEqual(mi.min())&&(n=Gs(t)),new zo(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Gs(e.commitTime);return this.listener.T_(n,t)}return Qr(!e.writeResults||0===e.writeResults.length),this.P_=!0,this.listener.E_()}},{key:"A_",value:function(){var e={};e.database=Ys(this.serializer),this.n_(e)}},{key:"d_",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Qs(t.serializer,e)}))};this.n_(n)}}]),n}(uu),fu=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a){var o;return(0,v.Z)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.connection=i,o.serializer=a,o.R_=!1,o}return(0,m.Z)(n,[{key:"V_",value:function(){if(this.R_)throw new ti(ei.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"bo",value:function(e,t,n){var r=this;return this.V_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,s.Z)(i,2),o=a[0],c=a[1];return r.connection.bo(e,t,n,o,c)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===ei.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new ti(ei.UNKNOWN,e.toString())}))}},{key:"Fo",value:function(e,t,n,r){var i=this;return this.V_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var o=(0,s.Z)(a,2),c=o[0],u=o[1];return i.connection.Fo(e,t,n,c,u,r)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===ei.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new ti(ei.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.R_=!0}}]),n}((0,m.Z)((function e(){(0,v.Z)(this,e)})));var pu=function(){function e(t,n){(0,v.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.f_=0,this.g_=null,this.p_=!0}return(0,m.Z)(e,[{key:"y_",value:function(){var e=this;0===this.f_&&(this.w_("Unknown"),this.g_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.g_=null,e.S_("Backend didn't respond within 10 seconds."),e.w_("Offline"),Promise.resolve()})))}},{key:"b_",value:function(e){"Online"===this.state?this.w_("Unknown"):(this.f_++,this.f_>=1&&(this.D_(),this.S_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.w_("Offline")))}},{key:"set",value:function(e){this.D_(),this.f_=0,"Online"===e&&(this.p_=!1),this.w_(e)}},{key:"w_",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"S_",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.p_?(zr(t),this.p_=!1):Kr("OnlineStateTracker",t)}},{key:"D_",value:function(){null!==this.g_&&(this.g_.cancel(),this.g_=null)}}]),e}(),hu=(0,m.Z)((function e(t,n,r,i,a){var o=this;(0,v.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.C_=[],this.v_=new Map,this.F_=new Set,this.M_=[],this.x_=a,this.x_.so((function(e){r.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Tu(o),!e.t0){e.next=5;break}return Kr("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=$r(t)).F_.add(4),e.next=4,gu(n);case 4:return n.O_.set("Unknown"),n.F_.delete(4),e.next=8,vu(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.O_=new pu(r,i)}));function vu(e){return mu.apply(this,arguments)}function mu(){return(mu=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Tu(t)){e.next=18;break}n=(0,u.Z)(t.M_),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function gu(e){return yu.apply(this,arguments)}function yu(){return(yu=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,u.Z)(t.M_),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function _u(e,t){var n=$r(e);n.v_.has(t.targetId)||(n.v_.set(t.targetId,t),ku(n)?Su(n):el(n).Yo()&&bu(n,t))}function Eu(e,t){var n=$r(e),r=el(n);n.v_.delete(t),r.Yo()&&wu(n,t),0===n.v_.size&&(r.Yo()?r.e_():Tu(n)&&n.O_.set("Unknown"))}function bu(e,t){if(e.N_.Le(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(mi.min())>0){var n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}el(e).l_(t)}function wu(e,t){e.N_.Le(t),el(e).h_(t)}function Su(e){e.N_=new Ns({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.v_.get(t)||null},st:function(){return e.datastore.serializer.databaseId}}),el(e).start(),e.O_.y_()}function ku(e){return Tu(e)&&!el(e).Jo()&&e.v_.size>0}function Tu(e){return 0===$r(e).F_.size}function Iu(e){e.N_=void 0}function Cu(e){return Ru.apply(this,arguments)}function Ru(){return(Ru=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.v_.forEach((function(e,n){bu(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Au(e,t){return Ou.apply(this,arguments)}function Ou(){return(Ou=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Iu(t),ku(t)?(t.O_.b_(n),Su(t)):t.O_.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nu(e,t,n){return xu.apply(this,arguments)}function xu(){return xu=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.O_.set("Online"),!(n instanceof As&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=(0,u.Z)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.v_.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.v_.delete(o),t.N_.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),Kr("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Du(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Cs?t.N_.Ge(n):n instanceof Rs?t.N_.Xe(n):t.N_.He(n),r.isEqual(mi.min())){e.next=29;break}return e.prev=14,e.next=17,Bc(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.N_._t(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.v_.get(r);i&&e.v_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t,n){var r=e.v_.get(t);if(r){e.v_.set(t,r.withResumeToken(Ji.EMPTY_BYTE_STRING,r.snapshotVersion)),wu(e,t);var i=new dc(r.target,t,n,r.sequenceNumber);bu(e,i)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),Kr("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Du(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),xu.apply(this,arguments)}function Du(e,t,n){return Pu.apply(this,arguments)}function Pu(){return(Pu=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xi(n)){e.next=2;break}throw n;case 2:return t.F_.add(1),e.next=5,gu(t);case 5:t.O_.set("Offline"),r||(r=function(){return Bc(t.localStore)}),t.asyncQueue.enqueueRetryable((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kr("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.F_.delete(1),e.next=6,vu(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lu(e,t){return t().catch((function(n){return Du(e,n,t)}))}function Mu(e){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=$r(t),r=tl(n),i=n.C_.length>0?n.C_[n.C_.length-1].batchId:-1;case 2:if(!ju(n)){e.next=19;break}return e.prev=3,e.next=6,qc(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.C_.length&&r.e_(),e.abrupt("break",19);case 10:i=a.batchId,Fu(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Du(n,e.t0);case 17:e.next=2;break;case 19:Vu(n)&&Bu(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Uu.apply(this,arguments)}function ju(e){return Tu(e)&&e.C_.length<10}function Fu(e,t){e.C_.push(t);var n=tl(e);n.Yo()&&n.I_&&n.d_(t.mutations)}function Vu(e){return Tu(e)&&!tl(e).Jo()&&e.C_.length>0}function Bu(e){tl(e).start()}function Gu(e){return Zu.apply(this,arguments)}function Zu(){return(Zu=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:tl(t).A_();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qu(e){return Wu.apply(this,arguments)}function Wu(){return(Wu=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=tl(t),r=(0,u.Z)(t.C_);try{for(r.s();!(i=r.n()).done;)a=i.value,n.d_(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hu(e,t,n){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.C_.shift(),a=ps.from(i,n,r),e.next=3,Lu(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Mu(t);case 5:case"end":return e.stop()}}),e)}))),Ku.apply(this,arguments)}function zu(e,t){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&tl(t).I_,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!function(e){return ms(e)&&e!==ei.ABORTED}(n.code)){e.next=7;break}return r=t.C_.shift(),tl(t).Xo(),e.next=5,Lu(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Mu(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Vu(t)&&Bu(t);case 5:case"end":return e.stop()}}),e)}))),Yu.apply(this,arguments)}function Ju(e,t){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=$r(t)).asyncQueue.verifyOperationInProgress(),Kr("RemoteStore","RemoteStore received new credentials"),i=Tu(r),r.F_.add(3),e.next=6,gu(r);case 6:return i&&r.O_.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.F_.delete(3),e.next=12,vu(r);case 12:case"end":return e.stop()}}),e)}))),Xu.apply(this,arguments)}function Qu(e,t){return $u.apply(this,arguments)}function $u(){return($u=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$r(t),!n){e.next=7;break}return r.F_.delete(2),e.next=5,vu(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.F_.add(2),e.next=12,gu(r);case 12:r.O_.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function el(e){return e.B_||(e.B_=function(e,t,n){var r=$r(e);return r.V_(),new lu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Io:Cu.bind(null,e),Eo:Au.bind(null,e),c_:Nu.bind(null,e)}),e.M_.push(function(){var t=(0,d.Z)((0,l.Z)().mark((function t(n){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.B_.Xo(),ku(e)?Su(e):e.O_.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.B_.stop();case 6:Iu(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.B_}function tl(e){return e.L_||(e.L_=function(e,t,n){var r=$r(e);return r.V_(),new du(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Io:Gu.bind(null,e),Eo:zu.bind(null,e),E_:qu.bind(null,e),T_:Hu.bind(null,e)}),e.M_.push(function(){var t=(0,d.Z)((0,l.Z)().mark((function t(n){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.L_.Xo(),t.next=4,Mu(e);case 4:t.next=9;break;case 6:return t.next=8,e.L_.stop();case 8:e.C_.length>0&&(Kr("RemoteStore","Stopping write stream with ".concat(e.C_.length," pending writes")),e.C_=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.L_}var nl=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new ni,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,m.Z)(e,[{key:"promise",get:function(){return this.deferred.promise}},{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ti(ei.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function rl(e,t){if(zr("AsyncQueue","".concat(t,": ").concat(e)),xi(e))return new ti(ei.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var il=function(){function e(t){(0,v.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||bi.comparator(e.key,n.key)}:function(e,t){return bi.comparator(e.key,t.key)},this.keyedMap=wo(),this.sortedSet=new Zi(this.comparator)}return(0,m.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),al=function(){function e(){(0,v.Z)(this,e),this.k_=new Zi(bi.comparator)}return(0,m.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.k_.get(t);n?0!==e.type&&3===n.type?this.k_=this.k_.insert(t,e):3===e.type&&1!==n.type?this.k_=this.k_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.k_=this.k_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.k_=this.k_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.k_=this.k_.remove(t):1===e.type&&2===n.type?this.k_=this.k_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.k_=this.k_.insert(t,{type:2,doc:e.doc}):Xr():this.k_=this.k_.insert(t,e)}},{key:"q_",value:function(){var e=[];return this.k_.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),ol=function(){function e(t,n,r,i,a,o,s,c,u){(0,v.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=c,this.hasCachedResults=u}return(0,m.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i,a){var o=[];return n.forEach((function(e){o.push({type:0,doc:e})})),new e(t,n,il.emptySet(n),o,r,i,!0,!1,a)}}]),e}(),sl=(0,m.Z)((function e(){(0,v.Z)(this,e),this.Q_=void 0,this.listeners=[]})),cl=(0,m.Z)((function e(){(0,v.Z)(this,e),this.queries=new yo((function(e){return fo(e)}),lo),this.onlineState="Unknown",this.K_=new Set}));function ul(e,t){return ll.apply(this,arguments)}function ll(){return ll=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$r(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new sl),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.Q_=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),s=rl(e.t0,"Initialization of query '".concat(po(n.query),"' failed")),e.abrupt("return",void n.onError(s));case 13:r.queries.set(i,o),o.listeners.push(n),n.U_(r.onlineState),o.Q_&&n.W_(o.Q_)&&vl(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),ll.apply(this,arguments)}function dl(e,t){return fl.apply(this,arguments)}function fl(){return fl=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$r(t),i=n.query,a=!1,(o=r.queries.get(i))&&(s=o.listeners.indexOf(n))>=0&&(o.listeners.splice(s,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)}))),fl.apply(this,arguments)}function pl(e,t){var n,r=$r(e),i=!1,a=(0,u.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.query,c=r.queries.get(s);if(c){var l,d=(0,u.Z)(c.listeners);try{for(d.s();!(l=d.n()).done;){l.value.W_(o)&&(i=!0)}}catch(f){d.e(f)}finally{d.f()}c.Q_=o}}}catch(f){a.e(f)}finally{a.f()}i&&vl(r)}function hl(e,t,n){var r=$r(e),i=r.queries.get(t);if(i){var a,o=(0,u.Z)(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(s){o.e(s)}finally{o.f()}}r.queries.delete(t)}function vl(e){e.K_.forEach((function(e){e.next()}))}var ml=function(){function e(t,n,r){(0,v.Z)(this,e),this.query=t,this.G_=n,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}return(0,m.Z)(e,[{key:"W_",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=(0,u.Z)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(o){r.e(o)}finally{r.f()}e=new ol(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}var a=!1;return this.z_?this.H_(e)&&(this.G_.next(e),a=!0):this.J_(e,this.onlineState)&&(this.Y_(e),a=!0),this.j_=e,a}},{key:"onError",value:function(e){this.G_.error(e)}},{key:"U_",value:function(e){this.onlineState=e;var t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}},{key:"J_",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}},{key:"H_",value:function(e){if(e.docChanges.length>0)return!0;var t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"Y_",value:function(e){e=ol.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}]),e}();var gl=(0,m.Z)((function e(t){(0,v.Z)(this,e),this.key=t})),yl=(0,m.Z)((function e(t){(0,v.Z)(this,e),this.key=t})),_l=function(){function e(t,n){(0,v.Z)(this,e),this.query=t,this.oa=n,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Ao(),this.mutatedKeys=Ao(),this.ua=mo(t),this.ca=new il(this.ua)}return(0,m.Z)(e,[{key:"la",get:function(){return this.oa}},{key:"ha",value:function(e,t){var n=this,r=t?t.Pa:new al,i=t?t.ca:this.ca,a=t?t.mutatedKeys:this.mutatedKeys,o=i,s=!1,c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,u="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),d=ho(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),p=!!d&&(d.hasLocalMutations||n.mutatedKeys.has(d.key)&&d.hasCommittedMutations),h=!1;l&&d?l.data.isEqual(d.data)?f!==p&&(r.track({type:3,doc:d}),h=!0):n.Ia(l,d)||(r.track({type:2,doc:d}),h=!0,(c&&n.ua(d,c)>0||u&&n.ua(d,u)<0)&&(s=!0)):!l&&d?(r.track({type:0,doc:d}),h=!0):l&&!d&&(r.track({type:1,doc:l}),h=!0,(c||u)&&(s=!0)),h&&(d?(o=o.add(d),a=p?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){var l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,es:s,mutatedKeys:a}}},{key:"Ia",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;var a=e.Pa.q_();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xr()}};return n(e)-n(t)}(e.type,t.type)||r.ua(e.doc,t.doc)})),this.da(n);var o=t?this.Ta():[],s=0===this.aa.size&&this.current?1:0,c=s!==this._a;return this._a=s,0!==a.length||c?{snapshot:new ol(this.query,e.ca,i,a,e.mutatedKeys,0===s,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ea:o}:{Ea:o}}},{key:"U_",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new al,mutatedKeys:this.mutatedKeys,es:!1},!1)):{Ea:[]}}},{key:"Aa",value:function(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}},{key:"da",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.oa=t.oa.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.oa=t.oa.delete(e)})),this.current=e.current)}},{key:"Ta",value:function(){var e=this;if(!this.current)return[];var t=this.aa;this.aa=Ao(),this.ca.forEach((function(t){e.Aa(t.key)&&(e.aa=e.aa.add(t.key))}));var n=[];return t.forEach((function(t){e.aa.has(t)||n.push(new yl(t))})),this.aa.forEach((function(e){t.has(e)||n.push(new gl(e))})),n}},{key:"Ra",value:function(e){this.oa=e.Ps,this.aa=Ao();var t=this.ha(e.documents);return this.applyChanges(t,!0)}},{key:"Va",value:function(){return ol.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}]),e}(),El=(0,m.Z)((function e(t,n,r){(0,v.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),bl=(0,m.Z)((function e(t){(0,v.Z)(this,e),this.key=t,this.ma=!1})),wl=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new yo((function(e){return fo(e)}),lo),this.pa=new Map,this.ya=new Set,this.wa=new Zi(bi.comparator),this.Sa=new Map,this.ba=new kc,this.Da={},this.Ca=new Map,this.va=yc.Ln(),this.onlineState="Unknown",this.Fa=void 0}return(0,m.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Fa}}]),e}();function Sl(e,t){return kl.apply(this,arguments)}function kl(){return kl=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,s,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ql(t),!(o=r.ga.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.Va(),e.next=15;break;case 6:return e.next=8,Wc(r.localStore,oo(n));case 8:return s=e.sent,c=r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.targetId,e.next=13,Tl(r,n,i,"current"===c,s.resumeToken);case 13:a=e.sent,r.isPrimaryClient&&_u(r.remoteStore,s);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),kl.apply(this,arguments)}function Tl(e,t,n,r,i){return Il.apply(this,arguments)}function Il(){return Il=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i,a){var o,s,c,u,f,p;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Ma=function(e,n,r){return function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var a,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.ha(r),e.t0=a.es,!e.t0){e.next=6;break}return e.next=5,zc(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.ha(t,a)}));case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(ql(t,n.targetId,s.Ea),s.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,zc(t.localStore,n,!0);case 3:return o=e.sent,s=new _l(n,o.Ps),c=s.ha(o.documents),u=Is.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState,a),f=s.applyChanges(c,t.isPrimaryClient,u),ql(t,r,f.Ea),p=new El(n,r,s),e.abrupt("return",(t.ga.set(n,p),t.pa.has(r)?t.pa.get(r).push(n):t.pa.set(r,[n]),f.snapshot));case 11:case"end":return e.stop()}}),e)}))),Il.apply(this,arguments)}function Cl(e,t){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$r(t),i=r.ga.get(n),!((a=r.pa.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.pa.set(i.targetId,a.filter((function(e){return!lo(e,n)}))),void r.ga.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Hc(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),Eu(r.remoteStore,i.targetId),Gl(r,i.targetId)})).catch(Ai);case 9:e.next=14;break;case 11:return Gl(r,i.targetId),e.next=14,Hc(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),Rl.apply(this,arguments)}function Al(e,t,n){return Ol.apply(this,arguments)}function Ol(){return Ol=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$l(t),e.prev=1,e.next=4,function(e,t){var n,r,i=$r(e),a=vi.now(),o=t.reduce((function(e,t){return e.add(t.key)}),Ao());return i.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var s=Eo(),c=Ao();return i._s.getEntries(e,o).next((function(e){(s=e).forEach((function(e,t){t.isValidDocument()||(c=c.add(e))}))})).next((function(){return i.localDocuments.getOverlayedDocuments(e,s)})).next((function(r){n=r;var o,s=[],c=(0,u.Z)(t);try{for(c.s();!(o=c.n()).done;){var l=o.value,d=ts(l,n.get(l.key).overlayedDocument);null!=d&&s.push(new is(l.key,d,Sa(d.value.mapValue),Yo.exists(!0)))}}catch(f){c.e(f)}finally{c.f()}return i.mutationQueue.addMutationBatch(e,a,s,t)})).next((function(t){r=t;var a=t.applyToLocalDocumentSet(n,c);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)}))})).then((function(){return{batchId:r.batchId,changes:So(n)}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Da[e.currentUser.toKey()];r||(r=new Zi(pi)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Kl(i,a.changes);case 9:return e.next=11,Mu(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=rl(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Ol.apply(this,arguments)}function Nl(e,t){return xl.apply(this,arguments)}function xl(){return xl=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),e.prev=1,e.next=4,Gc(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Sa.get(t);n&&(Qr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.ma=!0:e.modifiedDocuments.size>0?Qr(n.ma):e.removedDocuments.size>0&&(Qr(n.ma),n.ma=!1))})),e.next=8,Kl(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Ai(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),xl.apply(this,arguments)}function Dl(e,t,n){var r=$r(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.ga.forEach((function(e,n){var r=n.view.U_(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=$r(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,u.Z)(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.U_(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}})),r&&vl(n)}(r.eventManager,t),i.length&&r.fa.c_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Pl(e,t,n){return Ll.apply(this,arguments)}function Ll(){return Ll=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=$r(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Sa.get(n),!(o=a&&a.key)){e.next=14;break}return s=(s=new Zi(bi.comparator)).insert(o,ka.newNoDocument(o,mi.min())),c=Ao().add(o),u=new Ts(mi.min(),new Map,new Zi(pi),s,c),e.next=9,Nl(i,u);case 9:i.wa=i.wa.remove(o),i.Sa.delete(n),Hl(i),e.next=16;break;case 14:return e.next=16,Hc(i.localStore,n,!1).then((function(){return Gl(i,n,r)})).catch(Ai);case 16:case"end":return e.stop()}}),e)}))),Ll.apply(this,arguments)}function Ml(e,t){return Ul.apply(this,arguments)}function Ul(){return Ul=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),i=n.batch.batchId,e.prev=1,e.next=4,Vc(r.localStore,n);case 4:return a=e.sent,Bl(r,i,null),Vl(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Kl(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ai(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Ul.apply(this,arguments)}function jl(e,t,n){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$r(t),e.prev=1,e.next=4,function(e,t){var n=$r(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return Qr(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Bl(i,n,r),Vl(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Kl(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ai(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Fl.apply(this,arguments)}function Vl(e,t){(e.Ca.get(t)||[]).forEach((function(e){e.resolve()})),e.Ca.delete(t)}function Bl(e,t,n){var r=$r(e),i=r.Da[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function Gl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=(0,u.Z)(e.pa.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.ga.delete(a),n&&e.fa.xa(a,n)}}catch(o){i.e(o)}finally{i.f()}e.pa.delete(t),e.isPrimaryClient&&e.ba.mr(t).forEach((function(t){e.ba.containsKey(t)||Zl(e,t)}))}function Zl(e,t){e.ya.delete(t.path.canonicalString());var n=e.wa.get(t);null!==n&&(Eu(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),Hl(e))}function ql(e,t,n){var r,i=(0,u.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof gl?(e.ba.addReference(a.key,t),Wl(e,a)):a instanceof yl?(Kr("SyncEngine","Document no longer in limbo: "+a.key),e.ba.removeReference(a.key,t),e.ba.containsKey(a.key)||Zl(e,a.key)):Xr()}}catch(o){i.e(o)}finally{i.f()}}function Wl(e,t){var n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(Kr("SyncEngine","New document in limbo: "+n),e.ya.add(r),Hl(e))}function Hl(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){var t=e.ya.values().next().value;e.ya.delete(t);var n=new bi(yi.fromString(t)),r=e.va.next();e.Sa.set(r,new bl(n)),e.wa=e.wa.insert(n,r),_u(e.remoteStore,new dc(oo(eo(n.path)),r,"TargetPurposeLimboResolution",Di.ae))}}function Kl(e,t,n){return zl.apply(this,arguments)}function zl(){return zl=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=$r(t),a=[],o=[],s=[],e.t0=i.ga.isEmpty(),e.t0){e.next=9;break}return i.ga.forEach((function(e,t){s.push(i.Ma(t,n,r).then((function(e){if((e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){a.push(e);var n=Dc.$i(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.fa.c_(a),e.next=9,function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,s,c,d,f;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Ni.forEach(n,(function(t){return Ni.forEach(t.Qi,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Ni.forEach(t.Ki,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),xi(e.t0)){e.next=10;break}throw e.t0;case 10:Kr("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,u.Z)(n);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.targetId,o.fromCache||(c=r.rs.get(s),d=c.snapshotVersion,f=c.withLastLimboFreeSnapshotVersion(d),r.rs=r.rs.insert(s,f))}catch(l){i.e(l)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),zl.apply(this,arguments)}function Yl(e,t){return Jl.apply(this,arguments)}function Jl(){return(Jl=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=$r(t)).currentUser.isEqual(n)){e.next=11;break}return Kr("SyncEngine","User change. New user:",n.toKey()),e.next=5,jc(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Ca.forEach((function(e){e.forEach((function(e){e.reject(new ti(ei.CANCELLED,t))}))})),e.Ca.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Kl(r,i.cs);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xl(e,t){var n=$r(e),r=n.Sa.get(t);if(r&&r.ma)return Ao().add(r.key);var i=Ao(),a=n.pa.get(t);if(!a)return i;var o,s=(0,u.Z)(a);try{for(s.s();!(o=s.n()).done;){var c=o.value,l=n.ga.get(c);i=i.unionWith(l.view.la)}}catch(d){s.e(d)}finally{s.f()}return i}function Ql(e){var t=$r(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Pl.bind(null,t),t.fa.c_=pl.bind(null,t.eventManager),t.fa.xa=hl.bind(null,t.eventManager),t}function $l(e){var t=$r(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ml.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jl.bind(null,t),t}var ed=function(){function e(){(0,v.Z)(this,e),this.synchronizeTabs=!1}return(0,m.Z)(e,[{key:"initialize",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.serializer=su(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),e.next=5,this.persistence.start();case 5:this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGarbageCollectionScheduler",value:function(e,t){return null}},{key:"createIndexBackfillerScheduler",value:function(e,t){return null}},{key:"createLocalStore",value:function(e){return Uc(this.persistence,new Lc,e.initialUser,this.serializer)}},{key:"createPersistence",value:function(e){return new Oc(xc.Jr,this.serializer)}},{key:"createSharedClientState",value:function(e){return new Xc}},{key:"terminate",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),td=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"initialize",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Dl(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Yl.bind(null,this.syncEngine),e.next=12,Qu(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new cl}},{key:"createDatastore",value:function(e){var t=su(e.databaseInfo.databaseId),n=function(e){return new au(e)}(e.databaseInfo);return function(e,t,n,r){return new fu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function(e){var t=this;return function(e,t,n,r,i){return new hu(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(function(e){return Dl(t.syncEngine,e,0)}),$c.C()?new $c:new Qc)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var s=new wl(e,t,n,r,i,a);return o&&(s.Fa=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$r(t),Kr("RemoteStore","RemoteStore shutting down."),n.F_.add(5),e.next=5,gu(n);case 5:n.x_.shutdown(),n.O_.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();var nd=function(){function e(t){(0,v.Z)(this,e),this.observer=t,this.muted=!1}return(0,m.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.Ba(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ba(this.observer.error,e):zr("Uncaught Error in snapshot listener:",e.toString())}},{key:"La",value:function(){this.muted=!0}},{key:"Ba",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),rd=function(){function e(t,n,r,i){var a=this;(0,v.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Zr.UNAUTHENTICATED,this.clientId=fi.V(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kr("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return Kr("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)}))}return(0,m.Z)(e,[{key:"getConfiguration",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new ti(ei.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new ni;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,d.Z)((0,l.Z)().mark((function n(){var r;return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e._onlineComponents,!n.t0){n.next=5;break}return n.next=5,e._onlineComponents.terminate();case 5:if(n.t1=e._offlineComponents,!n.t1){n.next=9;break}return n.next=9,e._offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=rl(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function id(e,t){return ad.apply(this,arguments)}function ad(){return ad=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),Kr("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,jc(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t._offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),ad.apply(this,arguments)}function od(e,t){return sd.apply(this,arguments)}function sd(){return sd=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,ud(t);case 3:return r=e.sent,Kr("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return Ju(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return Ju(n.remoteStore,t)})),t._onlineComponents=n;case 13:case"end":return e.stop()}}),e)}))),sd.apply(this,arguments)}function cd(e){return"FirebaseError"===e.name?e.code===ei.FAILED_PRECONDITION||e.code===ei.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}function ud(e){return ld.apply(this,arguments)}function ld(){return(ld=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._offlineComponents){e.next=21;break}if(!t._uninitializedComponentsProvider){e.next=18;break}return Kr("FirestoreClient","Using user provided OfflineComponentProvider"),e.prev=3,e.next=6,id(t,t._uninitializedComponentsProvider._offline);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),cd(n=e.t0)){e.next=13;break}throw n;case 13:return Yr("Error using user provided cache. Falling back to memory cache: "+n),e.next=16,id(t,new ed);case 16:e.next=21;break;case 18:return Kr("FirestoreClient","Using default OfflineComponentProvider"),e.next=21,id(t,new ed);case 21:return e.abrupt("return",t._offlineComponents);case 22:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function dd(e){return fd.apply(this,arguments)}function fd(){return(fd=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._onlineComponents,e.t0){e.next=11;break}if(!t._uninitializedComponentsProvider){e.next=8;break}return Kr("FirestoreClient","Using user provided OnlineComponentProvider"),e.next=6,od(t,t._uninitializedComponentsProvider._online);case 6:e.next=11;break;case 8:return Kr("FirestoreClient","Using default OnlineComponentProvider"),e.next=11,od(t,new td);case 11:return e.abrupt("return",t._onlineComponents);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pd(e){return dd(e).then((function(e){return e.syncEngine}))}function hd(e){return vd.apply(this,arguments)}function vd(){return(vd=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dd(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Sl.bind(null,n.syncEngine),r.onUnlisten=Cl.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function md(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new ni;return e.asyncQueue.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function i(){return(0,l.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new nd({next:function(a){t.enqueueAndForget((function(){return dl(e,o)}));var s=a.docs.has(n);!s&&a.fromCache?i.reject(new ti(ei.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&a.fromCache&&r&&"server"===r.source?i.reject(new ti(ei.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new ml(eo(n.path),a,{includeMetadataChanges:!0,Z_:!0});return ul(e,o)},i.next=3,hd(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function gd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new ni;return e.asyncQueue.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function i(){return(0,l.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new nd({next:function(n){t.enqueueAndForget((function(){return dl(e,o)})),n.fromCache&&"server"===r.source?i.reject(new ti(ei.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new ml(n,a,{includeMetadataChanges:!0,Z_:!0});return ul(e,o)},i.next=3,hd(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function yd(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}var _d=new Map;function Ed(e,t,n){if(!n)throw new ti(ei.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function bd(e){if(!bi.isDocumentKey(e))throw new ti(ei.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function wd(e){if(bi.isDocumentKey(e))throw new ti(ei.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Sd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Xr()}function kd(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ti(ei.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Sd(e);throw new ti(ei.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}var Td=function(){function e(t){var n,r;if((0,v.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new ti(ei.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ti(ei.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new ti(ei.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yd(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Id=function(){function e(t,n,r,i){(0,v.Z)(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Td({}),this._settingsFrozen=!1}return(0,m.Z)(e,[{key:"app",get:function(){if(!this._app)throw new ti(ei.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new ti(ei.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Td(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ii;switch(e.type){case"firstParty":return new ci(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ti(ei.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=_d.get(e);t&&(Kr("ComponentProvider","Removing Datastore"),_d.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function Cd(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=kd(e,Id))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==a.host&&a.host!==o&&Yr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),i.mockUserToken){var s,c;if("string"==typeof i.mockUserToken)s=i.mockUserToken,c=Zr.MOCK_USER;else{s=(0,E.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new ti(ei.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Zr(u)}e._authCredentials=new ai(new ri(s,c))}}var Rd=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,m.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Ad=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,m.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Od(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Od=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,eo(i)))._path=i,a.type="collection",a}return(0,m.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Ad(this.firestore,null,new bi(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Rd);function Nd(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,E.m9)(e),Ed("collection","path",t),e instanceof Id){var a=yi.fromString.apply(yi,[t].concat(r));return wd(a),new Od(e,null,a)}if(!(e instanceof Ad||e instanceof Od))throw new ti(ei.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(yi.fromString.apply(yi,[t].concat(r)));return wd(o),new Od(e.firestore,null,o)}function xd(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,E.m9)(e),1===arguments.length&&(t=fi.V()),Ed("doc","path",t),e instanceof Id){var a=yi.fromString.apply(yi,[t].concat(r));return bd(a),new Ad(e,null,new bi(a))}if(!(e instanceof Ad||e instanceof Od))throw new ti(ei.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(yi.fromString.apply(yi,[t].concat(r)));return bd(o),new Ad(e.firestore,e instanceof Od?e.converter:null,new bi(o))}var Dd=function(){function e(){var t=this;(0,v.Z)(this,e),this.Za=Promise.resolve(),this.Xa=[],this.eu=!1,this.tu=[],this.nu=null,this.ru=!1,this.iu=!1,this.su=[],this.Ho=new cu(this,"async_queue_retry"),this.ou=function(){var e=ou();e&&Kr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Ho.$o()};var n=ou();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.ou)}return(0,m.Z)(e,[{key:"isShuttingDown",get:function(){return this.eu}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this._u(),this.au(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.eu){this.eu=!0,this.iu=e||!1;var t=ou();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ou)}}},{key:"enqueue",value:function(e){var t=this;if(this._u(),this.eu)return new Promise((function(){}));var n=new ni;return this.au((function(){return t.eu&&t.iu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.Xa.push(e),t.uu()}))}},{key:"uu",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Xa.length){e.next=14;break}return e.prev=1,e.next=4,this.Xa[0]();case 4:this.Xa.shift(),this.Ho.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),xi(e.t0)){e.next=12;break}throw e.t0;case 12:Kr("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Xa.length>0&&this.Ho.Qo((function(){return t.uu()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"au",value:function(e){var t=this,n=this.Za.then((function(){return t.ru=!0,e().catch((function(e){t.nu=e,t.ru=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw zr("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.ru=!1,e}))}));return this.Za=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this._u(),this.su.indexOf(e)>-1&&(t=0);var i=nl.createAndSchedule(this,e,t,n,(function(e){return r.cu(e)}));return this.tu.push(i),i}},{key:"_u",value:function(){this.nu&&Xr()}},{key:"verifyOperationInProgress",value:function(){}},{key:"lu",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Za,e.next=3,t;case 3:if(t!==this.Za){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hu",value:function(e){var t,n=(0,u.Z)(this.tu);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Pu",value:function(e){var t=this;return this.lu().then((function(){t.tu.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,u.Z)(t.tu);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.lu()}))}},{key:"Iu",value:function(e){this.su.push(e)}},{key:"cu",value:function(e){var t=this.tu.indexOf(e);this.tu.splice(t,1)}}]),e}();function Pd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=(0,u.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e,["next","error","complete"])}var Ld=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e,r,i,a)).type="firestore",o._queue=new Dd,o._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",o}return(0,m.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||jd(this),this._firestoreClient.terminate()}}]),n}(Id);function Md(e,t){var n="object"==typeof e?e:(0,g.Mq)(),r="string"==typeof e?e:t||"(default)",i=(0,g.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){var a=(0,E.P0)("firestore");a&&Cd.apply(void 0,[i].concat((0,h.Z)(a)))}return i}function Ud(e){return e._firestoreClient||jd(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function jd(e){var t,n,r,i=e._freezeSettings(),a=function(e,t,n,r){return new ia(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yd(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new rd(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Fd=function(){function e(t){(0,v.Z)(this,e),this._byteString=t}return(0,m.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Ji.fromBase64String(t))}catch(t){throw new ti(ei.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Ji.fromUint8Array(t))}}]),e}(),Vd=function(){function e(){(0,v.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new ti(ei.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ei(n)}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var Bd=(0,m.Z)((function e(t){(0,v.Z)(this,e),this._methodName=t})),Gd=function(){function e(t,n){if((0,v.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new ti(ei.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new ti(ei.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,m.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return pi(this._lat,e._lat)||pi(this._long,e._long)}}]),e}(),Zd=/^__.*__$/,qd=function(){function e(t,n,r){(0,v.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new is(e,this.data,this.fieldMask,t,this.fieldTransforms):new rs(e,this.data,t,this.fieldTransforms)}}]),e}(),Wd=function(){function e(t,n,r){(0,v.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,m.Z)(e,[{key:"toMutation",value:function(e,t){return new is(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Hd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xr()}}var Kd=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===a&&this.du(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return(0,m.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"Tu",get:function(){return this.settings.Tu}},{key:"Eu",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Au",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Eu({path:n,Ru:!1});return r.Vu(e),r}},{key:"mu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Eu({path:n,Ru:!1});return r.du(),r}},{key:"fu",value:function(e){return this.Eu({path:void 0,Ru:!0})}},{key:"gu",value:function(e){return df(e,this.settings.methodName,this.settings.pu||!1,this.path,this.settings.yu)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"du",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Vu(this.path.get(e))}},{key:"Vu",value:function(e){if(0===e.length)throw this.gu("Document fields must not be empty");if(Hd(this.Tu)&&Zd.test(e))throw this.gu('Document fields cannot begin and end with "__"')}}]),e}(),zd=function(){function e(t,n,r){(0,v.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||su(t)}return(0,m.Z)(e,[{key:"wu",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Kd({Tu:e,methodName:t,yu:n,path:Ei.emptyPath(),Ru:!1,pu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]),e}();function Yd(e){var t=e._freezeSettings(),n=su(e._databaseId);return new zd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Jd(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.wu(a.merge||a.mergeFields?2:0,t,n,i);sf("Data must be an object, but it was:",o,r);var s,c,l=af(r,o);if(a.merge)s=new zi(o.fieldMask),c=o.fieldTransforms;else if(a.mergeFields){var d,f=[],p=(0,u.Z)(a.mergeFields);try{for(p.s();!(d=p.n()).done;){var h=cf(t,d.value,n);if(!o.contains(h))throw new ti(ei.INVALID_ARGUMENT,"Field '".concat(h,"' is specified in your field mask but missing from your input data."));ff(f,h)||f.push(h)}}catch(v){p.e(v)}finally{p.f()}s=new zi(f),c=o.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,c=o.fieldTransforms;return new qd(new wa(l),s,c)}var Xd=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Tu)throw 1===e.Tu?e.gu("".concat(this._methodName,"() can only appear at the top level of your update data")):e.gu("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Bd);var Qd=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Ko(e.path,new Fo)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Bd),$d=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).bu=r,i}return(0,m.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new qo(e.serializer,Po(e.serializer,this.bu));return new Ko(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Bd);function ef(e,t,n,r){var i=e.wu(1,t,n);sf("Data must be an object, but it was:",i,r);var a=[],o=wa.empty();Bi(r,(function(e,r){var s=lf(t,e,n);r=(0,E.m9)(r);var c=i.mu(s);if(r instanceof Xd)a.push(s);else{var u=rf(r,c);null!=u&&(a.push(s),o.set(s,u))}}));var s=new zi(a);return new Wd(o,s,i.fieldTransforms)}function tf(e,t,n,r,i,a){var o=e.wu(1,t,n),s=[cf(t,r,n)],c=[i];if(a.length%2!=0)throw new ti(ei.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var u=0;u<a.length;u+=2)s.push(cf(t,a[u])),c.push(a[u+1]);for(var l=[],d=wa.empty(),f=s.length-1;f>=0;--f)if(!ff(l,s[f])){var p=s[f],h=c[f];h=(0,E.m9)(h);var v=o.mu(p);if(h instanceof Xd)l.push(p);else{var m=rf(h,v);null!=m&&(l.push(p),d.set(p,m))}}var g=new zi(l);return new Wd(d,g,o.fieldTransforms)}function nf(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return rf(n,e.wu(r?4:3,t))}function rf(e,t){if(of(e=(0,E.m9)(e)))return sf("Unsupported field value:",t,e),af(e,t);if(e instanceof Bd)return function(e,t){if(!Hd(t.Tu))throw t.gu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.gu("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Ru&&4!==t.Tu)throw t.gu("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,u.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=rf(n.value,t.fu(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(s){a.e(s)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,E.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Po(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=vi.fromDate(e);return{timestampValue:Fs(t.serializer,n)}}if(e instanceof vi){var r=new vi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Fs(t.serializer,r)}}if(e instanceof Gd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Fd)return{bytesValue:Vs(t.serializer,e._byteString)};if(e instanceof Ad){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.gu("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Zs(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.gu("Unsupported field value: ".concat(Sd(e)))}(e,t)}function af(e,t){var n={};return Gi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Bi(e,(function(e,r){var i=rf(r,t.Au(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function of(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof vi||e instanceof Gd||e instanceof Fd||e instanceof Ad||e instanceof Bd)}function sf(e,t,n){if(!of(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Sd(n);throw"an object"===r?t.gu(e+" a custom object"):t.gu(e+" "+r)}}function cf(e,t,n){if((t=(0,E.m9)(t))instanceof Vd)return t._internalPath;if("string"==typeof t)return lf(e,t);throw df("Field path arguments must be of type string or ",e,!1,void 0,n)}var uf=new RegExp("[~\\*/\\[\\]]");function lf(e,t,n){if(t.search(uf)>=0)throw df("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,i.Z)(Vd,(0,h.Z)(t.split(".")))._internalPath}catch(D){throw df("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function df(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var c="";return(a||o)&&(c+=" (found",a&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(i)),c+=")"),new ti(ei.INVALID_ARGUMENT,s+e+c)}function ff(e,t){return e.some((function(e){return e.isEqual(t)}))}var pf=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,m.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new Ad(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new hf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(vf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),hf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this)}}]),n}(pf);function vf(e,t){return"string"==typeof t?lf(e,t):t instanceof Vd?t._internalPath:t._delegate._internalPath}function mf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ti(ei.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var gf=(0,m.Z)((function e(){(0,v.Z)(this,e)})),yf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n)}(gf);function _f(e,t){for(var n=[],r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t instanceof gf&&n.push(t),function(e){var t=e.filter((function(e){return e instanceof bf})).length,n=e.filter((function(e){return e instanceof Ef})).length;if(t>1||t>0&&n>0)throw new ti(ei.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(i));var o,s=(0,u.Z)(n);try{for(s.s();!(o=s.n()).done;){e=o.value._apply(e)}}catch(c){s.e(c)}finally{s.f()}return e}var Ef=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this))._field=e,a._op=r,a._value=i,a.type="where",a}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=this._parse(e);return If(e._query,t),new Rd(e.firestore,e.converter,co(e._query,t))}},{key:"_parse",value:function(e){var t=Yd(e.firestore),n=function(e,t,n,r,i,a,o){var s;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new ti(ei.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){Tf(o,a);var c,l=[],d=(0,u.Z)(o);try{for(d.s();!(c=d.n()).done;){var f=c.value;l.push(kf(r,e,f))}}catch(p){d.e(p)}finally{d.f()}s={arrayValue:{values:l}}}else s=kf(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Tf(o,a),s=nf(n,t,o,"in"===a||"not-in"===a);return Na.create(i,a,s)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}],[{key:"_create",value:function(e,t,r){return new n(e,t,r)}}]),n}(yf);var bf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).type=e,i._queryConstraints=r,i}return(0,m.Z)(n,[{key:"_parse",value:function(e){var t=this._queryConstraints.map((function(t){return t._parse(e)})).filter((function(e){return e.getFilters().length>0}));return 1===t.length?t[0]:xa.create(t,this._getOperator())}},{key:"_apply",value:function(e){var t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){var n,r=e,i=t.getFlattenedFilters(),a=(0,u.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;If(r,o),r=co(r,o)}}catch(s){a.e(s)}finally{a.f()}}(e._query,t),new Rd(e.firestore,e.converter,co(e._query,t)))}},{key:"_getQueryConstraints",value:function(){return this._queryConstraints}},{key:"_getOperator",value:function(){return"and"===this.type?"and":"or"}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(gf);var wf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this))._field=e,i._direction=r,i.type="orderBy",i}return(0,m.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new ti(ei.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ti(ei.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ra(t,n);return function(e,t){if(null===no(e)){var n=ro(e);null!==n&&Cf(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Rd(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new Qa(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}],[{key:"_create",value:function(e,t){return new n(e,t)}}]),n}(yf);function Sf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=vf("orderBy",e);return wf._create(n,t)}function kf(e,t,n){if("string"==typeof(n=(0,E.m9)(n))){if(""===n)throw new ti(ei.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!io(t)&&-1!==n.indexOf("/"))throw new ti(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(yi.fromString(n));if(!bi.isDocumentKey(r))throw new ti(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return ha(e,new bi(r))}if(n instanceof Ad)return ha(e,n._key);throw new ti(ei.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Sd(n),"."))}function Tf(e,t){if(!Array.isArray(e)||0===e.length)throw new ti(ei.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function If(e,t){if(t.isInequality()){var n=ro(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new ti(ei.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(r.toString(),"'"));var i=no(e);null!==i&&Cf(e,r,i)}var a=function(e,t){var n,r=(0,u.Z)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value,o=(0,u.Z)(a.getFlattenedFilters());try{for(o.s();!(i=o.n()).done;){var s=i.value;if(t.indexOf(s.op)>=0)return s.op}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==a)throw a===t.op?new ti(ei.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new ti(ei.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(a.toString(),"' filters."))}function Cf(e,t,n){if(!n.isEqual(t))throw new ti(ei.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Rf=function(){function e(){(0,v.Z)(this,e)}return(0,m.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(sa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $i(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ea(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Xr()}}},{key:"convertObject",value:function(e,t){return this.convertObjectMap(e.fields,t)}},{key:"convertObjectMap",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r={};return Bi(e,(function(e,i){r[e]=t.convertValue(i,n)})),r}},{key:"convertGeoPoint",value:function(e){return new Gd($i(e.latitude),$i(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=na(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ra(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Qi(e);return new vi(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=yi.fromString(e);Qr(lc(n));var r=new aa(n.get(1),n.get(3)),i=new bi(n.popFirst(5));return r.isEqual(t)||zr("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Af(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Of=function(){function e(t,n){(0,v.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,m.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Nf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i,a,o,s){var c;return(0,v.Z)(this,n),(c=t.call(this,e,r,i,a,s))._firestore=e,c._firestoreImpl=e,c.metadata=o,c}return(0,m.Z)(n,[{key:"exists",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new xf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(vf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(pf),xf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this,e)}}]),n}(Nf),Df=function(){function e(t,n,r,i){(0,v.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Of(i.hasPendingWrites,i.fromCache),this.query=r}return(0,m.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new xf(n._firestore,n._userDataWriter,r.key,r,new Of(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ti(ei.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){var r=new xf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Of(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);return t.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new xf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Of(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Pf(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function Pf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xr()}}function Lf(e){e=kd(e,Ad);var t=kd(e.firestore,Ld);return md(Ud(t),e._key).then((function(n){return qf(t,e,n)}))}var Mf=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,m.Z)(n,[{key:"convertBytes",value:function(e){return new Fd(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ad(this.firestore,null,t)}}]),n}(Rf);function Uf(e){e=kd(e,Rd);var t=kd(e.firestore,Ld),n=Ud(t),r=new Mf(t);return mf(e._query),gd(n,e._query).then((function(n){return new Df(t,r,e,n)}))}function jf(e,t,n){e=kd(e,Ad);var r=kd(e.firestore,Ld),i=Af(e.converter,t,n);return Zf(r,[Jd(Yd(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Yo.none())])}function Ff(e,t,n){e=kd(e,Ad);for(var r=kd(e.firestore,Ld),i=Yd(r),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return Zf(r,[("string"==typeof(t=(0,E.m9)(t))||t instanceof Vd?tf(i,"updateDoc",e._key,t,n,o):ef(i,"updateDoc",e._key,t)).toMutation(e._key,Yo.exists(!0))])}function Vf(e){return Zf(kd(e.firestore,Ld),[new ls(e._key,Yo.none())])}function Bf(e,t){var n=kd(e.firestore,Ld),r=xd(e),i=Af(e.converter,t);return Zf(n,[Jd(Yd(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Yo.exists(!1))]).then((function(){return r}))}function Gf(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,E.m9)(e);var s={includeMetadataChanges:!1},c=0;"object"!=typeof n[c]||Pd(n[c])||(s=n[c],c++);var u,f,p,h={includeMetadataChanges:s.includeMetadataChanges};if(Pd(n[c])){var v=n[c];n[c]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[c+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[c+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof Ad)f=kd(e.firestore,Ld),p=eo(e._key.path),u={next:function(t){n[c]&&n[c](qf(f,e,t))},error:n[c+1],complete:n[c+2]};else{var m=kd(e,Rd);f=kd(m.firestore,Ld),p=m._query;var g=new Mf(f);u={next:function(e){n[c]&&n[c](new Df(f,g,m,e))},error:n[c+1],complete:n[c+2]},mf(e._query)}return function(e,t,n,r){var i=new nd(r),a=new ml(t,i,n);return e.asyncQueue.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=ul,t.next=3,hd(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.La(),e.asyncQueue.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=dl,t.next=3,hd(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(Ud(f),p,h,u)}function Zf(e,t){return function(e,t){var n=new ni;return e.asyncQueue.enqueueAndForget((0,d.Z)((0,l.Z)().mark((function r(){return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Al,r.next=3,pd(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(Ud(e),t)}function qf(e,t,n){var r=n.docs.get(t._key),i=new Mf(e);return new Nf(e,i,t._key,r,new Of(n.hasPendingWrites,n.fromCache),t.converter)}function Wf(){return new Qd("serverTimestamp")}function Hf(e){return new $d("increment",e)}new WeakMap;!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){qr=e}(g.Jn),(0,g.Xd)(new y.wA("firestore",(function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),o=new Ld(new oi(e.getProvider("auth-internal")),new li(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ti(ei.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aa(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o}),"PUBLIC").setMultipleInstances(!0)),(0,g.KN)(Gr,"4.2.0",e),(0,g.KN)(Gr,"4.2.0","esm2017")}()},6954:function(e,t,n){"use strict";n.d(t,{KL:function(){return et},LP:function(){return tt},ps:function(){return rt}});var r,i,a=n(4165),o=n(5671),s=n(3144),c=n(4942),u=n(5861),l=n(3433),d=(n(6463),n(3258)),f=n(1413),p=function(e,t){return t.some((function(t){return e instanceof t}))};var h=new WeakMap,v=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap;var _={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return v.get(e);if("objectStoreNames"===t)return e.objectStoreNames||m.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function E(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(S(this),n),w(h.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return w(e.apply(S(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[S(this),t].concat(r));return m.set(a,t.sort?t.sort():[t]),w(a)}}function b(e){return"function"===typeof e?E(e):(e instanceof IDBTransaction&&function(e){if(!v.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));v.set(e,t)}}(e),p(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,_):e)}function w(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(w(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&h.set(t,e)})).catch((function(){})),y.set(t,e),t}(e);if(g.has(e))return g.get(e);var t=b(e);return t!==e&&(g.set(e,t),y.set(t,e)),t}var S=function(e){return y.get(e)};function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),c=w(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(w(s.result),e.oldVersion,e.newVersion,w(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),c.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(){return a()}))})).catch((function(){})),c}function T(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(function(){return t()})),w(n).then((function(){}))}var I=["get","getKey","getAll","getAllKeys","count"],C=["put","add","delete","clear"],R=new Map;function A(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(R.get(t))return R.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=C.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||I.includes(n))){var o=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(t){var o,s,c,u,l,d,f=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),c=s.store,u=f.length,l=new Array(u>1?u-1:0),d=1;d<u;d++)l[d-1]=f[d];return r&&(c=c.index(l.shift())),e.next=6,Promise.all([(o=c)[n].apply(o,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return R.set(t,o),o}}}_=function(e){return(0,f.Z)((0,f.Z)({},e),{},{get:function(t,n,r){return A(t,n)||e.get(t,n,r)},has:function(t,n){return!!A(t,n)||e.has(t,n)}})}(_);var O,N,x,D=n(5854),P=n(7825),L="/firebase-messaging-sw.js",M="/firebase-cloud-messaging-push-scope",U="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",j="https://fcmregistrations.googleapis.com/v1",F="google.c.a.c_id",V="google.c.a.c_l",B="google.c.a.ts",G="google.c.a.e";function Z(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,(0,l.Z)(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function q(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(N||(N={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(x||(x={}));var W="fcm_token_details_db",H=5,K="fcm_token_object_Store";function z(e){return Y.apply(this,arguments)}function Y(){return Y=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("databases"in indexedDB)){e.next=7;break}return e.next=3,indexedDB.databases();case 3:if(n=e.sent,r=n.map((function(e){return e.name})),r.includes(W)){e.next=7;break}return e.abrupt("return",null);case 7:return i=null,e.next=10,k(W,H,{upgrade:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,r,o,s){var c,u,l,d,f,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r<2)){e.next=2;break}return e.abrupt("return");case 2:if(n.objectStoreNames.contains(K)){e.next=4;break}return e.abrupt("return");case 4:return u=s.objectStore(K),e.next=7,u.index("fcmSenderId").get(t);case 7:return l=e.sent,e.next=10,u.clear();case 10:if(l){e.next=12;break}return e.abrupt("return");case 12:if(2!==r){e.next=19;break}if((d=l).auth&&d.p256dh&&d.endpoint){e.next=16;break}return e.abrupt("return");case 16:i={token:d.fcmToken,createTime:null!==(c=d.createTime)&&void 0!==c?c:Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:"string"===typeof d.vapidKey?d.vapidKey:Z(d.vapidKey)}},e.next=20;break;case 19:3===r?i={token:(f=l).fcmToken,createTime:f.createTime,subscriptionOptions:{auth:Z(f.auth),p256dh:Z(f.p256dh),endpoint:f.endpoint,swScope:f.swScope,vapidKey:Z(f.vapidKey)}}:4===r&&(i={token:(p=l).fcmToken,createTime:p.createTime,subscriptionOptions:{auth:Z(p.auth),p256dh:Z(p.p256dh),endpoint:p.endpoint,swScope:p.swScope,vapidKey:Z(p.vapidKey)}});case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()});case 10:return e.sent.close(),e.next=14,T(W);case 14:return e.next=16,T("fcm_vapid_details_db");case 16:return e.next=18,T("undefined");case 18:return e.abrupt("return",J(i)?i:null);case 19:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function J(e){if(!e||!e.subscriptionOptions)return!1;var t=e.subscriptionOptions;return"number"===typeof e.createTime&&e.createTime>0&&"string"===typeof e.token&&e.token.length>0&&"string"===typeof t.auth&&t.auth.length>0&&"string"===typeof t.p256dh&&t.p256dh.length>0&&"string"===typeof t.endpoint&&t.endpoint.length>0&&"string"===typeof t.swScope&&t.swScope.length>0&&"string"===typeof t.vapidKey&&t.vapidKey.length>0}var X="firebase-messaging-database",Q=1,$="firebase-messaging-store",ee=null;function te(){return ee||(ee=k(X,Q,{upgrade:function(e,t){if(0===t)e.createObjectStore($)}})),ee}function ne(e){return re.apply(this,arguments)}function re(){return(re=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ce(t),e.next=3,te();case 3:return r=e.sent,e.next=6,r.transaction($).objectStore($).get(n);case 6:if(!(i=e.sent)){e.next=11;break}return e.abrupt("return",i);case 11:return e.next=13,z(t.appConfig.senderId);case 13:if(!(o=e.sent)){e.next=18;break}return e.next=17,ie(t,o);case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e,t){return ae.apply(this,arguments)}function ae(){return(ae=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ce(t),e.next=3,te();case 3:return i=e.sent,o=i.transaction($,"readwrite"),e.next=7,o.objectStore($).put(n,r);case 7:return e.next=9,o.done;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return se.apply(this,arguments)}function se(){return(se=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ce(t),e.next=3,te();case 3:return r=e.sent,i=r.transaction($,"readwrite"),e.next=7,i.objectStore($).delete(n);case 7:return e.next=9,i.done;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return e.appConfig.appId}var ue=(O={},(0,c.Z)(O,"missing-app-config-values",'Missing App configuration value: "{$valueName}"'),(0,c.Z)(O,"only-available-in-window","This method is available in a Window context."),(0,c.Z)(O,"only-available-in-sw","This method is available in a service worker context."),(0,c.Z)(O,"permission-default","The notification permission was not granted and dismissed instead."),(0,c.Z)(O,"permission-blocked","The notification permission was not granted and blocked instead."),(0,c.Z)(O,"unsupported-browser","This browser doesn't support the API's required to use the Firebase SDK."),(0,c.Z)(O,"indexed-db-unsupported","This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)"),(0,c.Z)(O,"failed-service-worker-registration","We are unable to register the default service worker. {$browserErrorMessage}"),(0,c.Z)(O,"token-subscribe-failed","A problem occurred while subscribing the user to FCM: {$errorInfo}"),(0,c.Z)(O,"token-subscribe-no-token","FCM returned no token when subscribing the user to push."),(0,c.Z)(O,"token-unsubscribe-failed","A problem occurred while unsubscribing the user from FCM: {$errorInfo}"),(0,c.Z)(O,"token-update-failed","A problem occurred while updating the user from FCM: {$errorInfo}"),(0,c.Z)(O,"token-update-no-token","FCM returned no token when updating the user to push."),(0,c.Z)(O,"use-sw-after-get-token","The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used."),(0,c.Z)(O,"invalid-sw-registration","The input to useServiceWorker() must be a ServiceWorkerRegistration."),(0,c.Z)(O,"invalid-bg-handler","The input to setBackgroundMessageHandler() must be a function."),(0,c.Z)(O,"invalid-vapid-key","The public VAPID key must be a string."),(0,c.Z)(O,"use-vapid-key-after-get-token","The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."),O),le=new D.LL("messaging","Messaging",ue);function de(e,t){return fe.apply(this,arguments)}function fe(){return(fe=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t);case 2:return r=e.sent,i=Ee(n),o={method:"POST",headers:r,body:JSON.stringify(i)},e.prev=5,e.next=8,fetch(ge(t.appConfig),o);case 8:return c=e.sent,e.next=11,c.json();case 11:s=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(5),le.create("token-subscribe-failed",{errorInfo:null===e.t0||void 0===e.t0?void 0:e.t0.toString()});case 17:if(!s.error){e.next=20;break}throw u=s.error.message,le.create("token-subscribe-failed",{errorInfo:u});case 20:if(s.token){e.next=22;break}throw le.create("token-subscribe-no-token");case 22:return e.abrupt("return",s.token);case 23:case"end":return e.stop()}}),e,null,[[5,14]])})))).apply(this,arguments)}function pe(e,t){return he.apply(this,arguments)}function he(){return(he=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t);case 2:return r=e.sent,i=Ee(n.subscriptionOptions),o={method:"PATCH",headers:r,body:JSON.stringify(i)},e.prev=5,e.next=8,fetch("".concat(ge(t.appConfig),"/").concat(n.token),o);case 8:return c=e.sent,e.next=11,c.json();case 11:s=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(5),le.create("token-update-failed",{errorInfo:null===e.t0||void 0===e.t0?void 0:e.t0.toString()});case 17:if(!s.error){e.next=20;break}throw u=s.error.message,le.create("token-update-failed",{errorInfo:u});case 20:if(s.token){e.next=22;break}throw le.create("token-update-no-token");case 22:return e.abrupt("return",s.token);case 23:case"end":return e.stop()}}),e,null,[[5,14]])})))).apply(this,arguments)}function ve(e,t){return me.apply(this,arguments)}function me(){return(me=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t);case 2:return r=e.sent,i={method:"DELETE",headers:r},e.prev=4,e.next=7,fetch("".concat(ge(t.appConfig),"/").concat(n),i);case 7:return o=e.sent,e.next=10,o.json();case 10:if(!(s=e.sent).error){e.next=14;break}throw c=s.error.message,le.create("token-unsubscribe-failed",{errorInfo:c});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(4),le.create("token-unsubscribe-failed",{errorInfo:null===e.t0||void 0===e.t0?void 0:e.t0.toString()});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})))).apply(this,arguments)}function ge(e){var t=e.projectId;return"".concat(j,"/projects/").concat(t,"/registrations")}function ye(e){return _e.apply(this,arguments)}function _e(){return(_e=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.appConfig,r=t.installations,e.next=3,r.getToken();case 3:return i=e.sent,e.abrupt("return",new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":"FIS ".concat(i)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){var t=e.p256dh,n=e.auth,r=e.endpoint,i=e.vapidKey,a={web:{endpoint:r,auth:n,p256dh:t}};return i!==U&&(a.web.applicationPubKey=i),a}var be=6048e5;function we(e){return Se.apply(this,arguments)}function Se(){return(Se=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe(t.swRegistration,t.vapidKey);case 2:return n=e.sent,r={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:n.endpoint,auth:Z(n.getKey("auth")),p256dh:Z(n.getKey("p256dh"))},e.next=6,ne(t.firebaseDependencies);case 6:if(i=e.sent){e.next=11;break}return e.abrupt("return",Re(t.firebaseDependencies,r));case 11:if(xe(i.subscriptionOptions,r)){e.next=23;break}return e.prev=12,e.next=15,ve(t.firebaseDependencies,i.token);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(12),console.warn(e.t0);case 20:return e.abrupt("return",Re(t.firebaseDependencies,r));case 23:if(!(Date.now()>=i.createTime+be)){e.next=27;break}return e.abrupt("return",Ie(t,{token:i.token,createTime:Date.now(),subscriptionOptions:r}));case 27:return e.abrupt("return",i.token);case 28:case"end":return e.stop()}}),e,null,[[12,17]])})))).apply(this,arguments)}function ke(e){return Te.apply(this,arguments)}function Te(){return(Te=(0,u.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t.firebaseDependencies);case 2:if(!(n=e.sent)){e.next=8;break}return e.next=6,ve(t.firebaseDependencies,n.token);case 6:return e.next=8,oe(t.firebaseDependencies);case 8:return e.next=10,t.swRegistration.pushManager.getSubscription();case 10:if(!(r=e.sent)){e.next=13;break}return e.abrupt("return",r.unsubscribe());case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pe(t.firebaseDependencies,n);case 3:return r=e.sent,i=Object.assign(Object.assign({},n),{token:r,createTime:Date.now()}),e.next=7,ie(t.firebaseDependencies,i);case 7:return e.abrupt("return",r);case 10:return e.prev=10,e.t0=e.catch(0),e.next=14,ke(t);case 14:throw e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function Re(e,t){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(t,n);case 2:return r=e.sent,i={token:r,createTime:Date.now(),subscriptionOptions:n},e.next=6,ie(t,i);case 6:return e.abrupt("return",i.token);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.pushManager.getSubscription();case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.abrupt("return",t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:q(n)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t){var n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,a=t.p256dh===e.p256dh;return n&&r&&i&&a}function De(e){var t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};var n=t.notification.title;n&&(e.notification.title=n);var r=t.notification.body;r&&(e.notification.body=r);var i=t.notification.image;i&&(e.notification.image=i);var a=t.notification.icon;a&&(e.notification.icon=a)}(t,e),function(e,t){if(!t.data)return;e.data=t.data}(t,e),function(e,t){var n,r,i,a,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};var s=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(a=t.notification)||void 0===a?void 0:a.click_action;s&&(e.fcmOptions.link=s);var c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}(t,e),t}function Pe(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function Le(e){return le.create("missing-app-config-values",{valueName:e})}Pe("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),Pe("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");var Me=function(){function e(t,n,r){(0,o.Z)(this,e),this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var i=function(e){if(!e||!e.options)throw Le("App Configuration Object");if(!e.name)throw Le("App Name");for(var t=e.options,n=0,r=["projectId","apiKey","appId","messagingSenderId"];n<r.length;n++){var i=r[n];if(!t[i])throw Le(i)}return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(t);this.firebaseDependencies={app:t,appConfig:i,installations:n,analyticsProvider:r}}return(0,s.Z)(e,[{key:"_delete",value:function(){return Promise.resolve()}}]),e}();function Ue(e){return je.apply(this,arguments)}function je(){return(je=(0,u.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register(L,{scope:M});case 3:t.swRegistration=e.sent,t.swRegistration.update().catch((function(){})),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),le.create("failed-service-worker-registration",{browserErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Fe(e,t){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,u.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||t.swRegistration){e.next=3;break}return e.next=3,Ue(t);case 3:if(n||!t.swRegistration){e.next=5;break}return e.abrupt("return");case 5:if(n instanceof ServiceWorkerRegistration){e.next=7;break}throw le.create("invalid-sw-registration");case 7:t.swRegistration=n;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(e,t){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,u.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?t.vapidKey=n:t.vapidKey||(t.vapidKey=U);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e,t){return qe.apply(this,arguments)}function qe(){return(qe=(0,u.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator){e.next=2;break}throw le.create("only-available-in-window");case 2:if("default"!==Notification.permission){e.next=5;break}return e.next=5,Notification.requestPermission();case 5:if("granted"===Notification.permission){e.next=7;break}throw le.create("permission-blocked");case 7:return e.next=9,Be(t,null===n||void 0===n?void 0:n.vapidKey);case 9:return e.next=11,Fe(t,null===n||void 0===n?void 0:n.serviceWorkerRegistration);case 11:return e.abrupt("return",we(t));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e,t,n){return He.apply(this,arguments)}function He(){return(He=(0,u.Z)((0,a.Z)().mark((function e(t,n,r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ke(n),e.next=3,t.firebaseDependencies.analyticsProvider.get();case 3:e.sent.logEvent(i,{message_id:r[F],message_name:r[V],message_time:r[B],message_device_time:Math.floor(Date.now()/1e3)});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e){switch(e){case x.NOTIFICATION_CLICKED:return"notification_open";case x.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function ze(){return(ze=(0,u.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.data).isFirebaseMessaging){e.next=3;break}return e.abrupt("return");case 3:if(t.onMessageHandler&&r.messageType===x.PUSH_RECEIVED&&("function"===typeof t.onMessageHandler?t.onMessageHandler(De(r)):t.onMessageHandler.next(De(r))),i=r.data,"object"!==typeof(a=i)||!a||!(F in a)||"1"!==i[G]){e.next=8;break}return e.next=8,We(t,r.messageType,i);case 8:case"end":return e.stop()}var a}),e)})))).apply(this,arguments)}var Ye="@firebase/messaging",Je="0.12.4",Xe=function(e){var t=new Me(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(function(e){return function(e,t){return ze.apply(this,arguments)}(t,e)})),t},Qe=function(e){var t=e.getProvider("messaging").getImmediate();return{getToken:function(e){return Ze(t,e)}}};function $e(){return($e=(0,u.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,D.eu)();case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return","undefined"!==typeof window&&(0,D.hl)()&&(0,D.zI)()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"));case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function et(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.Mq)();return function(){return $e.apply(this,arguments)}().then((function(e){if(!e)throw le.create("unsupported-browser")}),(function(e){throw le.create("indexed-db-unsupported")})),(0,P.qX)((0,D.m9)(e),"messaging").getImmediate()}function tt(e,t){return nt.apply(this,arguments)}function nt(){return(nt=(0,u.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,D.m9)(t),e.abrupt("return",Ze(t,n));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e,t){return function(e,t){if(!navigator)throw le.create("only-available-in-window");return e.onMessageHandler=t,function(){e.onMessageHandler=null}}(e=(0,D.m9)(e),t)}(0,P.Xd)(new d.wA("messaging",Xe,"PUBLIC")),(0,P.Xd)(new d.wA("messaging-internal",Qe,"PRIVATE")),(0,P.KN)(Ye,Je),(0,P.KN)(Ye,Je,"esm2017")},9230:function(e,t,n){"use strict";n.d(t,{Db:function(){return y},$G:function(){return S}});var r=n(2791);n(7399);Object.create(null);function i(){if(console&&console.warn){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];"string"===typeof n[0]&&(n[0]="react-i18next:: ".concat(n[0])),(e=console).warn.apply(e,n)}}var a={};function o(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"string"===typeof t[0]&&a[t[0]]||("string"===typeof t[0]&&(a[t[0]]=new Date),i.apply(void 0,t))}var s=function(e,t){return function(){if(e.isInitialized)t();else{e.on("initialized",(function n(){setTimeout((function(){e.off("initialized",n)}),0),t()}))}}};function c(e,t,n){e.loadNamespaces(t,s(e,n))}function u(e,t,n,r){"string"===typeof n&&(n=[n]),n.forEach((function(t){e.options.ns.indexOf(t)<0&&e.options.ns.push(t)})),e.loadLanguages(t,s(e,r))}var l=n(1413),d=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,f={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"\xa9","&#169;":"\xa9","&reg;":"\xae","&#174;":"\xae","&hellip;":"\u2026","&#8230;":"\u2026","&#x2F;":"/","&#47;":"/"},p=function(e){return f[e]},h={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:function(e){return e.replace(d,p)}};var v,m=n(5671),g=n(3144);var y={type:"3rdParty",init:function(e){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h=(0,l.Z)((0,l.Z)({},h),e)}(e.options.react),function(e){v=e}(e)}},_=(0,r.createContext)(),E=function(){function e(){(0,m.Z)(this,e),this.usedNamespaces={}}return(0,g.Z)(e,[{key:"addUsedNamespaces",value:function(e){var t=this;e.forEach((function(e){t.usedNamespaces[e]||(t.usedNamespaces[e]=!0)}))}},{key:"getUsedNamespaces",value:function(){return Object.keys(this.usedNamespaces)}}]),e}();var b=n(9439),w=function(e,t){var n=(0,r.useRef)();return(0,r.useEffect)((function(){n.current=t?n.current:e}),[e,t]),n.current};function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.i18n,i=(0,r.useContext)(_)||{},a=i.i18n,s=i.defaultNS,d=n||a||v;if(d&&!d.reportNamespaces&&(d.reportNamespaces=new E),!d){o("You will need to pass in an i18next instance by using initReactI18next");var f=function(e,t){return"string"===typeof t?t:t&&"object"===typeof t&&"string"===typeof t.defaultValue?t.defaultValue:Array.isArray(e)?e[e.length-1]:e},p=[f,{},!1];return p.t=f,p.i18n={},p.ready=!1,p}d.options.react&&void 0!==d.options.react.wait&&o("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");var m=(0,l.Z)((0,l.Z)((0,l.Z)({},h),d.options.react),t),g=m.useSuspense,y=m.keyPrefix,S=e||s||d.options&&d.options.defaultNS;S="string"===typeof S?[S]:S||["translation"],d.reportNamespaces.addUsedNamespaces&&d.reportNamespaces.addUsedNamespaces(S);var k=(d.isInitialized||d.initializedStoreOnce)&&S.every((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.languages&&t.languages.length?void 0!==t.options.ignoreJSONStructure?t.hasLoadedNamespace(e,{lng:n.lng,precheck:function(t,r){if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.languages[0],i=!!t.options&&t.options.fallbackLng,a=t.languages[t.languages.length-1];if("cimode"===r.toLowerCase())return!0;var o=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};return!(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!o(t.isLanguageChangingTo,e))&&(!!t.hasResourceBundle(r,e)||!(t.services.backendConnector.backend&&(!t.options.resources||t.options.partialBundledLanguages))||!(!o(r,e)||i&&!o(a,e)))}(e,t,n):(o("i18n.languages were undefined or empty",t.languages),!0)}(e,d,m)}));function T(){return d.getFixedT(t.lng||null,"fallback"===m.nsMode?S:S[0],y)}var I=(0,r.useState)(T),C=(0,b.Z)(I,2),R=C[0],A=C[1],O=S.join();t.lng&&(O="".concat(t.lng).concat(O));var N=w(O),x=(0,r.useRef)(!0);(0,r.useEffect)((function(){var e=m.bindI18n,n=m.bindI18nStore;function r(){x.current&&A(T)}return x.current=!0,k||g||(t.lng?u(d,t.lng,S,(function(){x.current&&A(T)})):c(d,S,(function(){x.current&&A(T)}))),k&&N&&N!==O&&x.current&&A(T),e&&d&&d.on(e,r),n&&d&&d.store.on(n,r),function(){x.current=!1,e&&d&&e.split(" ").forEach((function(e){return d.off(e,r)})),n&&d&&n.split(" ").forEach((function(e){return d.store.off(e,r)}))}}),[d,O]);var D=(0,r.useRef)(!0);(0,r.useEffect)((function(){x.current&&!D.current&&A(T),D.current=!1}),[d,y]);var P=[R,d,k];if(P.t=R,P.i18n=d,P.ready=k,k)return P;if(!k&&!g)return P;throw new Promise((function(e){t.lng?u(d,t.lng,S,(function(){return e()})):c(d,S,(function(){return e()}))}))}},9085:function(e,t,n){"use strict";n.d(t,{Ix:function(){return x},Am:function(){return G}});var r=n(4942),i=n(9439),a=n(1413),o=n(4925),s=n(3433),c=n(2791);function u(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=u(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}var l=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=u(e))&&(r&&(r+=" "),r+=t);return r},d=["theme","type"],f=["delay","staleId"],p=function(e){return"number"==typeof e&&!isNaN(e)},h=function(e){return"string"==typeof e},v=function(e){return"function"==typeof e},m=function(e){return h(e)||v(e)?e:null},g=function(e){return(0,c.isValidElement)(e)||h(e)||v(e)||p(e)};function y(e){var t=e.enter,n=e.exit,r=e.appendPosition,i=void 0!==r&&r,a=e.collapse,o=void 0===a||a,u=e.collapseDuration,l=void 0===u?300:u;return function(e){var r=e.children,a=e.position,u=e.preventExitTransition,d=e.done,f=e.nodeRef,p=e.isIn,h=i?"".concat(t,"--").concat(a):t,v=i?"".concat(n,"--").concat(a):n,m=(0,c.useRef)(0);return(0,c.useLayoutEffect)((function(){var e,t=f.current,n=h.split(" "),r=function e(r){var i;r.target===f.current&&(t.dispatchEvent(new Event("d")),t.removeEventListener("animationend",e),t.removeEventListener("animationcancel",e),0===m.current&&"animationcancel"!==r.type&&(i=t.classList).remove.apply(i,(0,s.Z)(n)))};(e=t.classList).add.apply(e,(0,s.Z)(n)),t.addEventListener("animationend",r),t.addEventListener("animationcancel",r)}),[]),(0,c.useEffect)((function(){var e=f.current,t=function t(){e.removeEventListener("animationend",t),o?function(e,t,n){void 0===n&&(n=300);var r=e.scrollHeight,i=e.style;requestAnimationFrame((function(){i.minHeight="initial",i.height=r+"px",i.transition="all ".concat(n,"ms"),requestAnimationFrame((function(){i.height="0",i.padding="0",i.margin="0",setTimeout(t,n)}))}))}(e,d,l):d()};p||(u?t():(m.current=1,e.className+=" ".concat(v),e.addEventListener("animationend",t)))}),[p]),c.createElement(c.Fragment,null,r)}}function _(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}var E={list:new Map,emitQueue:new Map,on:function(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off:function(e,t){if(t){var n=this.list.get(e).filter((function(e){return e!==t}));return this.list.set(e,n),this}return this.list.delete(e),this},cancelEmit:function(e){var t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit:function(e){var t=arguments,n=this;this.list.has(e)&&this.list.get(e).forEach((function(r){var i=setTimeout((function(){r.apply(void 0,(0,s.Z)([].slice.call(t,1)))}),0);n.emitQueue.has(e)||n.emitQueue.set(e,[]),n.emitQueue.get(e).push(i)}))}},b=function(e){var t=e.theme,n=e.type,r=(0,o.Z)(e,d);return c.createElement("svg",(0,a.Z)({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":"var(--toastify-icon-color-".concat(n,")")},r))},w={info:function(e){return c.createElement(b,(0,a.Z)({},e),c.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return c.createElement(b,(0,a.Z)({},e),c.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return c.createElement(b,(0,a.Z)({},e),c.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return c.createElement(b,(0,a.Z)({},e),c.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return c.createElement("div",{className:"Toastify__spinner"})}};function S(e){var t=(0,c.useReducer)((function(e){return e+1}),0),n=(0,i.Z)(t,2)[1],r=(0,c.useState)([]),u=(0,i.Z)(r,2),l=u[0],d=u[1],y=(0,c.useRef)(null),b=(0,c.useRef)(new Map).current,S=function(e){return-1!==l.indexOf(e)},k=(0,c.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:S,getToast:function(e){return b.get(e)}}).current;function T(e){var t=e.containerId;!k.props.limit||t&&k.containerId!==t||(k.count-=k.queue.length,k.queue=[])}function I(e){d((function(t){return null==e?[]:t.filter((function(t){return t!==e}))}))}function C(){var e=k.queue.shift();A(e.toastContent,e.toastProps,e.staleId)}function R(e,t){var r=t.delay,s=t.staleId,u=(0,o.Z)(t,f);if(g(e)&&!function(e){return!y.current||k.props.enableMultiContainer&&e.containerId!==k.props.containerId||b.has(e.toastId)&&null==e.updateId}(u)){var l=u.toastId,d=u.updateId,S=u.data,T=k.props,R=function(){return I(l)},O=null==d;O&&k.count++;var N,x,D=(0,a.Z)((0,a.Z)((0,a.Z)({},T),{},{style:T.toastStyle,key:k.toastKey++},Object.fromEntries(Object.entries(u).filter((function(e){var t=(0,i.Z)(e,2);t[0];return null!=t[1]})))),{},{toastId:l,updateId:d,data:S,closeToast:R,isIn:!1,className:m(u.className||T.toastClassName),bodyClassName:m(u.bodyClassName||T.bodyClassName),progressClassName:m(u.progressClassName||T.progressClassName),autoClose:!u.isLoading&&(N=u.autoClose,x=T.autoClose,!1===N||p(N)&&N>0?N:x),deleteToast:function(){var e=_(b.get(l),"removed");b.delete(l),E.emit(4,e);var t=k.queue.length;if(k.count=null==l?k.count-k.displayedToast:k.count-1,k.count<0&&(k.count=0),t>0){var r=null==l?k.props.limit:1;if(1===t||1===r)k.displayedToast++,C();else{var i=r>t?t:r;k.displayedToast=i;for(var a=0;a<i;a++)C()}}else n()}});D.iconOut=function(e){var t=e.theme,n=e.type,r=e.isLoading,i=e.icon,a=null,o={theme:t,type:n};return!1===i||(v(i)?a=i(o):(0,c.isValidElement)(i)?a=(0,c.cloneElement)(i,o):h(i)||p(i)?a=i:r?a=w.spinner():function(e){return e in w}(n)&&(a=w[n](o))),a}(D),v(u.onOpen)&&(D.onOpen=u.onOpen),v(u.onClose)&&(D.onClose=u.onClose),D.closeButton=T.closeButton,!1===u.closeButton||g(u.closeButton)?D.closeButton=u.closeButton:!0===u.closeButton&&(D.closeButton=!g(T.closeButton)||T.closeButton);var P=e;(0,c.isValidElement)(e)&&!h(e.type)?P=(0,c.cloneElement)(e,{closeToast:R,toastProps:D,data:S}):v(e)&&(P=e({closeToast:R,toastProps:D,data:S})),T.limit&&T.limit>0&&k.count>T.limit&&O?k.queue.push({toastContent:P,toastProps:D,staleId:s}):p(r)?setTimeout((function(){A(P,D,s)}),r):A(P,D,s)}}function A(e,t,n){var r=t.toastId;n&&b.delete(n);var i={content:e,props:t};b.set(r,i),d((function(e){return[].concat((0,s.Z)(e),[r]).filter((function(e){return e!==n}))})),E.emit(4,_(i,null==i.props.updateId?"added":"updated"))}return(0,c.useEffect)((function(){return k.containerId=e.containerId,E.cancelEmit(3).on(0,R).on(1,(function(e){return y.current&&I(e)})).on(5,T).emit(2,k),function(){b.clear(),E.emit(3,k)}}),[]),(0,c.useEffect)((function(){k.props=e,k.isToastActive=S,k.displayedToast=l.length})),{getToastToRender:function(t){var n=new Map,r=Array.from(b.values());return e.newestOnTop&&r.reverse(),r.forEach((function(e){var t=e.props.position;n.has(t)||n.set(t,[]),n.get(t).push(e)})),Array.from(n,(function(e){return t(e[0],e[1])}))},containerRef:y,isToastActive:S}}function k(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function T(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function I(e){var t=(0,c.useState)(!1),n=(0,i.Z)(t,2),r=n[0],a=n[1],o=(0,c.useState)(!1),s=(0,i.Z)(o,2),u=s[0],l=s[1],d=(0,c.useRef)(null),f=(0,c.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,p=(0,c.useRef)(e),h=e.autoClose,m=e.pauseOnHover,g=e.closeToast,y=e.onClick,_=e.closeOnClick;function E(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),f.didMove=!1,document.addEventListener("mousemove",I),document.addEventListener("mouseup",C),document.addEventListener("touchmove",I),document.addEventListener("touchend",C);var n=d.current;f.canCloseOnClick=!0,f.canDrag=!0,f.boundingRect=n.getBoundingClientRect(),n.style.transition="",f.x=k(t.nativeEvent),f.y=T(t.nativeEvent),"x"===e.draggableDirection?(f.start=f.x,f.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(f.start=f.y,f.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function b(t){if(f.boundingRect){var n=f.boundingRect,r=n.top,i=n.bottom,a=n.left,o=n.right;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&f.x>=a&&f.x<=o&&f.y>=r&&f.y<=i?S():w()}}function w(){a(!0)}function S(){a(!1)}function I(t){var n=d.current;f.canDrag&&n&&(f.didMove=!0,r&&S(),f.x=k(t),f.y=T(t),f.delta="x"===e.draggableDirection?f.x-f.start:f.y-f.start,f.start!==f.x&&(f.canCloseOnClick=!1),n.style.transform="translate".concat(e.draggableDirection,"(").concat(f.delta,"px)"),n.style.opacity=""+(1-Math.abs(f.delta/f.removalDistance)))}function C(){document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",C),document.removeEventListener("touchmove",I),document.removeEventListener("touchend",C);var t=d.current;if(f.canDrag&&f.didMove&&t){if(f.canDrag=!1,Math.abs(f.delta)>f.removalDistance)return l(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform="translate".concat(e.draggableDirection,"(0)"),t.style.opacity="1"}}(0,c.useEffect)((function(){p.current=e})),(0,c.useEffect)((function(){return d.current&&d.current.addEventListener("d",w,{once:!0}),v(e.onOpen)&&e.onOpen((0,c.isValidElement)(e.children)&&e.children.props),function(){var e=p.current;v(e.onClose)&&e.onClose((0,c.isValidElement)(e.children)&&e.children.props)}}),[]),(0,c.useEffect)((function(){return e.pauseOnFocusLoss&&(document.hasFocus()||S(),window.addEventListener("focus",w),window.addEventListener("blur",S)),function(){e.pauseOnFocusLoss&&(window.removeEventListener("focus",w),window.removeEventListener("blur",S))}}),[e.pauseOnFocusLoss]);var R={onMouseDown:E,onTouchStart:E,onMouseUp:b,onTouchEnd:b};return h&&m&&(R.onMouseEnter=S,R.onMouseLeave=w),_&&(R.onClick=function(e){y&&y(e),f.canCloseOnClick&&g()}),{playToast:w,pauseToast:S,isRunning:r,preventExitTransition:u,toastRef:d,eventHandlers:R}}function C(e){var t=e.closeToast,n=e.theme,r=e.ariaLabel,i=void 0===r?"close":r;return c.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(n),type:"button",onClick:function(e){e.stopPropagation(),t(e)},"aria-label":i},c.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},c.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function R(e){var t=e.delay,n=e.isRunning,i=e.closeToast,o=e.type,s=void 0===o?"default":o,u=e.hide,d=e.className,f=e.style,p=e.controlledProgress,h=e.progress,m=e.rtl,g=e.isIn,y=e.theme,_=u||p&&0===h,E=(0,a.Z)((0,a.Z)({},f),{},{animationDuration:"".concat(t,"ms"),animationPlayState:n?"running":"paused",opacity:_?0:1});p&&(E.transform="scaleX(".concat(h,")"));var b=l("Toastify__progress-bar",p?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(y),"Toastify__progress-bar--".concat(s),{"Toastify__progress-bar--rtl":m}),w=v(d)?d({rtl:m,type:s,defaultClassName:b}):l(b,d);return c.createElement("div",(0,r.Z)({role:"progressbar","aria-hidden":_?"true":"false","aria-label":"notification timer",className:w,style:E},p&&h>=1?"onTransitionEnd":"onAnimationEnd",p&&h<1?null:function(){g&&i()}))}var A=function(e){var t=I(e),n=t.isRunning,r=t.preventExitTransition,i=t.toastRef,o=t.eventHandlers,s=e.closeButton,u=e.children,d=e.autoClose,f=e.onClick,p=e.type,h=e.hideProgressBar,m=e.closeToast,g=e.transition,y=e.position,_=e.className,E=e.style,b=e.bodyClassName,w=e.bodyStyle,S=e.progressClassName,k=e.progressStyle,T=e.updateId,A=e.role,O=e.progress,N=e.rtl,x=e.toastId,D=e.deleteToast,P=e.isIn,L=e.isLoading,M=e.iconOut,U=e.closeOnClick,j=e.theme,F=l("Toastify__toast","Toastify__toast-theme--".concat(j),"Toastify__toast--".concat(p),{"Toastify__toast--rtl":N},{"Toastify__toast--close-on-click":U}),V=v(_)?_({rtl:N,position:y,type:p,defaultClassName:F}):l(F,_),B=!!O||!d,G={closeToast:m,type:p,theme:j},Z=null;return!1===s||(Z=v(s)?s(G):(0,c.isValidElement)(s)?(0,c.cloneElement)(s,G):C(G)),c.createElement(g,{isIn:P,done:D,position:y,preventExitTransition:r,nodeRef:i},c.createElement("div",(0,a.Z)((0,a.Z)({id:x,onClick:f,className:V},o),{},{style:E,ref:i}),c.createElement("div",(0,a.Z)((0,a.Z)({},P&&{role:A}),{},{className:v(b)?b({type:p}):l("Toastify__toast-body",b),style:w}),null!=M&&c.createElement("div",{className:l("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!L})},M),c.createElement("div",null,u)),Z,c.createElement(R,(0,a.Z)((0,a.Z)({},T&&!B?{key:"pb-".concat(T)}:{}),{},{rtl:N,theme:j,delay:d,isRunning:n,isIn:P,closeToast:m,hide:h,type:p,style:k,className:S,controlledProgress:B,progress:O||0}))))},O=function(e,t){return void 0===t&&(t=!1),{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},N=y(O("bounce",!0)),x=(y(O("slide",!0)),y(O("zoom")),y(O("flip")),(0,c.forwardRef)((function(e,t){var n=S(e),r=n.getToastToRender,i=n.containerRef,o=n.isToastActive,s=e.className,u=e.style,d=e.rtl,f=e.containerId;function p(e){var t=l("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":d});return v(s)?s({position:e,rtl:d,defaultClassName:t}):l(t,m(s))}return(0,c.useEffect)((function(){t&&(t.current=i.current)}),[]),c.createElement("div",{ref:i,className:"Toastify",id:f},r((function(e,t){var n=t.length?(0,a.Z)({},u):(0,a.Z)((0,a.Z)({},u),{},{pointerEvents:"none"});return c.createElement("div",{className:p(e),style:n,key:"container-".concat(e)},t.map((function(e,n){var r=e.content,i=e.props;return c.createElement(A,(0,a.Z)((0,a.Z)({},i),{},{isIn:o(i.toastId),style:(0,a.Z)((0,a.Z)({},i.style),{},{"--nth":n+1,"--len":t.length}),key:"toast-".concat(i.key)}),r)})))})))})));x.displayName="ToastContainer",x.defaultProps={position:"top-right",transition:N,autoClose:5e3,closeButton:C,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};var D,P=new Map,L=[],M=1;function U(){return""+M++}function j(e){return e&&(h(e.toastId)||p(e.toastId))?e.toastId:U()}function F(e,t){return P.size>0?E.emit(0,e,t):L.push({content:e,options:t}),t.toastId}function V(e,t){return(0,a.Z)((0,a.Z)({},t),{},{type:t&&t.type||e,toastId:j(t)})}function B(e){return function(t,n){return F(t,V(e,n))}}function G(e,t){return F(e,V("default",t))}G.loading=function(e,t){return F(e,V("default",(0,a.Z)({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t)))},G.promise=function(e,t,n){var r,i=t.pending,o=t.error,s=t.success;i&&(r=h(i)?G.loading(i,n):G.loading(i.render,(0,a.Z)((0,a.Z)({},n),i)));var c={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},u=function(e,t,i){if(null!=t){var o=(0,a.Z)((0,a.Z)((0,a.Z)({type:e},c),n),{},{data:i}),s=h(t)?{render:t}:t;return r?G.update(r,(0,a.Z)((0,a.Z)({},o),s)):G(s.render,(0,a.Z)((0,a.Z)({},o),s)),i}G.dismiss(r)},l=v(e)?e():e;return l.then((function(e){return u("success",s,e)})).catch((function(e){return u("error",o,e)})),l},G.success=B("success"),G.info=B("info"),G.error=B("error"),G.warning=B("warning"),G.warn=G.warning,G.dark=function(e,t){return F(e,V("default",(0,a.Z)({theme:"dark"},t)))},G.dismiss=function(e){P.size>0?E.emit(1,e):L=L.filter((function(t){return null!=e&&t.options.toastId!==e}))},G.clearWaitingQueue=function(e){return void 0===e&&(e={}),E.emit(5,e)},G.isActive=function(e){var t=!1;return P.forEach((function(n){n.isToastActive&&n.isToastActive(e)&&(t=!0)})),t},G.update=function(e,t){void 0===t&&(t={}),setTimeout((function(){var n=function(e,t){var n=t.containerId,r=P.get(n||D);return r&&r.getToast(e)}(e,t);if(n){var r=n.props,i=n.content,o=(0,a.Z)((0,a.Z)((0,a.Z)({delay:100},r),t),{},{toastId:t.toastId||e,updateId:U()});o.toastId!==e&&(o.staleId=e);var s=o.render||i;delete o.render,F(s,o)}}),0)},G.done=function(e){G.update(e,{progress:1})},G.onChange=function(e){return E.on(4,e),function(){E.off(4,e)}},G.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},G.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},E.on(2,(function(e){D=e.containerId||e,P.set(D,e),L.forEach((function(e){E.emit(0,e.content,e.options)})),L=[]})).on(3,(function(e){P.delete(e.containerId||e),0===P.size&&E.off(0).off(1).off(5)}))}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};__webpack_require__.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var i=Object.create(null);__webpack_require__.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){a[e]=function(){return n[e]}}));return a.default=function(){return n},__webpack_require__.d(i,a),i}}(),__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(t,n){return __webpack_require__.f[n](e,t),t}),[]))},__webpack_require__.u=function(e){return"static/js/"+e+"."+{27:"c5bc007b",51:"938486f4",281:"4f1cb3f2",379:"bc978516",426:"489341db",460:"dabc27ef",549:"bf3e749a",576:"3f33c7fd",787:"463adf65",793:"7c4dbf29"}[e]+".chunk.js"},__webpack_require__.miniCssF=function(e){},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="sasuga-admin:";__webpack_require__.l=function(n,r,i,a){if(e[n])e[n].push(r);else{var o,s;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==t+i){o=l;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack",t+i),o.src=n),e[n]=[r];var d=function(t,r){o.onerror=o.onload=null,clearTimeout(f);var i=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((function(e){return e(r)})),t)return t(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),s&&document.head.appendChild(o)}}}(),__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},__webpack_require__.p="/",function(){var e={179:0};__webpack_require__.f.j=function(t,n){var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((function(n,i){r=e[t]=[n,i]}));n.push(r[2]=i);var a=__webpack_require__.p+__webpack_require__.u(t),o=new Error;__webpack_require__.l(a,(function(n){if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,r[1](o)}}),"chunk-"+t,t)}};var t=function(t,n){var r,i,a=n[0],o=n[1],s=n[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(r in o)__webpack_require__.o(o,r)&&(__webpack_require__.m[r]=o[r]);if(s)s(__webpack_require__)}for(t&&t(n);c<a.length;c++)i=a[c],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunksasuga_admin=self.webpackChunksasuga_admin||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var __webpack_exports__={};!function(){"use strict";var e=__webpack_require__(2791),t=__webpack_require__.t(e,2),n=__webpack_require__(1250),r=__webpack_require__(184),i=function(){return(0,r.jsxs)("div",{className:"lds-ring",children:[(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{})]})},a=__webpack_require__(2970),o=__webpack_require__(9439),s=__webpack_require__(7689),c=__webpack_require__(8278);new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);var u=t.startTransition;function l(t){var n=t.basename,r=t.children,i=t.future,a=t.window,l=e.useRef();null==l.current&&(l.current=(0,c.lX)({window:a,v5Compat:!0}));var d=l.current,f=e.useState({action:d.action,location:d.location}),p=(0,o.Z)(f,2),h=p[0],v=p[1],m=(i||{}).v7_startTransition,g=e.useCallback((function(e){m&&u?u((function(){return v(e)})):v(e)}),[v,m]);return e.useLayoutEffect((function(){return d.listen(g)}),[d,g]),e.createElement(s.F0,{basename:n,children:r,location:h.location,navigationType:h.action,navigator:d})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var d,f;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(d||(d={})),function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(f||(f={}));var p=__webpack_require__(9085),h=(__webpack_require__(5462),__webpack_require__.p+"static/media/Logo.fc511ba13d8f00c25d6f.png"),v=__webpack_require__(1095),m=__webpack_require__(2481),g=__webpack_require__(6910),y=__webpack_require__(1213),_=function(e){e.color;return(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M15.5 8.00001C15.5 8.28408 15.3395 8.54378 15.0854 8.67083L1.58541 15.4208C1.32663 15.5502 1.01649 15.5192 0.78844 15.3412C0.560388 15.1631 0.455095 14.8697 0.51786 14.5873L1.9817 8.00001L0.51786 1.4127C0.455095 1.13026 0.560389 0.836908 0.788441 0.658851C1.01649 0.480794 1.32663 0.449792 1.58541 0.579185L15.0854 7.32919C15.3395 7.45623 15.5 7.71593 15.5 8.00001ZM3.35163 8.75001L2.32396 13.3745L11.5729 8.75001L3.35163 8.75001ZM11.5729 7.25001L2.32396 2.62551L3.35163 7.25001L11.5729 7.25001Z",fill:"currentColor"})})},E=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 3C7.34315 3 6 4.34315 6 6C6 7.65685 7.34315 9 9 9C10.6569 9 12 7.65685 12 6C12 4.34315 10.6569 3 9 3ZM4.5 6C4.5 3.51472 6.51472 1.5 9 1.5C11.4853 1.5 13.5 3.51472 13.5 6C13.5 8.48528 11.4853 10.5 9 10.5C6.51472 10.5 4.5 8.48528 4.5 6ZM6 13.5C4.75736 13.5 3.75 14.5074 3.75 15.75C3.75 16.1642 3.41421 16.5 3 16.5C2.58579 16.5 2.25 16.1642 2.25 15.75C2.25 13.6789 3.92893 12 6 12H12C14.0711 12 15.75 13.6789 15.75 15.75C15.75 16.1642 15.4142 16.5 15 16.5C14.5858 16.5 14.25 16.1642 14.25 15.75C14.25 14.5074 13.2426 13.5 12 13.5H6Z",fill:"currentColor"})})},b=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,r.jsx)("path",{d:"M7.60961 2.43609C7.83248 1.88712 8.37103 1.5 9 1.5C9.62897 1.5 10.1675 1.88712 10.3904 2.43609C12.6151 3.04554 14.25 5.08185 14.25 7.5V11.0229L15.624 13.084C15.7775 13.3141 15.7918 13.61 15.6613 13.8539C15.5307 14.0978 15.2766 14.25 15 14.25H11.5984C11.4165 15.5221 10.3224 16.5 9 16.5C7.67757 16.5 6.58355 15.5221 6.40158 14.25H3C2.7234 14.25 2.46926 14.0978 2.33875 13.8539C2.20823 13.61 2.22254 13.3141 2.37596 13.084L3.75 11.0229V7.5C3.75 5.08185 5.38487 3.04554 7.60961 2.43609ZM7.93902 14.25C8.09345 14.6869 8.51017 15 9 15C9.48983 15 9.90655 14.6869 10.061 14.25H7.93902ZM9 3.75C6.92893 3.75 5.25 5.42893 5.25 7.5V11.25C5.25 11.3981 5.20617 11.5428 5.12404 11.666L4.40139 12.75H13.5986L12.876 11.666C12.7938 11.5428 12.75 11.3981 12.75 11.25V7.5C12.75 5.42893 11.0711 3.75 9 3.75Z",fill:"currentColor"})})},w=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,r.jsx)("path",{d:"M3.75 2.25C2.92157 2.25 2.25 2.92157 2.25 3.75V14.25C2.25 15.0784 2.92157 15.75 3.75 15.75H8.99927C8.99976 15.75 9.00024 15.75 9.00073 15.75H14.25C15.0784 15.75 15.75 15.0784 15.75 14.25V9.00073C15.75 9.00024 15.75 8.99976 15.75 8.99927V3.75C15.75 2.92157 15.0784 2.25 14.25 2.25H3.75ZM14.25 8.68934L8.68934 14.25H3.75V3.75H14.25V8.68934ZM10.8107 14.25L14.25 10.8107V14.25H10.8107Z",fill:"currentColor"})})},S=function(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:[(0,r.jsx)("path",{d:"M9 3C8.58579 3 8.25 3.33579 8.25 3.75C8.25 5.01919 6.71549 5.65481 5.81804 4.75735C5.52514 4.46446 5.05027 4.46446 4.75738 4.75735C4.46448 5.05025 4.46448 5.52512 4.75738 5.81801C5.65487 6.7155 5.01917 8.25 3.75 8.25C3.33579 8.25 3 8.58579 3 9C3 9.41421 3.33579 9.75 3.75 9.75C5.01927 9.75 5.65473 11.2846 4.75733 12.182C4.46444 12.4749 4.46444 12.9498 4.75733 13.2426C5.05022 13.5355 5.5251 13.5355 5.81799 13.2426C6.71543 12.3452 8.25 12.9807 8.25 14.25C8.25 14.6642 8.58579 15 9 15C9.41421 15 9.75 14.6642 9.75 14.25C9.75 12.9808 11.2845 12.3452 12.182 13.2426C12.4749 13.5355 12.9498 13.5355 13.2427 13.2426C13.5356 12.9497 13.5356 12.4749 13.2427 12.182C12.3452 11.2845 12.9808 9.75 14.25 9.75C14.6642 9.75 15 9.41421 15 9C15 8.58579 14.6642 8.25 14.25 8.25C12.9809 8.25 12.3451 6.71554 13.2426 5.81802C13.5355 5.52513 13.5355 5.05026 13.2426 4.75737C12.9497 4.46447 12.4748 4.46447 12.182 4.75736C11.2845 5.65484 9.75 5.01915 9.75 3.75C9.75 3.33579 9.41421 3 9 3ZM6.75612 3.58277C6.84168 2.41823 7.81361 1.5 9 1.5C10.1864 1.5 11.1583 2.41823 11.2439 3.58277C12.1278 2.81983 13.4644 2.8578 14.3033 3.6967C15.1422 4.53561 15.1802 5.87216 14.4172 6.75612C15.5818 6.84165 16.5 7.81359 16.5 9C16.5 10.1864 15.5818 11.1583 14.4172 11.2439C15.1802 12.1278 15.1422 13.4644 14.3033 14.3033C13.4644 15.1422 12.1278 15.1802 11.2439 14.4172C11.1583 15.5818 10.1864 16.5 9 16.5C7.81359 16.5 6.84166 15.5818 6.75612 14.4172C5.87216 15.1802 4.53559 15.1422 3.69667 14.3033C2.85776 13.4644 2.81979 12.1278 3.58277 11.2439C2.41822 11.1583 1.5 10.1864 1.5 9C1.5 7.81359 2.41825 6.84165 3.58282 6.75612C2.81984 5.87216 2.8578 4.5356 3.69672 3.69669C4.53562 2.85779 5.87216 2.81981 6.75612 3.58277Z",fill:"currentColor"}),(0,r.jsx)("path",{d:"M9 7.5C8.60217 7.5 8.22064 7.65804 7.93934 7.93934C7.65804 8.22064 7.5 8.60217 7.5 9C7.5 9.39783 7.65804 9.77936 7.93934 10.0607C8.22064 10.342 8.60217 10.5 9 10.5C9.39783 10.5 9.77936 10.342 10.0607 10.0607C10.342 9.77936 10.5 9.39783 10.5 9C10.5 8.60217 10.342 8.22064 10.0607 7.93934C9.77936 7.65804 9.39783 7.5 9 7.5ZM6.87868 6.87868C7.44129 6.31607 8.20435 6 9 6C9.79565 6 10.5587 6.31607 11.1213 6.87868C11.6839 7.44129 12 8.20435 12 9C12 9.79565 11.6839 10.5587 11.1213 11.1213C10.5587 11.6839 9.79565 12 9 12C8.20435 12 7.44129 11.6839 6.87868 11.1213C6.31607 10.5587 6 9.79565 6 9C6 8.20435 6.31607 7.44129 6.87868 6.87868Z",fill:"currentColor"})]})},k=function(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.25 15C8.25 14.5858 7.91421 14.25 7.5 14.25H3.75V3.75H7.5C7.91421 3.75 8.25 3.41421 8.25 3C8.25 2.58579 7.91421 2.25 7.5 2.25H3.75C2.92157 2.25 2.25 2.92157 2.25 3.75V14.25C2.25 15.0784 2.92157 15.75 3.75 15.75H7.5C7.91421 15.75 8.25 15.4142 8.25 15Z",fill:"currentColor"}),(0,r.jsx)("path",{d:"M16.2852 9.52541C16.3547 9.45465 16.4073 9.37354 16.4431 9.28709C16.4795 9.19931 16.4997 9.10312 16.5 9.00225L16.5 9L16.5 8.99775C16.4994 8.80656 16.4262 8.61554 16.2803 8.46967L13.2803 5.46967C12.9874 5.17678 12.5126 5.17678 12.2197 5.46967C11.9268 5.76256 11.9268 6.23744 12.2197 6.53033L13.9393 8.25H6.75C6.33579 8.25 6 8.58579 6 9C6 9.41421 6.33579 9.75 6.75 9.75H13.9393L12.2197 11.4697C11.9268 11.7626 11.9268 12.2374 12.2197 12.5303C12.5126 12.8232 12.9874 12.8232 13.2803 12.5303L16.2798 9.53086L16.2852 9.52541Z",fill:"currentColor"})]})},T=function(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"18",height:"18",x:"0",y:"0",viewBox:"0 0 512 512",class:"",children:(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{d:"m195.708 268.059-30-150.001A14.999 14.999 0 0 0 151 106h-30a14.999 14.999 0 0 0-14.708 12.058l-30 150c-1.625 8.124 3.644 16.026 11.767 17.65 8.123 1.625 16.026-3.644 17.65-11.767L115.297 226h41.406l9.588 47.942c1.625 8.127 9.531 13.392 17.65 11.767 8.123-1.625 13.392-9.527 11.767-17.65zM121.297 196l12-60h5.406l12 60h-29.406zM436 226h-45v-15c0-8.284-6.716-15-15-15s-15 6.716-15 15v15h-45c-8.284 0-15 6.716-15 15s6.716 15 15 15h3.63c8.547 27.612 21.415 48.806 35.575 65.79-11.525 10.542-23.187 19.187-33.575 27.497-6.469 5.175-7.518 14.614-2.342 21.083 5.178 6.472 14.618 7.515 21.083 2.342 10.446-8.357 22.967-17.644 35.629-29.264 12.671 11.628 25.215 20.932 35.629 29.264 6.469 5.176 15.909 4.126 21.083-2.342 5.175-6.469 4.126-15.909-2.342-21.083-10.361-8.291-22.038-16.945-33.575-27.497 14.16-16.984 27.028-38.178 35.575-65.79H436c8.284 0 15-6.716 15-15s-6.716-15-15-15zm-60 73.745c-9.575-12.02-18.189-26.367-24.683-43.845h49.365c-6.493 17.478-15.107 31.825-24.682 43.845z",fill:"currentColor",opacity:"1","data-original":"currentColor"}),(0,r.jsx)("path",{d:"M467 91H250.599l-6.43-51.582C241.36 16.946 222.164 0 199.517 0H45C20.187 0 0 20.187 0 45v331c0 24.813 20.187 45 45 45h126.483l6.348 51.582c2.804 22.427 22 39.418 44.653 39.418H467c24.813 0 45-20.187 45-45V136c0-24.813-20.187-45-45-45zM45 391c-8.271 0-15-6.729-15-15V45c0-8.271 6.729-15 15-15h154.517c7.549 0 13.948 5.648 14.883 13.134L257.764 391H45zm161.724 70.75L201.709 421h40.244l-35.229 40.75zM482 467c0 8.271-6.729 15-15 15H228.874l57.104-66.053a14.976 14.976 0 0 0 3.629-12.024L254.339 121H467c8.271 0 15 6.729 15 15v331z",fill:"currentColor",opacity:"1","data-original":"currentColor"})]})})},I=__webpack_require__(9230),C=__webpack_require__(3016),R=__webpack_require__(8660),A=(__webpack_require__.p,function(t){var n=t.open,i=t.setOpen,c=(0,g.F_)(v.I8),u=(0,o.Z)(c,1)[0],l=(0,e.useState)(0),d=(0,o.Z)(l,2),f=d[0],A=d[1],O=(0,e.useState)(0),N=(0,o.Z)(O,2),x=N[0],D=N[1],P=(0,I.$G)().t,L=(0,s.s0)(),M=window.location.pathname,U=window.localStorage.getItem("accessToken"),j=[{path:"/dashboard",name:"".concat(P("Sidebar.Dashboard")),icon:(0,r.jsx)(_,{})},{path:"/usermanagement",name:"".concat(P("Sidebar.UserManagement")),icon:(0,r.jsx)(E,{})},{path:"/pushnotification",name:"".concat(P("Sidebar.PushNotification")),icon:(0,r.jsx)(b,{})},{path:"/reply",name:"".concat(P("Sidebar.Reply")),icon:(0,r.jsx)(w,{})},{path:"/adminsetting",name:"".concat(P("Sidebar.AdminSetting")),icon:(0,r.jsx)(S,{})},{path:"/changeLanguage",name:"".concat(P("Sidebar.ChangeLanguage")),icon:(0,r.jsx)(T,{})}];(0,e.useEffect)((function(){if(u){var e=(0,m.IO)((0,m.hJ)(v.db,"chatroom/"+u.uid+"/chats")),t=(0,m.cf)(e,(function(e){var t=0,n=0;e.forEach((function(e){var r=e.data();r.web_call_count>0&&(t+=r.web_call_count),r.web_message_count>0&&(n+=r.web_message_count)})),A(t),D(n)}));return function(){return t}}}),[u]);return(0,r.jsx)("aside",{id:"default-sidebar",className:"fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full md:translate-x-0 ".concat(n&&" translate-x-0"),"aria-label":"Sidebar",children:(0,r.jsxs)("div",{className:"h-full px-3 py-4 overflow-y-auto bg-lightgray pt-[48px] pl-[24px] flex-col relative",children:[(0,r.jsx)("button",{className:"md:hidden block absolute top-1 right-1",onClick:function(){return i(!1)},children:(0,r.jsx)(y.$iT,{className:"text-2xl ml-3"})}),(0,r.jsx)("div",{children:(0,r.jsx)("img",{src:h,alt:"logo"})}),(0,r.jsxs)("ul",{className:"mt-10 font-medium flex flex-col gap-4",children:[j.map((function(e,t){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("li",{className:"".concat(M===e.path?"bg-white shadow-Shidbar":""," rounded-lg pl-4 py-1"),children:(0,r.jsxs)("div",{onClick:function(){return t=e.path,void(U?L(t):p.Am.error("Enter your details"));var t},className:"".concat(M===e.path?"text-darkBlack":"text-typography"," flex items-center p-2 px-0 rounded-lg cursor-pointer ").concat("Reply"==e.name&&"relative"),children:[e.icon,(0,r.jsx)("span",{className:"ml-3",children:e.name}),"Reply"==e.name&&(0,r.jsxs)("div",{className:"chat-notification-cont",style:{flexDirection:"row",top:"13px"},children:[f>0&&(0,r.jsxs)("span",{className:"alertCounts",children:[(0,r.jsx)("span",{className:"numbers",children:f}),(0,r.jsx)("img",{src:C,alt:"messages"})]}),x>0&&(0,r.jsxs)("span",{className:"alertCounts",children:[(0,r.jsx)("span",{className:"numbers",children:x}),(0,r.jsx)("img",{src:R,alt:"messages"})]})]})]})},e.index)})})),(0,r.jsx)("li",{className:"rounded-lg pl-4",children:(0,r.jsxs)("button",{className:"flex items-center p-2 px-0 rounded-lg text-typography",onClick:function(){localStorage.removeItem("accessToken"),L(a.v.Login)},children:[(0,r.jsx)(k,{}),(0,r.jsx)("span",{className:"ml-3",children:P("Sidebar.LogOut")})]})})]})]})})}),O=__webpack_require__(7710),N=__webpack_require__(9983);function x(e){return(0,N.w_)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"}}]})(e)}var D=function(t){t.open;var n=t.setOpen,i=window.location.pathname,a=(0,e.useState)(""),s=(0,o.Z)(a,2),c=s[0],u=s[1];return(0,e.useEffect)((function(){var e=(0,O.hR)(i);u(e)}),[i]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"md:pl-64 h-[62px] py-2 border-b border-bordercolor flex items-center relative",children:[(0,r.jsx)("button",{className:"md:hidden block",onClick:function(){return n(!0)},children:(0,r.jsx)(x,{className:"text-2xl ml-3"})}),(0,r.jsx)("p",{className:"text-black text-lg font-medium leading-6 ml-8",children:c})]})})},P=__webpack_require__(9954),L=function(t){var n=t.children,i=(0,e.useState)(!1),a=(0,o.Z)(i,2),s=a[0],c=a[1];return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)(P.Z,{}),(0,r.jsx)("div",{className:"fixed inset-y-0 z-50 flex flex-col",children:(0,r.jsx)(A,{open:s,setOpen:c})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(D,{open:s,setOpen:c}),(0,r.jsx)("main",{className:"h-[calc(100vh-62px)] md:w-[calc(100%-256px)] ml-auto",children:n})]})]})})},M=(0,e.lazy)((function(){return __webpack_require__.e(549).then(__webpack_require__.bind(__webpack_require__,2549))})),U=(0,e.lazy)((function(){return __webpack_require__.e(27).then(__webpack_require__.bind(__webpack_require__,8027))})),j=(0,e.lazy)((function(){return Promise.all([__webpack_require__.e(426),__webpack_require__.e(281)]).then(__webpack_require__.bind(__webpack_require__,5841))})),F=(0,e.lazy)((function(){return __webpack_require__.e(379).then(__webpack_require__.bind(__webpack_require__,3110))})),V=(0,e.lazy)((function(){return Promise.all([__webpack_require__.e(460),__webpack_require__.e(576)]).then(__webpack_require__.bind(__webpack_require__,6576))})),B=(0,e.lazy)((function(){return Promise.all([__webpack_require__.e(460),__webpack_require__.e(426),__webpack_require__.e(793)]).then(__webpack_require__.bind(__webpack_require__,3793))})),G=(0,e.lazy)((function(){return __webpack_require__.e(51).then(__webpack_require__.bind(__webpack_require__,2051))})),Z=[{path:a.v.Initial,component:M,isPrivateRoute:!0},{path:a.v.Login,component:M,isPrivateRoute:!0},{path:a.v.Dashboard,component:U,isPrivateRoute:!0},{path:a.v.Reply,component:j,isPrivateRoute:!0},{path:a.v.Usermanagement,component:V,isPrivateRoute:!0},{path:a.v.AdminSetting,component:F,isPrivateRoute:!0},{path:a.v.pushNotification,component:B,isPrivateRoute:!0},{path:a.v.notification,component:P.Z,isPrivateRoute:!0},{path:a.v.changeLanguage,component:G,isPrivateRoute:!0}];var q=function(){return(0,r.jsxs)(e.Suspense,{fallback:(0,r.jsx)(i,{}),children:[(0,r.jsxs)(l,{children:[(0,r.jsx)(s.Z5,{children:Z.filter((function(e){return!e.isPrivateRoute})).map((function(e,t){return(0,r.jsx)(s.AW,{path:e.path,element:(0,r.jsx)(e.component,{})},t)}))}),(0,r.jsx)(s.Z5,{children:Z.filter((function(e){return e.isPrivateRoute})).map((function(e,t){return(0,r.jsx)(s.AW,{path:e.path,element:(0,r.jsx)(L,{children:(0,r.jsx)(e.component,{})})},t)}))})]}),(0,r.jsx)(p.Ix,{position:"top-right",autoClose:5e3})]})},W=function(e){e&&e instanceof Function&&__webpack_require__.e(787).then(__webpack_require__.bind(__webpack_require__,787)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),a(e),o(e)}))};__webpack_require__(1778);n.createRoot(document.getElementById("root")).render((0,r.jsx)(e.StrictMode,{children:(0,r.jsx)(q,{})})),W()}()})();
//# sourceMappingURL=main.aa9a4576.js.map